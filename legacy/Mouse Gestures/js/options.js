/*!
 * ---------------------------------------------------------
 * Copyright(C) Microsoft Corporation. All rights reserved.
 * ---------------------------------------------------------
 */
(function(){(function(){typeof msBrowser!="undefined"?chrome=msBrowser:typeof browser!="undefined"&&(chrome=browser)})();var i={checkNewVersion:function(){telemetry.checkNewVersion(function(n){var i=JSON.parse(n),r=i.version,u=i.url,t;this.compareVersionNumber(r,telemetry.getCurrentVersion())>0&&(t=$("#upgradeConfirmModal"),t.modal("show"),$("#upgradeConfirmButtonId").click(function(){window.open(u,"_blank");t.modal("hide")}))}.bind(this))},compareVersionNumber:function(n,t){for(var r=n.split(".").map(Number),u=t.split(".").map(Number),i=0;i<4;i++)if(r[i]===u[i])continue;else return r[i]>u[i]?1:-1;return 0}},n={ALERT_DURATION:1e3,SETTING_DEFAULT:{enableMouseGesture:!0,enablePenGesture:!0,enableSendTelemetry:!0,gesturesMapping:{R:"Forward",RU:"OpenNewTab",RL:"NoMatch",RD:"RefreshCurrentTab",U:"ScrollUp",UR:"ScrollRight",UL:"ScrollLeft",UD:"ScrollToBottom",L:"Back",LR:"NoMatch",LU:"CloseAllTabs",LD:"StopLoading",D:"ScrollDown",DR:"CloseCurrentTab",DU:"ScrollToTop",DL:"CloseAllTabsExceptCurrent"}},initSettingUser:function(){this.setting_user=jQuery.extend(!0,{},this.SETTING_DEFAULT)},initElements:function(){this.enableMouseGestureCheckbox=$("#enableMouseGestureCheckboxId");this.enablePenGestureCheckbox=$("#enablePenGestureCheckboxId");this.enableSendTelemetryCheckbox=$("#enableSendTelemetryCheckboxId");this.appliedSettingAlert=$("#appliedSettingAlertId");this.appliedSettingAlertTitle=$("#appliedSettingAlertTextId");this.appliedSettingAlert.affix({offset:{top:this.appliedSettingAlert.offset().top}});this.appliedSettingAlert.hide()},initEventListener:function(){this.enableMouseGestureCheckbox.change(function(){chrome.storage.local.set({enableMouseGesture:$(this).prop("checked")})});this.enablePenGestureCheckbox.change(function(){chrome.storage.local.set({enablePenGesture:$(this).prop("checked")})});this.enableSendTelemetryCheckbox.change(function(){chrome.storage.local.set({enableSendTelemetry:$(this).prop("checked")})});var n=this;this.enableMouseGestureCheckbox.click(function(){n.setAlertText("applySettingAlertText");n.toggleAppliedSettingAlert(!0)});this.enablePenGestureCheckbox.click(function(){n.setAlertText("applySettingAlertText");n.toggleAppliedSettingAlert(!0)});this.enableSendTelemetryCheckbox.click(function(){n.setAlertText("applySettingAlertText");n.toggleAppliedSettingAlert(!0)});$("#resetConfirmButtonId").click(function(){n.initSettingUser();n.setElementState(n.setting_user);chrome.storage.local.set({enableMouseGesture:n.setting_user.enableMouseGesture,enablePenGesture:n.setting_user.enablePenGesture,enableSendTelemetry:n.setting_user.enableSendTelemetry,gesturesMapping:n.setting_user.gesturesMapping});n.setAlertText("resetSettingAlertText");n.toggleAppliedSettingAlert(!0)});$("#appliedSettingAlertButtonId").click(function(){n.toggleAppliedSettingAlert(!1)});$(".dropdown-menu li a").click(function(){var i=$(this).parents(".dropdown").find(".btn"),r=i.attr("id"),u=r.substring(13,r.length),t=$(this).data("i18n"),f=t!==i.children().first().data("i18n");f&&(n.setting_user.gesturesMapping[u]=t.substring(6,t.length),chrome.storage.local.set({gesturesMapping:n.setting_user.gesturesMapping}),n.setSingleDropdownListState(i,t),n.setAlertText("applySettingAlertText"),n.toggleAppliedSettingAlert(!0))})},initDropdownMenu:function(){var n=["Back","Forward","ScrollToTop","ScrollToBottom","ScrollLeft","ScrollRight","ScrollUp","ScrollDown","OpenNewTab","CloseCurrentTab","RefreshCurrentTab","CloseAllTabs","CloseAllTabsExceptCurrent","StopLoading","NoMatch"].reduce(function(n,t,i){return i===1&&(n='<li><a data-i18n="action'+n+'"><\/a><\/li>'),n+'<li><a data-i18n="action'+t+'"><\/a><\/li>'});$(".dropdown-menu").html(n)},setAlertText:function(n){var t=chrome.i18n.getMessage(n);this.appliedSettingAlertTitle.attr("data-i18n",n);this.appliedSettingAlertTitle.text(t)},toggleAppliedSettingAlert:function(n){this.appliedSettingAlert.stop(!0);n?this.appliedSettingAlert.show(this.ALERT_DURATION).hide(this.ALERT_DURATION):this.appliedSettingAlert.hide()},loadUserSetting:function(){chrome.storage.local.get(null,function(n){var i=Object.keys(n),r,t;if(i.length!==0)for(r in i)t=i[r],t in this.setting_user&&(this.setting_user[t]=n[t]);this.setElementState(this.setting_user)}.bind(this))},setElementState:function(n){this.setEnableMouseGestureCheckboxState(n.enableMouseGesture);this.setEnablePenGestureCheckboxState(n.enablePenGesture);this.setEnableSendTelemetryCheckboxState(n.enableSendTelemetry);this.setDropdownListState(n.gesturesMapping)},setEnableMouseGestureCheckboxState:function(n){this.enableMouseGestureCheckbox.prop("checked",n);this.enableMouseGestureCheckbox.change()},setEnablePenGestureCheckboxState:function(n){this.enablePenGestureCheckbox.prop("checked",n);this.enablePenGestureCheckbox.change()},setEnableSendTelemetryCheckboxState:function(n){this.enableSendTelemetryCheckbox.prop("checked",n);this.enableSendTelemetryCheckbox.change()},setDropdownListState:function(n){var t=this;$(".dropdown button").each(function(){var i=$(this).attr("id"),r=i.substring(13,i.length),u=n[r],f="action"+u;t.setSingleDropdownListState($(this),f)})},setSingleDropdownListState:function(n,t){n.html('<label data-i18n="'+t+'">'+chrome.i18n.getMessage(t)+"<\/label><span class='caret'><\/span>");var i=n.parents(".dropdown").find("li");i.each(function(){$($(this).find("a")[0]).data("i18n")===t?$(this).addClass("active"):$(this).removeClass("active")})}},t={MODAL_DURATION:2e3,initElements:function(){this.includeEmailCheckbox=$("#includeEmailCheckboxId");this.emailInput=$("#emailInput");this.feedbackSubmitButton=$("#feedbackSubmitButtonId");this.feedbackTabFeedbackKindRadioButtonGroup=$("input[name=feedbackTabFeedbackKind]");this.feedbackCommentTextarea=$("#feedbackComment");this.successSendFeedbackModal=$("#successSendFeedbackModal");this.failSendFeedbackModal=$("#failSendFeedbackModal");this.feedbackCommentTextarea.attr("placeholder",chrome.i18n.getMessage("feedbackTabFeedbackCommentTextAreaPlaceholder"));this.emailInput.attr("placeholder",chrome.i18n.getMessage("feedbackTabEmailInputPlaceholder"))},initEventListener:function(){var n=this;this.includeEmailCheckbox.change(function(){n.emailInput.prop("disabled",!$(this).prop("checked"))});this.feedbackSubmitButton.click(function(){n.changeFeedbackElementsState(!1);telemetry.getOrGenerateUserGuid(function(t){var i={UserId:t,FeedbackType:$("#feedbackKindSuggestionRadioButtonId").is(":checked")?"Suggestion":"Problem",EmailAddress:n.includeEmailCheckbox.prop("checked")?n.emailInput.val():null,Comment:n.feedbackCommentTextarea.val()},r=function(){n.successSendFeedbackModal.modal("show");setTimeout(function(){n.successSendFeedbackModal.modal("hide")},n.MODAL_DURATION);n.changeFeedbackElementsState(!0,!0)},u=function(){n.failSendFeedbackModal.modal("show");setTimeout(function(){n.failSendFeedbackModal.modal("hide")},n.MODAL_DURATION);n.changeFeedbackElementsState(!0,!1)};telemetry.sendFeedback(i,r,u)})})},changeFeedbackElementsState:function(n,t){this.feedbackTabFeedbackKindRadioButtonGroup.each(function(){$(this).prop("disabled",!n);t&&$(this).prop("checked",$(this).val()==="Suggestion")});this.feedbackCommentTextarea.prop("disabled",!n);t&&this.includeEmailCheckbox.prop("checked",!0);this.includeEmailCheckbox.prop("disabled",!n);this.emailInput.prop("disabled",!n);(n||t)&&(this.feedbackCommentTextarea.val(""),this.emailInput.val(""));this.feedbackSubmitButton.prop("disabled",!n)}},r={changeLogBase:{getChangeLogDivId:function(){return"changeLog"+this.versionNumber+"DivId"},getHtml:function(){for(var i='<a role="button" data-toggle="collapse" href="#'+this.getChangeLogDivId()+'" aria-expanded="false" aria-controls="'+this.getChangeLogDivId()+'">'+this.versionNumber.split("_").join(".")+"<\/a>",n='<div class="collapse" id="'+this.getChangeLogDivId()+'"><ul>',t=0;t<this.changeLogLinesNumber;t++)n+='<li><p data-i18n="changeLog_'+this.versionNumber+"_Line"+t+'"><\/p><\/li>';return n+="<\/ul><\/div>",i+n}},initChangeLogs:function(){var n=this;$("#changeLogParentDivId").html([{versionNumber:"0_2_16_8501",changeLogLinesNumber:2},{versionNumber:"0_1_16_10501",changeLogLinesNumber:2}].reduce(function(t,i,r,u){var f=Object.create(n.changeLogBase,{versionNumber:{value:u[r].versionNumber},changeLogLinesNumber:{value:u[r].changeLogLinesNumber}});return t+f.getHtml()},""))}},u={TAB_ID:["settingTabId","feedbackTabId","aboutTabId"],init:function(){this.initTabTransitionListener();n.initSettingUser();n.initDropdownMenu();r.initChangeLogs();this.initI18n();this.initFontFaceIfNeeded();n.initElements();t.initElements();n.initEventListener();t.initEventListener();n.loadUserSetting();i.checkNewVersion()},initI18n:function(){$("[data-i18n]").each(function(){var n=$(this).data("i18n");n&&$(this).html(chrome.i18n.getMessage(n))})},initFontFaceIfNeeded:function(){chrome.i18n.getUILanguage()==="zh-CN"&&$("head").append('<link rel="stylesheet" href="../webcore/stylesheets/font-localizations/microsoft-yahei-ui.css" />')},initTabTransitionListener:function(){var n=this;$("nav ul li a").click(function(t){for(var r=$(this).attr("data-tab"),i=0;i<n.TAB_ID.length;i++)r===n.TAB_ID[i]?$("#"+n.TAB_ID[i]).show():$("#"+n.TAB_ID[i]).hide();t.preventDefault()})}};window.addEventListener("load",function(){u.init()},!1)})()