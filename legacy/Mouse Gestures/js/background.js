/*!
 * ---------------------------------------------------------
 * Copyright(C) Microsoft Corporation. All rights reserved.
 * ---------------------------------------------------------
 */
(function(){var i={"Open New Tab":function(n,i){chrome.tabs.create({url:i.url?i.url:t})},"Close Current Tab":function(n){chrome.tabs.remove(n.tab.id)},"Close All Tabs":function(){chrome.tabs.query({currentWindow:!0},function(n){for(var t=0;t<n.length;t++)chrome.tabs.remove(n[t].id)})},"Close All Tabs Except Current":function(n){chrome.tabs.query({currentWindow:!0},function(t){for(var i=0;i<t.length;i++)t[i].id!==n.tab.id&&chrome.tabs.remove(t[i].id)})},"Send Daily Active State":function(){telemetry.getOrGenerateUserGuid(function(t){var r={UserId:t},i;telemetry.sendDailyActiveUserState(r);for(i in n)n[i]!==0&&(r[i]=n[i]);telemetry.sendGestureResult(r,function(){for(var t in n)n[t]=0;chrome.storage.local.set({actionRecords:n})})})},"Save Action Result":function(t,i){n[i.actionResult]++;chrome.storage.local.set({actionRecords:n})}},n={Forward:0,OpenNewTab:0,RefreshCurrentTab:0,ScrollUp:0,ScrollRight:0,ScrollLeft:0,ScrollToTop:0,Back:0,CloseAllTabs:0,StopLoading:0,ScrollDown:0,CloseCurrentTab:0,ScrollToBottom:0,CloseAllTabsExceptCurrent:0,OpenLinkInNewTab:0,NoMatch:0},t="about:blank",r=function(){typeof msBrowser!="undefined"?(chrome=msBrowser,t="about:tabs"):typeof browser!="undefined"?(chrome=browser,t="about:tabs"):t="chrome://newtab"},u=function(){chrome.browserAction.onClicked.addListener(function(){chrome.tabs.create({url:chrome.runtime.getURL("../html/options.html")})})},f=function(){chrome.runtime.onMessage.addListener(function(n,t,r){i[n.action](t,n,r)})},e=function(){chrome.storage.onChanged.addListener(function(n){chrome.storage.local.get("enableSendTelemetry",function(t){var e=t.enableSendTelemetry,r,i,u,f;if(e)for(r in n)if(i=n[r],typeof i.oldValue!="undefined")if(r==="gesturesMapping"){if(i.oldValue&&(u=Object.keys(i.oldValue),u.length!==0))for(f in u)(function(n){var t=i.oldValue[n],r=i.newValue[n];t!==r&&telemetry.getOrGenerateUserGuid(function(i){var u={Name:n,UserId:i,OldValue:t,NewValue:r};telemetry.sendSetting(u)})})(u[f])}else(r==="enableMouseGesture"||r==="enableSendTelemetry"||r==="enablePenGesture")&&telemetry.getOrGenerateUserGuid(function(n){var t={Name:r,UserId:n,OldValue:i.oldValue,NewValue:i.newValue};telemetry.sendSetting(t)})})})},o=function(){chrome.storage.local.get("actionRecords",function(t){var i=t.actionRecords;i&&(n=i)})},s=function(){chrome.runtime.onInstalled.addListener(function(n){n.reason==="install"?chrome.tabs.create({url:chrome.runtime.getURL("../html/ftu.html#welcome")}):n.reason==="update"})};r();u();f();e();o();s()})()