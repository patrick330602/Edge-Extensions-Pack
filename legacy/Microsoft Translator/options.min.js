;var Microsoft;(function(a){var b;(function(a){function b(a){if(a===undefined||a===null)a=document.body.parentElement;if(!(a instanceof HTMLElement))return;var b=a.querySelectorAll("[data-localize]");for(var c=0;c<b.length;c++){var d=b[c].getAttribute("data-localize-substitutions"),e=undefined;d&&(e=d.split(",")),b[c].innerHTML=chrome.i18n.getMessage(b[c].getAttribute("data-localize"),e)}}"use strict",a.localize=b,b()})(b=a.JS||(a.JS={}))})(Microsoft||(Microsoft={}))
;function typeOf(a){var b=typeof a;return b==="object"&&(a?Object.prototype.toString.call(a)=="[object Array]"&&(b="array"):b="null"),b}String.isNullOrWhiteSpace=String.isNullOrWhiteSpace||function(a){return a===undefined||a===null||typeof a!="string"||a.trim().length===0},String.htmlEscape=String.htmlEscape||function(a){if(!a)return"";var b=document.createElement("span");return b.innerText=a,b.innerHTML};var Logger=function(){return"use strict",{info:function(){var a=[];for(var b=0;b<arguments.length;b++)a[b-0]=arguments[b];console&&typeOf(console.info)==="function"&&Microsoft.JS.config.logLevel&Microsoft.JS.LogLevel.Info&&console.info.apply(console,a)},warning:function(){var a=[];for(var b=0;b<arguments.length;b++)a[b-0]=arguments[b];console&&typeOf(console.warn)==="function"&&Microsoft.JS.config.logLevel&Microsoft.JS.LogLevel.Warning&&console.warn.apply(console,a)},error:function(){var a=[];for(var b=0;b<arguments.length;b++)a[b-0]=arguments[b];console&&typeOf(console.error)==="function"&&Microsoft.JS.config.logLevel&Microsoft.JS.LogLevel.Error&&console.error.apply(console,a)},assert:function(a){var b=[];for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];console&&typeOf(console.assert)==="function"&&Microsoft.JS.config.logLevel&Microsoft.JS.LogLevel.Debug&&(b.unshift(a),console.assert.apply(console,b))},debug:function(){var a=[];for(var b=0;b<arguments.length;b++)a[b-0]=arguments[b];typeOf(console.debug)==="function"&&Microsoft.JS.config.logLevel&Microsoft.JS.LogLevel.Debug&&console.debug.apply(console,a)}}}(),Microsoft;(function(a){var b;(function(b){function d(a){switch(typeOf(a)){case"object":return JSON.stringify(a);case"null":return"null";case"undefined":return"undefined";case"array":return JSON.stringify(a);default:return a.toString()}}function h(a){var b="",c=0;if(a)for(var d in a)a.hasOwnProperty(d)&&(c++&&(b+="&"),b+=encodeURIComponent(d),a[d]!=null&&(b+="="+encodeURIComponent(a[d])));return b}function i(a,b,c,d){if(d.query){var e=h(d.query);e.length>0&&(b+=(b.indexOf("?")<0?"?":"&")+e)}typeOf(d.timeoutInMs)==="number"&&(a.timeout=d.timeoutInMs),a.open(f[c],b,!0);if(d.headers)for(var g in d.headers)d.headers.hasOwnProperty(g)&&a.setRequestHeader(g,d.headers[g]);d.contentType&&a.setRequestHeader("Content-Type",d.contentType)}function j(a,b,c){c=c||{};if(a==null||b==null)return Promise.reject(new g("HTTP method or URL are not set"));if(c.timeoutInMs!=null&&c.timeoutInMs<0)return Promise.reject(new g("Cannot have a negative timeout. Set to 0 to have no timeout"));var d=new Promise(function(d,e){var h=new XMLHttpRequest;i(h,b,a,c);var j=null;a!=f.GET&&a!=f.HEAD&&(j=c.body),h.send(j),h.onload=function(){if(h.status>=200&&h.status<300){var a=h.response;if(c.parser)try{a=c.parser(h)}catch(b){e(b);return}d(a)}else e(new g(h.statusText,h.status,h))},h.onerror=function(){var a=h.statusText||"Failed to send the request";e(new g(a,h.status,h))},h.ontimeout=function(){e(new g("Timed out",-1,h))},c.token&&c.token.addListener&&c.token.addListener(h.abort.bind(h))});return d}function k(a,b){return Logger.debug("Injecting '"+b+"' into tab "+a),new Promise(function(c,d){chrome.tabs.executeScript(a,{code:b},function(a){chrome.runtime.lastError?d(chrome.runtime.lastError):c(a)})})}function l(a,b){return Logger.debug("Injecting '"+b+"' into tab "+a),new Promise(function(c,d){chrome.tabs.executeScript(a,{file:b},function(a){chrome.runtime.lastError?d(chrome.runtime.lastError):c(a)})})}function m(b,c,d){var e=0,f=a.JS.config.scriptsToInject,g=function(a,b,c){return l(b,c)},h=k(b,'window.fromLang="'+c+'";window.toLang="'+d+'";');for(var e=0;e<f.length;e++)h=h.then(g.bind(null,null,b,f[e]));return h.catch(function(a){throw Logger.error("Failed to inject one or more of the scripts into the page",a),a})}function n(a){return k(a,"window.location.reload();")}"use strict",function(a){a[a.Off=0]="Off",a[a.Error=1]="Error",a[a.Warning=2]="Warning",a[a.Info=4]="Info",a[a.Debug=8]="Debug",a[a.Assert=16]="Assert",a[a.All=4294967295]="All"}(b.LogLevel||(b.LogLevel={}));var c=b.LogLevel;b.serialize=d;var e=function(){function a(a){var b=this;this._listeners=[],this._canceled=!1,typeof a=="number"&&a>0&&setTimeout(function(){b.cancel()},a)}return Object.defineProperty(a.prototype,"isCanceled",{get:function(){return this._canceled},enumerable:!0,configurable:!0}),a.prototype.throwIfCanceled=function(){if(this._canceled===!0)throw new Error("Operation was canceled")},a.prototype.addListener=function(a){if(typeOf(a)!=="function")return;this._listeners.push(a),this._canceled&&setTimeout(a,0)},a.prototype.cancel=function(){if(this._canceled===!0)return;this._canceled=!0;for(var a=0;a<this._listeners.length;a++)try{this._listeners[a]()}catch(b){Logger.warning("Failed during cancellation callback",b)}},a}();b.CancellationTokenSource=e,function(a){a[a.GET=0]="GET",a[a.POST=1]="POST",a[a.HEAD=2]="HEAD",a[a.PUT=3]="PUT",a[a.DELETE=4]="DELETE"}(b.HttpMethod||(b.HttpMethod={}));var f=b.HttpMethod,g=function(){function a(a,b,c){b===void 0&&(b=0),c===void 0&&(c=null),this.message=a,this.status=b,this.details=c}return Object.defineProperty(a.prototype,"isBadRequest",{get:function(){return this.status!=null&&this.status>=400&&this.status<500},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isServerError",{get:function(){return this.status!=null&&this.status>=500&&this.status<600},enumerable:!0,configurable:!0}),a}();b.HttpError=g,b.toQueryString=h,b.AjaxPromise=j,b.injectScript=l,b.injectTranslatorScripts=m,b.injectDisableTranslatorScripts=n})(b=a.JS||(a.JS={}))})(Microsoft||(Microsoft={}))
;function getUiTextLang(){return Microsoft.JS.TextLanguage.normalizeCode(window.navigator.language)||"en"}var Microsoft;(function(a){var b;(function(a){function d(b,c){var d;try{d=JSON.parse(b.responseText)}catch(e){throw new a.HttpError(b.responseText)}if(typeOf(d)!==c)throw new a.HttpError(a.serialize(d));return d}"use strict";var b={ar:!0,he:!0,fa:!0,ur:!0},c=function(){function a(b,c){this.name=c,this.code=a.normalizeCode(b)}return Object.defineProperty(a.prototype,"isRtl",{get:function(){return this.code&&b.hasOwnProperty(this.code)},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return this.code+": "+this.name},a.isRtl=function(c){return c=a.normalizeCode(c),c&&b.hasOwnProperty(c.toLowerCase())},a.equals=function(a,b){return a!=null&&b!=null&&a.code===b.code},a.normalizeCode=function(a){var b="",c="",d="";if(typeOf(a)==="string"){var e=a.split("-");b=e[0].toLowerCase();for(var f=1;f<e.length&&!d&&!c;f++)e[f].length===2?(c=e[f].toUpperCase(),b==="zh"&&c==="CN"?d="Hans":b=="zh"&&c==="TW"&&(d="Hant")):e[f].length===3&&!c?e[f].toUpperCase()==="CHS"?d="Hans":e[f]==="CHT"&&(d="Hant"):e[f].length===4&&!c&&(d=e[f][0].toUpperCase()+e[f].substring(1).toLowerCase())}b==="nb"&&(b="no");var g=b;return d&&(g+="-"+d),g},a}();a.TextLanguage=c;var e="text_lang_last_sync",f="text_langs_"+getUiTextLang(),g=function(){function b(b,c,d){this._baseUrl=b,this._storage=d;if(b==null||b.length===0)throw new Error("The application ID cannot be null or empty");if(c==null||c.length===0)throw new Error("The application ID cannot be null or empty");this._baseQuery="";var e=b.indexOf("?");e>=0&&(this._baseUrl=b.substring(0,e),this._baseQuery=b.substring(e)),this._baseUrl.charAt(this._baseUrl.length-1)!=="/"&&(this._baseUrl+="/");var f=a.toQueryString({appId:c});this._baseQuery+=(this._baseQuery.length===0?"?":"&")+f}return b.prototype._getCachedTextLanguagesAsync=function(){var b=this;return new Promise(function(c,d){try{b._storage.get([e,f],function(b){if(chrome.runtime.lastError){d(chrome.runtime.lastError);return}if(Date.now()-b[e]>a.config.languageCacheDurationMs){d("The cached text languages have expired");return}typeOf(b[f])!=="array"?d("The cached text languages were not an array"):c(b[f])})}catch(g){d(g)}})},b.prototype.getTextLanguagesAsync=function(b,d){var g=this,h;return b===!0?h=Promise.reject("Forcing an update"):h=this._getCachedTextLanguagesAsync(),h.catch(function(b){Logger.info("Need to retrieve updated text languages",b);var h=[];return g.getTextLanguageCodesAsync(d).then(function(a){return h=a,g.getLanguageNamesAsync(a,d)}).then(function(b){if(b.length!==h.length)return Promise.reject(new a.HttpError("Wrong number of language names returned"));var d=[];for(var i=0;i<b.length;i++)d.push(new c(h[i],b[i]));Logger.debug("Retrieved the following text languages:",d);var j={};return j[e]=Date.now(),j[f]=d,g._storage.set(j,function(){chrome.runtime.lastError&&Logger.error("Failed to store the cached languages.",chrome.runtime.lastError)}),d})})},b.prototype.getTextLanguageCodesAsync=function(b){return a.AjaxPromise(a.HttpMethod.GET,this._baseUrl+"GetLanguagesForTranslate"+this._baseQuery,{contentType:"application/x-www-form-urlencoded",parser:function(a){return d(a,"array")},token:b})},b.prototype.getLanguageNamesAsync=function(b,c){return a.AjaxPromise(a.HttpMethod.GET,this._baseUrl+"GetLanguageNames"+this._baseQuery,{query:{locale:getUiTextLang(),languageCodes:JSON.stringify(b)},contentType:"application/x-www-form-urlencoded",parser:function(a){return d(a,"array")},token:c})},b.prototype.translateAsync=function(b,c,e,f,g,h){if(c==null||c.length===0)return Promise.reject(new a.HttpError("toLang cannot be null or empty"));if(e==null)return Promise.reject(new a.HttpError("Must specify an array of text items to translate"));var i={from:b||"",to:c,texts:JSON.stringify(e)};return f&&(i.options=JSON.stringify(f)),a.AjaxPromise(a.HttpMethod.GET,this._baseUrl+"TranslateArray"+this._baseQuery,{query:i,contentType:"application/x-www-form-urlencoded",timeoutInMs:g,parser:function(a){return d(a,"array")},token:h})},b.TEXT_CONTENT="text/plain",b.XML_CONTENT="text/xml",b.HTML_CONTENT="text/html",b}();a.AjaxTranslatorClientV2=g})(b=a.JS||(a.JS={}))})(Microsoft||(Microsoft={}))
;var Microsoft;(function(a){var b;(function(a){var b="999999998DF84F8327FA426EB589A528730CB6B7",c="https://api.microsofttranslator.com/V2/Ajax.svc";a.config={logLevel:a.LogLevel.Error,debug:!1,languageCacheDurationMs:864e5,translatorClient:new a.AjaxTranslatorClientV2(c,b,chrome.storage.local),scriptsToInject:["injectedscript.min.js"]}})(b=a.JS||(a.JS={}))})(Microsoft||(Microsoft={}))
;function onClickListeners(){var a=document.getElementsByClassName("languageCheckbox"),b=document.getElementById("selectall");for(var c=0;c<a.length;c++)a[c].onclick=function d(){if(this.id==="selectall")for(var c=0;c<a.length;c++)a[c].checked=this.checked;else if(this.checked===!1)b.checked=!1;else if(this.checked===!0){var d=Array.prototype.some.call(a,function(a,b){return b>0&&a.checked===!1});b.checked=d===!1}saveAll()};document.getElementById("alwaysTranslate").onclick=function(){saveAll()}}function saveAll(){var a=document.getElementById("languages"),b=document.getElementById("alwaysTranslate"),c=document.getElementsByClassName("languageCheckbox"),d=a.value,e=b.checked,f={};for(var g=0;g<c.length;g++){var h=c[g].value,i=c[g].checked;f[h]=!i}chrome.storage.local.set({translateTo:d,alwaysTranslate:e,languagesValue:f},function(){chrome.runtime.lastError&&Logger.error("Failed to save the selected options to storage",chrome.runtime.lastError)})}function getLanguages(a){Microsoft.JS.config.translatorClient.getTextLanguagesAsync(a===!0).then(updateUi).catch(function(a){Logger.error("Failed to retrieve the latest languages from the service",a);var b=document.getElementsByClassName("error")[0];b.innerText="";var c=document.createElement("div");return c.innerText="Failed to retrieve the latest languages from the service.",b.appendChild(c),a&&!String.isNullOrWhiteSpace(a.message)&&(c=document.createElement("div"),c.innerText=a.message,c.className="small",b.appendChild(c)),b.style.display="inline-block",Microsoft.JS.config.translatorClient.getTextLanguagesAsync(!1).then(updateUi)})}function updateUi(a){addLangDropdown(a),addLangSelector(a),addAlwaysTranslate()}function addLangDropdown(a){var b=document.getElementById("languages");for(var c=0;c<a.length;c++){var d=document.createElement("option");d.text=a[c].name,d.value=a[c].code,a[c].code===translateTo?b.add(d,0):b.add(d)}b.selectedIndex=0,b.onchange=saveAll}function addAlwaysTranslate(){var a=document.getElementById("alwaysTranslate");a.checked=alwaysTranslate}function addLangSelector(a){var b=document.getElementById("langtable"),c=4,d=Math.ceil((a.length+1)/c);for(var e=0;e<d;e++){var f=langtable.insertRow(e);f.id=e}var g=-1;for(var h=0;h<c;h++)for(var i=0;i<d;i++)if(g<a.length){var j=document.getElementById(i),k=j.insertCell(h),l=document.createElement("input"),m,n;g===-1?(m=chrome.i18n.getMessage("selectAll"),n="selectall",l.style.display="none",i--):(m=a[g].name,n=a[g].code),l.type="checkbox",l.className="languageCheckbox",l.id=n,l.name="langsToTranslate",l.value=n,typeof languagesValue[n]=="undefined"?l.checked=!1:l.checked=!languagesValue[n];var o=document.createElement("label");o.htmlFor=n,o.appendChild(document.createElement("span"));var p=document.createElement("div");p.className="languagetext",p.innerText=m,o.appendChild(p),k.appendChild(l),k.appendChild(o),g++}onClickListeners()}function getSettings(){chrome.storage.local.get(["translateTo","alwaysTranslate","languagesValue"],function(a){a.translateTo!=null&&(translateTo=a.translateTo),a.alwaysTranslate!=null&&(alwaysTranslate=a.alwaysTranslate),a.languagesValue!=null&&(languagesValue=a.languagesValue)})}var translateTo=getUiTextLang(),alwaysTranslate=!1,languagesValue={};getSettings(),getLanguages(!0)
