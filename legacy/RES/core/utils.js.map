{"version":3,"sources":["core/utils.js"],"names":[],"mappings":"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","file":"core/utils.js","sourcesContent":["/* exported RESUtils, escapeHTML, modules, addModule, libraries, addLibrary, safeJSON, perfTest */\r\nvar modules = {};\r\nvar addModule = function(moduleID, extend) {\r\n\tvar base = {\r\n\t\tmoduleID: moduleID,\r\n\t\tmoduleName: moduleID,\r\n\t\tcategory: 'General',\r\n\t\toptions: {},\r\n\t\tdescription: '',\r\n\t\tisEnabled: function() {\r\n\t\t\treturn RESUtils.options.getModulePrefs(this.moduleID);\r\n\t\t},\r\n\t\tisMatchURL: function() {\r\n\t\t\treturn RESUtils.isMatchURL(this.moduleID);\r\n\t\t},\r\n\t\tinclude: [\r\n\t\t\t'all'\r\n\t\t],\r\n\t\texclude: [],\r\n\t\tloadDependencies: function() { },\r\n\t\tloadDynamicOptions: function() { },\r\n\t\tbeforeLoad: function() { },\r\n\t\tgo: function() { },\r\n\t\taddOptionsBodyClasses: function() {\r\n\t\t\t// Adds body classes for enabled options that have `bodyClass: true`\r\n\t\t\t// In the form `res-moduleId-optionKey` for boolean options\r\n\t\t\t// and `res-moduleId-optionKey-optionValue` for enum options\r\n\t\t\t// spaces in enum option values will be replaced with underscores\r\n\t\t\tif (!(this.isEnabled() && this.isMatchURL())) return;\r\n\r\n\t\t\t$.each(this.options, (optId, opt) => {\r\n\t\t\t\tif (!(opt.bodyClass && opt.value)) return;\r\n\r\n\t\t\t\tif (!['enum', 'boolean'].includes(opt.type)) {\r\n\t\t\t\t\tthrow new Error(`modules['${this.moduleID}'].options['${optId}'] - only enum and boolean options may generate body classes`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet cls = typeof opt.bodyClass === 'string' ? opt.bodyClass : `res-${this.moduleID}-${optId}`;\r\n\r\n\t\t\t\tif (opt.type === 'enum') {\r\n\t\t\t\t\tcls += `-${opt.value.replace(/\\s/g, '_')}`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tRESUtils.bodyClasses.add(cls);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tvar module = extend.call(base, base, moduleID);\r\n\tmodule = $.extend(true, base, module);\r\n\tmodules[moduleID] = module;\r\n\treturn module;\r\n};\r\n\r\nvar libraries = {};\r\nvar addLibrary = function(libraryID, moduleID, library) {\r\n\tif (typeof moduleID !== 'string') {\r\n\t\tlibrary = moduleID;\r\n\t\tmoduleID = undefined;\r\n\t}\r\n\r\n\tif (libraryID && moduleID) {\r\n\t\tlibraries[libraryID] = libraries[libraryID] || {};\r\n\t\tlibraries[libraryID][moduleID] = library;\r\n\t} else if (libraryID) {\r\n\t\tlibraries[libraryID] = library;\r\n\t}\r\n};\r\n\r\n// DOM utility functions\r\nvar escapeLookups = {\r\n\t'&': '&amp;',\r\n\t'\"': '&quot;',\r\n\t'<': '&lt;',\r\n\t'>': '&gt;'\r\n};\r\n\r\nfunction escapeHTML(str) {\r\n\treturn (str === undefined || str === null) ?\r\n\t\tnull :\r\n\t\tstr.toString().replace(/[&\"<>]/g, function(m) {\r\n\t\t\treturn escapeLookups[m];\r\n\t\t});\r\n}\r\n\r\nvar safeJSON = {\r\n\t// Safely parses JSON and won't kill the whole script if JSON.parse fails\r\n\t// If localStorageSource is specified, will offer the user the ability to delete that localStorageSource to stop further errors.\r\n\t// If silent is specified, it will fail silently...\r\n\tparse: function(data, localStorageSource, silent) {\r\n\t\ttry {\r\n\t\t\tdata = RESEnvironment.sanitizeJSON(data);\r\n\t\t\treturn JSON.parse(data);\r\n\t\t} catch (error) {\r\n\t\t\tif (silent) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\tconsole.error('Could not parse JSON data', error);\r\n\t\t\tif (localStorageSource) {\r\n\t\t\t\tvar msg = 'Error caught: JSON parse failure on the following data from \"' + localStorageSource + '\": <textarea rows=\"5\" cols=\"50\">' + data + '</textarea><br>RES can delete this data to stop errors from happening, but you might want to copy/paste it to a text file so you can more easily re-enter any lost information.';\r\n\t\t\t\talert(msg, function() {\r\n\t\t\t\t\t// Back up a copy of the corrupt data\r\n\t\t\t\t\tlocalStorage.setItem(localStorageSource + '.error', data);\r\n\t\t\t\t\t// Delete the corrupt data\r\n\t\t\t\t\tRESStorage.removeItem(localStorageSource);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\talert('Error caught: JSON parse failure on the following data: ' + data);\r\n\t\t\t}\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar lastPerf = 0;\r\nfunction perfTest(name) {\r\n\tvar now = Date.now();\r\n\tvar diff = now - lastPerf;\r\n\tconsole.log(name + ' executed. Diff since last: ' + diff + 'ms');\r\n\tlastPerf = now;\r\n}\r\n\r\n(function($) {\r\n\t$.fn.safeHtml = function(string) {\r\n\t\tif (!string) return '';\r\n\t\telse return $(this).html(RESUtils.sanitizeHTML(string));\r\n\t};\r\n})(\ttypeof $ !== 'undefined' && $.fn ? $ :\r\n\ttypeof jQuery !== 'undefined' ? jQuery :\r\n\t{} /* silently fail if jQuery not defined */);\r\n\r\n// define common RESUtils - reddit related functions and data that may need to be accessed...\r\nvar RESUtils = RESUtils || {};\r\n// set up arrays for html tag classes and body tag classes to be added as early\r\n// as possible and all at once to avoid excess screen repaints\r\n(function(exports) {\r\n\tvar classes = [];\r\n\r\n\tfunction init() {\r\n\t\tif (!classes.length) {\r\n\t\t\tclasses = [ 'res', 'res-v430' ];\r\n\t\t}\r\n\r\n\t\taddVersionClasses();\r\n\t}\r\n\r\n\tvar _addVersionClasses = false;\r\n\tfunction addVersionClasses() {\r\n\t\tif (!RESMetadata.version) return;\r\n\t\tif (_addVersionClasses) return;\r\n\t\t_addVersionClasses = true;\r\n\t\tvar versionComponents = RESMetadata.version.split('.');\r\n\t\tfor (var i = 0, length = versionComponents.length; i < length; i++) {\r\n\t\t\tclasses.push('res-v' + (versionComponents.slice(0, i + 1).join('-')));\r\n\t\t}\r\n\t}\r\n\r\n\tvar add = function() {\r\n\t\tinit();\r\n\r\n\t\tclasses = Array.prototype.slice.call(arguments).reduce(function(a, b) {\r\n\t\t\treturn a.concat(b);\r\n\t\t}, classes);\r\n\r\n\r\n\t\tif (classes.length) {\r\n\t\t\tif (document.html) {\r\n\t\t\t\tdocument.html.classList.add.apply(document.html.classList, classes);\r\n\t\t\t}\r\n\t\t\tif (document.body) {\r\n\t\t\t\tdocument.body.classList.add.apply(document.body.classList, classes);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar remove = function(classes) {\r\n\t\tclasses = Array.prototype.slice.call(arguments)\r\n\t\t\t.reduce(function(a, b) {\r\n\t\t\t\treturn a.concat(b);\r\n\t\t\t}, []);\r\n\r\n\t\tif (classes.length) {\r\n\t\t\tif (document.html) {\r\n\t\t\t\tdocument.html.classList.remove.apply(document.html.classList, classes);\r\n\t\t\t}\r\n\t\t\tif (document.body) {\r\n\t\t\t\tdocument.body.classList.remove.apply(document.body.classList, classes);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\texports.init = init;\r\n\texports.add = add;\r\n\texports.remove = remove;\r\n})(RESUtils.bodyClasses = RESUtils.bodyClasses || {});\r\n\r\n// A cache variable to store CSS that will be applied at the end of execution...\r\nRESUtils.randomHash = function(len) {\r\n\tvar chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\n\tvar numChars = len || 5;\r\n\tvar randomString = '';\r\n\tfor (var i = 0; i < numChars; i++) {\r\n\t\tvar rnum = Math.floor(Math.random() * chars.length);\r\n\t\trandomString += chars.substring(rnum, rnum + 1);\r\n\t}\r\n\treturn randomString;\r\n};\r\nRESUtils.hashCode = function(str) {\r\n\tvar hash = 0,\r\n\t\ti, len, char;\r\n\tif (str.length === 0) return hash;\r\n\tfor (i = 0, len = str.length; i < len; i++) {\r\n\t\tchar = str.charCodeAt(i);\r\n\t\thash = ((hash << 5) - hash) + char;\r\n\t\thash |= 0; // Convert to 32bit integer\r\n\t}\r\n\treturn hash;\r\n};\r\nRESUtils.addCSS = function(css) {\r\n\tvar style = RESUtils.addStyle(css);\r\n\treturn {\r\n\t\tremove: function() {\r\n\t\t\tstyle.textContent = '';\r\n\t\t\tif (style.parentNode) {\r\n\t\t\t\tstyle.parentNode.removeChild(style);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\nRESUtils.insertParam = function(href, key, value) {\r\n\tvar pre = '&';\r\n\tif (href.indexOf('?') === -1) pre = '?';\r\n\treturn href + pre + key + '=' + value;\r\n};\r\n// checks if script should run on current URL using exclude / include.\r\nRESUtils.isMatchURL = function(moduleID) {\r\n\t// stop if not on reddit\r\n\tif (!RESUtils.isReddit()) {\r\n\t\treturn false;\r\n\t}\r\n\tvar module = modules[moduleID];\r\n\tif (!module) {\r\n\t\tconsole.warn('isMatchURL could not find module', moduleID);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar exclude = module.exclude,\r\n\t\tinclude = module.include;\r\n\treturn RESUtils.matchesPageLocation(include, exclude);\r\n};\r\n\r\nRESUtils.matchesPageLocation = function(includes, excludes) {\r\n\tincludes = typeof includes === 'undefined' ? [] : [].concat(includes);\r\n\texcludes = typeof excludes === 'undefined' ? [] : [].concat(excludes);\r\n\r\n\tvar excludesPageType = excludes.length && (RESUtils.isPageType.apply(RESUtils, excludes) || RESUtils.matchesPageRegex.apply(RESUtils, excludes));\r\n\tif (!excludesPageType) {\r\n\t\tvar includesPageType = !includes.length || RESUtils.isPageType.apply(RESUtils, includes) || RESUtils.matchesPageRegex.apply(RESUtils, includes);\r\n\t\treturn includesPageType;\r\n\t}\r\n};\r\n\r\nRESUtils.getUrlParams = function(url) {\r\n\tvar result = {},\r\n\t\tre = /([^&=]+)=([^&]*)/g,\r\n\t\tm, queryString;\r\n\tif (url) {\r\n\t\tvar fullUrlRe = /\\?((?:[^&=]+=[^&]*?&?)+)(?:#[^&]*)?$/;\r\n\t\tvar groups = fullUrlRe.exec(url);\r\n\t\tif (groups) {\r\n\t\t\tqueryString = groups[1];\r\n\t\t} else {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t} else {\r\n\t\tqueryString = location.search.substr(1);\r\n\t}\r\n\twhile ((m = re.exec(queryString))) {\r\n\t\tresult[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);\r\n\t}\r\n\treturn result;\r\n};\r\n\r\nRESUtils.click = function(obj, button) {\r\n\tvar evt = document.createEvent('MouseEvents');\r\n\tbutton = button || 0;\r\n\tevt.initMouseEvent('click', true, true, window.wrappedJSObject, 0, 1, 1, 1, 1, false, false, false, false, button, null);\r\n\tobj.dispatchEvent(evt);\r\n};\r\nRESUtils.mousedown = function(obj, button) {\r\n\tvar evt = document.createEvent('MouseEvents');\r\n\tbutton = button || 0;\r\n\tevt.initMouseEvent('mousedown', true, true, window.wrappedJSObject, 0, 1, 1, 1, 1, false, false, false, false, button, null);\r\n\tobj.dispatchEvent(evt);\r\n};\r\nRESUtils.loggedInUser = function(tryingEarly) {\r\n\tif (typeof this.loggedInUserCached === 'undefined') {\r\n\t\tvar userLink = document.querySelector('#header-bottom-right > span.user > a');\r\n\t\tif ((userLink !== null) && (!userLink.classList.contains('login-required'))) {\r\n\t\t\tthis.loggedInUserCached = userLink.textContent;\r\n\t\t\t// HERE BE DRAGONS\r\n\t\t\t// this.verifyHash(this.loggedInUserCached);\r\n\t\t\tthis.loggedInUserHashCached = document.querySelector('[name=uh]').value;\r\n\t\t} else {\r\n\t\t\tif (tryingEarly) {\r\n\t\t\t\t// trying early means we're trying before DOM load may be complete, so if we fail here\r\n\t\t\t\t// we don't want to null this, we want to allow another try.\r\n\t\t\t\t// currently the only place this is really used is username hider, which tries (if possible)\r\n\t\t\t\t// to hide the username as early/fast as possible.\r\n\t\t\t\tdelete this.loggedInUserCached;\r\n\t\t\t\tdelete this.loggedInUserHashCached;\r\n\t\t\t} else {\r\n\t\t\t\tthis.loggedInUserCached = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn this.loggedInUserCached;\r\n};\r\nRESUtils.isModeratorAnywhere = function() {\r\n\t// I was given special permission to do this.\r\n\treturn !!document.getElementById('modmail');\r\n};\r\nRESUtils.loggedInUserHash = function() {\r\n\tthis.loggedInUser();\r\n\treturn this.loggedInUserHashCached;\r\n};\r\nRESUtils.problemHashes = [991658920, 3385400];\r\nRESUtils.getUserInfo = function(callback, username, live) {\r\n\t// Default to currently logged-in user, for backwards compatibility\r\n\tusername = (typeof username !== 'undefined' ? username : RESUtils.loggedInUser());\r\n\tif (username === null) return false;\r\n\r\n\t// Default to getting live data (i.e. from reddit's server)\r\n\tlive = (typeof live === 'boolean' ? live : true);\r\n\r\n\tRESUtils.cache.fetch({\r\n\t\tendpoint: 'user/' + encodeURIComponent(username) + '/about.json',\r\n\t\texpires: live ? 0 : 300000,\r\n\t\tcallback: callback\r\n\t});\r\n};\r\nRESUtils.regexes = {\r\n\tall: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\//i,\r\n\tcomments: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/[\\-\\w\\.\\/]*\\/comments/i,\r\n\tnosubComments: /https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/comments\\/[\\-\\w\\.\\/]*/i,\r\n\tfriendsComments: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/friends\\/comments/i,\r\n\tinbox: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/(?:r\\/[\\-\\w\\.\\/]+?\\/)?message\\//i,\r\n\tprofile: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/user\\/([\\-\\w\\.#=]*)\\/?(?:comments)?\\/?(?:\\?(?:[a-z]+=[a-zA-Z0-9_%]*&?)*)?$/i,\r\n\tsubmit: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/(?:[\\-\\w\\.\\/]*\\/)?submit\\/?(?:\\?.*)?$/i,\r\n\tprefs: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/prefs/i,\r\n\taccount: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/account/i,\r\n\twiki: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/(?:r\\/[\\-\\w\\.]+\\/)?wiki/i,\r\n\tstylesheet: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/(?:r\\/[\\-\\w\\.]+\\/)?about\\/stylesheet/i,\r\n\tsearch: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/(?:[\\-\\w\\.\\/]*\\/)?search/i,\r\n\ttoolbar: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/tb\\//i,\r\n\tcommentPermalink: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/[\\-\\w\\.\\/]*comments\\/[a-z0-9]+\\/[^\\/]+\\/[a-z0-9]+$/i,\r\n\tsubreddit: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/([\\w\\.\\+]+)/i,\r\n\tsubredditPostListing: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/([\\w\\.\\+]+)(?:\\/(new|rising|controversial|top))?\\/?(?:\\?.*)?$/i,\r\n\tsubredditAbout: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/([\\w\\.\\+]+)\\/about/i,\r\n\tmultireddit: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/((?:me|user\\/[\\-\\w\\.#=]*)\\/(?:m|f)\\/([\\w\\.\\+]+))/i,\r\n\tdomain: /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/domain\\/([\\w\\.\\+]+)/i\r\n};\r\nRESUtils.verifyHash = function(hash) {\r\n\tif ($.inArray(RESUtils.hashCode(hash), RESUtils.problemHashes) !== -1) {\r\n\t\tthrow 'Error';\r\n\t}\r\n};\r\nRESUtils.isReddit = function() {\r\n\tvar currURL = location.href;\r\n\treturn RESUtils.regexes.all.test(currURL) && !RESUtils.regexes.toolbar.test(currURL);\r\n};\r\nRESUtils.pageType = function() {\r\n\tif (this.pageTypeSaved !== undefined) {\r\n\t\treturn this.pageTypeSaved;\r\n\t}\r\n\r\n\tvar currURL = location.href.split('#')[0];\r\n\tvar defaultPageType = 'linklist';\r\n\tvar pageTypes = [ 'wiki', 'search', 'profile', 'subredditAbout', 'comments', 'inbox', 'submit', 'account', 'prefs', 'stylesheet' ];\r\n\tvar pageType = pageTypes.find(function(pageType) {\r\n\t\treturn RESUtils.regexes[pageType].test(currURL);\r\n\t}) || defaultPageType;\r\n\r\n\r\n\tthis.pageTypeSaved = pageType;\r\n\treturn pageType;\r\n};\r\nRESUtils.isPageType = function(/*type1, type2, type3, ...*/) {\r\n\tvar thisPage = RESUtils.pageType();\r\n\treturn Array.prototype.slice.call(arguments).some(function(type) {\r\n\t\treturn (type === 'all') || (type === thisPage);\r\n\t});\r\n};\r\nRESUtils.matchesPageRegex = function(/*regex1, regex2, regex3, ...*/) {\r\n\tvar href = document.location.href;\r\n\treturn Array.prototype.slice.call(arguments).some(function(regex) {\r\n\t\treturn regex.test && regex.test(href);\r\n\t});\r\n};\r\nRESUtils.isCommentPermalinkPage = function() {\r\n\tif (typeof this.isCommentPermalinkSaved === 'undefined') {\r\n\t\tvar currURL = location.href.split('#')[0];\r\n\t\tif (RESUtils.regexes.commentPermalink.test(currURL)) {\r\n\t\t\tthis.isCommentPermalinkSaved = true;\r\n\t\t} else {\r\n\t\t\tthis.isCommentPermalinkSaved = false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn this.isCommentPermalinkSaved;\r\n};\r\nRESUtils.currentSubreddit = function(check) {\r\n\tif (typeof this.curSub === 'undefined') {\r\n\t\tvar match = location.href.match(RESUtils.regexes.subreddit);\r\n\t\tif (match !== null) {\r\n\t\t\tthis.curSub = match[1];\r\n\t\t\tif (check) return (match[1].toLowerCase() === check.toLowerCase());\r\n\t\t\treturn match[1];\r\n\t\t} else {\r\n\t\t\tif (check) return false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t} else {\r\n\t\tif (check) return (this.curSub.toLowerCase() === check.toLowerCase());\r\n\t\treturn this.curSub;\r\n\t}\r\n};\r\nRESUtils.thingsContainer = function(body) {\r\n\tvar container;\r\n\tbody = body || document.body;\r\n\tcontainer = body.querySelectorAll(RESUtils.thing.prototype.containerSelector);\r\n\t// stupid sponsored links create a second div with ID of sitetable (bad reddit! you should never have 2 IDs with the same name! naughty, naughty reddit!)\r\n\tif (container.length === 2) {\r\n\t\t// console.log('skipped first sitetable, stupid reddit.');\r\n\t\tcontainer = container[1];\r\n\t} else {\r\n\t\tcontainer = container[0];\r\n\t}\r\n\r\n\treturn container;\r\n};\r\nRESUtils.$things = function(container) {\r\n\tcontainer = container || RESUtils.thingsContainer();\r\n\treturn $(container).find(RESUtils.thing.prototype.thingSelector);\r\n};\r\nRESUtils.things = function(container) {\r\n\treturn RESUtils.$things(container).get()\r\n\t\t.map(function(ele, index) {\r\n\t\t\treturn new RESUtils.thing(ele);\r\n\t\t});\r\n};\r\nRESUtils.thing = function(element) {\r\n\tif (element instanceof RESUtils.thing) {\r\n\t\treturn element;\r\n\t}\r\n\tif (!(this instanceof RESUtils.thing)) {\r\n\t\treturn new RESUtils.thing(element);\r\n\t}\r\n\r\n\tvar $thing = $(element).closest(this.thingSelector);\r\n\tvar thing = $thing[0];\r\n\tvar entry = thing && thing.querySelector(this.entrySelector) || thing;\r\n\r\n\t$.extend(this, {\r\n\t\t'$thing': $thing,\r\n\t\tthing: thing,\r\n\t\telement: thing,\r\n\t\tentry: entry,\r\n\r\n\t\tfind: $thing.find.bind($thing),\r\n\t\tquerySelector: thing ? thing.querySelector.bind(thing) : function() { },\r\n\t\tquerySelectorAll: thing ? thing.querySelectorAll.bind(thing) : function() { }\r\n\t});\r\n\r\n\treturn this;\r\n};\r\nRESUtils.thing.prototype = {\r\n\tthingSelector: '.thing, .search-result-link',\r\n\tentrySelector: '.entry, .search-result-link > :not(.thumbnail)',\r\n\tcontainerSelector: '.sitetable, .search-result-listing',\r\n\r\n\tis: function(otherThing) {\r\n\t\tif (otherThing && otherThing.element === this.element) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\tisPost: function() {\r\n\t\treturn this.thing.classList.contains('link') || this.thing.classList.contains('search-result-link');\r\n\t},\r\n\tisLinkPost: function() {\r\n\t\tif (!this.isPost()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.thing.classList.contains('search-result-link')) {\r\n\t\t\treturn !this.thing.querySelector('a').classList.contains('self');\r\n\t\t} else {\r\n\t\t\treturn !this.thing.classList.contains('self');\r\n\t\t}\r\n\t},\r\n\tisSelfPost: function() {\r\n\t\tif (!this.isPost()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.thing.classList.contains('search-result-link')) {\r\n\t\t\treturn this.thing.querySelector('a').classList.contains('self');\r\n\t\t} else {\r\n\t\t\treturn this.thing.classList.contains('self');\r\n\t\t}\r\n\t},\r\n\tisComment: function() {\r\n\t\treturn this.entry.classList.contains('comment');\r\n\t},\r\n\r\n\tgetTitle: function() {\r\n\t\tvar element = this.getTitleElement();\r\n\t\treturn element && element.textContent;\r\n\t},\r\n\tgetTitleElement: function() {\r\n\t\treturn this.entry.querySelector('a.title, a.search-title');\r\n\t},\r\n\tgetPostLink: function() {\r\n\t\treturn this.entry.querySelector('a.title, a.search-link');\r\n\t},\r\n\tgetCommentsLink: function() {\r\n\t\treturn this.entry.querySelector('a.comments, a.search-comments');\r\n\t},\r\n\tgetCommentPermalink: function() {\r\n\t\treturn this.entry.querySelector('a.bylink');\r\n\t},\r\n\tgetScore: function() {\r\n\t\tvar element = this.getScoreElement();\r\n\t\t//parseInt() strips off the ' points' from comments\r\n\t\treturn element && parseInt(element.textContent, 10);\r\n\t},\r\n\tgetScoreElement: function() {\r\n\t\tif (this.isPost()) {\r\n\t\t\treturn this.entry.querySelector('.midcol.unvoted > .score.unvoted, .midcol.likes > score.likes, .midcol.dislikes > .score.dislikes, .search-score');\r\n\t\t} else if (this.isComment()) {\r\n\t\t\t// TODO: does this work?\r\n\t\t\treturn this.entry.querySelector('tagline > .score');\r\n\t\t}\r\n\t},\r\n\tgetAuthor: function() {\r\n\t\tvar element = this.getAuthorElement();\r\n\t\treturn element && RESUtils.regexes.profile.exec(element.href)[1];\r\n\t},\r\n\tgetAuthorElement: function() {\r\n\t\treturn this.entry.querySelector('.tagline > .author, .search-author .author');\r\n\t},\r\n\tgetSubreddit: function() {\r\n\t\tvar element = this.getSubredditLink();\r\n\t\treturn element && RESUtils.regexes.subreddit.exec(element.href)[1];\r\n\t},\r\n\tgetSubredditLink: function() {\r\n\t\tif (this.isPost()) {\r\n\t\t\treturn this.entry.querySelector('.tagline a.subreddit, a.search-subreddit-link');\r\n\t\t} else if (this.isComment()) {\r\n\t\t\t// TODO: does this work?\r\n\t\t\treturn this.entry.querySelector('.parent a.subreddit');\r\n\t\t}\r\n\t},\r\n\tgetPostDomain: function() {\r\n\t\tvar element = this.getPostDomainLink();\r\n\t\tif (element) {\r\n\t\t\treturn element.textContent;\r\n\t\t}\r\n\r\n\t\tvar subreddit = this.getSubreddit() || RESUtils.currentSubreddit();\r\n\t\tif (subreddit) {\r\n\t\t\treturn 'self.' + subreddit;\r\n\t\t}\r\n\r\n\t\treturn 'reddit.com';\r\n\t},\r\n\tgetPostDomainLink: function() {\r\n\t\treturn this.thing.querySelector('.domain > a');\r\n\t},\r\n\tgetCommentCount: function() {\r\n\t\tvar element = this.getCommentCountElement();\r\n\t\treturn element && parseInt(/\\d+/.exec(element.textContent), 10);\r\n\t},\r\n\tgetCommentCountElement: function() {\r\n\t\tif (this.isPost()) {\r\n\t\t\treturn this.thing.querySelector('.buttons .comments');\r\n\t\t} else if (this.isComment()) {\r\n\t\t\treturn this.thing.querySelector('.buttons a.full-comments');\r\n\t\t}\r\n\t},\r\n\tgetPostFlairText: function() {\r\n\t\tvar element = this.getPostFlairElement();\r\n\t\treturn element && element.textContent;\r\n\t},\r\n\tgetPostFlairElement: function() {\r\n\t\treturn $(this.entry).find('> .title > .linkflairlabel')[0];\r\n\t},\r\n\tgetUserFlairText: function() {\r\n\t\tvar element = this.getUserFlairElement();\r\n\t\treturn element && element.textContent;\r\n\t},\r\n\tgetUserFlairElement: function() {\r\n\t\treturn $(this.entry).find('> .title > .linkflairlabel')[0];\r\n\t},\r\n\tgetUpvoteButton: function() {\r\n\t\treturn this._getVoteButton('div.up, div.upmod');\r\n\t},\r\n\tgetDownvoteButton: function() {\r\n\t\treturn this._getVoteButton('div.down, div.downmod');\r\n\t},\r\n\t_getVoteButton: function(selector) {\r\n\t\tvar button;\r\n\t\tif (this.entry.previousSibling.tagName === 'A') {\r\n\t\t\tbutton = this.entry.previousSibling.previousSibling.querySelector(selector);\r\n\t\t} else {\r\n\t\t\tbutton = this.entry.previousSibling.querySelector(selector);\r\n\t\t}\r\n\t\treturn button;\r\n\t},\r\n\tgetExpandoButton: function() {\r\n\t\treturn this.entry.querySelector('.expando-button, .search-expando-button');\r\n\t},\r\n\tgetExpandoButtons: function() {\r\n\t\treturn this.entry.querySelectorAll('.expando-button, .search-expando-button');\r\n\t},\r\n\tgetTimestamp: function() {\r\n\t\tvar element = this.getTimestampElement();\r\n\t\treturn element && new Date(element.getAttribute('datetime'));\r\n\t},\r\n\tgetTimestampElement: function() {\r\n\t\treturn this.entry.querySelector('time');\r\n\t},\r\n\tisNSFW: function() {\r\n\t\tif (this.thing.classList.contains('search-result')) {\r\n\t\t\treturn this.entry.querySelector('.nsfw-stamp');\r\n\t\t}\r\n\t\treturn this.thing.classList.contains('over18');\r\n\t},\r\n};\r\nRESUtils.subredditForElement = function(element) {\r\n\tvar $thing = $(element).closest('.thing');\r\n\tif (!$thing.length) return;\r\n\r\n\tvar $subredditElement = $thing.find('.subreddit');\r\n\r\n\tif (!$subredditElement.length) {\r\n\t\t$subredditElement = $thing.find('.tagline a').filter(function() {\r\n\t\t\treturn RESUtils.regexes.subreddit.test(this.href);\r\n\t\t});\r\n\t}\r\n\r\n\tif (!$subredditElement.length) {\r\n\t\t$subredditElement = $('.sitetable .link .subreddit');\r\n\t}\r\n\r\n\tif ($subredditElement.length) {\r\n\t\tvar subredditName = $subredditElement[0].href.match(RESUtils.regexes.subreddit)[1];\r\n\t\treturn subredditName;\r\n\t}\r\n};\r\nRESUtils.currentMultireddit = function(check) {\r\n\tif (typeof this.curMulti === 'undefined') {\r\n\t\tvar match = location.href.match(RESUtils.regexes.multireddit);\r\n\t\tif (match !== null) {\r\n\t\t\tthis.curMulti = match[1];\r\n\t\t\tif (check) return (match[1].toLowerCase() === check.toLowerCase());\r\n\t\t\treturn match[1];\r\n\t\t} else {\r\n\t\t\tif (check) return false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t} else {\r\n\t\tif (check) return (this.curMulti.toLowerCase() === check.toLowerCase());\r\n\t\treturn this.curMulti;\r\n\t}\r\n};\r\nRESUtils.currentDomain = function(check) {\r\n\tif (typeof this.curDom === 'undefined') {\r\n\t\tvar match = location.href.match(RESUtils.regexes.domain);\r\n\t\tif (match !== null) {\r\n\t\t\tthis.curDom = match[1];\r\n\t\t\tif (check) return (match[1].toLowerCase() === check.toLowerCase());\r\n\t\t\treturn match[1];\r\n\t\t} else {\r\n\t\t\tif (check) return false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t} else {\r\n\t\tif (check) return (this.curDom.toLowerCase() === check.toLowerCase());\r\n\t\treturn this.curDom;\r\n\t}\r\n};\r\nRESUtils.currentUserProfile = function() {\r\n\tif (typeof this.curUserProfile === 'undefined') {\r\n\t\tvar match = location.href.match(RESUtils.regexes.profile);\r\n\t\tif (match !== null) {\r\n\t\t\tthis.curUserProfile = match[1];\r\n\t\t\treturn match[1];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t} else {\r\n\t\treturn this.curUserProfile;\r\n\t}\r\n};\r\nRESUtils.subredditForPost = function(thingEle) {\r\n\tvar postSubreddit = '';\r\n\tvar thisSubRedditEle = $(thingEle).find('A.subreddit')[0];\r\n\tif ((typeof thisSubRedditEle !== 'undefined') && (thisSubRedditEle !== null)) {\r\n\t\tpostSubreddit = RESUtils.regexes.subreddit.exec(thisSubRedditEle.href)[1] || '';\r\n\t}\r\n\treturn postSubreddit;\r\n};\r\nRESUtils.getXYpos = function(obj) {\r\n\tvar topValue = 0,\r\n\t\tleftValue = 0;\r\n\twhile (obj) {\r\n\t\tleftValue += obj.offsetLeft;\r\n\t\ttopValue += obj.offsetTop;\r\n\t\tobj = obj.offsetParent;\r\n\t}\r\n\treturn {\r\n\t\t'x': leftValue,\r\n\t\t'y': topValue\r\n\t};\r\n};\r\n\r\nRESUtils.elementInViewport = function(obj) {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\tvar element = RESUtils.getDimensions(obj);\r\n\tvar viewport = RESUtils.getViewportDimensions();\r\n\r\n\tvar contained = (\r\n\t\tviewport.top <= element.top  &&\r\n\t\tviewport.left <= element.left  &&\r\n\t\telement.bottom <= viewport.bottom &&\r\n\t\telement.right <= viewport.right\r\n\t);\r\n\treturn contained;\r\n};\r\nRESUtils.getDimensions = function(obj) {\r\n\tvar headerOffset = this.getHeaderOffset();\r\n\tvar top = obj.offsetTop - headerOffset;\r\n\tvar left = obj.offsetLeft;\r\n\tvar width = obj.offsetWidth;\r\n\tvar height = obj.offsetHeight;\r\n\twhile (obj.offsetParent) {\r\n\t\tobj = obj.offsetParent;\r\n\t\ttop += obj.offsetTop;\r\n\t\tleft += obj.offsetLeft;\r\n\t}\r\n\tvar bottom = top + height;\r\n\tvar right = left + width;\r\n\r\n\treturn {\r\n\t\tyOffset: headerOffset,\r\n\t\tx: top,\r\n\t\ty: left,\r\n\t\ttop: top,\r\n\t\tleft: left,\r\n\t\tbottom: bottom,\r\n\t\tright: right,\r\n\t\twidth: width,\r\n\t\theight: height\r\n\t};\r\n};\r\n\r\nRESUtils.getViewportDimensions = function() {\r\n\tvar headerOffset = this.getHeaderOffset();\r\n\r\n\tvar dimensions = {\r\n\t\tyOffset: headerOffset,\r\n\t\tx: window.pageXOffset,\r\n\t\ty: window.pageYOffset + headerOffset,\r\n\t\twidth: window.innerWidth,\r\n\t\theight: window.innerHeight - headerOffset\r\n\t};\r\n\tdimensions.top = dimensions.y;\r\n\tdimensions.left = dimensions.x;\r\n\tdimensions.bottom = dimensions.top + dimensions.height;\r\n\tdimensions.right = dimensions.left + dimensions.width;\r\n\r\n\treturn dimensions;\r\n};\r\n// Returns percentage of the element that is within the viewport along the y-axis\r\n// Note that it doesn't matter where the element is on the x-axis, it can be totally invisible to the user\r\n// and this function might still return 1!\r\nRESUtils.getPercentageVisibleYAxis = function(obj) {\r\n\tvar rect = obj.getBoundingClientRect();\r\n\tvar top = Math.max(0, rect.bottom - rect.height);\r\n\tvar bottom = Math.min(document.documentElement.clientHeight, rect.bottom);\r\n\tif (rect.height === 0) {\r\n\t\treturn 0;\r\n\t}\r\n\treturn Math.max(0, (bottom - top) / rect.height);\r\n};\r\n// Returns percentage of the element that is within the viewport along the x-axis\r\n// Note that it doesn't matter where the element is on the y-axis, it can be totally invisible to the user\r\n// and this function might still return 1!\r\nRESUtils.getPercentageVisibleXAxis = function(obj) {\r\n\tvar rect = obj.getBoundingClientRect();\r\n\tvar left = Math.max(0, rect.left);\r\n\tvar right = Math.min(document.documentElement.clientWidth, rect.right);\r\n\tif (rect.width === 0) {\r\n\t\treturn 0;\r\n\t}\r\n\treturn Math.max(0, (right - left) / rect.width);\r\n};\r\n// Returns percentage of the element that is within the viewport\r\nRESUtils.getPercentageVisible = function(obj) {\r\n\treturn RESUtils.getPercentageVisibleXAxis(obj) * RESUtils.getPercentageVisibleYAxis(obj);\r\n};\r\nRESUtils.watchMouseMove = function() {\r\n\tdocument.body.addEventListener('mousemove', RESUtils.setMouseXY, false);\r\n};\r\nRESUtils.setMouseXY = function(e) {\r\n\te = e || window.event;\r\n\tvar cursor = {\r\n\t\tx: 0,\r\n\t\ty: 0\r\n\t};\r\n\tif (e.pageX || e.pageY) {\r\n\t\tcursor.x = e.pageX;\r\n\t\tcursor.y = e.pageY;\r\n\t} else {\r\n\t\tcursor.x = e.clientX +\r\n\t\t\t(document.documentElement.scrollLeft ||\r\n\t\t\tdocument.body.scrollLeft) -\r\n\t\t\tdocument.documentElement.clientLeft;\r\n\t\tcursor.y = e.clientY +\r\n\t\t\t(document.documentElement.scrollTop ||\r\n\t\t\tdocument.body.scrollTop) -\r\n\t\t\tdocument.documentElement.clientTop;\r\n\t}\r\n\tRESUtils.mouseX = cursor.x;\r\n\tRESUtils.mouseY = cursor.y;\r\n};\r\nRESUtils.doElementsCollide = function(ele1, ele2, margin) {\r\n\tmargin = margin || 0;\r\n\tele1 = $(ele1);\r\n\tele2 = $(ele2);\r\n\r\n\tvar dims1 = ele1.offset();\r\n\tdims1.right = dims1.left + ele1.width();\r\n\tdims1.bottom = dims1.top + ele1.height();\r\n\r\n\tdims1.left -= margin;\r\n\tdims1.top -= margin;\r\n\tdims1.right += margin;\r\n\tdims1.bottom += margin;\r\n\r\n\tvar dims2 = ele2.offset();\r\n\tdims2.right = dims2.left + ele2.width();\r\n\tdims2.bottom = dims2.top + ele2.height();\r\n\r\n\tif (\r\n\t\t(\r\n\t\t\t(dims1.left < dims2.left && dims2.left < dims1.right) ||\r\n\t\t\t(dims1.left < dims2.right && dims2.right < dims1.right) ||\r\n\t\t\t(dims2.left < dims1.left && dims1.left < dims2.right) ||\r\n\t\t\t(dims2.left < dims1.right && dims1.right < dims2.right)\r\n\t\t) &&\r\n\t\t(\r\n\t\t\t(dims1.top < dims2.top && dims2.top < dims1.bottom) ||\r\n\t\t\t(dims1.top < dims2.bottom && dims2.bottom < dims1.bottom) ||\r\n\t\t\t(dims2.top < dims1.top && dims1.top < dims2.bottom) ||\r\n\t\t\t(dims2.top < dims1.bottom && dims1.bottom < dims2.bottom))\r\n\t) {\r\n\t\t// In layman's terms:\r\n\t\t// If one of the box's left/right borders is between the other box's left/right\r\n\t\t// and same with top/bottom,\r\n\t\t// then they collide.\r\n\t\t// This could probably be logicked into a more compact form.\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\nRESUtils.scrollToElement = function(element, options) {\r\n\toptions = $.extend(true, {\r\n\t\ttopOffset: 5,\r\n\t\tmakeVisible: undefined\r\n\t}, options);\r\n\r\n\tvar target = (options.makeVisible || element).getBoundingClientRect(); // top, right, bottom, left are relative to viewport\r\n\tvar viewport = RESUtils.getViewportDimensions();\r\n\r\n\ttarget = $.extend({}, target);\r\n\ttarget.top -= viewport.yOffset;\r\n\ttarget.bottom -= viewport.yOffset;\r\n\r\n\tvar top = viewport.y + target.top - options.topOffset; // for DRY\r\n\r\n\tif (options.scrollStyle === 'none') {\r\n\t\treturn;\r\n\t} else if (options.scrollStyle === 'top') {\r\n\t\t// Always scroll element to top of page\r\n\t\tRESUtils.scrollTo(0, top);\r\n\t} else if (0 <= target.top && target.bottom <= viewport.height) {\r\n\t\t// Element is already completely inside viewport\r\n\t\t// (remember, top and bottom are relative to viewport)\r\n\t\treturn;\r\n\t} else if (target.top < viewport.yOffset) {\r\n\t\t// Element starts above viewport\r\n\t\t// So, align top of element to top of viewport\r\n\t\tRESUtils.scrollTo(0, top);\r\n\t} else if (viewport.height < target.bottom &&\r\n\t\t\ttarget.height < viewport.height) {\r\n\t\t// Visible part of element starts or extends below viewport\r\n\r\n\t\tif (options.scrollStyle === 'page') {\r\n\t\t\tRESUtils.scrollTo(0, viewport.y + target.top - options.topOffset);\r\n\t\t} else {\r\n\t\t\t// So, align bottom of target to bottom of viewport\r\n\t\t\tRESUtils.scrollTo(0, viewport.y + target.bottom - viewport.height);\r\n\t\t}\r\n\t\treturn;\r\n\t} else {\r\n\t\t// Visible part of element below the viewport but it'll fill the viewport, or fallback\r\n\t\t// So, align top of element to top of viewport\r\n\t\tRESUtils.scrollTo(0, top);\r\n\t}\r\n};\r\nRESUtils.scrollTo = function(x, y) {\r\n\tvar headerOffset = this.getHeaderOffset();\r\n\twindow.scrollTo(x, y - headerOffset);\r\n};\r\nRESUtils.getHeaderOffset = function() {\r\n\tif (typeof this.headerOffset === 'undefined') {\r\n\t\tvar header;\r\n\t\tvar headerOffset = 0;\r\n\t\tif (modules['betteReddit'].isEnabled()) {\r\n\t\t\tswitch (modules['betteReddit'].options.pinHeader.value) {\r\n\t\t\t\tcase 'sub':\r\n\t\t\t\tcase 'subanduser':\r\n\t\t\t\t\theader = document.getElementById('sr-header-area');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'header':\r\n\t\t\t\t\theader = document.getElementById('header');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// case 'none':\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (header) {\r\n\t\t\theaderOffset = header.offsetHeight + 6;\r\n\t\t}\r\n\r\n\t\tthis.headerOffset = headerOffset;\r\n\t}\r\n\treturn this.headerOffset;\r\n};\r\nRESUtils.addStyle = function(css) {\r\n\tvar style = document.createElement('style');\r\n\tstyle.textContent = css;\r\n\tRESUtils.init.await.headReady().done(function() {\r\n\t\tdocument.head.appendChild(style);\r\n\t});\r\n\r\n\treturn style;\r\n};\r\nRESUtils.stripHTML = function(str) {\r\n\tvar regExp = /<\\/?[^>]+>/gi;\r\n\tstr = str.replace(regExp, '');\r\n\treturn str;\r\n};\r\nRESUtils.sanitizeHTML = function(htmlStr) {\r\n\treturn window.Pasteurizer.safeParseHTML(htmlStr).wrapAll('<div></div>').parent().html();\r\n};\r\nRESUtils.firstValid = function() {\r\n\treturn Array.prototype.slice.call(arguments).find(function(argument) {\r\n\t\treturn argument !== undefined && argument !== null &&\r\n\t\t\t(typeof argument !== 'number' || !isNaN(argument));\r\n\t});\r\n};\r\nRESUtils.fadeElementTo = function(el, speedInSeconds, finalOpacity, callback) {\r\n\tvar initialOpacity;\r\n\tstart();\r\n\r\n\tfunction start() {\r\n\t\tif (el._resIsFading) {\r\n\t\t\treturn;\r\n\t\t} else if (finalOpacity === 0 && el.style.display === 'none') {\r\n\t\t\t// already faded out, don't need to fade out again.\r\n\t\t\tdone();\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tsetup();\r\n\t\t\tgo();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setup() {\r\n\t\tel._resIsFading = true;\r\n\r\n\t\tif (el.style.display === 'none' || el.style.display === '') {\r\n\t\t\tinitialOpacity = 0;\r\n\t\t\tel.style.display = 'block';\r\n\t\t} else {\r\n\t\t\tinitialOpacity = parseFloat(el.style.opacity) || 1;\r\n\t\t}\r\n\r\n\t\tif (typeof finalOpacity === 'undefined') {\r\n\t\t\tfinalOpacity = 1;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction go() {\r\n\t\t$(el).fadeTo(speedInSeconds * 1000, finalOpacity, done);\r\n\t}\r\n\r\n\tfunction done() {\r\n\t\tel.style.opacity = finalOpacity;\r\n\t\tif (finalOpacity <= 0) {\r\n\t\t\tel.style.display = 'none';\r\n\t\t}\r\n\t\tdelete el._resIsFading;\r\n\t\tif (callback && callback.call) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\treturn true;\r\n};\r\nRESUtils.fadeElementOut = function(el, speed, callback) {\r\n\tRESUtils.fadeElementTo(el, speed, 0, callback);\r\n};\r\nRESUtils.fadeElementIn = function(el, speed, finalOpacity, callback) {\r\n\tRESUtils.fadeElementTo(el, speed, finalOpacity, callback);\r\n};\r\n\r\nRESUtils.setCursorPosition = function(form, pos) {\r\n\tvar elem = $(form)[0];\r\n\tif (!elem) return;\r\n\r\n\tif (elem.setSelectionRange) {\r\n\t\telem.setSelectionRange(pos, pos);\r\n\t} else if (elem.createTextRange) {\r\n\t\tvar range = elem.createTextRange();\r\n\t\trange.collapse(true);\r\n\t\trange.moveEnd('character', pos);\r\n\t\trange.moveStart('character', pos);\r\n\t\trange.select();\r\n\t}\r\n\r\n\treturn form;\r\n};\r\nRESUtils.createMultiLock = function() {\r\n\tvar locks = {};\r\n\tvar count = 0;\r\n\r\n\treturn {\r\n\t\tlock: function(lockname, value) {\r\n\t\t\tif (typeof lockname === 'undefined') return;\r\n\t\t\tif (locks[lockname]) return;\r\n\r\n\t\t\tlocks[lockname] = value || true;\r\n\t\t\tcount++;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tunlock: function(lockname) {\r\n\t\t\tif (typeof lockname === 'undefined') return;\r\n\t\t\tif (!locks[lockname]) return;\r\n\r\n\t\t\tlocks[lockname] = false;\r\n\t\t\tcount--;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlocked: function(lockname) {\r\n\t\t\tif (typeof lockname !== 'undefined') {\r\n\t\t\t\t// Is this lock set?\r\n\t\t\t\treturn locks[lockname];\r\n\t\t\t} else {\r\n\t\t\t\t// Is any lock set?\r\n\t\t\t\treturn count > 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\nRESUtils.indexOptionTable = function(moduleID, optionKey, keyFieldIndex) {\r\n\tvar source = modules[moduleID].options[optionKey].value;\r\n\tvar keyIsList =\r\n\t\tmodules[moduleID].options[optionKey].fields[keyFieldIndex].type === 'list' ?\r\n\t\t',' :\r\n\t\tfalse;\r\n\treturn RESUtils.indexArrayByProperty(source, keyFieldIndex, keyIsList);\r\n};\r\nRESUtils.indexArrayByProperty = function(source, keyIndex, keyValueSeparator) {\r\n\tvar index;\r\n\tif (!source || !source.length) {\r\n\t\tindex = {\r\n\t\t\titems: [],\r\n\t\t\tkeys: []\r\n\t\t};\r\n\t} else {\r\n\t\tindex = createIndex();\r\n\t}\r\n\r\n\tObject.defineProperty(getItem, 'keys', {\r\n\t\tvalue: index.keys,\r\n\t\twriteable: false\r\n\t});\r\n\tObject.defineProperty(getItem, 'all', {\r\n\t\tvalue: getAllItems,\r\n\t\twriteable: false\r\n\t});\r\n\treturn getItem;\r\n\r\n\tfunction createIndex() {\r\n\t\tvar itemsByKey = {};\r\n\t\tvar allKeys = [];\r\n\r\n\t\tfor (var i = 0, length = source.length; i < length; i++) {\r\n\t\t\tvar item = source[i];\r\n\t\t\tvar key = item && item[keyIndex];\r\n\t\t\tif (!key) continue;\r\n\r\n\t\t\tvar keys;\r\n\t\t\tif (keyValueSeparator) {\r\n\t\t\t\tkeys = key.split(keyValueSeparator);\r\n\t\t\t} else {\r\n\t\t\t\tkeys = [ key && key ];\r\n\t\t\t}\r\n\t\t\tfor (var ki = 0, klength = keys.length; ki < klength; ki++) {\r\n\t\t\t\tkey = keys[ki].toLowerCase();\r\n\r\n\t\t\t\titemsByKey[key] = itemsByKey[key] || [];\r\n\t\t\t\titemsByKey[key].push(item);\r\n\t\t\t}\r\n\r\n\t\t\tallKeys = allKeys.concat(keys);\r\n\t\t}\r\n\r\n\t\tallKeys = allKeys.filter(function(value, index, array) {\r\n\t\t\tvar unique = array.indexOf(value, index + 1) === -1;\r\n\t\t\treturn unique;\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\titems: itemsByKey,\r\n\t\t\tkeys: allKeys\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getItem(key) {\r\n\t\tkey = key && key.toLowerCase();\r\n\t\tvar item = index.items[key];\r\n\t\treturn item;\r\n\t}\r\n\r\n\tfunction getAllItems() {\r\n\t\treturn index.keys.map(getItem);\r\n\t}\r\n};\r\n\r\nRESUtils.inList = function(needle, haystack, separator, isCaseSensitive) {\r\n\tif (!needle || !haystack) return false;\r\n\r\n\tseparator = separator || ',';\r\n\r\n\tif (haystack.indexOf(separator) !== -1) {\r\n\t\tvar haystacks = haystack.split(separator);\r\n\t\tif (RESUtils.inArray(needle, haystacks, isCaseSensitive)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else {\r\n\t\tif (isCaseSensitive) {\r\n\t\t\treturn (needle === haystack);\r\n\t\t} else {\r\n\t\t\treturn (needle.toLowerCase() === haystack.toLowerCase());\r\n\t\t}\r\n\t}\r\n};\r\nRESUtils.inArray = function(needle, haystacks, isCaseSensitive) {\r\n\tif (!isCaseSensitive) needle = needle.toLowerCase();\r\n\r\n\tfor (var i = 0, length = haystacks.length; i < length; i++) {\r\n\t\tif (isCaseSensitive) {\r\n\t\t\tif (needle === haystacks[i]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (needle === haystacks[i].toLowerCase()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nRESUtils.deferred = RESUtils.deferred || {};\r\nRESUtils.deferred.map = function(array, callback) {\r\n\tvar deferreds,\r\n\t\tmapped = [];\r\n\tdeferreds = [].concat(array).map(function(item, index, array) {\r\n\t\tvar def = callback(item, index, array)\r\n\t\t\t.done(function(mappedItem) {\r\n\t\t\t\tmapped[index] = mappedItem;\r\n\t\t\t});\r\n\t\treturn def;\r\n\t});\r\n\r\n\treturn RESUtils.deferred.all(deferreds)\r\n\t\t.then(function() { return mapped; })\r\n\t\t.promise();\r\n};\r\nRESUtils.deferred.all = function(deferreds) {\r\n\tvar deferred = $.Deferred(),\r\n\t\tdoneCount = 0,\r\n\t\tfailCount = 0;\r\n\tdeferreds = [].concat(deferreds);\r\n\tdeferreds.forEach(function(def) {\r\n\t\tdef\r\n\t\t\t.done(done)\r\n\t\t\t.fail(fail)\r\n\t\t\t.always(always);\r\n\t});\r\n\r\n\tfunction done() {\r\n\t\tdoneCount++;\r\n\t}\r\n\tfunction fail() {\r\n\t\tfailCount++;\r\n\t}\r\n\tfunction always() {\r\n\t\tif ((doneCount + failCount) < deferreds.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (failCount > 0 && doneCount === 0) {\r\n\t\t\tdeferred.reject(doneCount, failCount);\r\n\t\t} else {\r\n\t\t\tdeferred.resolve(doneCount, failCount);\r\n\t\t}\r\n\t}\r\n\r\n\treturn deferred.promise();\r\n};\r\nRESUtils.rpc = function(moduleID, method, args) {\r\n\tif (args && args[args.length - 1] === 'rpc') {\r\n\t\tconsole.warn('rpc warning: loop.', moduleID, method, args);\r\n\t\treturn 'rpc loop suspected';\r\n\t}\r\n\tvar module = modules[moduleID];\r\n\tif (!module || typeof module[method] !== 'function') {\r\n\t\tconsole.warn('rpc error: could not find method.', moduleID, method, args);\r\n\t\treturn 'could not find method';\r\n\t}\r\n\r\n\tvar sanitized = args ?\r\n\t\t[].concat(JSON.parse(JSON.stringify(args))) :\r\n\t\t[];\r\n\tsanitized = sanitized.concat('rpc');\r\n\r\n\treturn module[method].apply(module, sanitized);\r\n};\r\nRESUtils.proEnabled = function() {\r\n\treturn ((typeof modules['RESPro'] !== 'undefined') && (modules['RESPro'].isEnabled()));\r\n};\r\nRESUtils.niceKeyCode = function(charCode) {\r\n\tvar keyComboString = '';\r\n\tvar testCode, niceString;\r\n\tif (typeof charCode === 'string') {\r\n\t\tvar tempArray = charCode.split(',');\r\n\t\tif (tempArray.length) {\r\n\t\t\tif (tempArray[1] === 'true') keyComboString += 'alt-';\r\n\t\t\tif (tempArray[2] === 'true') keyComboString += 'ctrl-';\r\n\t\t\tif (tempArray[3] === 'true') keyComboString += 'shift-';\r\n\t\t\tif (tempArray[4] === 'true') keyComboString += 'command-';\r\n\t\t}\r\n\t\ttestCode = parseInt(charCode, 10);\r\n\t} else if (typeof charCode === 'object') {\r\n\t\ttestCode = parseInt(charCode[0], 10);\r\n\t\tif (charCode[1]) keyComboString += 'alt-';\r\n\t\tif (charCode[2]) keyComboString += 'ctrl-';\r\n\t\tif (charCode[3]) keyComboString += 'shift-';\r\n\t\tif (charCode[4]) keyComboString += 'command-';\r\n\t}\r\n\tswitch (testCode) {\r\n\t\tcase -1:\r\n\t\t\tniceString = 'none'; //  none\r\n\t\t\tbreak;\r\n\t\tcase 8:\r\n\t\t\tniceString = 'backspace'; //  backspace\r\n\t\t\tbreak;\r\n\t\tcase 9:\r\n\t\t\tniceString = 'tab'; //  tab\r\n\t\t\tbreak;\r\n\t\tcase 13:\r\n\t\t\tniceString = 'enter'; //  enter\r\n\t\t\tbreak;\r\n\t\tcase 16:\r\n\t\t\tniceString = 'shift'; //  shift\r\n\t\t\tbreak;\r\n\t\tcase 17:\r\n\t\t\tniceString = 'ctrl'; //  ctrl\r\n\t\t\tbreak;\r\n\t\tcase 18:\r\n\t\t\tniceString = 'alt'; //  alt\r\n\t\t\tbreak;\r\n\t\tcase 19:\r\n\t\t\tniceString = 'pause/break'; //  pause/break\r\n\t\t\tbreak;\r\n\t\tcase 20:\r\n\t\t\tniceString = 'caps lock'; //  caps lock\r\n\t\t\tbreak;\r\n\t\tcase 27:\r\n\t\t\tniceString = 'escape'; //  escape\r\n\t\t\tbreak;\r\n\t\tcase 33:\r\n\t\t\tniceString = 'page up'; // page up, to avoid displaying alternate character and confusing people\r\n\t\t\tbreak;\r\n\t\tcase 34:\r\n\t\t\tniceString = 'page down'; // page down\r\n\t\t\tbreak;\r\n\t\tcase 35:\r\n\t\t\tniceString = 'end'; // end\r\n\t\t\tbreak;\r\n\t\tcase 36:\r\n\t\t\tniceString = 'home'; // home\r\n\t\t\tbreak;\r\n\t\tcase 37:\r\n\t\t\tniceString = 'left arrow'; // left arrow\r\n\t\t\tbreak;\r\n\t\tcase 38:\r\n\t\t\tniceString = 'up arrow'; // up arrow\r\n\t\t\tbreak;\r\n\t\tcase 39:\r\n\t\t\tniceString = 'right arrow'; // right arrow\r\n\t\t\tbreak;\r\n\t\tcase 40:\r\n\t\t\tniceString = 'down arrow'; // down arrow\r\n\t\t\tbreak;\r\n\t\tcase 45:\r\n\t\t\tniceString = 'insert'; // insert\r\n\t\t\tbreak;\r\n\t\tcase 46:\r\n\t\t\tniceString = 'delete'; // delete\r\n\t\t\tbreak;\r\n\t\tcase 91:\r\n\t\t\tniceString = 'left window'; // left window\r\n\t\t\tbreak;\r\n\t\tcase 92:\r\n\t\t\tniceString = 'right window'; // right window\r\n\t\t\tbreak;\r\n\t\tcase 93:\r\n\t\t\tniceString = 'select key'; // select key\r\n\t\t\tbreak;\r\n\t\tcase 96:\r\n\t\t\tniceString = 'numpad 0'; // numpad 0\r\n\t\t\tbreak;\r\n\t\tcase 97:\r\n\t\t\tniceString = 'numpad 1'; // numpad 1\r\n\t\t\tbreak;\r\n\t\tcase 98:\r\n\t\t\tniceString = 'numpad 2'; // numpad 2\r\n\t\t\tbreak;\r\n\t\tcase 99:\r\n\t\t\tniceString = 'numpad 3'; // numpad 3\r\n\t\t\tbreak;\r\n\t\tcase 100:\r\n\t\t\tniceString = 'numpad 4'; // numpad 4\r\n\t\t\tbreak;\r\n\t\tcase 101:\r\n\t\t\tniceString = 'numpad 5'; // numpad 5\r\n\t\t\tbreak;\r\n\t\tcase 102:\r\n\t\t\tniceString = 'numpad 6'; // numpad 6\r\n\t\t\tbreak;\r\n\t\tcase 103:\r\n\t\t\tniceString = 'numpad 7'; // numpad 7\r\n\t\t\tbreak;\r\n\t\tcase 104:\r\n\t\t\tniceString = 'numpad 8'; // numpad 8\r\n\t\t\tbreak;\r\n\t\tcase 105:\r\n\t\t\tniceString = 'numpad 9'; // numpad 9\r\n\t\t\tbreak;\r\n\t\tcase 106:\r\n\t\t\tniceString = 'multiply'; // multiply\r\n\t\t\tbreak;\r\n\t\tcase 107:\r\n\t\t\tniceString = 'add'; // add\r\n\t\t\tbreak;\r\n\t\tcase 109:\r\n\t\t\tniceString = 'subtract'; // subtract\r\n\t\t\tbreak;\r\n\t\tcase 110:\r\n\t\t\tniceString = 'decimal point'; // decimal point\r\n\t\t\tbreak;\r\n\t\tcase 111:\r\n\t\t\tniceString = 'divide'; // divide\r\n\t\t\tbreak;\r\n\t\tcase 112:\r\n\t\t\tniceString = 'F1'; // F1\r\n\t\t\tbreak;\r\n\t\tcase 113:\r\n\t\t\tniceString = 'F2'; // F2\r\n\t\t\tbreak;\r\n\t\tcase 114:\r\n\t\t\tniceString = 'F3'; // F3\r\n\t\t\tbreak;\r\n\t\tcase 115:\r\n\t\t\tniceString = 'F4'; // F4\r\n\t\t\tbreak;\r\n\t\tcase 116:\r\n\t\t\tniceString = 'F5'; // F5\r\n\t\t\tbreak;\r\n\t\tcase 117:\r\n\t\t\tniceString = 'F6'; // F6\r\n\t\t\tbreak;\r\n\t\tcase 118:\r\n\t\t\tniceString = 'F7'; // F7\r\n\t\t\tbreak;\r\n\t\tcase 119:\r\n\t\t\tniceString = 'F8'; // F8\r\n\t\t\tbreak;\r\n\t\tcase 120:\r\n\t\t\tniceString = 'F9'; // F9\r\n\t\t\tbreak;\r\n\t\tcase 121:\r\n\t\t\tniceString = 'F10'; // F10\r\n\t\t\tbreak;\r\n\t\tcase 122:\r\n\t\t\tniceString = 'F11'; // F11\r\n\t\t\tbreak;\r\n\t\tcase 123:\r\n\t\t\tniceString = 'F12'; // F12\r\n\t\t\tbreak;\r\n\t\tcase 144:\r\n\t\t\tniceString = 'num lock'; // num lock\r\n\t\t\tbreak;\r\n\t\tcase 145:\r\n\t\t\tniceString = 'scroll lock'; // scroll lock\r\n\t\t\tbreak;\r\n\t\tcase 186:\r\n\t\t\tniceString = ';'; // semi-colon\r\n\t\t\tbreak;\r\n\t\tcase 187:\r\n\t\t\tniceString = '='; // equal-sign\r\n\t\t\tbreak;\r\n\t\tcase 188:\r\n\t\t\tniceString = ','; // comma\r\n\t\t\tbreak;\r\n\t\tcase 189:\r\n\t\t\tniceString = '-'; // dash\r\n\t\t\tbreak;\r\n\t\tcase 190:\r\n\t\t\tniceString = '.'; // period\r\n\t\t\tbreak;\r\n\t\tcase 191:\r\n\t\t\tniceString = '/'; // forward slash\r\n\t\t\tbreak;\r\n\t\tcase 192:\r\n\t\t\tniceString = '`'; // grave accent\r\n\t\t\tbreak;\r\n\t\tcase 219:\r\n\t\t\tniceString = '['; // open bracket\r\n\t\t\tbreak;\r\n\t\tcase 220:\r\n\t\t\tniceString = '\\\\'; // back slash\r\n\t\t\tbreak;\r\n\t\tcase 221:\r\n\t\t\tniceString = ']'; // close bracket\r\n\t\t\tbreak;\r\n\t\tcase 222:\r\n\t\t\tniceString = '\\''; // single quote\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tniceString = String.fromCharCode(testCode);\r\n\t\t\tbreak;\r\n\t}\r\n\treturn keyComboString + niceString;\r\n};\r\nRESUtils.niceDate = function(d, usformat) {\r\n\td = d || new Date();\r\n\tvar year = d.getFullYear();\r\n\tvar month = (d.getMonth() + 1);\r\n\tmonth = (month < 10) ? '0' + month : month;\r\n\tvar day = d.getDate();\r\n\tday = (day < 10) ? '0' + day : day;\r\n\tvar fullString = year + '-' + month + '-' + day;\r\n\tif (usformat) {\r\n\t\tfullString = month + '-' + day + '-' + year;\r\n\t}\r\n\treturn fullString;\r\n};\r\nRESUtils.niceDateTime = function(d, usformat) {\r\n\td = d || new Date();\r\n\tvar dateString = RESUtils.niceDate(d, usformat);\r\n\tvar hours = d.getHours();\r\n\thours = (hours < 10) ? '0' + hours : hours;\r\n\tvar minutes = d.getMinutes();\r\n\tminutes = (minutes < 10) ? '0' + minutes : minutes;\r\n\tvar seconds = d.getSeconds();\r\n\tseconds = (seconds < 10) ? '0' + seconds : seconds;\r\n\tvar fullString = dateString + ' ' + hours + ':' + minutes + ':' + seconds;\r\n\treturn fullString;\r\n};\r\nRESUtils.niceDateDiff = function(origdate, newdate) {\r\n\t// Enter the month, day, and year below you want to use as\r\n\t// the starting point for the date calculation\r\n\tif (!newdate) {\r\n\t\tnewdate = new Date();\r\n\t}\r\n\r\n\tvar amonth = origdate.getUTCMonth() + 1;\r\n\tvar aday = origdate.getUTCDate();\r\n\tvar ayear = origdate.getUTCFullYear();\r\n\r\n\tvar tmonth = newdate.getUTCMonth() + 1;\r\n\tvar tday = newdate.getUTCDate();\r\n\tvar tyear = newdate.getUTCFullYear();\r\n\r\n\tvar y = 1;\r\n\tvar mm = 1;\r\n\tvar d = 1;\r\n\tvar a2 = 0;\r\n\tvar a1 = 0;\r\n\tvar f = 28;\r\n\r\n\tif (((tyear % 4 === 0) && (tyear % 100 !== 0)) || (tyear % 400 === 0)) {\r\n\t\tf = 29;\r\n\t}\r\n\r\n\tvar m = [31, f, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\n\r\n\tvar dyear = tyear - ayear;\r\n\r\n\tvar dmonth = tmonth - amonth;\r\n\tif (dmonth < 0 && dyear > 0) {\r\n\t\tdmonth += 12;\r\n\t\tdyear--;\r\n\t}\r\n\r\n\tvar dday = tday - aday;\r\n\tif (dday < 0) {\r\n\t\tif (dmonth > 0) {\r\n\t\t\tvar ma = tmonth - 1;\r\n\t\t\t// Retrive total number of days in month before tmonth\r\n\t\t\t// Can think of diff as (dmonth-1) months, and\r\n\t\t\t// (daysIn(tmonth-1) + tday - aday) days\r\n\t\t\tdday += m[((ma + 12) - 1) % 12];\r\n\t\t\t// Months are 0 indexed in array m but 1 indexed for\r\n\t\t\t// amonth and tmonth. This compensates for that\r\n\t\t\tdmonth--;\r\n\t\t\tif (dmonth < 0) {\r\n\t\t\t\tdyear--;\r\n\t\t\t\tdmonth += 12;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdday = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tvar returnString = '';\r\n\r\n\tif (dyear === 0) {\r\n\t\ty = 0;\r\n\t}\r\n\tif (dmonth === 0) {\r\n\t\tmm = 0;\r\n\t}\r\n\tif (dday === 0) {\r\n\t\td = 0;\r\n\t}\r\n\tif ((y === 1) && (mm === 1)) {\r\n\t\ta1 = 1;\r\n\t}\r\n\tif ((y === 1) && (d === 1)) {\r\n\t\ta1 = 1;\r\n\t}\r\n\tif ((mm === 1) && (d === 1)) {\r\n\t\ta2 = 1;\r\n\t}\r\n\tif (y === 1) {\r\n\t\tif (dyear === 1) {\r\n\t\t\treturnString += dyear + ' year';\r\n\t\t} else {\r\n\t\t\treturnString += dyear + ' years';\r\n\t\t}\r\n\t}\r\n\tif ((a1 === 1) && (a2 === 0)) {\r\n\t\treturnString += ' and ';\r\n\t}\r\n\tif ((a1 === 1) && (a2 === 1)) {\r\n\t\treturnString += ', ';\r\n\t}\r\n\tif (mm === 1) {\r\n\t\tif (dmonth === 1) {\r\n\t\t\treturnString += dmonth + ' month';\r\n\t\t} else {\r\n\t\t\treturnString += dmonth + ' months';\r\n\t\t}\r\n\t}\r\n\tif (a2 === 1) {\r\n\t\treturnString += ' and ';\r\n\t}\r\n\tif (d === 1) {\r\n\t\tif (dday === 1) {\r\n\t\t\treturnString += dday + ' day';\r\n\t\t} else {\r\n\t\t\treturnString += dday + ' days';\r\n\t\t}\r\n\t}\r\n\tif (returnString === '') {\r\n\t\treturnString = '0 days';\r\n\t}\r\n\treturn returnString;\r\n};\r\n\r\nRESUtils.isEmpty = function(obj) {\r\n\tfor (var prop in obj) {\r\n\t\tif (obj.hasOwnProperty(prop))\r\n\t\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nRESUtils.openLinkInNewTab = function(url, focus) {\r\n\tvar thisJSON = {\r\n\t\trequestType: 'openLinkInNewTab',\r\n\t\tlinkURL: url,\r\n\t\tbutton: focus\r\n\t};\r\n\r\n\tRESEnvironment.sendMessage(thisJSON);\r\n};\r\nRESUtils.createElement = function(elementType, id, classname, textContent) {\r\n\tvar obj = document.createElement(elementType);\r\n\tif (id) {\r\n\t\tobj.setAttribute('id', id);\r\n\t}\r\n\tif ((typeof classname !== 'undefined') && classname && (classname !== '')) {\r\n\t\tobj.setAttribute('class', classname);\r\n\t}\r\n\tif (textContent) {\r\n\t\tif (classname && classname.split(' ').indexOf('noCtrlF') !== -1) {\r\n\t\t\tobj.setAttribute('data-text', textContent);\r\n\t\t} else {\r\n\t\t\tobj.textContent = textContent;\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\nRESUtils.createElementWithID = RESUtils.createElement; // legacy alias\r\nRESUtils.createElement.toggleButton = function(moduleID, fieldID, enabled, onText, offText, isTable) {\r\n\tvar checked, thisToggle,\r\n\t\ttoggleOn, toggleOff, field;\r\n\r\n\tenabled = enabled || false;\r\n\tchecked = (enabled) ? 'CHECKED' : '';\r\n\tonText = onText || 'on';\r\n\toffText = offText || 'off';\r\n\tthisToggle = document.createElement('div');\r\n\tthisToggle.setAttribute('class', 'toggleButton');\r\n\tthisToggle.setAttribute('id', fieldID + 'Container');\r\n\r\n\ttoggleOn = RESUtils.createElement('span', null, 'toggleOn noCtrlF', onText);\r\n\ttoggleOff = RESUtils.createElement('span', null, 'toggleOff noCtrlF', offText);\r\n\tfield = RESUtils.createElement('input', fieldID);\r\n\tfield.name = fieldID;\r\n\tfield.type = 'checkbox';\r\n\tif (enabled) {\r\n\t\tfield.checked = true;\r\n\t}\r\n\tif (isTable) {\r\n\t\tfield.setAttribute('tableOption', 'true');\r\n\t}\r\n\r\n\tthisToggle.appendChild(toggleOn);\r\n\tthisToggle.appendChild(toggleOff);\r\n\tthisToggle.appendChild(field);\r\n\tthisToggle.addEventListener('click', function(e) {\r\n\t\tvar thisCheckbox = this.querySelector('input[type=checkbox]'),\r\n\t\t\tenabled = thisCheckbox.checked;\r\n\t\tthisCheckbox.checked = !enabled;\r\n\t\tif (enabled) {\r\n\t\t\tthis.classList.remove('enabled');\r\n\t\t} else {\r\n\t\t\tthis.classList.add('enabled');\r\n\t\t}\r\n\t\tif (moduleID) {\r\n\t\t\tmodules['settingsConsole'].onOptionChange(moduleID, fieldID, enabled, !enabled);\r\n\t\t}\r\n\t}, false);\r\n\tif (enabled) thisToggle.classList.add('enabled');\r\n\treturn thisToggle;\r\n};\r\nRESUtils.createElement.commaDelimitedNumber = function(nStr) {\r\n\tnStr = typeof nStr === 'string' ? nStr.replace(/[^\\w]/, '') : nStr;\r\n\tvar locale = document.querySelector('html').getAttribute('lang') || 'en';\r\n\treturn Number(nStr).toLocaleString(locale);\r\n};\r\nRESUtils.createElement.table = function(items, call, context) {\r\n\tif (!items || !call) return;\r\n\t// Sanitize single item into items array\r\n\tif (!(items.length && typeof items !== 'string')) items = [items];\r\n\r\n\tvar description = [];\r\n\tdescription.push('<table>');\r\n\r\n\tfor (var i = 0; i < items.length; i++) {\r\n\t\tvar item = call(items[i], i, items, context);\r\n\t\tif (typeof item === 'string') {\r\n\t\t\tdescription.push(item);\r\n\t\t} else if (item.length) {\r\n\t\t\tdescription = description.concat(item);\r\n\t\t}\r\n\t}\r\n\tdescription.push('</table>');\r\n\tdescription = description.join('\\n');\r\n\r\n\treturn description;\r\n};\r\nRESUtils.xhrCache = function(operation) {\r\n\tvar thisJSON = {\r\n\t\trequestType: 'XHRCache',\r\n\t\toperation: operation\r\n\t};\r\n\r\n\tRESEnvironment.sendMessage(thisJSON);\r\n};\r\nRESUtils.initObservers = function() {\r\n\tvar MutationObserver = RESEnvironment.getMutationObserver();\r\n\tvar siteTable, observer;\r\n\tif (RESUtils.pageType() !== 'comments') {\r\n\t\t// initialize sitetable observer...\r\n\t\tsiteTable = RESUtils.thingsContainer();\r\n\r\n\t\tif (MutationObserver && siteTable) {\r\n\t\t\tobserver = new MutationObserver(function(mutations) {\r\n\t\t\t\tmutations.forEach(function(mutation) {\r\n\t\t\t\t\tif ($(mutation.addedNodes[0]).is(RESUtils.thing.prototype.containerSelector)) {\r\n\t\t\t\t\t\t// when a new sitetable is loaded, we need to add new observers for selftexts within that sitetable...\r\n\t\t\t\t\t\t$(mutation.addedNodes[0]).find('.entry div.expando').each(function() {\r\n\t\t\t\t\t\t\tRESUtils.addSelfTextObserver(this);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tRESUtils.watchers.siteTable.forEach(function(callback) {\r\n\t\t\t\t\t\t\tif (callback) callback(mutation.addedNodes[0]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tobserver.observe(siteTable, {\r\n\t\t\t\tattributes: false,\r\n\t\t\t\tchildList: true,\r\n\t\t\t\tcharacterData: false\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\t// initialize sitetable observer...\r\n\t\tsiteTable = document.querySelector('.commentarea > .sitetable');\r\n\t\tif (!siteTable) {\r\n\t\t\tsiteTable = document.querySelector('.sitetable');\r\n\t\t}\r\n\r\n\t\tif (MutationObserver && siteTable) {\r\n\t\t\tobserver = new MutationObserver(function(mutations) {\r\n\t\t\t\tmutations.forEach(function(mutation) {\r\n\r\n\t\t\t\t\t// handle comment listing pages (not within a post)\r\n\t\t\t\t\tvar $container = $(mutation.addedNodes[0]);\r\n\t\t\t\t\tif ($container.is('[id^=\"siteTable\"]')) {\r\n\t\t\t\t\t\t// when a new sitetable is loaded, we need to add new observers for selftexts within that sitetable...\r\n\t\t\t\t\t\t$container.find('.entry div.expando').each(function() {\r\n\t\t\t\t\t\t\tRESUtils.addSelfTextObserver(this);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tRESUtils.watchers.siteTable.forEach(function(callback) {\r\n\t\t\t\t\t\t\tif (callback) callback(mutation.addedNodes[0]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (mutation.addedNodes.length > 0 && mutation.addedNodes[0].classList.contains('thing')) {\r\n\t\t\t\t\t\tvar thing = mutation.addedNodes[0];\r\n\t\t\t\t\t\tvar newCommentEntry = thing.querySelector('.entry');\r\n\t\t\t\t\t\tif (!$(newCommentEntry).data('alreadyDetected')) {\r\n\t\t\t\t\t\t\t$(newCommentEntry).data('alreadyDetected', true);\r\n\t\t\t\t\t\t\t$(thing).find('.child').each(function() {\r\n\t\t\t\t\t\t\t\tRESUtils.addNewCommentFormObserver(this);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tRESUtils.watchers.newComments.forEach(function(callback) {\r\n\t\t\t\t\t\t\t\tif (callback) callback(newCommentEntry);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tobserver.observe(siteTable, {\r\n\t\t\t\tattributes: false,\r\n\t\t\t\tchildList: true,\r\n\t\t\t\tcharacterData: false\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t$('.entry div.expando').each(function() {\r\n\t\tRESUtils.addSelfTextObserver(this);\r\n\t});\r\n\r\n\t// initialize new comments observers on demand, by first wiring up click listeners to \"load more comments\" buttons.\r\n\t// on click, we'll add a mutation observer...\r\n\t$('.morecomments a').on('click', RESUtils.addNewCommentObserverToTarget);\r\n\r\n\t// initialize new comments forms observers on demand, by first wiring up click listeners to reply buttons.\r\n\t// on click, we'll add a mutation observer...\r\n\t// $('body').on('click', 'ul.flat-list li a[onclick*=reply]', RESUtils.addNewCommentFormObserver);\r\n\t$('.thing .child').each(function() {\r\n\t\tRESUtils.addNewCommentFormObserver(this);\r\n\t});\r\n\r\n};\r\n\r\nRESUtils.addNewCommentObserverToTarget = function(e) {\r\n\tvar ele = $(e.currentTarget).closest('.sitetable')[0];\r\n\t// mark this as having an observer so we don't add multiples...\r\n\tif (!$(ele).hasClass('hasObserver')) {\r\n\t\t$(ele).addClass('hasObserver');\r\n\t\tRESUtils.addNewCommentObserver(ele);\r\n\t}\r\n};\r\nRESUtils.addNewCommentObserver = function(ele) {\r\n\tvar mutationNodeToObserve = ele;\r\n\tvar MutationObserver = RESEnvironment.getMutationObserver();\r\n\tif (MutationObserver) {\r\n\t\tvar observer = new MutationObserver(function(mutations) {\r\n\t\t\t// we need to get ONLY the nodes that are new...\r\n\t\t\t// get the nodeList from each mutation, find comments within it,\r\n\t\t\t// then call our callback on it.\r\n\t\t\tfor (var i = 0, len = mutations.length; i < len; i++) {\r\n\t\t\t\tvar thisMutation = mutations[i];\r\n\t\t\t\tvar nodeList = thisMutation.addedNodes;\r\n\t\t\t\t// look at the added nodes, and find comment containers.\r\n\t\t\t\tfor (var j = 0, jLen = nodeList.length; j < jLen; j++) {\r\n\t\t\t\t\tif (nodeList[j].classList.contains('thing')) {\r\n\t\t\t\t\t\t$(nodeList[j]).find('.child').each(function() {\r\n\t\t\t\t\t\t\tRESUtils.addNewCommentFormObserver(this);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// check for \"load new comments\" links within this group as well...\r\n\t\t\t\t\t\t$(nodeList[j]).find('.morecomments a').click(RESUtils.addNewCommentObserverToTarget);\r\n\r\n\t\t\t\t\t\tvar subComments = nodeList[j].querySelectorAll('.entry');\r\n\t\t\t\t\t\t// look at the comment containers and find actual comments...\r\n\t\t\t\t\t\tfor (var k = 0, kLen = subComments.length; k < kLen; k++) {\r\n\t\t\t\t\t\t\tvar thisComment = subComments[k];\r\n\t\t\t\t\t\t\tif (!$(thisComment).data('alreadyDetected')) {\r\n\t\t\t\t\t\t\t\t$(thisComment).data('alreadyDetected', true);\r\n\t\t\t\t\t\t\t\tRESUtils.watchers.newComments.forEach(function(callback) {\r\n\t\t\t\t\t\t\t\t\tif (callback) callback(thisComment);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// RESUtils.watchers.newComments.forEach(function(callback) {\r\n\t\t\t// // add form observers to these new comments we've found...\r\n\t\t\t//\t$(mutations[0].target).find('.thing .child').each(function() {\r\n\t\t\t//\t\tRESUtils.addNewCommentFormObserver(this);\r\n\t\t\t//\t});\r\n\t\t\t//\t// check for \"load new comments\" links within this group as well...\r\n\t\t\t//\t$(mutations[0].target).find('.morecomments a').click(RESUtils.addNewCommentObserverToTarget);\r\n\t\t\t//\tcallback(mutations[0].target);\r\n\t\t\t// });\r\n\r\n\t\t\t// disconnect this observer once all callbacks have been run.\r\n\t\t\t// unless we have the nestedlisting class, in which case don't disconnect because that's a\r\n\t\t\t// bottom level load more comments where even more can be loaded after, so they all drop into this\r\n\t\t\t// same .sitetable div.\r\n\t\t\tif (!$(ele).hasClass('nestedlisting')) {\r\n\t\t\t\tobserver.disconnect();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tobserver.observe(mutationNodeToObserve, {\r\n\t\t\tattributes: false,\r\n\t\t\tchildList: true,\r\n\t\t\tcharacterData: false\r\n\t\t});\r\n\t}\r\n};\r\nRESUtils.addNewCommentFormObserver = function(ele) {\r\n\tvar commentsFormParent = ele;\r\n\tvar MutationObserver = RESEnvironment.getMutationObserver();\r\n\tif (MutationObserver) {\r\n\t\t// var mutationNodeToObserve = moreCommentsParent.parentNode.parentNode.parentNode.parentNode;\r\n\t\tvar observer = new MutationObserver(function(mutations) {\r\n\t\t\tvar form = $(mutations[0].target).children('form');\r\n\t\t\tif ((form) && (form.length === 1)) {\r\n\t\t\t\tRESUtils.watchers.newCommentsForms.forEach(function(callback) {\r\n\t\t\t\t\tcallback(form[0]);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tvar newOwnComment = $(mutations[0].target).find(' > div.sitetable > .thing:first-child'); // assumes new comment will be prepended to sitetable's children\r\n\t\t\t\tif ((newOwnComment) && (newOwnComment.length === 1)) {\r\n\t\t\t\t\t// new comment detected from the current user...\r\n\t\t\t\t\tRESUtils.watchers.newComments.forEach(function(callback) {\r\n\t\t\t\t\t\tcallback(newOwnComment[0]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tobserver.observe(commentsFormParent, {\r\n\t\t\tattributes: false,\r\n\t\t\tchildList: true,\r\n\t\t\tcharacterData: false\r\n\t\t});\r\n\t}\r\n};\r\nRESUtils.addSelfTextObserver = function(ele) {\r\n\tvar selfTextParent = ele;\r\n\tvar MutationObserver = RESEnvironment.getMutationObserver();\r\n\tif (MutationObserver) {\r\n\t\t// var mutationNodeToObserve = moreCommentsParent.parentNode.parentNode.parentNode.parentNode;\r\n\t\tvar observer = new MutationObserver(function(mutations) {\r\n\t\t\tvar form = $(mutations[0].target).find('form');\r\n\t\t\tif ((form) && (form.length > 0)) {\r\n\t\t\t\tRESUtils.watchers.selfText.forEach(function(callback) {\r\n\t\t\t\t\tcallback(form[0]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tobserver.observe(selfTextParent, {\r\n\t\t\tattributes: false,\r\n\t\t\tchildList: true,\r\n\t\t\tcharacterData: false\r\n\t\t});\r\n\t}\r\n};\r\nRESUtils.watchForElement = function(type, callback) {\r\n\tswitch (type) {\r\n\t\tcase 'siteTable':\r\n\t\t\tRESUtils.watchers.siteTable.push(callback);\r\n\t\t\tbreak;\r\n\t\tcase 'newComments':\r\n\t\t\tRESUtils.watchers.newComments.push(callback);\r\n\t\t\tbreak;\r\n\t\tcase 'selfText':\r\n\t\t\tRESUtils.watchers.selfText.push(callback);\r\n\t\t\tbreak;\r\n\t\tcase 'newCommentsForms':\r\n\t\t\tRESUtils.watchers.newCommentsForms.push(callback);\r\n\t\t\tbreak;\r\n\t}\r\n};\r\nRESUtils.watchers = {\r\n\tsiteTable: [],\r\n\tnewComments: [],\r\n\tselfText: [],\r\n\tnewCommentsForms: []\r\n};\r\n// A link is a comment code if all these conditions are true:\r\n// * It has no content (i.e. content.length === 0)\r\n// * Its href is of the form \"/code\" or \"#code\"\r\n//\r\n// In case it's not clear, here is a list of some common comment\r\n// codes on a specific subreddit:\r\n// http://www.reddit.com/r/metarage/comments/p3eqe/full_updated_list_of_comment_faces_wcodes/\r\n// also for CSS hacks to do special formatting, like /r/CSSlibrary\r\n\r\nRESUtils.COMMENT_CODE_REGEX = /^[\\/#].+$/;\r\nRESUtils.isCommentCode = function(link) {\r\n\t// don't add annotations for hidden links - these are used as CSS\r\n\t// hacks on subreddits to do special formatting, etc.\r\n\r\n\t// Note that link.href will return the full href (which includes the\r\n\t// reddit.com domain). We don't want that.\r\n\tvar href = link.getAttribute('href');\r\n\r\n\tvar emptyText = link.textContent.length === 0;\r\n\tvar isCommentCode = RESUtils.COMMENT_CODE_REGEX.test(href);\r\n\r\n\treturn emptyText && isCommentCode;\r\n};\r\nRESUtils.isEmptyLink = function(link) {\r\n\t// Note that link.href will return the full href (which includes the\r\n\t// reddit.com domain). We don't want that.\r\n\tvar href = link.getAttribute('href');\r\n\treturn typeof href !== 'string' || href.substring(0, 11) === 'javascript:'; // eslint-disable-line no-script-url\r\n};\r\n/*\r\nStarts a unique named timeout.\r\nIf there is a running timeout with the same name cancel the old one in favor of the new.\r\nCall with no time/call parameter (null/undefined/missing) to and existing one with the given name.\r\nUsed to derfer an action until a series of events has stopped.\r\ne.g. wait until a user a stopped typing to update a comment preview.\r\n(name based on similar function in underscore.js)\r\n*/\r\nRESUtils.debounceTimeouts = {};\r\nRESUtils.debounce = function(name, time, call, data) {\r\n\tif (name === null) return;\r\n\tif (RESUtils.debounceTimeouts[name] !== undefined) {\r\n\t\twindow.clearTimeout(RESUtils.debounceTimeouts[name]);\r\n\t\tdelete RESUtils.debounceTimeouts[name];\r\n\t}\r\n\tif (typeof time === 'number' && typeof call === 'function') {\r\n\t\tRESUtils.debounceTimeouts[name] = window.setTimeout(function() {\r\n\t\t\tdelete RESUtils.debounceTimeouts[name];\r\n\t\t\tcall(data);\r\n\t\t}, time);\r\n\t}\r\n};\r\nRESUtils.toolTipTimers = {};\r\n/*\r\nIterate through an array in chunks, executing a callback on each element.\r\nEach chunk is handled asynchronously from the others with a delay betwen each batch.\r\nIf the provided callback returns false iteration will be halted.\r\n*/\r\nRESUtils.forEachChunked = function(array, chunkSize, delay, call) {\r\n\tif (typeof array === 'undefined' || array === null) return;\r\n\tif (typeof chunkSize === 'undefined' || chunkSize === null || chunkSize < 1) return;\r\n\tif (typeof delay === 'undefined' || delay === null || delay < 0) return;\r\n\tif (typeof call === 'undefined' || call === null) return;\r\n\tvar counter = 0,\r\n\t\tlength = array.length;\r\n\r\n\tfunction doChunk() {\r\n\t\tfor (var end = Math.min(length, counter + chunkSize); counter < end; counter++) {\r\n\t\t\tvar ret = call(array[counter], counter, array);\r\n\t\t\tif (ret === false) return;\r\n\t\t}\r\n\t\tif (counter < length) {\r\n\t\t\tsetTimeout(doChunk, delay);\r\n\t\t}\r\n\t}\r\n\tsetTimeout(doChunk, delay);\r\n};\r\nRESUtils.getComputedStyle = function(elem, property) {\r\n\tif (elem.constructor === String) {\r\n\t\telem = document.querySelector(elem);\r\n\t} else if (!(elem instanceof Node)) {\r\n\t\treturn undefined;\r\n\t}\r\n\tvar strValue;\r\n\tif (document.defaultView && document.defaultView.getComputedStyle) {\r\n\t\tstrValue = document.defaultView.getComputedStyle(elem, '').getPropertyValue(property);\r\n\t} else if (elem.currentStyle) {\r\n\t\tproperty = property.replace(/\\-(\\w)/g, function(strMatch, p1) {\r\n\t\t\treturn p1.toUpperCase();\r\n\t\t});\r\n\t\tstrValue = elem.currentStyle[property];\r\n\t}\r\n\treturn strValue;\r\n};\r\n// utility function for checking events against keyCode arrays\r\nRESUtils.checkKeysForEvent = function(event, keyArray) {\r\n\t//[keycode, alt, ctrl, shift, meta]\r\n\t// if we've passed in a number, fix that and make it an array with alt, shift and ctrl set to false.\r\n\tif (typeof keyArray === 'number') {\r\n\t\tkeyArray = [keyArray, false, false, false, false];\r\n\t} else if (keyArray.length === 4) {\r\n\t\tkeyArray.push(false);\r\n\t}\r\n\r\n\tvar eventHash = RESUtils.hashKeyEvent(event);\r\n\tvar arrayHash = RESUtils.hashKeyArray(keyArray);\r\n\tvar matches = (eventHash === arrayHash);\r\n\r\n\treturn matches;\r\n};\r\nRESUtils.hashKeyEvent = function(event) {\r\n\tvar keyArray = [ event.keyCode, event.altKey, event.ctrlKey, event.shiftKey, event.metaKey ];\r\n\r\n\t// this hack is because Firefox differs from other browsers with keycodes for - and =\r\n\tif (BrowserDetect.isFirefox()) {\r\n\t\tif (keyArray[0] === 173) {\r\n\t\t\tkeyArray[0] = 189;\r\n\r\n\t\t}\r\n\t\tif (keyArray[0] === 61) {\r\n\t\t\tkeyArray[0] = 187;\r\n\t\t}\r\n\t}\r\n\r\n\treturn RESUtils.hashKeyArray(keyArray);\r\n};\r\nRESUtils.hashKeyArray = function(keyArray) {\r\n\tvar length = 5;\r\n\tvar hash = keyArray[0] * Math.pow(2, length);\r\n\tfor (var i = 1; i < length; i++) {\r\n\t\tif (keyArray[i]) {\r\n\t\t\thash += Math.pow(2, i);\r\n\t\t}\r\n\t}\r\n\treturn hash;\r\n};\r\n// Retrieves either a live or cached copy of some data from reddit's api, i.e.\r\n//\tRESUtils.cache.fetch({\r\n//\t\tkey: 'RESmodules.module.subs.username', // optional, necessary to distinguish between users if the endpoint doesn't\r\n//\t\tendpoint: 'subreddits/mine/moderator.json?limit=100',\r\n//\t\texpires: 0, // optional: default 30000 (5 minutes)\r\n//\t\thandleData: function(response, expiredData) { return response.data.children; }, // optional: default `return response;`\r\n//\t\tcallback: function(data) { RESUtils.someFunction(data); }\r\n//\t});\r\n(function() {\r\n\tRESUtils.cache = RESUtils.cache || {};\r\n\tfunction makeCacheKey(obj) {\r\n\t\tvar key;\r\n\t\tif (typeof obj.key === 'string') {\r\n\t\t\tkey = obj.key;\r\n\t\t} else if (typeof obj.endpoint === 'string') {\r\n\t\t\tkey = 'RESUtils.cache.' + obj.endpoint.replace(/[^\\w\\-]/g, '-');\r\n\t\t} else {\r\n\t\t\tconsole.error('makeCacheKey: no key or endpoint specified.');\r\n\t\t}\r\n\t\treturn key;\r\n\t}\r\n\tvar fetching = {};\r\n\tRESUtils.cache.fetch = function(obj) {\r\n\t\tvar deferred;\r\n\t\tif (typeof obj.callback !== 'function') {\r\n\t\t\tconsole.error('RESUtils.cache.fetch: no callback given');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (typeof obj.endpoint !== 'string') {\r\n\t\t\tconsole.error('RESUtils.cache.fetch: no endpoint given');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tobj.key = makeCacheKey(obj);\r\n\t\tobj.expires = (typeof obj.expires === 'number') ? obj.expires : 300000;\r\n\t\tobj.handleData = (typeof obj.handleData === 'function') ? obj.handleData : function(data) { return data; };\r\n\r\n\t\tvar cache = safeJSON.parse(RESStorage.getItem(obj.key), obj.key, true) || {},\r\n\t\t\tlastCheck = (cache !== null) ? parseInt(cache.lastCheck, 10) || 0 : 0,\r\n\t\t\tnow = Date.now();\r\n\r\n\t\tif ((now - lastCheck) > obj.expires || lastCheck > now) {\r\n\t\t\tif (fetching[obj.key]) {\r\n\t\t\t\tdeferred = fetching[obj.key];\r\n\t\t\t} else {\r\n\t\t\t\tdeferred = fetching[obj.key] = $.Deferred();\r\n\t\t\t\tRESEnvironment.ajax({\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: location.protocol + '//' + location.hostname + '/' + obj.endpoint,\r\n\t\t\t\t\tdata: 'app=res',\r\n\t\t\t\t\tonload: function(response) {\r\n\t\t\t\t\t\tvar data;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tdata = JSON.parse(response.responseText);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tconsole.error('RESUtils.cache.fetch: Error parsing response from ' + this.url);\r\n\t\t\t\t\t\t\tconsole.log(response.responseText);\r\n\t\t\t\t\t\t\tdelete fetching[obj.key];\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar handled = obj.handleData(data, cache && cache.data);\r\n\t\t\t\t\t\tcache.data = (typeof handled !== 'undefined') ? handled : data;\r\n\t\t\t\t\t\tcache.lastCheck = now;\r\n\t\t\t\t\t\tRESStorage.setItem(obj.key, JSON.stringify(cache));\r\n\t\t\t\t\t\tdeferred.resolve(cache.data);\r\n\t\t\t\t\t\tdelete fetching[obj.key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdeferred = $.Deferred().resolve(cache.data);\r\n\t\t}\r\n\t\tif (obj.callback) {\r\n\t\t\tdeferred.done(obj.callback);\r\n\t\t}\r\n\r\n\t\treturn deferred.promise();\r\n\t};\r\n\tRESUtils.cache.expire = function(obj) {\r\n\t\tvar key = makeCacheKey(obj);\r\n\t\tif (key) {\r\n\t\t\tvar existingCache = RESStorage.getItem(key) || {},\r\n\t\t\t\tcache = {\r\n\t\t\t\t\tdata: existingCache.data,\r\n\t\t\t\t\tlastCheck: 0\r\n\t\t\t\t};\r\n\t\t\tRESStorage.setItem(key, JSON.stringify(cache));\r\n\t\t}\r\n\t};\r\n})();\r\nRESUtils.insertAfter = function(referenceNode, newNode, verbose) {\r\n\tif ((typeof referenceNode === 'undefined') || (referenceNode === null)) {\r\n\t\tif (verbose !== false) {\r\n\t\t\tconsole.error('Could not insert node after undefined node from', arguments.callee.caller, newNode);\r\n\t\t}\r\n\t} else if ((typeof referenceNode.parentNode !== 'undefined') && (typeof referenceNode.nextSibling !== 'undefined')) {\r\n\t\tif (referenceNode.parentNode === null) {\r\n\t\t\tif (verbose !== false) {\r\n\t\t\t\tconsole.error('Could not insert node after parentless node from', arguments.callee.caller, newNode);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treferenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n\t\t}\r\n\t}\r\n};\r\nRESUtils.cssPrefix = function(css) {\r\n\treturn '-webkit-' + css + ';' + '-o-' + css + ';' + '-moz-' + css + ';' +\r\n\t\t'-ms-' + css + ';' + css + ';';\r\n};\r\nRESUtils.baseStyleProtection = 'margin: 0 !important; background-color: inherit !important; color: inherit !important; position: relative !important; left: 0 !important; top: 0 !important; max-height: none!important; max-width: none!important; height: auto !important; width: auto !important; visibility: visible !important; overflow: auto !important; text-indent: 0 !important; font-size: 12px !important; float: none !important; opacity: 1 !important;' + RESUtils.cssPrefix('transform: none !important;') + RESUtils.cssPrefix('filter: none !important;');\r\n\r\nif (typeof exports === 'object') {\r\n\texports.RESUtils = RESUtils;\r\n\texports.escapeHTML = escapeHTML;\r\n\texports.modules = modules;\r\n\texports.addModule = addModule;\r\n\texports.libraries = libraries;\r\n\texports.addLibrary = addLibrary;\r\n\texports.safeJSON = safeJSON;\r\n\texports.perfTest = perfTest;\r\n}\r\n"],"sourceRoot":"/source/"}