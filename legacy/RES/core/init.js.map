{"version":3,"sources":["core/init.js"],"names":[],"mappings":"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","file":"core/init.js","sourcesContent":["RESUtils.init = function() {\r\n\t// Don't fire the script on the iframe. This annoyingly fires this whole thing twice. Yuck.\r\n\t// Also don't fire it on static.reddit or thumbs.reddit, as those are just images.\r\n\t// Also omit blog and code.reddit\r\n\tif (\r\n\t\t\t(/\\/toolbar\\/toolbar\\?id/i.test(location.href)) ||\r\n\t\t\t(/comscore-iframe/i.test(location.href)) ||\r\n\t\t\t(/(?:static|thumbs|blog|code)\\.reddit\\.com/i.test(location.hostname)) ||\r\n\t\t\t(/^[www\\.]?(?:i|m)\\.reddit\\.com/i.test(location.href)) ||\r\n\t\t\t(/\\.(?:compact|mobile)$/i.test(location.pathname)) ||\r\n\t\t\t(/metareddit\\.com/i.test(location.href))) {\r\n\t\treturn;\r\n\t}\r\n\tif (sessionStorage.getItem('RES.disabled')) return;\r\n\r\n\tRESUtils.init._watch();\r\n\tRESUtils.init._loadModules();\r\n\r\n\tRESUtils.init.await('metadata').done(function() { RESUtils.bodyClasses.init(); RESUtils.bodyClasses.add(); });\r\n\tRESUtils.init.await.documentReady().done(RESUtils.bodyClasses.add);\r\n\tRESUtils.init.await.bodyReady().done(RESUtils.bodyClasses.add);\r\n\tRESUtils.init.await.beforeLoad().done(RESUtils.bodyClasses.add);\r\n\tRESUtils.init.await.go().done(RESUtils.bodyClasses.add);\r\n\tRESUtils.init.await.bodyReady().done(RESUtils.watchMouseMove);\r\n\tRESUtils.init.await.bodyReady().done(RESUtils.init._homePage);\r\n\tRESUtils.deferred.all([\r\n\t\tRESUtils.init.await('metadata'),\r\n\t\tRESUtils.init.await.bodyReady()\r\n\t]).done(RESUtils.init._reportVersion);\r\n\tRESUtils.init.await('storage').fail(RESUtils.init._localStorageFailed);\r\n\r\n\tRESUtils.init.await.go().fail(RESUtils.init._showErrors);\r\n\tRESUtils.deferred.all([\r\n\t\tRESUtils.init.await.bodyReady(),\r\n\t\tRESUtils.init.await.go()\r\n\t]).done(RESUtils.initObservers);\r\n};\r\n\r\nRESUtils.init.await = function(type, id) {\r\n\tvar def = RESUtils.init.await._deferred(type, id);\r\n\treturn def.promise();\r\n};\r\n[ 'loadLibraries', 'loadDynamicOptions', 'options', 'beforeLoad', 'documentReady', 'headReady', 'bodyReady', 'go', 'afterLoad' ].forEach(function(type) {\r\n\tRESUtils.init.await[type] = RESUtils.init.await.bind(RESUtils.init, type);\r\n});\r\nRESUtils.init.await._deferreds = {};\r\nRESUtils.init.await._deferred = function(type, id, deferred) {\r\n\t// Wait for various pieces of the environment, memory, and app to be ready\r\n\tvar collection = RESUtils.init.await._deferreds;\r\n\r\n\ttype = typeof type !== 'undefined' ? type : 'go';\r\n\tid = typeof id !== 'undefined' ? id : '_all';\r\n\tcollection[type] = collection[type] || {};\r\n\r\n\tdeferred = deferred || collection[type][id] || $.Deferred();\r\n\tif (typeof deferred.promise !== 'function') {\r\n\t\tthrow [ 'Not a deferred: ', type, id, deferred ].join(' - ');\r\n\t}\r\n\r\n\tcollection[type][id] = deferred;\r\n\r\n\r\n\treturn collection[type][id];\r\n};\r\n\r\nRESUtils.init._watch = function() {\r\n\tRESUtils.init._watch.metadata();\r\n\tRESUtils.init._watch.storage();\r\n\tRESUtils.init._watch.documentReady();\r\n\tRESUtils.init._watch.headReady();\r\n\t$(RESUtils.init._watch.bodyReady);\r\n\tif (typeof window !== 'undefined') {\r\n\t\twindow.addEventListener('load', RESUtils.init._watch.contentLoaded, false);\r\n\t}\r\n};\r\n\r\nRESUtils.init._watch.metadata = function() {\r\n\tRESUtils.init.await._deferred('metadata', '_all', RESMetadata.setup());\r\n};\r\n\r\nRESUtils.init._watch.storage = function() {\r\n\tvar def = RESStorage.setup()\r\n\t\t.then(RESOptionsMigrate.migrate);\r\n\tRESUtils.init.await._deferred('storage', '_all', def);\r\n};\r\n\r\nRESUtils.init._watch.documentReady = function() {\r\n\tif (document && document.documentElement && document.documentElement.classList) {\r\n\t\tdocument.html = document.documentElement;\r\n\t\tRESUtils.init.await._deferred('documentReady').resolve();\r\n\t} else {\r\n\t\tsetTimeout(RESUtils.init._watch.documentReady, 1);\r\n\t}\r\n};\r\n\r\n\r\nRESUtils.init._watch.headReady = function() {\r\n\tif (document && document.head) {\r\n\t\tRESUtils.init.await._deferred('documentReady').resolve();\r\n\t\tRESUtils.init.await._deferred('headReady').resolve();\r\n\t} else {\r\n\t\tsetTimeout(RESUtils.init._watch.headReady, 1);\r\n\t}\r\n};\r\n\r\nRESUtils.init._watch.bodyReady = function() {\r\n\tif (document && document.body && document.body.classList) {\r\n\t\tRESUtils.init.await._deferred('documentReady').resolve();\r\n\t\tRESUtils.init.await._deferred('headReady').resolve();\r\n\t\tRESUtils.init.await._deferred('bodyReady').resolve();\r\n\t} else {\r\n\t\tsetTimeout(RESUtils.init._watch.bodyReady, 1);\r\n\t}\r\n};\r\n\r\nRESUtils.init._watch.contentLoaded = function() {\r\n\tRESUtils.init.await._deferred('documentContentLoaded').resolve();\r\n};\r\n\r\nRESUtils.init._watch.initReadyCheck = function() {\r\n\t// TODO: tidy this up, use await.headReady\r\n\tif (\r\n\t\t(!RESStorage.isReady) ||\r\n\t\t(typeof document.body === 'undefined') ||\r\n\t\t(!document.html) ||\r\n\t\t(typeof document.html.classList === 'undefined')\r\n\t) {\r\n\t\tsetTimeout(RESInitReadyCheck, 50);\r\n\t} else {\r\n\t\tRESEnvironment.RESInitReadyCheck(RESInit);\r\n\t}\r\n};\r\n\r\nRESUtils.init.await.library = function(libraryID) {\r\n\treturn RESUtils.init.await._deferred('sourceLoaded')\r\n\t\t.then(function() {\r\n\t\t\treturn libraries[libraryID];\r\n\t\t});\r\n};\r\n\r\nRESUtils.init._loadModules = function() {\r\n\tif (!RESUtils.regexes.all.test(location.href)) {\r\n\t\t// added this if statement because some people's Greasemonkey \"include\" lines are getting borked or ignored, so they're calling RES on non-reddit pages.\r\n\t\treturn;\r\n\t}\r\n\r\n\tRESUtils.init._queueModulesStage('loadLibraries', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.init.await._deferred('sourceLoaded')\r\n\t\t\t.then(RESUtils.init._runModuleStage.bind(this, stage, module, moduleID));\r\n\t});\r\n\r\n\tRESUtils.init._queueModulesStage('loadDynamicOptions', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.init.await._deferred('loadLibraries')\r\n\t\t\t.then(RESUtils.init._runModuleStage.bind(this, stage, module, moduleID));\r\n\t});\r\n\tRESUtils.init._queueModulesStage('options', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.init.await.loadDynamicOptions(moduleID)\r\n\t\t\t.then(RESUtils.options.loadOptions.bind(this, moduleID));\r\n\t});\r\n\tRESUtils.init._queueModulesStage('beforeLoad', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.deferred.all([\r\n\t\t\tRESStorage.loadItem('RES.modulePrefs'),\r\n\t\t\tRESUtils.init.await.options(moduleID),\r\n\t\t\tRESUtils.init.await('headReady')\r\n\t\t])\r\n\t\t\t.then(RESUtils.init._runModuleStage.bind(this, stage, module, moduleID));\r\n\t});\r\n\tRESUtils.init._queueModulesStage('addOptionsBodyClasses', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.deferred.all([\r\n\t\t\tRESStorage.loadItem('RES.modulePrefs'),\r\n\t\t\tRESUtils.init.await.options(moduleID)\r\n\t\t])\r\n\t\t\t.then(RESUtils.init._runModuleStage.bind(this, stage, module, moduleID));\r\n\t});\r\n\tRESUtils.init._queueModulesStage('go', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.deferred.all([\r\n\t\t\tRESUtils.init.await.beforeLoad(moduleID),\r\n\t\t\tRESUtils.init.await('bodyReady')\r\n\t\t])\r\n\t\t\t.then(RESUtils.init._runModuleStage.bind(this, stage, module, moduleID));\r\n\t});\r\n\r\n\tRESUtils.init._queueModulesStage('afterLoad', function(stage, module, moduleID) {\r\n\t\treturn RESUtils.deferred.all([\r\n\t\t\tRESUtils.init.await.go(moduleID),\r\n\t\t\tRESUtils.init.await('documentContentLoaded')\r\n\t\t])\r\n\t\t\t.then(RESUtils.init._runModuleStage.bind(this, stage, module, moduleID));\r\n\t});\r\n\r\n\tRESUtils.init.await._deferred('sourceLoaded').resolve(); // kick everything off\r\n};\r\n\r\nRESUtils.init._queueModulesStage = function(stage, queueModulesStage) {\r\n\tvar defs = $.map(modules, function(module, moduleID) {\r\n\t\tvar def = queueModulesStage(stage, module, moduleID);\r\n\t\tRESUtils.init.await._deferred(stage, moduleID, def);\r\n\t\treturn def;\r\n\t});\r\n\tRESUtils.init.await._deferred(stage, '_all', RESUtils.deferred.all(defs));\r\n};\r\nRESUtils.init._runModuleStage = function(stage, module, moduleID) {\r\n\tvar result, deferred;\r\n\r\n\tif (typeof module[stage] === 'function') {\r\n\t\ttry {\r\n\t\t\tresult = module[stage]();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('Error in modules[' + moduleID + '].' + stage, e, e.stack);\r\n\t\t\tdeferred = $.Deferred().reject(e);\r\n\t\t}\r\n\t}\r\n\r\n\tif (typeof result === 'undefined') {\r\n\t\tdeferred = $.Deferred().resolve();\r\n\t} else if (result.done) {\r\n\t\tdeferred = result;\r\n\t} else if (result) {\r\n\t\tdeferred = $.Deferred().resolve(result);\r\n\t} else {\r\n\t\tdeferred = $.Deferred().reject(result);\r\n\t}\r\n\r\n\treturn deferred;\r\n};\r\n\r\nRESUtils.init._showErrors = function() {\r\n\tvar deferreds = RESUtils.init.await._deferreds,\r\n\t\tdeferred,\r\n\t\tstate,\r\n\t\tfailure,\r\n\t\tfailures = {};\r\n\tfor (var type in deferreds) {\r\n\t\tif (!(deferreds.hasOwnProperty(type) && typeof deferreds[type] === 'object')) continue;\r\n\t\tfor (var id in deferreds[type]) {\r\n\t\t\tif (!(deferreds[type].hasOwnProperty(id) && typeof deferreds[type][id].state === 'function')) continue;\r\n\t\t\tif (failures[id]) continue;\r\n\r\n\t\t\tdeferred = deferreds[type][id];\r\n\t\t\tstate = deferred.state();\r\n\t\t\tif (state !== 'resolved') {\r\n\t\t\t\tfailures[id] = type;\r\n\t\t\t\tif (state === 'rejected') {\r\n\t\t\t\t\tdeferred.fail(function() {\r\n\t\t\t\t\t\tfailure = Array.prototype.slice.call(arguments, 0);\r\n\t\t\t\t\t\tconsole.error('Failed to load', id, type, failure);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('Failed to load', id, type, state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tRESUtils.init.await._deferreds = {}; // allow garbage collection\r\n};\r\n\r\nRESUtils.init.complete = function() {\r\n\t// nothing to do here\r\n};\r\n\r\nRESUtils.init._reportVersion = function() {\r\n\t// report the version of RES to reddit's advisory checker.\r\n\tvar RESVersionReport = RESUtils.createElement('div', 'RESConsoleVersion');\r\n\tRESVersionReport.setAttribute('style', 'display: none;');\r\n\tRESVersionReport.textContent = RESMetadata.version;\r\n\tdocument.body.appendChild(RESVersionReport);\r\n};\r\n\r\nRESUtils.init._localStorageFailed = function(error) {\r\n\r\n\tvar RESFail = 'Sorry, but localStorage seems inaccessible. Reddit Enhancement Suite can\\'t work without it. \\n\\n';\r\n\tif (BrowserDetect.isSafari()) {\r\n\t\tRESFail += 'Since you\\'re using Safari, it might be that you\\'re in private browsing mode, which unfortunately is incompatible with RES until Safari provides a way to allow extensions localStorage access.';\r\n\t} else if (BrowserDetect.isChrome()) {\r\n\t\tRESFail += 'Since you\\'re using Chrome, you might just need to go to your extensions settings and check the \"Allow in Incognito\" box.';\r\n\t} else if (BrowserDetect.isFirefox()) {\r\n\t\tRESFail += 'Since it looks like you\\'re using Firefox, you probably need to go to about:config and ensure that dom.storage.enabled is set to true, and that dom.storage.default_quota is set to a number above zero (i.e. 5120, the normal default)\".';\r\n\t}\r\n\r\n\tconsole.error(RESFail);\r\n\tconsole.error(error);\r\n\r\n\tvar userMenu = typeof document !== 'undefined' && document.querySelector && document.querySelector('#header-bottom-right');\r\n\tif (userMenu) {\r\n\t\tvar preferencesUL = userMenu.querySelector('UL');\r\n\t\tvar separator = document.createElement('span');\r\n\t\tseparator.setAttribute('class', 'separator');\r\n\t\tseparator.textContent = '|';\r\n\t\tvar RESPrefsLink = document.createElement('a');\r\n\t\tRESPrefsLink.setAttribute('href', '#');\r\n\t\tRESPrefsLink.addEventListener('click', function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\talert(RESFail);\r\n\t\t}, true);\r\n\t\tRESPrefsLink.textContent = '[RES - ERROR]';\r\n\t\tRESPrefsLink.setAttribute('style', 'color: red; font-weight: bold;');\r\n\t\tRESUtils.insertAfter(preferencesUL, RESPrefsLink);\r\n\t\tRESUtils.insertAfter(preferencesUL, separator);\r\n\t}\r\n};\r\n\r\nRESUtils.init._homePage = function() {\r\n\tif ((location.href.indexOf('reddit.honestbleeps.com/download') !== -1) ||\r\n\t\t\t(location.href.indexOf('redditenhancementsuite.com/download') !== -1)) {\r\n\t\tvar installLinks = document.body.querySelectorAll('.install');\r\n\t\tfor (var i = 0, len = installLinks.length; i < len; i++) {\r\n\t\t\tinstallLinks[i].classList.add('update');\r\n\t\t\tinstallLinks[i].classList.add('res4'); // if update but not RES 4, then FF users == greasemonkey...\r\n\t\t\tinstallLinks[i].classList.remove('install');\r\n\t\t}\r\n\t}\r\n};\r\n\r\nRESUtils.init();\r\n"],"sourceRoot":"/source/"}