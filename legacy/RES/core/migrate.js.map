{"version":3,"sources":["core/migrate.js"],"names":[],"mappings":"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","file":"core/migrate.js","sourcesContent":["/* exported RESOptionsMigrate */\r\n\r\n/*\r\nAdd new migrations to the end of RESOptionsMigrate.migrations in the\r\nfollowing form:\r\n\r\n{\r\n\tversionNumber: '#.#.#',\r\n\tgo: function() {\r\n\t\t// migration code\r\n\t}\r\n}\r\n*/\r\n\r\nvar RESOptionsMigrate = {\r\n\tmigrations: [\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.0.0',\r\n\t\t\tgo: function() {\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'searchSubredditByDefault', 'searchHelper', 'searchSubredditByDefault');\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('styleTweaks', 'lightSwitch', 'nightMode', 'nightSwitch');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('styleTweaks', 'lightOrDark', 'nightMode', 'nightModeOn',\r\n\t\t\t\t\tRESOptionsMigrate.migrators.specific.nightModeOn);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('styleTweaks', 'useSubredditStyleInDarkMode', 'nightMode', 'useSubredditStyles');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveStorageToOption('RESmodules.styleTweaks.nightModeWhitelist',\r\n\t\t\t\t\t'nightMode', 'subredditStylesWhitelist',\r\n\t\t\t\t\tRESOptionsMigrate.migrators.specific.subredditStylesWhitelist);\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar userTags = RESStorage.getItem('RESmodules.userTagger.tags'),\r\n\t\t\t\t\t\tupdatedTags = {},\r\n\t\t\t\t\t\ttoRemove;\r\n\t\t\t\t\tuserTags = userTags ? safeJSON.parse(userTags, 'RESmodules.userTagger.tags', true) : null;\r\n\t\t\t\t\tif (userTags === null) {\r\n\t\t\t\t\t\tupdatedTags = RESOptionsMigrate.migrators.specific.updateTagStorage();\r\n\t\t\t\t\t\tuserTags = updatedTags.tags;\r\n\t\t\t\t\t\ttoRemove = updatedTags.toRemove;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tuserTags = RESOptionsMigrate.migrators.specific.updateTagStorageCaseInsensitive(userTags);\r\n\t\t\t\t\tRESStorage.setItem('RESmodules.userTagger.tags', userTags);\r\n\t\t\t\t\tRESOptionsMigrate.migrators.specific.clearOldLocalStorage(toRemove);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Could not migrate user tags, please post this error to /r/RESissues', e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.0.2',\r\n\t\t\tgo: function() {\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('keyboardNav', 'imageMoveUp', [38, false, false, true, false], [38, false, true, false, false]);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('keyboardNav', 'imageMoveDown', [40, false, false, true, false], [40, false, true, false, false]);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('keyboardNav', 'imageMoveLeft', [37, false, false, true, false], [37, false, true, false, false]);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('keyboardNav', 'imageMoveRight', [39, false, false, true, false], [39, false, true, false, false]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.0.3',\r\n\t\t\tgo: function() {\r\n\t\t\t\t// Token migration for the benefit of developers or people running bleeding-edge\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.1',\r\n\t\t\tgo: function() {\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('voteEnhancements', 'colorCommentScore', RESOptionsMigrate.migrators.specific.colorCommentScore);\r\n\r\n\t\t\t\tvar sticky = RESUtils.options.getOptions('notifications', true).sticky.value,\r\n\t\t\t\t\tfg = RESUtils.options.getOptions('keyboardNav', true).focusFGColorNight.value,\r\n\t\t\t\t\tbg = RESUtils.options.getOptions('keyboardNav', true).focusBGColorNight.value,\r\n\t\t\t\t\ttest = document.createElement('div'),\r\n\t\t\t\t\tfgCalculated, bgCalculated;\r\n\r\n\t\t\t\t// perNotification may have only been present in dev releases, but check for it and update as it's\r\n\t\t\t\t// no longer a valid option.\r\n\t\t\t\tif (sticky === 'perNotification') {\r\n\t\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('notifications', 'sticky', 'notificationType');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If night mode focus foreground color === night mode focus background color,\r\n\t\t\t\t// force them back to new defaults.\r\n\t\t\t\t//\r\n\t\t\t\t// Since it may be rgba or hex and we're not sure, let's do something clever to\r\n\t\t\t\t// make sure we can compare the colors.\r\n\t\t\t\ttest.style.color = fg;\r\n\t\t\t\ttest.style.backgroundColor = bg;\r\n\t\t\t\tfgCalculated = test.style.color;\r\n\t\t\t\tbgCalculated = test.style.backgroundColor;\r\n\t\t\t\tif ((fg === bg) || (fgCalculated === bgCalculated)) {\r\n\t\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('keyboardNav', 'focusBGColorNight', '#373737');\r\n\t\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('keyboardNav', 'focusFGColorNight', '#DDDDDD');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Show all options for all users\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('settingsNavigation', 'showAdvancedOptions', 'settingsNavigation', 'showAllOptions',\r\n\t\t\t\t\ttrue);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('settingsNavigation', 'showAdvancedOptionsAlert', 'settingsNavigation', 'showAllOptionsAlert');\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.3',\r\n\t\t\tgo: function() {\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('searchHelper', 'addSubmitButton', true, false);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'save', 'keyboardNav', 'savePost');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'save', 'keyboardNav', 'saveRES');\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.4',\r\n\t\t\tgo: function() {\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('filteReddit', 'keywords', RESOptionsMigrate.migrators.specific.removeUndefinedUnlessKeyword);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('quickMessage', 'quickModeratorMessage', false, true);\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.5.5',\r\n\t\t\tgo: function() {\r\n\t\t\t\tvar scrollTop = RESUtils.options.getOptions('keyboardNav', true).scrollTop;\r\n\t\t\t\tif (scrollTop && scrollTop.value) {\r\n\t\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('keyboardNav', 'scrollStyle', 'directional', 'top');\r\n\t\t\t\t}\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'uncheckSendRepliesToInbox', 'submitHelper', 'uncheckSendRepliesToInbox');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'openBigEditor', 'commentPreview', 'openBigEditor');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'autoSelectOnScroll', 'selectedEntry', 'autoSelectOnScroll');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'clickFocus', 'selectedEntry', 'selectOnClick');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'addFocusBGColor', 'selectedEntry', 'addFocusBGColor');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'focusBGColor', 'selectedEntry', 'focusBGColor');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'focusBGColorNight', 'selectedEntry', 'focusBGColorNight');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'focusFGColorNight', 'selectedEntry', 'focusFGColorNight');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'addFocusBorder', 'selectedEntry', 'addFocusBorder');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'focusBorder', 'selectedEntry', 'focusBorder');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'focusBorderNight', 'selectedEntry', 'focusBorderNight');\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('hover', 'fadeSpeed', RESOptionsMigrate.migrators.specific.updateFadeSpeed);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('showParent', 'fadeSpeed', RESOptionsMigrate.migrators.specific.updateFadeSpeed);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('subredditInfo', 'fadeSpeed', RESOptionsMigrate.migrators.specific.updateFadeSpeed);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('userTagger', 'fadeSpeed', RESOptionsMigrate.migrators.specific.updateFadeSpeed);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('commentTools', 'macros', RESOptionsMigrate.migrators.specific.commentToolsDefaultMacros);\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'showUnreadCount', 'orangered', 'showUnreadCount');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'retroUnreadCount', 'orangered', 'retroUnreadCount');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'showUnreadCountInFavicon', 'orangered', 'showUnreadCountInFavicon');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'unreadLinksToInbox', 'orangered', 'unreadLinksToInbox');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('betteReddit', 'hideModMail', 'orangered', 'hideModMail');\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('quickMessage', 'quickModeratorMessage', 'quickMessage', 'handleSideLinks');\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.updateOption('showKarma', 'useCommas', false, true);\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'moveDown', 'keyboardNav', 'moveDownComment');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('keyboardNav', 'moveUp', 'keyboardNav', 'moveUpComment');\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'hoverInfo', 'userInfo', 'hoverInfo');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'useQuickMessage', 'userInfo', 'useQuickMessage');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'hoverDelay', 'userInfo', 'hoverDelay');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'fadeDelay', 'userInfo', 'fadeDelay');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'fadeSpeed', 'userInfo', 'fadeSpeed');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'gildComments', 'userInfo', 'gildComments');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'highlightButton', 'userInfo', 'highlightButton');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'highlightColor', 'userInfo', 'highlightColor');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'highlightColorHover', 'userInfo', 'highlightColorHover');\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('userTagger', 'USDateFormat', 'userInfo', 'USDateFormat');\r\n\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('notifications', 'notificationTypes', RESOptionsMigrate.migrators.generic.selectDistinctRowsByColumnIndex.bind(this, [ 0, 1 /* moduleID, notificationID */ ] ));\r\n\t\t\t\t// Minify existing options\r\n\t\t\t\tfor (var key in modules) {\r\n\t\t\t\t\tif ('options' in modules[key]) {\r\n\t\t\t\t\t\tRESUtils.options.saveModuleOptions(key, RESUtils.options.getOptions(key));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tversionNumber: '4.7.0',\r\n\t\t\tgo() {\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.forceUpdateOption('orangered', 'showUnreadCount', value => value === false);\r\n\t\t\t\tRESOptionsMigrate.migrators.generic.moveOption('orangered', 'showUnreadCount', 'orangered', 'hideUnreadCount');\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\r\n\tmigrators: {\r\n\t\tgeneric: {\r\n\t\t\tupdateOption: function(moduleID, optionName, formerDefaultValue, valueOrFunction) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar options = RESUtils.options.getOptions(moduleID, true),\r\n\t\t\t\t\t\toption = options[optionName],\r\n\t\t\t\t\t\toldValue = option ? option.value : undefined,\r\n\t\t\t\t\t\tnewValue = RESOptionsMigrate.updateValue(oldValue, valueOrFunction);\r\n\r\n\t\t\t\t\t// Only update this option to the new default value if its current value\r\n\t\t\t\t\t// hasn't been changed from the former default value.\r\n\t\t\t\t\tif (RESOptionsMigrate.optionMatchesFormerDefaultValue(option, formerDefaultValue)) {\r\n\t\t\t\t\t\tRESUtils.options.setOption(moduleID, optionName, newValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Couldn\\'t migrate (' + e + '; arguments were ' + Array.prototype.join.call(arguments, ', ') + ')', e.stack);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tforceUpdateOption: function(moduleID, optionName, valueOrFunction) {\r\n\t\t\t\t// ☢ ☠ ☣  DANGER, WILL ROBINSON, DANGER ☠ ☣ ☢\r\n\t\t\t\t// Make sure valueOrFunction doesn't destroy user settings!\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar options = RESUtils.options.getOptions(moduleID, true),\r\n\t\t\t\t\t\toption = options[optionName],\r\n\t\t\t\t\t\toldValue = option ? option.value : undefined,\r\n\t\t\t\t\t\tnewValue = RESOptionsMigrate.updateValue(oldValue, valueOrFunction);\r\n\r\n\t\t\t\t\tif (typeof newValue !== 'undefined') {\r\n\t\t\t\t\t\tRESUtils.options.setOption(moduleID, optionName, newValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Couldn\\'t migrate (' + e + '; arguments were ' + Array.prototype.join.call(arguments, ', ') + ')', e.stack);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmoveOption: function(oldModuleID, oldOptionName, newModuleID, newOptionName, valueOrFunction) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar options = RESUtils.options.getOptions(oldModuleID, true),\r\n\t\t\t\t\t\toption = options[oldOptionName],\r\n\t\t\t\t\t\toldValue = option ? option.value : undefined,\r\n\t\t\t\t\t\tnewValue = RESOptionsMigrate.updateValue(oldValue, valueOrFunction);\r\n\r\n\t\t\t\t\tif (typeof newValue !== 'undefined') {\r\n\t\t\t\t\t\tRESUtils.options.setOption(newModuleID, newOptionName, newValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Couldn\\'t migrate (' + e + '; arguments were ' + Array.prototype.join.call(arguments, ', ') + ')', e.stack);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmoveStorage: function(oldKey, newKey, valueOrFunction) {\r\n\t\t\t\tvar oldValue = RESStorage.getItem(oldKey);\r\n\r\n\t\t\t\tif (oldValue === null) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newValue = RESOptionsMigrate.updateValue(oldValue, valueOrFunction);\r\n\t\t\t\tif (typeof newValue !== 'undefined') {\r\n\t\t\t\t\tRESStorage.setItem(newKey, newValue);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmoveStorageToOption: function(oldKey, newModuleID, newOptionName, valueOrFunction) {\r\n\t\t\t\tvar oldValue = RESStorage.getItem(oldKey);\r\n\r\n\t\t\t\tif (oldValue === null) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newValue = RESOptionsMigrate.updateValue(oldValue, valueOrFunction);\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (typeof newValue !== 'undefined') {\r\n\t\t\t\t\t\tRESUtils.options.setOption(newModuleID, newOptionName, newValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Couldn\\'t migrate (' + e + '; arguments were ' + Array.prototype.join.call(arguments, ', ') + ')');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tselectDistinctRowsByColumnIndex: function(distinctColumns, rows) {\r\n\t\t\t\t/**\r\n\t\t\t\t\trows: array of arrays (e.g. RES table option)\r\n\t\t\t\t\tdistinct (optional): array of numbers, indexes of columns for selecting distinct values\r\n\r\n\t\t\t\t\tSQL-ish: SELECT DISTINCT 0thColumn, 1stColumn FROM rows\r\n\t\t\t\t*/\r\n\r\n\t\t\t\tif (typeof rows === 'undefined') {\r\n\t\t\t\t\trows = distinctColumns;\r\n\t\t\t\t\tdistinctColumns = [ 0 ];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdistinctColumns = [].concat(distinctColumns);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar index = {};\r\n\t\t\t\tvar distinctRows = rows.filter(function(row) {\r\n\t\t\t\t\tvar key = distinctColumns.map(function(columnIndex) {\r\n\t\t\t\t\t\treturn row[columnIndex];\r\n\t\t\t\t\t}).join('!@#');\r\n\r\n\t\t\t\t\tif (index[key]) {\r\n\t\t\t\t\t\t// Already found a row with values for columns in distinct columns\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tindex[key] = row;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn distinctRows;\r\n\t\t\t},\r\n\t\t\t_testSelectDistinctRowsByColumnIndex: function() {\r\n\t\t\t\t// TODO: move to qunit file\r\n\t\t\t\tvar\tf = RESOptionsMigrate.migrators.generic.selectDistinctRowsByColumnIndex,\r\n\t\t\t\t\tdistinct = [ 0, 1 ],\r\n\t\t\t\t\trows = [\r\n\t\t\t\t\t\t[ 'for matching', 'values', 'keep the first row found' ],\r\n\t\t\t\t\t\t[ 'for matching', 'values', 'drop other rows' ],\r\n\t\t\t\t\t\t[ 'for non-matching', 'values', 'keep the only row found' ]\r\n\t\t\t\t\t],\r\n\t\t\t\t\texpected = [\r\n\t\t\t\t\t\t[ 'for matching', 'values', 'keep the first row found' ],\r\n\t\t\t\t\t\t[ 'for non-matching', 'values', 'keep the only row found' ]\r\n\t\t\t\t\t],\r\n\t\t\t\t\tactual = f(distinct, rows);\r\n\t\t\t\tconsole.log('Expected:', expected);\r\n\t\t\t\tconsole.log('Actual:', actual);\r\n\t\t\t\t// compare actual and expected\r\n\t\t\t\tdebugger; // eslint-disable-line no-debugger\r\n\t\t\t}\r\n\t\t},\r\n\t\tspecific: {\r\n\t\t\tnightModeOn: function(value) {\r\n\t\t\t\treturn value === 'dark';\r\n\t\t\t},\r\n\t\t\tsubredditStylesWhitelist: function(value) {\r\n\t\t\t\tvar parsedValue = safeJSON.parse(value);\r\n\t\t\t\treturn parsedValue.join(',');\r\n\t\t\t},\r\n\t\t\tcolorCommentScore: function(value) {\r\n\t\t\t\t// v4.5.0.2 (fresh installs) onwards have the correct default value\r\n\t\t\t\tif (typeof value === 'string') {\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Notification about 4.5.0.1 upgrade issue (ref: 49b4cf2c08659c218eed5f3a82dd81f9797ac984)\r\n\t\t\t\tif (!value) {\r\n\t\t\t\t\tRESOptionsMigrate.showNotification('voteEnhancements', 'colorCommentScore',\r\n\t\t\t\t\t\t'The Vote Enhancements colorCommentScore feature has been turned off.');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 4.5.0.1 migration\r\n\t\t\t\treturn value ? 'automatic' : 'none';\r\n\t\t\t},\r\n\t\t\tremoveUndefinedUnlessKeyword: function(values) {\r\n\t\t\t\tfor (var i = 0, length = values.length; i < length; i++) {\r\n\r\n\t\t\t\t\tif (values[i] && values[i][3] === 'undefined') {\r\n\t\t\t\t\t\tvalues[i][3] = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn values;\r\n\t\t\t},\r\n\t\t\tupdateFadeSpeed: function(value) {\r\n\t\t\t\tif (value < 0 || value > 1) {\r\n\t\t\t\t\treturn '0.7';\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn (1 - value).toFixed(2);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcommentToolsDefaultMacros: function(value) {\r\n\t\t\t\tvalue = value || [];\r\n\t\t\t\tvalue = [\r\n\t\t\t\t\t['reddiquette', '[reddiquette](/wiki/reddiquette) '],\r\n\t\t\t\t\t['Promote RES', '[Reddit Enhancement Suite](http://redditenhancementsuite.com \"also /r/Enhancement\") '],\r\n\t\t\t\t\t['Current timestamp', '{{now}} ']\r\n\t\t\t\t].concat(value);\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tupdateTagStorage: function() {\r\n\t\t\t\t// update tag storage format from the old individual bits to a big JSON blob\r\n\t\t\t\t// It's OK that we're directly accessing localStorage here because if they have old school tag storage, it IS in localStorage.\r\n\t\t\t\tvar ls = RESEnvironment.localStorage();\r\n\t\t\t\tif (!ls) return;\r\n\t\t\t\tvar tags = {};\r\n\t\t\t\tvar toRemove = [];\r\n\t\t\t\tfor (var i = 0, len = ls.length; i < len; i++) {\r\n\t\t\t\t\tvar keySplit = null;\r\n\t\t\t\t\tif (ls.key(i)) {\r\n\t\t\t\t\t\tkeySplit = ls.key(i).split('.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (keySplit) {\r\n\t\t\t\t\t\tvar keyRoot = keySplit[0];\r\n\t\t\t\t\t\tswitch (keyRoot) {\r\n\t\t\t\t\t\t\tcase 'reddituser':\r\n\t\t\t\t\t\t\t\tvar thisNode = keySplit[1];\r\n\t\t\t\t\t\t\t\tif (typeof tags[keySplit[2]] === 'undefined') {\r\n\t\t\t\t\t\t\t\t\ttags[keySplit[2]] = {};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (thisNode === 'votes') {\r\n\t\t\t\t\t\t\t\t\ttags[keySplit[2]].votes = ls.getItem(ls.key(i));\r\n\t\t\t\t\t\t\t\t} else if (thisNode === 'tag') {\r\n\t\t\t\t\t\t\t\t\ttags[keySplit[2]].tag = ls.getItem(ls.key(i));\r\n\t\t\t\t\t\t\t\t} else if (thisNode === 'color') {\r\n\t\t\t\t\t\t\t\t\ttags[keySplit[2]].color = ls.getItem(ls.key(i));\r\n\t\t\t\t\t\t\t\t} else if (thisNode === 'ignore') {\r\n\t\t\t\t\t\t\t\t\ttags[keySplit[2]].ignore = ls.getItem(ls.key(i));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// now delete the old stored garbage...\r\n\t\t\t\t\t\t\t\tvar keyString = 'reddituser.' + thisNode + '.' + keySplit[2];\r\n\t\t\t\t\t\t\t\ttoRemove.push(keyString);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t// console.log('Not currently handling keys with root: ' + keyRoot);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttags: tags,\r\n\t\t\t\t\ttoRemove: toRemove\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tclearOldLocalStorage: function(keys) {\r\n\t\t\t\tif (!(keys && keys.length)) return;\r\n\t\t\t\tvar localStorage = RESEnvironment.localStorage();\r\n\t\t\t\tif (!localStorage) return;\r\n\t\t\t\tfor (var i = 0, len = keys.length; i < len; i++) {\r\n\t\t\t\t\tlocalStorage.removeItem(keys[i]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateTagStorageCaseInsensitive: function(tags) {\r\n\t\t\t\tvar destination, source, username, lower;\r\n\t\t\t\tvar usernames = Object.keys(tags);\r\n\r\n\t\t\t\tfor (var i = 0, length = usernames.length; i < length; i++) {\r\n\t\t\t\t\tusername = usernames[i];\r\n\t\t\t\t\tlower = username.toLowerCase();\r\n\t\t\t\t\tif (lower === username) continue;\r\n\r\n\t\t\t\t\tdestination = this.tags[lower] = this.tags[lower] || {};\r\n\t\t\t\t\tsource = this.tags[username];\r\n\r\n\t\t\t\t\tif (source.votes) {\r\n\t\t\t\t\t\tdestination.votes = (parseInt(destination.votes, 10) || 0) + (parseInt(source.votes, 10) || 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (source.color && (!destination.color || destination.color === 'none')) {\r\n\t\t\t\t\t\tdestination.color = source.color;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (source.tag) {\r\n\t\t\t\t\t\tdestination.tag = destination.tag ? destination.tag + ' | ' : '';\r\n\t\t\t\t\t\tdestination.tag += source.tag;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (source.ignore) {\r\n\t\t\t\t\t\tdestination.ignore = source.ignore;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (source.link) {\r\n\t\t\t\t\t\tif (destination.link) {\r\n\t\t\t\t\t\t\tdestination.tag = destination.tag ? destination.tag + ' | ' : '';\r\n\t\t\t\t\t\t\tdestination.tag += source.link;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdestination.link = source.link;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdelete this.tags[username]; // safe because of \"lower === username.toLowerCase\" guard above\r\n\t\t\t\t}\r\n\r\n\t\t\t\tRESStorage.setItem('RESmodules.userTagger.tags', JSON.stringify(this.tags));\r\n\t\t\t\tRESStorage.setItem('RESmodules.userTagger.casefix', true);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t},\r\n\r\n\tshowNotification: function(moduleID, optionName, message) {\r\n\t\tmessage = RESUtils.firstValid(message, '') +\r\n\t\t\t'<br><br>You can change this option ' +\r\n\t\t\tmodules['settingsNavigation'].makeUrlHashLink('voteEnhancements', 'colorCommentScore', 'in the RES settings console.');\r\n\r\n\t\tmodules['notifications'].showNotification({\r\n\t\t\tmoduleID: 'troubleshooter',\r\n\t\t\tnotificationID: 'migration',\r\n\t\t\tsticky: true,\r\n\t\t\theader: 'Options Updated',\r\n\t\t\tmessage: message\r\n\t\t});\r\n\t},\r\n\r\n\tmigrate: function() {\r\n\t\tvar startMigrationAt = RESOptionsMigrate.getMigrationStartIndex(),\r\n\t\t\tmigrationVersions = RESOptionsMigrate.getVersionNumbers();\r\n\r\n\t\tif (typeof startMigrationAt !== 'undefined') {\r\n\t\t\tfor (var i = startMigrationAt, length = migrationVersions.length; i < length; i++) {\r\n\t\t\t\tvar currentMigration = RESOptionsMigrate.migrations[i];\r\n\t\t\t\tcurrentMigration.go();\r\n\r\n\t\t\t\t// Checkpoint, in case the next migration crashes\r\n\t\t\t\tRESOptionsMigrate.setLastMigratedVersion(currentMigration.versionNumber);\r\n\t\t\t}\r\n\r\n\t\t\tRESUtils.options.removeObsoleteOptions();\r\n\t\t}\r\n\r\n\t\t// Indicate that all the current migrations are satisfied for the next upgrade\r\n\t\tRESOptionsMigrate.setLastMigratedVersion(migrationVersions[migrationVersions.length - 1]);\r\n\t},\r\n\r\n\tgetMigrationStartIndex: function() {\r\n\t\tvar lastMigratedVersion = RESOptionsMigrate.getLastMigratedVersion();\r\n\r\n\t\tif (lastMigratedVersion !== false) {\r\n\t\t\tvar startIndex = 0;\r\n\r\n\t\t\tif (typeof lastMigratedVersion === 'string') {\r\n\t\t\t\t// Already ran migrations up to and including lastMigratedVersion\r\n\t\t\t\t// Start at the migration directly following\r\n\t\t\t\tvar migrationVersions = RESOptionsMigrate.getVersionNumbers();\r\n\t\t\t\tstartIndex = migrationVersions.indexOf(lastMigratedVersion) + 1;\r\n\t\t\t}\r\n\r\n\t\t\treturn startIndex;\r\n\t\t}\r\n\t},\r\n\r\n\t// Returns a string like \"4.5.0.1\" (the last migration run),\r\n\t// null (no migrations run yet), or false (do not run migrations)\r\n\tgetLastMigratedVersion: function() {\r\n\t\tvar RESOptionsVersion = RESStorage.getItem('RESOptionsVersion');\r\n\r\n\t\tif (typeof RESOptionsVersion === 'undefined') {\r\n\t\t\t// Error occured sometime in the past, abort\r\n\t\t\tconsole.warn('RESOptionsVersion was undefined');\r\n\t\t} else if (RESOptionsVersion !== null) {\r\n\t\t\t// Migration has run before; verify/sanitize the version number\r\n\t\t\tif (/^\\d$/.test(RESOptionsVersion)) {\r\n\t\t\t\t// Legacy format: integer number\r\n\t\t\t\tvar legacyOptionVersionMapping = ['4.5.0.0', '4.5.0.1'];\r\n\t\t\t\tRESOptionsVersion = legacyOptionVersionMapping[RESOptionsVersion - 1];\r\n\t\t\t} else if (RESOptionsMigrate.getVersionNumbers().indexOf(RESOptionsVersion) === -1) {\r\n\t\t\t\t// Abort, abort! Probably downgraded\r\n\t\t\t\tconsole.warn('Couldn\\'t find a migration matching RESOptionsVersion = ' + RESOptionsVersion);\r\n\t\t\t\tRESOptionsVersion = false;\r\n\t\t\t} else {\r\n\t\t\t\t// RESOptionsVersion is a valid migration version number\r\n\t\t\t}\r\n\t\t} else if (RESStorage.getItem('RES.firstRun.4.5.0.2')) {\r\n\t\t\t// 4.5.0.2 bug: RESOptionsVersion was not set on fresh installs.\r\n\t\t\tRESOptionsVersion = '4.5.0.2';\r\n\t\t} else if (RESStorage.getItem('RES.firstRun.4.3.2.1') || RESStorage.getItem('RES.firstRun.4.3.1.2') || RESStorage.getItem('RES.firstRun.4.3.0.3') || RESStorage.getItem('RES.firstRun.4.2.0.2') || RESStorage.getItem('RES.firstRun.4.1.5')) {\r\n\t\t\t// Upgraded from old version to a version which supports migrations; run all migrations\r\n\t\t\tRESOptionsVersion = null;\r\n\t\t} else {\r\n\t\t\t// New install, no migrations necessary\r\n\t\t\tRESOptionsVersion = false;\r\n\t\t}\r\n\r\n\t\treturn RESOptionsVersion;\r\n\t},\r\n\tsetLastMigratedVersion: function(value) {\r\n\t\tif (value) {\r\n\t\t\tRESStorage.setItem('RESOptionsVersion', value);\r\n\t\t}\r\n\t},\r\n\r\n\tgetVersionNumbers: function() {\r\n\t\treturn RESOptionsMigrate.migrations.map(function(migration) { return migration.versionNumber; });\r\n\t},\r\n\r\n\t// This function compares a given option value to its \"former default\" -- the default\r\n\t// before an attempted migration. Options aren't always a string, so equivalency won't\r\n\t// work. Note that \"option\" needs to be the actual option object, NOT option.value.\r\n\t//\r\n\t// NOTE: This function may need to be updated for things like objects, etc. Currently\r\n\t// it'll only work on string / array.\r\n\toptionMatchesFormerDefaultValue: function(option, formerDefaultValue) {\r\n\t\tif (!option) {\r\n\t\t\toption = {\r\n\t\t\t\ttype: 'legacy',\r\n\t\t\t\tvalue: undefined\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar oldValue = option.value;\r\n\r\n\t\t// keyCodes once customized also save metaKey in a 5th index, but we used\r\n\t\t// to not store the metakey, so they have a length of 4 by default. In order\r\n\t\t// to do a proper array comparison, we need the lengths to match, so if a\r\n\t\t// 5th element is not present, push false into the array.\r\n\t\tif ((option.type === 'keycode') && (option.value.length === 4)) {\r\n\t\t\toldValue.push(false);\r\n\t\t}\r\n\r\n\t\t// Check if the oldValue differs from the former default value. If it doesn't,\r\n\t\t// then the user set something custom and we should honor that.\r\n\t\t//\r\n\t\t// If it's an array, it's not as simple as just variable comparison.\r\n\t\tif (Array.isArray(formerDefaultValue)) {\r\n\t\t\t// Compare arrays; if they're not the same, abort since the arrays aren't equal.\r\n\t\t\tif (formerDefaultValue.length !== oldValue.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, len = formerDefaultValue.length; i < len; i++) {\r\n\t\t\t\tif (formerDefaultValue[i] !== oldValue[i]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (formerDefaultValue !== oldValue) {\r\n\t\t\t// Skip migration; the user set custom settings that aren't the default.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tupdateValue: function(oldValue, valueOrFunction) {\r\n\t\tvar newValue;\r\n\t\tif (typeof valueOrFunction === 'function') {\r\n\t\t\tnewValue = valueOrFunction(oldValue);\r\n\t\t} else if (typeof valueOrFunction !== 'undefined') {\r\n\t\t\tnewValue = valueOrFunction;\r\n\t\t} else {\r\n\t\t\tnewValue = oldValue;\r\n\t\t}\r\n\r\n\t\treturn newValue;\r\n\t}\r\n};\r\n\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.RESOptionsMigrate = RESOptionsMigrate;\r\n}\r\n"],"sourceRoot":"/source/"}