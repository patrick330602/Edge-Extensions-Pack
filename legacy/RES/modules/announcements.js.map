{"version":3,"sources":["modules/announcements.js"],"names":[],"mappings":"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","file":"modules/announcements.js","sourcesContent":["addModule('RESAnnouncements', function(module, moduleID) {\r\n\tmodule.moduleName = 'RES Announcements';\r\n\tmodule.category = 'Core';\r\n\tmodule.description = 'Keep up with important news';\r\n\tmodule.alwaysEnabled = true;\r\n\tmodule.hidden = true;\r\n\r\n\tvar sourceUrl = 'r/RESAnnouncements/new.json?limit=1&app=res';\r\n\tvar viewUrl = '/r/RESAnnouncements/new';\r\n\r\n\tvar keys = {\r\n\t\tunread: 'RESmodules.announcement.newAnnouncement',\r\n\t\tlastUnreadDate: 'RESmodules.announcement.lastUnreadDate',\r\n\t\tposts: 'RESmodules.announcements.announcements',\r\n\t\tlastID: 'RESModules.announcement.lastAnnouncementID'\r\n\t};\r\n\r\n\tvar clearAnnouncements = RESUtils.currentSubreddit('RESAnnouncements');\r\n\r\n\tmodule.beforeLoad = function() {\r\n\t\treturn RESStorage.loadItem.apply(RESStorage,Â Object.getOwnPropertyNames(keys).map(function(key) {\r\n\t\t\treturn keys[key];\r\n\t\t}))\r\n\t\t.then(function() {\r\n\t\t\tif (clearAnnouncements) {\r\n\t\t\t\tclearUnread();\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn checkForUpdate();\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tmodule.go = function() {\r\n\t\tif (RESStorage.getItem(keys.unread)) {\r\n\t\t\tsetNewNotification();\r\n\t\t}\r\n\t};\r\n\r\n\tfunction openAnnouncements() {\r\n\t\tlocation.href = viewUrl;\r\n\t}\r\n\r\n\tfunction setNewNotification() {\r\n\t\t// if the user hasn't clicked it for 3 days, start to annoy them\r\n\t\tvar lastUnread = RESStorage.getItem(keys.lastUnreadDate),\r\n\t\t\twithPizzazz = (lastUnread && (new Date() - lastUnread > 86400000 * 3));\r\n\t\tmodules['RESMenu'].setNewNotification(openAnnouncements, withPizzazz);\r\n\r\n\t\tvar menuItem = RESUtils.createElement('div', 'RESAnnouncementMenuItem');\r\n\t\t$('<span class=\"RESMenuItemButton\"><span class=\"gearIcon newNotification\" /></span>').appendTo(menuItem)\r\n\t\t\t.on('click', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\tclearUnread();\r\n\t\t\t\te.target.classList.remove('newNotification');\r\n\t\t\t});\r\n\t\t$('<a>new announcement!</a>', { href: viewUrl }).appendTo(menuItem);\r\n\t\tmodules['RESMenu'].addMenuItem(menuItem, openAnnouncements);\r\n\t}\r\n\r\n\tfunction clearUnread() {\r\n\t\tRESStorage.removeItem(keys.unread);\r\n\t\tRESStorage.removeItem(keys.lastUnreadDate);\r\n\t\treturn $.Deferred().resolve(false);\r\n\t}\r\n\r\n\tfunction checkForUpdate() {\r\n\t\treturn RESUtils.cache.fetch({\r\n\t\t\tkey: keys.posts,\r\n\t\t\tendpoint: sourceUrl,\r\n\t\t\texpires: 86400000, // 24hrs\r\n\t\t\tcallback: function(data) {\r\n\t\t\t\tvar lastID = RESStorage.getItem(keys.lastID);\r\n\r\n\t\t\t\tvar thisID = data.data.children[0].data.id;\r\n\t\t\t\tif (thisID !== lastID) {\r\n\t\t\t\t\tRESStorage.setItem(keys.unread, 'true');\r\n\t\t\t\t\tRESStorage.setItem(keys.lastUnreadDate, new Date());\r\n\t\t\t\t\tsetNewNotification();\r\n\t\t\t\t}\r\n\t\t\t\tRESStorage.setItem(keys.lastID, thisID);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}