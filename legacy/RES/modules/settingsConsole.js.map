{"version":3,"sources":["modules/settingsConsole.js"],"names":[],"mappings":"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","file":"modules/settingsConsole.js","sourcesContent":["addModule('settingsConsole', function(module, moduleID) {\r\n\tmodule.moduleName = 'Settings Console';\r\n\tmodule.category = 'Core';\r\n\tmodule.description = 'Manage your RES settings and preferences';\r\n\tmodule.alwaysEnabled = true;\r\n\tmodule.hidden = true;\r\n\r\n\tvar AUTOSTAGE_DEBOUNCE_NAME = 'RESSettings.autostage';\r\n\r\n\tvar modalOverlay, keyCodeModal, RESConsoleContainer, moduleOptionsScrim, saveButton, moduleToggle,\r\n\t\tcaptureKey, captureKeyID, currentModule;\r\n\r\n\tmodule.beforeLoad = function() {\r\n\t\trenderMenuItem();\r\n\t};\r\n\tmodule.go = function() {\r\n\t\taddMenuItem();\r\n\t};\r\n\r\n\tfunction renderMenuItem() {\r\n\t\tmodule.menuItem = RESUtils.createElement('div', 'SettingsConsole', null, 'RES settings console');\r\n\t}\r\n\r\n\tfunction addMenuItem() {\r\n\t\tfunction onClick() {\r\n\t\t\tmodules['RESMenu'].hidePrefsDropdown();\r\n\t\t\tmodule.open();\r\n\t\t}\r\n\t\tmodules['RESMenu'].addMenuItem(module.menuItem, onClick, true);\r\n\t}\r\n\r\n\tfunction create() {\r\n\t\tpopulateCategories();\r\n\t\tRESTemplates.load('settingsConsole', _create);\r\n\t}\r\n\r\n\tfunction _create(template) {\r\n\t\t// create the console container\r\n\t\tRESConsoleContainer = template.html(RESMetadata)[0];\r\n\t\t// hide it by default...\r\n\t\t// create a modal overlay\r\n\t\tmodalOverlay = RESUtils.createElement('div', 'modalOverlay');\r\n\t\tmodalOverlay.addEventListener('click', function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\treturn false;\r\n\t\t}, true);\r\n\t\tdocument.body.appendChild(modalOverlay);\r\n\r\n\t\tvar RESClose = RESConsoleContainer.querySelector('#RESClose');\r\n\t\tRESClose.addEventListener('click', function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tmodule.close();\r\n\t\t}, true);\r\n\r\n\r\n\t\tvar RESAdvOptionsSpan = RESConsoleContainer.querySelector('#RESAllOptionsSpan');\r\n\t\tRESAdvOptionsSpan.setAttribute('title', modules['settingsNavigation'].options.showAllOptions.description);\r\n\r\n\t\tvar RESAdvOptions = RESAdvOptionsSpan.querySelector('input');\r\n\t\tRESAdvOptions.addEventListener('change', function(e) {\r\n\t\t\tRESUtils.options.setOption('settingsNavigation', 'showAllOptions', this.checked);\r\n\t\t\tupdateAdvancedOptionsVisibility();\r\n\t\t}, true);\r\n\r\n\t\t// create the menu\r\n\t\tRESTemplates.load('settingsConsoleModuleSelector', function(template) {\r\n\t\t\tvar modulesSelector = template.html({ categories: module.categories });\r\n\t\t\t$(RESConsoleContainer).find('#RESConfigPanelModulesList').html(modulesSelector);\r\n\t\t});\r\n\r\n\t\t$(RESConsoleContainer).find('#RESConfigPanelModulesPane')\r\n\t\t\t.on('click', '.moduleButton', function(e) {\r\n\t\t\t\tvar id = $(this).data('module');\r\n\t\t\t\tif (id) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tshowConfigOptions(id);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on('click', '.categoryButton', function(e) {\r\n\t\t\t\tvar id = $(this).data('category');\r\n\t\t\t\tif (id) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\topenCategoryPanel(id);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tmodule.RESConsoleContent = RESConsoleContainer.querySelector('#RESConsoleContent');\r\n\t\tif (modules['settingsNavigation'].options.showAllOptions.value) {\r\n\t\t\tRESAdvOptions.checked = true;\r\n\t\t} else {\r\n\t\t\tmodule.RESConsoleContent.classList.add('advanced-options-disabled');\r\n\t\t}\r\n\t\tmodule.RESConfigPanelOptions = RESConsoleContainer.querySelector('#RESConfigPanelOptions');\r\n\r\n\t\tmodules['search'].renderSearchForm(RESConsoleContainer);\r\n\r\n\t\t// Okay, the console is done. Add it to the document body.\r\n\t\tdocument.body.appendChild(RESConsoleContainer);\r\n\r\n\t\twindow.addEventListener('keydown', function(e) {\r\n\t\t\tif (captureKey && (e.keyCode !== 16) && (e.keyCode !== 17) && (e.keyCode !== 18)) {\r\n\t\t\t\t// capture the key, display something nice for it, and then close the popup...\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar keyArray;\r\n\t\t\t\tif (e.keyCode === 8) { // backspace, we disable the shortcut\r\n\t\t\t\t\tkeyArray = [-1, false, false, false, false];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tkeyArray = [e.keyCode, e.altKey, e.ctrlKey, e.shiftKey, e.metaKey];\r\n\t\t\t\t}\r\n\t\t\t\t// not using .getElementById here due to a collision with reddit's elements (i.e. #modmail)\r\n\t\t\t\tmodule.RESConfigPanelOptions.querySelector('[id=\"' + captureKeyID + '\"]').value = keyArray.join(',');\r\n\t\t\t\tmodule.RESConfigPanelOptions.querySelector('[id=\"' + captureKeyID + '-display\"]').value = RESUtils.niceKeyCode(keyArray);\r\n\t\t\t\tkeyCodeModal.style.display = 'none';\r\n\t\t\t\tcaptureKey = false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$(module.RESConsoleContent).on({\r\n\t\t\tfocus: function(e) {\r\n\t\t\t\t// show dialog box to grab keycode, but display something nice...\r\n\t\t\t\t$(keyCodeModal).css({\r\n\t\t\t\t\tdisplay: 'block',\r\n\t\t\t\t\ttop: RESUtils.mouseY + 'px',\r\n\t\t\t\t\tleft: RESUtils.mouseX + 'px'\r\n\t\t\t\t});\r\n\t\t\t\tcaptureKey = true;\r\n\t\t\t\tcaptureKeyID = this.getAttribute('capturefor');\r\n\t\t\t},\r\n\t\t\tblur: function(e) {\r\n\t\t\t\t$(keyCodeModal).css('display', 'none');\r\n\t\t\t}\r\n\t\t}, '.keycode + input[type=text][displayonly]');\r\n\r\n\t\tkeyCodeModal = RESUtils.createElement('div', 'keyCodeModal');\r\n\t\t$(keyCodeModal).text('Press a key (or combination with shift, alt and/or ctrl) to assign this action.');\r\n\t\tdocument.body.appendChild(keyCodeModal);\r\n\t}\r\n\r\n\tfunction populateCategories() {\r\n\t\tvar categories = [];\r\n\t\tvar modulesByCategory = {};\r\n\r\n\t\tfor (var moduleID in modules) {\r\n\t\t\tvar mod = modules[moduleID];\r\n\t\t\tif (mod.hidden) continue;\r\n\r\n\t\t\tvar moduleCategories = [].concat(mod.category);\r\n\t\t\tmoduleCategories.forEach(function(category) {\r\n\t\t\t\tif (category && !modulesByCategory[category]) {\r\n\t\t\t\t\tcategories.push(category);\r\n\t\t\t\t\tmodulesByCategory[category] = [];\r\n\t\t\t\t}\r\n\t\t\t\tmodulesByCategory[category].push({\r\n\t\t\t\t\tmoduleID: mod.moduleID,\r\n\t\t\t\t\tmoduleName: mod.moduleName,\r\n\t\t\t\t\tisEnabled: mod.isEnabled(),\r\n\t\t\t\t\tsort: mod.sort\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar categoryNames = Object.getOwnPropertyNames(modulesByCategory);\r\n\r\n\t\tvar categorySortSpec = RESMetadata.categories.slice(0).map(function(a) { return a.toLocaleLowerCase(); }),\r\n\t\t\tpresortedCategories = [],\r\n\t\t\tunsortedCategories = [];\r\n\t\tcategoryNames.forEach(function(category) {\r\n\t\t\tvar index = categorySortSpec.indexOf(category.toLocaleLowerCase());\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tpresortedCategories[index] = category;\r\n\t\t\t} else {\r\n\t\t\t\tunsortedCategories.push(category);\r\n\t\t\t}\r\n\t\t});\r\n\t\tunsortedCategories.sort(function(a, b) {\r\n\t\t\treturn a.toLocaleLowerCase().localeCompare(b.toLocaleLowerCase());\r\n\t\t});\r\n\t\tvar splice = categorySortSpec.indexOf('*');\r\n\t\tif (splice === -1) {\r\n\t\t\tcategoryNames = presortedCategories.concat(unsortedCategories);\r\n\t\t} else {\r\n\t\t\tcategoryNames = presortedCategories.slice(0, splice)\r\n\t\t\t\t\t\t\t.concat(unsortedCategories)\r\n\t\t\t\t\t\t\t.concat(presortedCategories.slice(splice + 1));\r\n\t\t}\r\n\r\n\t\tcategories = categoryNames.map(function(category) {\r\n\t\t\tvar modules = modulesByCategory[category];\r\n\t\t\tif (modules && modules.length) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: category,\r\n\t\t\t\t\tmodules: modules\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}).filter(function(category) {\r\n\t\t\treturn !!category;\r\n\t\t});\r\n\r\n\t\tcategories.forEach(function(category) {\r\n\t\t\tcategory.modules.sort(function(a, b) {\r\n\t\t\t\tvar sort = 0;\r\n\t\t\t\tif (a.sort == b.sort) {\r\n\t\t\t\t\tsort = a.moduleName.toLocaleLowerCase().localeCompare(b.moduleName.toLocaleLowerCase());\r\n\t\t\t\t}  else {\r\n\t\t\t\t\tsort = (a.sort || 0) - (b.sort || 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn sort;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tmodule.categories = categories;\r\n\t}\r\n\r\n\tfunction updateSelectedModule(moduleID) {\r\n\t\tvar items = $(RESConsoleContainer).find('.moduleButton');\r\n\r\n\t\tvar selected = items.filter(function() {\r\n\t\t\tvar thisValue = $(this).data('module');\r\n\r\n\t\t\treturn thisValue === moduleID;\r\n\t\t});\r\n\t\titems.not(selected).removeClass('active');\r\n\t\tselected.addClass('active');\r\n\r\n\t\tvar category = (category = modules[moduleID]) && category.category;\r\n\t\topenCategoryPanel(category);\r\n\t}\r\n\r\n\tfunction drawOptionInput(moduleID, optionName, optionObject, isTable) {\r\n\t\tvar thisOptionFormEle;\r\n\t\tswitch (optionObject.type) {\r\n\t\t\tcase 'textarea':\r\n\t\t\t\t// textarea...\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement('textarea', optionName);\r\n\t\t\t\tthisOptionFormEle.setAttribute('type', 'textarea');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\t// this is typed user input and therefore safe, we allow HTML for a few settings.\r\n\t\t\t\t$(thisOptionFormEle).html(escapeHTML(optionObject.value));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'text':\r\n\t\t\t\t// text...\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement('input', optionName);\r\n\t\t\t\tthisOptionFormEle.setAttribute('type', 'text');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\tthisOptionFormEle.setAttribute('placeHolder', optionObject.placeHolder || '');\r\n\t\t\t\tif (typeof optionObject.value !== 'undefined') {\r\n\t\t\t\t\tthisOptionFormEle.setAttribute('value', optionObject.value);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'color':\r\n\t\t\t\t// color...\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement('input', optionName);\r\n\t\t\t\tthisOptionFormEle.setAttribute('type', 'color');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\t// thisOptionFormEle.setAttribute('value', optionObject.value); // didn't work on chrome, need to work with .value\r\n\t\t\t\tif (typeof optionObject.value !== 'undefined') {\r\n\t\t\t\t\tthisOptionFormEle.value = optionObject.value;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'button':\r\n\t\t\t\t// button...\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement('button', optionName);\r\n\t\t\t\tthisOptionFormEle.classList.add('RESConsoleButton');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\tthisOptionFormEle.textContent = optionObject.text;\r\n\t\t\t\tif (typeof optionObject.callback === 'function') {\r\n\t\t\t\t\tthisOptionFormEle.addEventListener('click', optionObject.callback, false);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'list':\r\n\t\t\t\t// list...\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement('input', optionName);\r\n\t\t\t\tthisOptionFormEle.setAttribute('class', 'RESInputList');\r\n\t\t\t\tthisOptionFormEle.setAttribute('type', 'text');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\t// thisOptionFormEle.setAttribute('value', optionObject.value);\r\n\t\t\t\tvar existingOptions = optionObject.value;\r\n\t\t\t\tif (typeof existingOptions === 'undefined') existingOptions = '';\r\n\r\n\t\t\t\tvar optionArray, prepop, listSpec;\r\n\t\t\t\toptionArray = existingOptions.split(',');\r\n\t\t\t\tprepop = optionArray.filter(function(option) {\r\n\t\t\t\t\treturn option !== '';\r\n\t\t\t\t}).map(function(option) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid: option,\r\n\t\t\t\t\t\tname: option\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\tlistSpec = RESUtils.options.listTypes[optionObject.listType] || optionObject;\r\n\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t$(thisOptionFormEle).tokenInput(listSpec.source, {\r\n\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\tqueryParam: 'query',\r\n\t\t\t\t\t\ttheme: 'facebook',\r\n\t\t\t\t\t\tallowFreeTagging: true,\r\n\t\t\t\t\t\tzindex: 999999999,\r\n\t\t\t\t\t\tonResult: (typeof listSpec.onResult === 'function') ? listSpec.onResult : null,\r\n\t\t\t\t\t\tonCachedResult: (typeof listSpec.onCachedResult === 'function') ? listSpec.onCachedResult : null,\r\n\t\t\t\t\t\tprePopulate: prepop,\r\n\t\t\t\t\t\thintText: (typeof listSpec.hintText === 'string') ? listSpec.hintText : null\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 100);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'password':\r\n\t\t\t\t// password...\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement('input', optionName);\r\n\t\t\t\tthisOptionFormEle.setAttribute('type', 'password');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\tif (typeof optionObject.value !== 'undefined') {\r\n\t\t\t\t\tthisOptionFormEle.setAttribute('value', optionObject.value);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'boolean':\r\n\t\t\t\t// checkbox\r\n\t\t\t\t/*\r\n\t\t\t\tvar thisOptionFormEle = RESUtils.createElement('input', optionName);\r\n\t\t\t\tthisOptionFormEle.setAttribute('type','checkbox');\r\n\t\t\t\tthisOptionFormEle.setAttribute('moduleID',moduleID);\r\n\t\t\t\tthisOptionFormEle.setAttribute('value',optionObject.value);\r\n\t\t\t\tif (optionObject.value) {\r\n\t\t\t\t\tthisOptionFormEle.setAttribute('checked',true);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tthisOptionFormEle = RESUtils.createElement.toggleButton(moduleID, optionName, optionObject.value, null, null, isTable);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'enum':\r\n\t\t\t\t// radio buttons\r\n\t\t\t\tif (typeof optionObject.values === 'undefined') {\r\n\t\t\t\t\talert('misconfigured enum option in module: ' + moduleID);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthisOptionFormEle = RESUtils.createElement('div', optionName);\r\n\t\t\t\t\tthisOptionFormEle.setAttribute('class', 'enum');\r\n\t\t\t\t\toptionObject.values.forEach(function(optionValue, index) {\r\n\t\t\t\t\t\tvar thisId = optionName + '-' + index;\r\n\t\t\t\t\t\tvar thisOptionFormSubEle = RESUtils.createElement('input', thisId);\r\n\t\t\t\t\t\tif (isTable) thisOptionFormSubEle.setAttribute('tableOption', 'true');\r\n\t\t\t\t\t\tthisOptionFormSubEle.setAttribute('type', 'radio');\r\n\t\t\t\t\t\tthisOptionFormSubEle.setAttribute('name', optionName);\r\n\t\t\t\t\t\tthisOptionFormSubEle.setAttribute('moduleID', moduleID);\r\n\t\t\t\t\t\tthisOptionFormSubEle.setAttribute('value', optionValue.value);\r\n\t\t\t\t\t\tvar nullEqualsEmpty = ((optionObject.value === null) && (optionValue.value === ''));\r\n\t\t\t\t\t\t// we also need to check for null == '' - which are technically equal.\r\n\t\t\t\t\t\tif ((optionObject.value === optionValue.value) || nullEqualsEmpty) {\r\n\t\t\t\t\t\t\tthisOptionFormSubEle.setAttribute('checked', 'checked');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar thisLabel = document.createElement('label');\r\n\t\t\t\t\t\tthisLabel.setAttribute('for', thisId);\r\n\t\t\t\t\t\t$(thisLabel).safeHtml(' ' + optionValue.name + ' ' /* security note: the name property is hardcoded, not user input */);\r\n\t\t\t\t\t\tthisOptionFormEle.appendChild(thisOptionFormSubEle);\r\n\t\t\t\t\t\tthisOptionFormEle.appendChild(thisLabel);\r\n\t\t\t\t\t\tvar thisBR = document.createElement('br');\r\n\t\t\t\t\t\tthisOptionFormEle.appendChild(thisBR);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'keycode':\r\n\t\t\t\t// keycode - shows a key value, but stores a keycode and possibly shift/alt/ctrl combo.\r\n\t\t\t\tvar realOptionFormEle = $('<input>').attr({\r\n\t\t\t\t\tid: optionName,\r\n\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\tclass: 'keycode',\r\n\t\t\t\t\tmoduleID: moduleID\r\n\t\t\t\t}).css({\r\n\t\t\t\t\tborder: '1px solid red',\r\n\t\t\t\t\tdisplay: 'none'\r\n\t\t\t\t}).val(optionObject.value);\r\n\t\t\t\tif (isTable) realOptionFormEle.attr('tableOption', 'true');\r\n\r\n\t\t\t\tvar thisKeyCodeDisplay = $('<input>').attr({\r\n\t\t\t\t\tid: optionName + '-display',\r\n\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\tcapturefor: optionName,\r\n\t\t\t\t\tdisplayonly: 'true'\r\n\t\t\t\t}).val(RESUtils.niceKeyCode(optionObject.value));\r\n\t\t\t\tthisOptionFormEle = $('<div>').append(realOptionFormEle).append(thisKeyCodeDisplay)[0];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log('misconfigured option in module: ' + moduleID);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (isTable) {\r\n\t\t\tthisOptionFormEle.setAttribute('tableOption', 'true');\r\n\t\t}\r\n\t\treturn thisOptionFormEle;\r\n\t}\r\n\r\n\tfunction showConfigOptions(moduleID) {\r\n\t\tif (!modules[moduleID]) return;\r\n\r\n\t\tdrawConfigOptions(moduleID);\r\n\t\tupdateSelectedModule(moduleID);\r\n\t\tcurrentModule = moduleID;\r\n\r\n\t\tmodule.RESConsoleContent.scrollTop = 0;\r\n\r\n\t\tmodules['settingsNavigation'].setUrlHash(moduleID);\r\n\t}\r\n\r\n\tvar _didDrawSettingsConsole;\r\n\tfunction drawSettingsConsole() {\r\n\t\tif (_didDrawSettingsConsole) return;\r\n\t\t_didDrawSettingsConsole = true;\r\n\r\n\t\t// put in the description, and a button to enable/disable the module, first..\r\n\t\tvar thisToggle = RESConsoleContainer.querySelector('.moduleToggle');\r\n\t\tmoduleToggle = thisToggle;\r\n\r\n\t\t$(thisToggle)\r\n\t\t\t.toggle(!modules[moduleID].alwaysEnabled)\r\n\t\t\t.toggleClass('enabled', modules[moduleID].isEnabled())\r\n\t\t\t.data('module', moduleID);\r\n\r\n\t\t$(thisToggle)\r\n\t\t\t.toggle(!modules[moduleID].alwaysEnabled)\r\n\t\t\t.toggleClass('enabled', modules[moduleID].isEnabled())\r\n\t\t\t.data('module', moduleID);\r\n\r\n\t\tthisToggle.addEventListener('click', function(e) {\r\n\t\t\tvar moduleID = $(this).data('module'),\r\n\t\t\t\t$moduleButton = $(RESConsoleContainer).find('.moduleButton').filter(function() {\r\n\t\t\t\t\treturn $(this).data('module') === moduleID;\r\n\t\t\t\t}),\r\n\t\t\t\tenabled = this.classList.contains('enabled');\r\n\r\n\t\t\tvar enable = !enabled;\r\n\t\t\t$(thisToggle).add($moduleButton).add(this.classList)\r\n\t\t\t\t.toggleClass('enabled', enable);\r\n\t\t\tupdateSaveButton(enable && Object.getOwnPropertyNames(modules[moduleID].options).length);\r\n\t\t\t$(moduleOptionsScrim)\r\n\t\t\t\t.toggleClass('visible', !enable);\r\n\r\n\t\t\tRESUtils.options.enableModule(moduleID, !enabled);\r\n\t\t}, true);\r\n\r\n\t\tfunction saveModuleOptions(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tsaveCurrentModuleOptions();\r\n\t\t}\r\n\r\n\t\tsaveButton = RESConsoleContainer.querySelector('#moduleOptionsSave');\r\n\t\tsaveButton.addEventListener('click', saveModuleOptions, true);\r\n\t}\r\n\r\n\tfunction drawConfigOptions(moduleID) {\r\n\t\tdrawSettingsConsole();\r\n\t\tif (modules[moduleID] && modules[moduleID].hidden) return;\r\n\t\tvar thisOptions = getOptions(moduleID),\r\n\t\t\toptCount = 0,\r\n\t\t\tthisDescription, allOptionsContainer,\r\n\t\t\tthisOptionContainer, containerID, thisLabel,\r\n\t\t\tthisOptionFormEle,\r\n\t\t\ti, dep;\r\n\r\n\t\t// TODO: potentially use markdown instead of HTML for descriptions and convert on the\r\n\t\t// fly with SnuOwnd. Using .html() is safe here because we control each module's\r\n\t\t// description field, but for future code review sanity we should consider updating.\r\n\t\tif (typeof modules[moduleID].onConsoleOpen === 'function') {\r\n\t\t\tmodules[moduleID].onConsoleOpen();\r\n\t\t}\r\n\r\n\t\tRESConsoleContainer.querySelector('.moduleName').textContent = modules[moduleID].moduleName;\r\n\r\n\t\t$(moduleToggle)\r\n\t\t\t.toggle(!modules[moduleID].alwaysEnabled)\r\n\t\t\t.toggleClass('enabled', modules[moduleID].isEnabled())\r\n\t\t\t.data('module', moduleID);\r\n\t\tupdateSaveButton(Object.getOwnPropertyNames(thisOptions).length > 0);\r\n\t\tthisDescription = RESConsoleContainer.querySelector('.moduleDescription');\r\n\t\t$(thisDescription).html(modules[moduleID].description);\r\n\r\n\t\tallOptionsContainer = RESConsoleContainer.querySelector('#allOptionsContainer');\r\n\t\t$(allOptionsContainer).empty();\r\n\t\t// now draw all the options...\r\n\t\tfor (i in thisOptions) {\r\n\t\t\tif (!thisOptions[i].noconfig) {\r\n\t\t\t\toptCount++;\r\n\t\t\t\tcontainerID = 'optionContainer-' + moduleID + '-' + i;\r\n\t\t\t\tthisOptionContainer = RESUtils.createElement('div', containerID, 'optionContainer');\r\n\t\t\t\tdep = thisOptions[i].dependsOn;\r\n\t\t\t\tif (dep) {\r\n\t\t\t\t\t// if the option this one depends on is false, hide it\r\n\t\t\t\t\tif (!thisOptions[dep].value) {\r\n\t\t\t\t\t\tthisOptionContainer.setAttribute('style', 'display: none;');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (thisOptions[i].advanced) {\r\n\t\t\t\t\tthisOptionContainer.classList.add('advanced');\r\n\t\t\t\t}\r\n\t\t\t\tthisLabel = RESUtils.createElement('label', null, 'optionTitle');\r\n\t\t\t\tthisLabel.setAttribute('for', i);\r\n\t\t\t\tvar niceDefaultOption = null;\r\n\t\t\t\tswitch (thisOptions[i].type) {\r\n\t\t\t\t\tcase 'textarea':\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\tcase 'password':\r\n\t\t\t\t\tcase 'list':\r\n\t\t\t\t\t\tniceDefaultOption = thisOptions[i].default;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'color':\r\n\t\t\t\t\t\tniceDefaultOption = thisOptions[i].default;\r\n\t\t\t\t\t\tif (thisOptions[i].default.substr(0, 1) === '#') {\r\n\t\t\t\t\t\t\tniceDefaultOption += ' (R:' + parseInt(thisOptions[i].default.substr(1, 2), 16) + ', G:' + parseInt(thisOptions[i].default.substr(3, 2), 16) + ', B:' + parseInt(thisOptions[i].default.substr(5, 2), 16) + ')';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'boolean':\r\n\t\t\t\t\t\tniceDefaultOption = thisOptions[i].default ? 'on' : 'off';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'enum':\r\n\t\t\t\t\t\tthisOptions[i].values.some(function(thisValue) {\r\n\t\t\t\t\t\t\tif (thisOptions[i].default === thisValue.value) {\r\n\t\t\t\t\t\t\t\tniceDefaultOption = thisValue.name;\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'keycode':\r\n\t\t\t\t\t\tniceDefaultOption = RESUtils.niceKeyCode(thisOptions[i].default);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (niceDefaultOption !== null) {\r\n\t\t\t\t\tthisLabel.setAttribute('title', 'Default: ' + niceDefaultOption);\r\n\t\t\t\t}\r\n\t\t\t\t$(thisLabel).text(i);\r\n\t\t\t\tvar thisOptionDescription = RESUtils.createElement('div', null, 'optionDescription');\r\n\t\t\t\tvar thisOptionSetting = RESUtils.createElement('div', null, 'optionSetting');\r\n\t\t\t\t// TODO: same as above in this function, let's use markdown in the future\r\n\t\t\t\t$(thisOptionDescription).html(thisOptions[i].description);\r\n\t\t\t\tthisOptionContainer.appendChild(thisLabel);\r\n\t\t\t\tthisOptionContainer.appendChild(thisOptionSetting);\r\n\t\t\t\tif (thisOptions[i].type === 'table') {\r\n\t\t\t\t\tvar isFixed = thisOptions[i].addRowText === false; // set addRowText value to false to disable additing/removing/moving of row\r\n\t\t\t\t\tthisOptionContainer.classList.add('table');\r\n\t\t\t\t\tvar thisTbody;\r\n\t\t\t\t\t// table - has a list of fields (headers of table), users can add/remove rows...\r\n\t\t\t\t\tif (typeof thisOptions[i].fields === 'undefined') {\r\n\t\t\t\t\t\talert('Misconfigured table option in module: ' + moduleID + ' - options of type \"table\" must have fields defined.');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// get field names...\r\n\t\t\t\t\t\tvar fieldNames = [];\r\n\t\t\t\t\t\t// now that we know the field names, get table rows...\r\n\t\t\t\t\t\tvar thisTable = document.createElement('table');\r\n\t\t\t\t\t\tthisTable.setAttribute('moduleID', moduleID);\r\n\t\t\t\t\t\tthisTable.setAttribute('optionName', i);\r\n\t\t\t\t\t\tthisTable.setAttribute('class', 'optionsTable');\r\n\t\t\t\t\t\tvar thisThead = document.createElement('thead');\r\n\t\t\t\t\t\tvar thisTableHeader = document.createElement('tr'),\r\n\t\t\t\t\t\t\tthisTH;\r\n\t\t\t\t\t\tthisTable.appendChild(thisThead);\r\n\t\t\t\t\t\tthisOptions[i].fields.forEach(function(field) {\r\n\t\t\t\t\t\t\tfieldNames.push(field.name);\r\n\t\t\t\t\t\t\tthisTH = document.createElement('th');\r\n\t\t\t\t\t\t\t$(thisTH).text(field.name);\r\n\t\t\t\t\t\t\tthisTableHeader.appendChild(thisTH);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (!isFixed) {\r\n\t\t\t\t\t\t\t// add delete column\r\n\t\t\t\t\t\t\tthisTH = document.createElement('th');\r\n\t\t\t\t\t\t\tthisTableHeader.appendChild(thisTH);\r\n\t\t\t\t\t\t\t// add move column\r\n\t\t\t\t\t\t\tthisTH = document.createElement('th');\r\n\t\t\t\t\t\t\t$(thisTableHeader).prepend(thisTH);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthisThead.appendChild(thisTableHeader);\r\n\t\t\t\t\t\tthisTable.appendChild(thisThead);\r\n\t\t\t\t\t\tthisTbody = document.createElement('tbody');\r\n\t\t\t\t\t\tthisTbody.setAttribute('id', 'tbody_' + i);\r\n\t\t\t\t\t\tvar thisTR, thisTD;\r\n\t\t\t\t\t\tif (thisOptions[i].value) {\r\n\t\t\t\t\t\t\tthisOptions[i].value.forEach(function(thisValue, j) {\r\n\t\t\t\t\t\t\t\tthisTR = document.createElement('tr');\r\n\t\t\t\t\t\t\t\t$(thisTR).data('itemidx-orig', j);\r\n\t\t\t\t\t\t\t\tthisOptions[i].fields.forEach(function(thisOpt, k) {\r\n\t\t\t\t\t\t\t\t\tthisTD = document.createElement('td');\r\n\t\t\t\t\t\t\t\t\tthisTD.className = 'hasTableOption';\r\n\t\t\t\t\t\t\t\t\tvar thisFullOpt = i + '_' + thisOpt.name;\r\n\t\t\t\t\t\t\t\t\tthisOpt.value = thisValue[k];\r\n\t\t\t\t\t\t\t\t\t// var thisOptInputName = thisOpt.name + '_' + j;\r\n\t\t\t\t\t\t\t\t\tvar thisOptInputName = thisFullOpt + '_' + j;\r\n\t\t\t\t\t\t\t\t\tvar thisTableEle = drawOptionInput(moduleID, thisOptInputName, thisOpt, true);\r\n\t\t\t\t\t\t\t\t\tthisTD.appendChild(thisTableEle);\r\n\t\t\t\t\t\t\t\t\tthisTR.appendChild(thisTD);\r\n\t\t\t\t\t\t\t\t}, this);\r\n\t\t\t\t\t\t\t\tif (!isFixed) {\r\n\t\t\t\t\t\t\t\t\taddTableButtons(thisTR);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthisTbody.appendChild(thisTR);\r\n\t\t\t\t\t\t\t}, this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthisTable.appendChild(thisTbody);\r\n\t\t\t\t\t\tthisOptionFormEle = thisTable;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(thisOptionDescription).insertAfter(thisLabel);\r\n\t\t\t\t\tif (!isFixed) {\r\n\t\t\t\t\t\t// Create an \"add row\" button...\r\n\t\t\t\t\t\tvar addRowText = thisOptions[i].addRowText || 'Add Row';\r\n\t\t\t\t\t\tvar addRowButton = document.createElement('input');\r\n\t\t\t\t\t\taddRowButton.classList.add('addRowButton');\r\n\t\t\t\t\t\taddRowButton.setAttribute('type', 'button');\r\n\t\t\t\t\t\taddRowButton.setAttribute('value', addRowText);\r\n\t\t\t\t\t\taddRowButton.setAttribute('optionName', i);\r\n\t\t\t\t\t\taddRowButton.setAttribute('moduleID', moduleID);\r\n\t\t\t\t\t\taddRowButton.addEventListener('click', function() {\r\n\t\t\t\t\t\t\tvar optionName = this.getAttribute('optionName');\r\n\t\t\t\t\t\t\tvar thisTbodyName = 'tbody_' + optionName;\r\n\t\t\t\t\t\t\tvar thisTbody = document.getElementById(thisTbodyName);\r\n\t\t\t\t\t\t\tvar newRow = document.createElement('tr');\r\n\t\t\t\t\t\t\tvar rowCount = (thisTbody.querySelectorAll('tr')) ? thisTbody.querySelectorAll('tr').length + 1 : 1;\r\n\t\t\t\t\t\t\tmodules[moduleID].options[optionName].fields.forEach(function(thisOpt) {\r\n\t\t\t\t\t\t\t\tvar newCell = document.createElement('td');\r\n\t\t\t\t\t\t\t\tnewCell.className = 'hasTableOption';\r\n\t\t\t\t\t\t\t\tif (thisOpt.type !== 'enum') thisOpt.value = '';\r\n\t\t\t\t\t\t\t\tvar optionNameWithRow = optionName + '_' + thisOpt.name + '_' + rowCount;\r\n\t\t\t\t\t\t\t\tvar thisInput = drawOptionInput(moduleID, optionNameWithRow, thisOpt, true);\r\n\t\t\t\t\t\t\t\tnewCell.appendChild(thisInput);\r\n\t\t\t\t\t\t\t\tnewRow.appendChild(newCell);\r\n\t\t\t\t\t\t\t\t$(newRow).data('option-index', rowCount - 1);\r\n\t\t\t\t\t\t\t\tvar firstText = newRow.querySelector('input[type=text]');\r\n\t\t\t\t\t\t\t\tif (!firstText) firstText = newRow.querySelector('textarea');\r\n\t\t\t\t\t\t\t\tif (firstText) {\r\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t\t\tfirstText.focus();\r\n\t\t\t\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\taddTableButtons(newRow);\r\n\r\n\t\t\t\t\t\t\tvar thisLen = $(thisTbody).find(' > tr').length;\r\n\t\t\t\t\t\t\t$(newRow).data('itemidx-orig', thisLen);\r\n\r\n\t\t\t\t\t\t\tthisTbody.appendChild(newRow);\r\n\t\t\t\t\t\t\t$(thisTbody).trigger('change');\r\n\t\t\t\t\t\t}, true);\r\n\r\n\t\t\t\t\t\t$(addRowButton).insertAfter(thisOptionSetting);\r\n\r\n\t\t\t\t\t\tmakeOptionTableSortable(thisTbody, moduleID, i);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (thisOptions[i].type == 'builder') {\r\n\t\t\t\t\tthisOptionContainer.classList.add('specialOptionType');\r\n\t\t\t\t\t$(thisOptionDescription).insertAfter(thisLabel);\r\n\t\t\t\t\tthisOptionFormEle = drawOptionBuilder(thisOptions, moduleID, i);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif ((thisOptions[i].type === 'text') || (thisOptions[i].type === 'password') || (thisOptions[i].type === 'keycode')) thisOptionDescription.classList.add('textInput');\r\n\t\t\t\t\tthisOptionFormEle = drawOptionInput(moduleID, i, thisOptions[i]);\r\n\t\t\t\t\tthisOptionContainer.appendChild(thisOptionDescription);\r\n\t\t\t\t}\r\n\t\t\t\tthisOptionSetting.appendChild(thisOptionFormEle);\r\n\t\t\t\tallOptionsContainer.appendChild(thisOptionContainer);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmodule.RESConfigPanelOptions.querySelector('#noOptions').style.display = 'none';\r\n\t\tif (!optCount && modules[moduleID].alwaysEnabled) {\r\n\t\t\t// do nothing\r\n\t\t} else if (optCount === 0) {\r\n\t\t\tmodule.RESConfigPanelOptions.querySelector('#noOptions').style.display = 'block';\r\n\t\t} else {\r\n\t\t\tmoduleOptionsScrim = RESUtils.createElement('div', 'moduleOptionsScrim');\r\n\t\t\tmoduleOptionsScrim.classList.toggle('visible', !modules[moduleID].isEnabled());\r\n\t\t\tallOptionsContainer.appendChild(moduleOptionsScrim);\r\n\t\t\t// console.log($(thisSaveButton).position());\r\n\t\t}\r\n\r\n\t\tfunction addTableButtons(thisTR) {\r\n\t\t\t// add delete button\r\n\t\t\tthisTD = document.createElement('td');\r\n\t\t\tvar thisDeleteButton = document.createElement('div');\r\n\t\t\t$(thisDeleteButton)\r\n\t\t\t\t.addClass('res-icon-button res-icon deleteButton')\r\n\t\t\t\t.html('&#xF056;')\r\n\t\t\t\t.attr('title', 'remove this row');\r\n\r\n\t\t\tthisDeleteButton.addEventListener('click', function(e) {\r\n\t\t\t\tif (!confirm('Are you sure you want to delete this row?')) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdeleteOptionRow(e);\r\n\t\t\t});\r\n\t\t\tthisTD.appendChild(thisDeleteButton);\r\n\t\t\tthisTR.appendChild(thisTD);\r\n\r\n\t\t\t// add move handle\r\n\t\t\tthisTD = document.createElement('td');\r\n\t\t\tvar thisHandle = document.createElement('div');\r\n\t\t\t$(thisHandle)\r\n\t\t\t.addClass('res-icon-button res-icon handle')\r\n\t\t\t\t.html('&#xF0AA;')\r\n\t\t\t\t.attr('title', 'drag and drop to move this row');\r\n\r\n\t\t\tthisTD.appendChild(thisHandle);\r\n\t\t\t$(thisTR).prepend(thisTD);\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.onOptionChange = function(moduleID, fieldID, oldValue, newValue) {\r\n\t\tvar thisOptions = getOptions(moduleID);\r\n\r\n\t\tif (thisOptions[fieldID] && thisOptions[fieldID].dependents) {\r\n\t\t\tthisOptions[fieldID].dependents.forEach(function(dep) {\r\n\t\t\t\tif (newValue) {\r\n\t\t\t\t\tshowOption(moduleID, dep);\r\n\t\t\t\t} else {\r\n\t\t\t\t\thideOption(moduleID, dep);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t\t$(RESConsoleContainer).trigger('change');\r\n\t};\r\n\r\n\tfunction showOption(moduleID, fieldID) {\r\n\t\t$('#optionContainer-'+moduleID+'-'+fieldID).slideDown();\r\n\t}\r\n\r\n\tfunction hideOption(moduleID, fieldID) {\r\n\t\t$('#optionContainer-'+moduleID+'-'+fieldID).slideUp();\r\n\t}\r\n\r\n\tfunction deleteOptionRow(e) {\r\n\t\tvar thisRow = e.target.parentNode.parentNode;\r\n\t\t$(thisRow).trigger('change').remove();\r\n\t}\r\n\r\n\tfunction stageCurrentModuleOptions() {\r\n\t\t// Cancel debounce so we don't needlessly stage twice\r\n\t\tRESUtils.debounce(AUTOSTAGE_DEBOUNCE_NAME);\r\n\r\n\t\tvar panelOptionsDiv = module.RESConfigPanelOptions;\r\n\t\t// first, go through inputs that aren't of a specialized type like table or builder\r\n\t\t$(panelOptionsDiv)\r\n\t\t\t.find('.optionContainer:not(.specialOptionType)')\r\n\t\t\t.find('input, textarea')\r\n\t\t\t.each(function(i, input) {\r\n\t\t\t\t// save values of any inputs onscreen, but skip ones with 'capturefor' - those are display only.\r\n\t\t\t\tvar notTokenPrefix = (input.getAttribute('id') !== null) && (input.getAttribute('id').indexOf('token-input-') === -1);\r\n\t\t\t\tif ((notTokenPrefix) && (input.getAttribute('type') !== 'button') && (input.getAttribute('displayonly') !== 'true') && (input.getAttribute('tableOption') !== 'true')) {\r\n\t\t\t\t\t// get the option name out of the input field id - unless it's a radio button...\r\n\t\t\t\t\tvar optionName;\r\n\t\t\t\t\tif (input.getAttribute('type') === 'radio') {\r\n\t\t\t\t\t\toptionName = input.getAttribute('name');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toptionName = input.getAttribute('id');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// get the module name out of the input's moduleid attribute\r\n\t\t\t\t\tvar optionValue, moduleID = currentModule;\r\n\t\t\t\t\tif (input.getAttribute('type') === 'checkbox') {\r\n\t\t\t\t\t\toptionValue = !!input.checked;\r\n\t\t\t\t\t} else if (input.getAttribute('type') === 'radio') {\r\n\t\t\t\t\t\tif (input.checked) {\r\n\t\t\t\t\t\t\toptionValue = input.value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// check if it's a keycode, in which case we need to parse it into an array...\r\n\t\t\t\t\t\tif ((input.getAttribute('class')) && (input.getAttribute('class').indexOf('keycode') !== -1)) {\r\n\t\t\t\t\t\t\tvar tempArray = input.value.split(',');\r\n\t\t\t\t\t\t\t// convert the internal values of this array into their respective types (int, bool, bool, bool)\r\n\t\t\t\t\t\t\toptionValue = [parseInt(tempArray[0], 10), (tempArray[1] === 'true'), (tempArray[2] === 'true'), (tempArray[3] === 'true'), (tempArray[4] === 'true')];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toptionValue = input.value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof optionValue !== 'undefined') {\r\n\t\t\t\t\t\tRESUtils.options.stage.add(moduleID, optionName, optionValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t// Check if there are any tables of options on this panel...\r\n\t\tvar optionsTables = panelOptionsDiv.querySelectorAll('.optionsTable');\r\n\t\tif (typeof optionsTables !== 'undefined') {\r\n\t\t\t// For each table, we need to go through each row in the tbody, and then go through each option and make a multidimensional array.\r\n\t\t\t// For example, something like: [['foo','bar','baz'],['pants','warez','cats']]\r\n\t\t\t$.each(optionsTables, function(i, table) {\r\n\t\t\t\tvar moduleID = table.getAttribute('moduleID');\r\n\t\t\t\tvar optionName = table.getAttribute('optionName');\r\n\t\t\t\tvar thisTBODY = table.querySelector('tbody');\r\n\t\t\t\tvar thisRows = thisTBODY.querySelectorAll('tr');\r\n\t\t\t\t// check if there are any rows...\r\n\t\t\t\tif (typeof thisRows !== 'undefined') {\r\n\t\t\t\t\t// go through each row, and get all of the inputs...\r\n\t\t\t\t\tvar optionMulti = Array.prototype.slice.call(thisRows).map(function(row) {\r\n\t\t\t\t\t\tvar cells = row.querySelectorAll('td.hasTableOption');\r\n\t\t\t\t\t\tvar notAllBlank = false;\r\n\t\t\t\t\t\tvar optionRow = Array.prototype.slice.call(cells).map(function(cell) {\r\n\t\t\t\t\t\t\tvar inputs = cell.querySelectorAll('input[tableOption=true], textarea[tableOption=true]');\r\n\t\t\t\t\t\t\tvar optionValue = null;\r\n\t\t\t\t\t\t\t$.each(inputs, function(i, input) {\r\n\t\t\t\t\t\t\t\t// get the module name out of the input's moduleid attribute\r\n\t\t\t\t\t\t\t\t// var moduleID = input.getAttribute('moduleID');\r\n\t\t\t\t\t\t\t\tif (input.getAttribute('type') === 'checkbox') {\r\n\t\t\t\t\t\t\t\t\toptionValue = input.checked;\r\n\t\t\t\t\t\t\t\t} else if (input.getAttribute('type') === 'radio') {\r\n\t\t\t\t\t\t\t\t\tif (input.checked) {\r\n\t\t\t\t\t\t\t\t\t\toptionValue = input.value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// check if it's a keycode, in which case we need to parse it into an array...\r\n\t\t\t\t\t\t\t\t\tif ((input.getAttribute('class')) && (input.getAttribute('class').indexOf('keycode') !== -1)) {\r\n\t\t\t\t\t\t\t\t\t\tvar tempArray = input.value.split(',');\r\n\t\t\t\t\t\t\t\t\t\t// convert the internal values of this array into their respective types (int, bool, bool, bool)\r\n\t\t\t\t\t\t\t\t\t\toptionValue = [parseInt(tempArray[0], 10), (tempArray[1] === 'true'), (tempArray[2] === 'true'), (tempArray[3] === 'true')];\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\toptionValue = input.value;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif ((optionValue !== '') && (input.getAttribute('type') !== 'radio') &&\r\n\t\t\t\t\t\t\t\t\t\t// If no keyCode is set, then discard the value\r\n\t\t\t\t\t\t\t\t\t\t!(Array.isArray(optionValue) && isNaN(optionValue[0]))) {\r\n\t\t\t\t\t\t\t\t\tnotAllBlank = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn optionValue;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif (notAllBlank) {\r\n\t\t\t\t\t\t\treturn optionRow;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\toptionMulti = optionMulti.filter(function(optionRow) {\r\n\t\t\t\t\t\treturn Array.isArray(optionRow) && (optionRow.length > 0);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (typeof modules[moduleID].options[optionName].sort === 'function') {\r\n\t\t\t\t\t\toptionMulti.sort(modules[moduleID].options[optionName].sort);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tRESUtils.options.stage.add(moduleID, optionName, optionMulti);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$(panelOptionsDiv).find('.optionBuilder').each(function(i, builder) {\r\n\t\t\tvar moduleId = this.dataset.moduleId,\r\n\t\t\t\toptionName = this.dataset.optionName;\r\n\r\n\t\t\tvar option = modules[moduleId].options[optionName],\r\n\t\t\t\tconfig = option.cases;\r\n\r\n\t\t\tvar items = [];\r\n\t\t\t$(builder).find('.builderItem').each(function() {\r\n\t\t\t\titems.push(readBuilderItem(this, config));\r\n\t\t\t});\r\n\t\t\tRESUtils.options.stage.add(moduleId, optionName, items);\r\n\t\t});\r\n\r\n\t\tupdateSaveButton();\r\n\t}\r\n\r\n\tfunction saveCurrentModuleOptions() {\r\n\t\tstageCurrentModuleOptions();\r\n\t\tRESUtils.options.stage.commit();\r\n\t\tupdateSaveButton();\r\n\t\tnotifyOptionsSaved();\r\n\t}\r\n\r\n\tfunction updateSaveButton(visibleOptions) {\r\n\t\tvar unsavedOptions = RESUtils.options.stage.isDirty();\r\n\r\n\t\t$(saveButton).toggleClass('optionsSaved', !unsavedOptions);\r\n\t}\r\n\r\n\tmodule.open = function(moduleIdOrCategory) {\r\n\t\tvar moduleID;\r\n\t\tif (!RESConsoleContainer) {\r\n\t\t\tcreate();\r\n\t\t}\r\n\r\n\t\tif (modules[moduleIdOrCategory]) {\r\n\t\t\tvar mod = modules[moduleIdOrCategory];\r\n\t\t\tmoduleID = mod && mod.moduleID;\r\n\t\t} else if (module.categories[moduleIdOrCategory]) {\r\n\t\t\tmoduleID = RESUtils.options.getModuleIDsByCategory(moduleIdOrCategory)[0];\r\n\t\t}\r\n\t\tif (!moduleID || !moduleID.length) {\r\n\t\t\tmoduleID = RESMetadata.defaultModuleID;\r\n\t\t}\r\n\r\n\t\t// Draw the config panel\r\n\t\tshowConfigOptions(moduleID);\r\n\r\n\t\tmodule.isOpen = true;\r\n\t\t// hide the ad-frame div in case it's flash, because then it covers up the settings console and makes it impossible to see the save button!\r\n\t\tvar adFrame = document.getElementById('ad-frame');\r\n\t\tif ((typeof adFrame !== 'undefined') && (adFrame !== null)) {\r\n\t\t\tadFrame.style.display = 'none';\r\n\t\t}\r\n\t\t// add a class to body to hide the scrollbar.\r\n\t\tsetTimeout(function() {\r\n\t\t\t// Main reason for timeout: https://bugzilla.mozilla.org/show_bug.cgi?id=625289\r\n\t\t\tdocument.querySelector('body').classList.add('res-console-open');\r\n\t\t}, 500);\r\n\r\n\t\tmodules['styleTweaks'].setSRStyleToggleVisibility(false, 'RESConsole');\r\n\t\t// var leftCentered = Math.floor((window.innerWidth - 720) / 2);\r\n\t\t// modalOverlay.setAttribute('style','display: block; height: ' + document.documentElement.scrollHeight + 'px');\r\n\t\tmodalOverlay.classList.remove('fadeOut');\r\n\t\tmodalOverlay.classList.add('fadeIn');\r\n\r\n\t\tRESConsoleContainer.classList.remove('slideOut');\r\n\t\tRESConsoleContainer.classList.add('slideIn');\r\n\r\n\t\tRESStorage.setItem('RESConsole.hasOpenedConsole', true);\r\n\r\n\t\t$(document.body).on('keyup', handleEscapeKey);\r\n\t\t$(window).on('beforeunload', handleBeforeUnload);\r\n\t\t$('#SearchRES-input').focus();\r\n\t\t$(RESConsoleContainer).on('change', RESUtils.debounce.bind(RESUtils, AUTOSTAGE_DEBOUNCE_NAME, 300, stageCurrentModuleOptions))\r\n\t\t\t.on('keyup', RESUtils.debounce.bind(RESUtils, AUTOSTAGE_DEBOUNCE_NAME, 1000, stageCurrentModuleOptions));\r\n\t};\r\n\r\n\tfunction handleEscapeKey(event) {\r\n\t\t// don't close if the user is in a token input field (e.g. adding subreddits to a list)\r\n\t\t// because they probably just want to cancel the dropdown list\r\n\t\tif (event.which === 27 && (document.activeElement.id.indexOf('token-input') === -1)) {\r\n\t\t\tmodule.close();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleBeforeUnload() {\r\n\t\tif (RESUtils.options.stage.isDirty()) {\r\n\t\t\treturn abandonChangesConfirmation;\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.close = function(options) {\r\n\t\toptions = $.extend({\r\n\t\t\tpromptIfStagedOptions: true,\r\n\t\t\tresetUrl: true\r\n\t\t}, options);\r\n\r\n\t\tif (options.promptIfStagedOptions && RESUtils.options.stage.isDirty()) {\r\n\t\t\tvar abandonChanges = confirm(abandonChangesConfirmation);\r\n\t\t\tif (!abandonChanges) return;\r\n\t\t}\r\n\r\n\t\tRESUtils.options.stage.reset();\r\n\r\n\t\tmodule.isOpen = false;\r\n\t\t$(document.body).off('keyup', handleEscapeKey);\r\n\t\t$(window).off('beforeunload', handleBeforeUnload);\r\n\t\t// Let's be nice to reddit and put their ad frame back now...\r\n\t\tvar adFrame = document.getElementById('ad-frame');\r\n\t\tif ((typeof adFrame !== 'undefined') && (adFrame !== null)) {\r\n\t\t\tadFrame.style.display = 'block';\r\n\t\t}\r\n\r\n\t\tmodules['styleTweaks'].setSRStyleToggleVisibility(true, 'RESConsole');\r\n\r\n\t\tmodalOverlay.classList.remove('fadeIn');\r\n\t\tmodalOverlay.classList.add('fadeOut');\r\n\t\tRESConsoleContainer.classList.remove('slideIn');\r\n\t\tRESConsoleContainer.classList.add('slideOut');\r\n\t\tsetTimeout(function() {\r\n\t\t\t// Main reason for timeout: https://bugzilla.mozilla.org/show_bug.cgi?id=625289\r\n\t\t\tdocument.body.classList.remove('res-console-open');\r\n\t\t}, 500);\r\n\t\t// just in case the user was in the middle of setting a key and decided to close the dialog, clean that up.\r\n\t\tif (keyCodeModal) {\r\n\t\t\tkeyCodeModal.style.display = 'none';\r\n\t\t\tcaptureKey = false;\r\n\t\t}\r\n\r\n\t\tif (options.resetUrl) {\r\n\t\t\tmodules['settingsNavigation'].resetUrlHash();\r\n\t\t}\r\n\t};\r\n\r\n\tfunction openCategoryPanel(categories) {\r\n\t\tvar items = $(RESConsoleContainer).find('#RESConfigPanelModulesList .RESConfigPanelCategory'),\r\n\t\t\tselected = items.filter(function() {\r\n\t\t\t\tvar thisValue = $(this).data('category');\r\n\r\n\t\t\t\treturn categories.indexOf(thisValue) !== -1;\r\n\t\t\t});\r\n\t\tif (selected.filter('.active').length === 0) { // if a category isn't already open\r\n\t\t\tselected = selected.filter(function() { // select first category\r\n\t\t\t\tvar thisValue = $(this).data('category');\r\n\t\t\t\treturn categories.indexOf(thisValue) === 0;\r\n\t\t\t});\r\n\r\n\t\t\titems.not(selected).removeClass('active').find('ul').slideUp(300);\r\n\t\t\tselected.addClass('active').find('ul').slideDown(300);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateAdvancedOptionsVisibility() {\r\n\t\tif (modules['settingsNavigation'].options.showAllOptions.value) {\r\n\t\t\tdocument.getElementById('RESConsoleContent').classList.remove('advanced-options-disabled');\r\n\t\t} else {\r\n\t\t\tdocument.getElementById('RESConsoleContent').classList.add('advanced-options-disabled');\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.getOptionValue = function(moduleID, optionKey) {\r\n\t\tvar optionInput = document.getElementById(optionKey);\r\n\t\tif (optionInput) {\r\n\t\t\treturn optionInput.value;\r\n\t\t} else {\r\n\t\t\tconsole.error('Cannot get a value for ' + moduleID + '.' + optionKey +\r\n\t\t\t\t' because the HTML element does not exist.');\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\tmodule.setOptionValue = function(moduleID, optionKey, value) {\r\n\t\tvar optionInput = document.getElementById(optionKey);\r\n\t\tif (optionInput) {\r\n\t\t\toptionInput.value = value;\r\n\t\t} else {\r\n\t\t\tconsole.error('Cannot set a value for ' + moduleID + '.' + optionKey +\r\n\t\t\t\t' because the HTML element does not exist.');\r\n\t\t}\r\n\t};\r\n\r\n\tfunction makeOptionTableSortable(tableBody, moduleID, optionKey) {\r\n\t\tfunction cleanupDrag($item) {\r\n\t\t\t$item.removeData(['oldIndex', 'dragOffset']);\r\n\t\t\t$(module.RESConfigPanelOptions).edgescroll('stop');\r\n\t\t\t$item.find('>td').removeAttr('style');\r\n\t\t}\r\n\t\t$(tableBody).sortable({\r\n\t\t\tnested: false,\r\n\t\t\thandle: '.handle',\r\n\t\t\tplaceholderClass: 'RESSortPlaceholder',\r\n\t\t\tplaceholder: '<tr class=\"RESSortPlaceholder\"><td></td></tr>',\r\n\t\t\tcontainerSelector: 'tbody',\r\n\t\t\titemSelector: 'tr',\r\n\t\t\tonCancel: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\t\t\t\tcleanupDrag($item);\r\n\t\t\t},\r\n\t\t\tonDrop: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\r\n\t\t\t\tvar oldIndex = $item.data('oldIndex'),\r\n\t\t\t\t\tnewIndex = $item.index(),\r\n\t\t\t\t\trows = modules[moduleID].options[optionKey].value,\r\n\t\t\t\t\trow = rows.splice(oldIndex, 1)[0];\r\n\r\n\t\t\t\trows.splice(newIndex, 0, row);\r\n\r\n\t\t\t\tcleanupDrag($item);\r\n\t\t\t\t$item.trigger('change');\r\n\t\t\t},\r\n\t\t\tonDrag: function($item, position, _super, event) {\r\n\t\t\t\tvar dragOffset = $item.data('dragOffset');\r\n\t\t\t\t//Reposition the row, remembering to apply the offset\r\n\t\t\t\t$item.css({\r\n\t\t\t\t\ttop: position.top - dragOffset.top,\r\n\t\t\t\t\tleft: position.left - dragOffset.left\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonDragStart: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\r\n\t\t\t\t$(module.RESConfigPanelOptions).edgescroll({speed: 4});\r\n\r\n\t\t\t\tvar offset = $item.offset(),\r\n\t\t\t\t\tpointer = container.rootGroup.pointer;\r\n\r\n\t\t\t\t//force a constant width for the columns since switching the\r\n\t\t\t\t// row's positioning method to absolute means that the column\r\n\t\t\t\t// width calulation ignores the other rows.\r\n\t\t\t\t$item.find('>td').css('width', function() {\r\n\t\t\t\t\treturn $(this).width();\r\n\t\t\t\t});\r\n\t\t\t\t$item.css({\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\theight: $item.height(),\r\n\t\t\t\t\twidth: $item.width()\r\n\t\t\t\t}).data({\r\n\t\t\t\t\toldIndex: $item.index(),\r\n\t\t\t\t\t// Store this so we can keep what we are dragging at\r\n\t\t\t\t\t// the same relative cursor position\r\n\t\t\t\t\tdragOffset: {\r\n\t\t\t\t\t\tleft: pointer.left - offset.left,\r\n\t\t\t\t\t\ttop: pointer.top - offset.top\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t//Builder stuff\r\n\r\n\tfunction drawOptionBuilder(options, moduleID, optionName) {\r\n\t\tvar option = options[optionName];\r\n\t\tvar $addRowButton = $('<button class=\"addRowButton\">'),\r\n\t\t\t$itemContainer = $('<div class=\"optionBuilder\">');\r\n\r\n\t\t$itemContainer.attr({\r\n\t\t\t'data-module-id': moduleID,\r\n\t\t\t'data-option-name': optionName\r\n\t\t});\r\n\t\t$addRowButton\r\n\t\t\t.text(option.addItemText || '+add item')\r\n\t\t\t.on('click', function(e) {\r\n\t\t\t\tvar $newBody = drawBuilderItem(option.defaultTemplate(), option.cases);\r\n\t\t\t\t$(this).siblings('.optionBuilder:first').trigger('change').append($newBody);\r\n\t\t\t\tvar firstText = $newBody.find('input[type=text], textarea')[0];\r\n\t\t\t\tif (firstText) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tfirstText.focus();\r\n\t\t\t\t\t}, 200);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\toption.value.forEach(function(item) {\r\n\t\t\tdrawBuilderItem(item, option.cases).appendTo($itemContainer);\r\n\t\t});\r\n\t\tmakeBuilderItemsSortable($itemContainer);\r\n\r\n\t\treturn $('<div>').append($itemContainer, $addRowButton)[0];\r\n\t}\r\n\r\n\tfunction drawBuilderItem(data, config) {\r\n\t\tvar $body = $('<div class=\"builderItem\">'),\r\n\t\t\t$header = $('<textarea name=\"builderNote\" rows=\"2\" cols=\"40\" placeholder=\"Write a description/note for this\">').val(data.note),\r\n\t\t\t$versionField  = $('<input type=\"hidden\" name=\"version\">').val(data.ver),\r\n\t\t\t$wrapper = $('<div class=\"builderBody\">');\r\n\r\n\t\tvar $handle = $('<div>')\r\n\t\t\t.addClass('res-icon-button res-icon handle')\r\n\t\t\t.html('&#xF0AA;')\r\n\t\t\t.attr('title', 'drag and drop to move this filter');\r\n\r\n\t\tvar $deleteButton = $('<div>')\r\n\t\t\t.addClass('res-icon-button res-icon deleteButton')\r\n\t\t\t.html('&#xF056;')\r\n\t\t\t.attr('title', 'remove this filter')\r\n\t\t\t.on('click', function(e) {\r\n\t\t\t\tif (confirm('Are you sure you want remove this filter?')) {\r\n\t\t\t\t\t$(this).trigger('change');\r\n\t\t\t\t\t$(this).closest('.builderItem').trigger('change').remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tvar $editButton = $('<div>')\r\n\t\t\t.addClass('res-icon-button res-icon')\r\n\t\t\t.html('&#xF061;')\r\n\t\t\t.attr('title', 'copy and share, or update your settings with a new version')\r\n\t\t\t.on('click', function(e) {\r\n\t\t\t\tvar data = readBuilderItem($(this).closest('.builderItem'), config),\r\n\t\t\t\t\tjson = prompt(\r\n\t\t\t\t\t\t'Copy this and share it, or paste a new version and update your settings',\r\n\t\t\t\t\t\tJSON.stringify(data)\r\n\t\t\t\t\t);\r\n\t\t\t\tif (json !== null) {\r\n\t\t\t\t\tvar newData = JSON.parse(json);\r\n\t\t\t\t\t$body.trigger('change').replaceWith(drawBuilderItem(newData, config));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t$body.append([\r\n\t\t\t$('<div class=\"builderItemControls\">').append($handle),\r\n\t\t\t$('<div class=\"builderItemControls builderTrailingControls\">').append($editButton, $deleteButton),\r\n\t\t\t$header,\r\n\t\t\t$versionField,\r\n\t\t\t$wrapper\r\n\t\t]);\r\n\t\t$wrapper.append(drawBuilderBlock(data.body, config));\r\n\t\t$wrapper.find('> .builderWrap > .builderControls').remove();\r\n\t\tmakeBuilderBlocksSortable($wrapper);\r\n\t\treturn $body;\r\n\t}\r\n\r\n\tfunction drawBlockControls() {\r\n\t\tvar $handle = $('<div>')\r\n\t\t\t.addClass('res-icon-button res-icon handle')\r\n\t\t\t.html('&#xF0AA;')\r\n\t\t\t.attr('title', 'drag and drop to move this condition');\r\n\r\n\t\treturn $('<div class=\"builderControls\">').append($handle);\r\n\t}\r\n\r\n\tfunction drawBlockTrailingControls() {\r\n\t\tvar $deleteButton = $('<div>')\r\n\t\t\t.addClass('res-icon-button res-icon deleteButton')\r\n\t\t\t.html('&#xF056;')\r\n\t\t\t.attr('title', 'remove this condition');\r\n\t\t$deleteButton.on('click', function(e) {\r\n\t\t\tif (confirm('Are you sure you want to delete this condition?')) {\r\n\t\t\t\t$(this).trigger('change');\r\n\t\t\t\t$(this).closest('.builderWrap').parent('li').remove();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn $('<div class=\"builderControls builderTrailingControls\">').append($deleteButton);\r\n\t}\r\n\r\n\tfunction drawBuilderBlock(data, config, tag) {\r\n\t\tvar $wrapper = $('<div class=\"builderWrap\">'),\r\n\t\t\t$controls = drawBlockControls(),\r\n\t\t\t$trailingControls = drawBlockTrailingControls(),\r\n\t\t\t$block = $('<div class=\"builderBlock\">');\r\n\t\t$wrapper.append($trailingControls, $controls, $block);\r\n\t\t$block.attr('data-type', data.type);\r\n\r\n\t\tvar blockConfig = config[data.type];\r\n\r\n\t\tblockConfig.fields.forEach(function(field) {\r\n\t\t\tif (typeof field === 'string') return $block.append(field);\r\n\r\n\t\t\tvar fieldModule = builderFields[field.type];\r\n\t\t\tif (fieldModule === undefined)\r\n\t\t\t\tthrow new Error('Unimplemented field type: ' + field.type);\r\n\t\t\t$block.append(fieldModule.draw(data, field, config));\r\n\t\t});\r\n\t\treturn $wrapper;\r\n\t}\r\n\r\n\tfunction readBuilderItem(item, config) {\r\n\t\tvar obj = {\r\n\t\t\tnote: $(item).find('> textarea[name=builderNote]').val(),\r\n\t\t\tver: parseInt($(item).find('> input[name=version]').val(), 10)\r\n\t\t};\r\n\t\tvar $firstBlock = $(item).find('> .builderBody > .builderWrap > .builderBlock');\r\n\t\tobj.body = readBuilderBlock($firstBlock, config);\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tfunction readBuilderBlock($element, config) {\r\n\t\tvar type = $element.attr('data-type'),\r\n\t\t\tblockConfig = config[type];\r\n\t\tvar data = {type: type};\r\n\t\tblockConfig.fields.forEach(function(field) {\r\n\t\t\tif (typeof field === 'string') return;\r\n\t\t\tvar fieldType = field.type;\r\n\t\t\tvar $fieldElem = $element.find('> [name='+field.id+']');\r\n\t\t\tif (typeof builderFields[fieldType].read === 'function') {\r\n\t\t\t\tdata[field.id] = builderFields[fieldType].read($fieldElem, field, config);\r\n\t\t\t} else {\r\n\t\t\t\tdata[field.id] = $fieldElem.val();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn data;\r\n\t}\r\n\r\n\tfunction makeBuilderItemsSortable($builder) {\r\n\t\tfunction cleanupDrag($item) {\r\n\t\t\t$item.removeData('dragOffset');\r\n\t\t\t$(module.RESConfigPanelOptions).edgescroll('stop');\r\n\t\t}\r\n\r\n\t\t$builder.sortable({\r\n\t\t\tnested: false,\r\n\t\t\thandle: '.builderItem > .builderItemControls .handle',\r\n\t\t\tplaceholderClass: 'RESSortPlaceholder',\r\n\t\t\tplaceholder: '<div class=\"RESSortPlaceholder\"></div>',\r\n\t\t\tcontainerSelector: '.optionBuilder',\r\n\t\t\titemSelector: '.builderItem',\r\n\t\t\tonCancel: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\t\t\t\tcleanupDrag($item);\r\n\t\t\t},\r\n\t\t\tonDrop: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\t\t\t\tcleanupDrag($item);\r\n\t\t\t\t$item.trigger('change');\r\n\t\t\t},\r\n\t\t\tonDrag: function($item, position, _super, event) {\r\n\t\t\t\tvar dragOffset = $item.data('dragOffset');\r\n\t\t\t\t//Reposition the row, remembering to apply the offset\r\n\t\t\t\t$item.css({\r\n\t\t\t\t\ttop: position.top - dragOffset.top,\r\n\t\t\t\t\tleft: position.left - dragOffset.left\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonDragStart: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\r\n\t\t\t\t$(module.RESConfigPanelOptions).edgescroll({speed: 4});\r\n\r\n\t\t\t\t$item.css({\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\theight: $item.height(),\r\n\t\t\t\t\twidth: $item.width()\r\n\t\t\t\t});\r\n\t\t\t\t// Store this so we can keep what we are dragging at\r\n\t\t\t\t// the same relative cursor position\r\n\t\t\t\tvar offset = $item.offset(),\r\n\t\t\t\t\tpointer = container.rootGroup.pointer;\r\n\t\t\t\t$item.data('dragOffset', {\r\n\t\t\t\t\tleft: pointer.left - offset.left,\r\n\t\t\t\t\ttop: pointer.top - offset.top\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction makeBuilderBlocksSortable($builderItem) {\r\n\t\tfunction cleanupDrag($item) {\r\n\t\t\t$item.removeData('dragOffset');\r\n\t\t\t$(module.RESConfigPanelOptions).edgescroll('stop');\r\n\t\t}\r\n\r\n\t\t$builderItem.children('.builderWrap').sortable({\r\n\t\t\tnested: true,\r\n\t\t\thandle: '.handle',\r\n\t\t\tplaceholderClass: 'RESSortPlaceholder',\r\n\t\t\tplaceholder: '<li class=\"RESSortPlaceholder\"></li>',\r\n\t\t\tcontainerSelector: '.builderWrap',\r\n\t\t\titemPath: '> .builderBlock > .builderMulti',\r\n\t\t\titemSelector: 'li',\r\n\t\t\tonCancel: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\t\t\t\tcleanupDrag($item);\r\n\t\t\t},\r\n\t\t\tonDrop: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\t\t\t\tcleanupDrag($item);\r\n\t\t\t\t$item.trigger('change');\r\n\t\t\t},\r\n\t\t\tonDrag: function($item, position, _super, event) {\r\n\t\t\t\tvar dragOffset = $item.data('dragOffset');\r\n\t\t\t\t//Reposition the row, remembering to apply the offset\r\n\t\t\t\t$item.css({\r\n\t\t\t\t\ttop: position.top - dragOffset.top,\r\n\t\t\t\t\tleft: position.left - dragOffset.left\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonDragStart: function($item, container, _super, event) {\r\n\t\t\t\t_super($item, container, _super, event);\r\n\r\n\t\t\t\t$(module.RESConfigPanelOptions).edgescroll({speed: 4});\r\n\r\n\t\t\t\t$item.css({\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\theight: $item.height(),\r\n\t\t\t\t\twidth: $item.width()\r\n\t\t\t\t});\r\n\t\t\t\t// Store this so we can keep what we are dragging at\r\n\t\t\t\t// the same relative cursor position\r\n\t\t\t\tvar offset = $item.offset(),\r\n\t\t\t\t\tpointer = container.rootGroup.pointer;\r\n\t\t\t\t$item.data('dragOffset', {\r\n\t\t\t\t\tleft: pointer.left - offset.left,\r\n\t\t\t\t\ttop: pointer.top - offset.top\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tmodule.numericalCompare = function(op, a, b) {\r\n\t\tswitch (op) {\r\n\t\t\tcase '==':\treturn a == b;\r\n\t\t\tcase '!=':\treturn a != b;\r\n\t\t\tcase '>':\treturn a > b;\r\n\t\t\tcase '<':\treturn a < b;\r\n\t\t\tcase '>=':\treturn a >= b;\r\n\t\t\tcase '<=':\treturn a <= b;\r\n\t\t\tdefault: throw new Error('Unhandled operator ' + op);\r\n\t\t}\r\n\t};\r\n\r\n\tvar builderFields = {\r\n\t\tmulti: {\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\tvar $rowWrapper = $('<ul class=\"builderMulti\">').attr('name', blockConfig.id),\r\n\t\t\t\t\titems = data[blockConfig.id];\r\n\t\t\t\titems.forEach(function(itemData) {\r\n\t\t\t\t\tdrawBuilderBlock(itemData, config).appendTo($rowWrapper).wrap('<li>');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar $addButton = $('<select class=\"addBuilderBlock\">');\r\n\t\t\t\t$addButton.append('<option value=\"\">+ add a condition</option>');\r\n\t\t\t\tvar addableKeys = blockConfig.include;\r\n\t\t\t\tif (addableKeys === 'all') addableKeys = Object.keys(config);\r\n\t\t\t\taddableKeys.forEach(function(key) {\r\n\t\t\t\t\tvar name = config[key].name || key;\r\n\t\t\t\t\t$('<option>').text(name).val(key).appendTo($addButton);\r\n\t\t\t\t});\r\n\t\t\t\t$addButton.on('change', function(e) {\r\n\t\t\t\t\tvar type = $(this).val();\r\n\t\t\t\t\tif (type !== '' && type in config) {\r\n\t\t\t\t\t\tvar newRowData = config[type].defaultTemplate();\r\n\t\t\t\t\t\tvar $newRow = drawBuilderBlock(newRowData, config);\r\n\t\t\t\t\t\t$rowWrapper.append($newRow);\r\n\t\t\t\t\t\t$newRow.wrap('<li>');\r\n\t\t\t\t\t\t$(this).val('');\r\n\r\n\t\t\t\t\t\tvar firstText = $newRow.find('input[type=text], input[type=number], textarea')[0];\r\n\t\t\t\t\t\tif (firstText) {\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\tfirstText.focus();\r\n\t\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn $rowWrapper.add($addButton);\r\n\t\t\t},\r\n\t\t\tread: function($elem, fieldConfig, config) {\r\n\t\t\t\treturn $elem.find('> li > .builderWrap > .builderBlock').map(function() {\r\n\t\t\t\t\treturn readBuilderBlock($(this), config);\r\n\t\t\t\t}).get();\r\n\t\t\t}\r\n\t\t},\r\n\t\tnumber: {\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\tvar id = blockConfig.id;\r\n\t\t\t\treturn $('<input type=\"number\">').attr('name', id).val(data[id]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheck: {\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\tvar id = blockConfig.id;\r\n\t\t\t\treturn $('<input type=\"checkbox\">').attr('name', id).val(data[id]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheckset: {\r\n\t\t\tuid: 0,\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\tvar id = blockConfig.id;\r\n\t\t\t\tvar prefixId = this.uid++;\r\n\t\t\t\tvar $wrap = $('<div class=\"checkset\">').attr('name', blockConfig.id);\r\n\t\t\t\tblockConfig.items.forEach(function(e, idx, a) {\r\n\t\t\t\t\tvar itemId = 'checkset-'+prefixId+'-'+idx + 'X';\r\n\t\t\t\t\tvar $box = $('<input type=\"checkbox\" />')\r\n\t\t\t\t\t\t.attr('id', itemId)\r\n\t\t\t\t\t\t.attr('name', e);\r\n\t\t\t\t\tif (id in data && data[id].indexOf(e) > -1) $box.prop('checked', true);\r\n\t\t\t\t\tvar $label = $('<label>')\r\n\t\t\t\t\t\t.attr('for', itemId)\r\n\t\t\t\t\t\t.text(e);\r\n\t\t\t\t\t$wrap.append($box, $label);\r\n\t\t\t\t});\r\n\t\t\t\treturn $wrap;\r\n\t\t\t},\r\n\t\t\tread: function($elem, fieldConfig, config) {\r\n\t\t\t\tvar found = fieldConfig.items.filter(function(e, i, a) {\r\n\t\t\t\t\treturn $elem.children('[name=\"'+e+'\"]').prop('checked');\r\n\t\t\t\t});\r\n\t\t\t\treturn found;\r\n\t\t\t}\r\n\t\t},\r\n\t\ttext: {\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\tvar id = blockConfig.id;\r\n\t\t\t\tvar $field = $('<input type=\"text\">')\r\n\t\t\t\t\t.attr('name', id)\r\n\t\t\t\t\t.val(data[id]);\r\n\t\t\t\tif ('pattern' in blockConfig) {\r\n\t\t\t\t\t$field.attr('pattern', blockConfig.pattern);\r\n\t\t\t\t}\r\n\t\t\t\tif ('placeholder' in blockConfig) {\r\n\t\t\t\t\t$field.attr('placeholder', blockConfig.placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tif ('validator' in blockConfig) {\r\n\t\t\t\t\t$field.on('input', function(e) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tblockConfig.validator(this.value);\r\n\t\t\t\t\t\t\tthis.setCustomValidity('');\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\tthis.setCustomValidity('invalid');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn $field;\r\n\t\t\t}\r\n\t\t},\r\n\t\tduration: {\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\t//Store as milliseconds like JavaScript Date\r\n\t\t\t\tvar durr = data[blockConfig.id];\r\n\t\t\t\tvar days, hours, minutes;\r\n\t\t\t\tdurr /= 60 * 1000;\r\n\t\t\t\tminutes = durr % 60;\r\n\t\t\t\tdurr = (durr - minutes) / 60;\r\n\t\t\t\thours = durr % 24;\r\n\t\t\t\tdurr = (durr - hours) / 24;\r\n\t\t\t\tdays = durr;\r\n\r\n\t\t\t\treturn $('<div class=\"durationField\">')\r\n\t\t\t\t\t.attr('name', blockConfig.id)\r\n\t\t\t\t\t.append([\r\n\t\t\t\t\t\t$('<input type=\"number\" name=\"days\" />').val(days), ' days ',\r\n\t\t\t\t\t\t$('<input type=\"number\" name=\"hours\" />').val(hours), 'hours ',\r\n\t\t\t\t\t\t$('<input type=\"number\" name=\"minutes\" />').val(minutes), ' minutes ',\r\n\t\t\t\t\t]);\r\n\t\t\t},\r\n\t\t\tread: function($elem, fieldConfig, config) {\r\n\t\t\t\tvar days    = parseFloat($elem.children('[name=days]')   .val()) || 0,\r\n\t\t\t\t\thours   = parseFloat($elem.children('[name=hours]')  .val()) || 0,\r\n\t\t\t\t\tminutes = parseFloat($elem.children('[name=minutes]').val()) || 0;\r\n\r\n\t\t\t\t// Store as milliseconds like JavaScript Date\r\n\t\t\t\tvar duration = 0;\r\n\t\t\t\tduration += days    * 24 * 60 * 60;\r\n\t\t\t\tduration += hours        * 60 * 60;\r\n\t\t\t\tduration += minutes           * 60;\r\n\t\t\t\tduration *= 1000;\r\n\r\n\t\t\t\treturn duration;\r\n\t\t\t}\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\tdraw: function(data, blockConfig, config) {\r\n\t\t\t\tvar value = data[blockConfig.id],\r\n\t\t\t\t\tentries = blockConfig.options;\r\n\r\n\t\t\t\tif (typeof entries === 'string')\r\n\t\t\t\t\tentries = this.getPredefinedChoices(entries);\r\n\r\n\t\t\t\tvar $dropdown = $('<select>').attr('name', blockConfig.id);\r\n\t\t\t\tentries.forEach(function(row) {\r\n\t\t\t\t\tvar label, value;\r\n\t\t\t\t\tif (typeof row === 'string') {\r\n\t\t\t\t\t\tlabel = value = row;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlabel = row[0];\r\n\t\t\t\t\t\tvalue = row[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$('<option>').text(label).val(value).appendTo($dropdown);\r\n\t\t\t\t});\r\n\t\t\t\t$dropdown.val(value);\r\n\t\t\t\treturn $dropdown;\r\n\t\t\t},\r\n\t\t\tgetPredefinedChoices: function(name) {\r\n\t\t\t\tif (name === 'COMPARISON') {\r\n\t\t\t\t\treturn [\r\n\t\t\t\t\t\t['exactly', '=='],\r\n\t\t\t\t\t\t['not', '!='],\r\n\t\t\t\t\t\t['more than', '>'],\r\n\t\t\t\t\t\t['less than', '<'],\r\n\t\t\t\t\t\t['at least', '>='],\r\n\t\t\t\t\t\t['at most', '<='],\r\n\t\t\t\t\t];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('Option set \"'+name+'\" is not defined');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t//End Builder Stuff\r\n\r\n\tfunction getOptions(moduleID) {\r\n\t\tvar stored = RESUtils.options.getOptions(moduleID);\r\n\t\tvar staged = RESUtils.options.stage.get(moduleID);\r\n\r\n\t\tvar merged = $.extend(true, {}, stored, staged);\r\n\t\tvar dependency;\r\n\t\tfor (var optionKey in merged) {\r\n\t\t\tif (!merged.hasOwnProperty(optionKey)) continue;\r\n\r\n\t\t\tdependency = merged[merged[optionKey].dependsOn];\r\n\t\t\tif (dependency) {\r\n\t\t\t\t// we'll store a list of dependents on the 'parent' so we can show/hide them on\r\n\t\t\t\t// the fly as necessary\r\n\t\t\t\tdependency.dependents = dependency.dependents || [];\r\n\t\t\t\tdependency.dependents.push(optionKey);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn merged;\r\n\t}\r\n\r\n\tvar abandonChangesConfirmation = 'Abandon your changes to RES settings?';\r\n\r\n\tfunction notifyOptionsSaved() {\r\n\t\tvar statusEle = RESConsoleContainer.querySelector('#moduleOptionsSaveStatus');\r\n\t\tif (statusEle) {\r\n\t\t\tstatusEle.setAttribute('style', 'display: block; opacity: 1');\r\n\t\t\tsetTimeout(RESUtils.fadeElementOut, 500, statusEle, 1.0);\r\n\t\t}\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}