{"version":3,"sources":["modules/customToggles.js"],"names":[],"mappings":"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","file":"modules/customToggles.js","sourcesContent":["addModule('customToggles', function(module, moduleID) {\r\n\tmodule.moduleName = 'Custom Toggles';\r\n\tmodule.category = ['Core'];\r\n\tmodule.description = 'Set up custom on/off switches for various parts of RES.';\r\n\r\n\tmodule.options.toggle = {\r\n\t\tdescription: 'Enable or disable everything connected to this toggle; and optionally add a toggle to the RES gear dropdown menu',\r\n\t\ttype: 'table',\r\n\t\tfields: [{\r\n\t\t\tname: 'name',\r\n\t\t\ttype: 'text'\r\n\t\t}, {\r\n\t\t\tname: 'enabled',\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t}, {\r\n\t\t\tname: 'menuItem',\r\n\t\t\ttype: 'text'\r\n\t\t}]\r\n\t};\r\n\t/*\r\n\tmodule.options.activateToggle = {\r\n\t\ttype: 'builder',\r\n\t\tadvanced: true,\r\n\t\tdescription: 'Activate toggles based on complex custom criteria.'\r\n\t\t\t+ '\\n<p>This is a very advanced feature, please <a href=\"http://www.reddit.com/r/Enhancement/wiki/customToggles\">read the guide</a> before asking questions.  <p style=\"font-weight: bold; font-size: 16pt;\">This feature is currently in beta and may break in future RES updates.</p>',\r\n\t\tvalue: [],\r\n\t\taddItemText: '+add custom toggle activator',\r\n\t\tdefaultTemplate: function() {\r\n\t\t\treturn {\r\n\t\t\t\tnote: '', ver: 1,\r\n\t\t\t\tbody: {type: 'group', op: 'all', of: [\r\n\t\t\t\t\t// empty\r\n\t\t\t]}};\r\n\t\t},\r\n\t\tcases: {\r\n\t\t\ttoggleName:\r\n\t\t\tgroup: ...\r\n\t\t\tcurrentSub: ...,\r\n\t\t\tcurrentMultireddit: ...\r\n\t\t\tcurrentUserProfile: ...\r\n\t\t\tdow: ...,\r\n\t\t\tdate: ...,\r\n\t\t\ttime: ...\r\n\t\t\ttoggles: ... // for dependent toggles\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tvar _getByToggle = {};\r\n\tfunction getOptionByToggleName(optionKey, toggle) {\r\n\t\tif (!_getByToggle[optionKey]) {\r\n\t\t\t_getByToggle[optionKey] = RESUtils.indexOptionTable(moduleID, optionKey, 0);\r\n\t\t}\r\n\r\n\t\treturn _getByToggle[optionKey](toggle);\r\n\t}\r\n\r\n\r\n\tvar _getMenuItems;\r\n\tfunction getMenuItems(menuItemID) {\r\n\t\tif (!_getMenuItems) {\r\n\t\t\t_getMenuItems = RESUtils.indexOptionTable(moduleID, 'toggle', 2, true);\r\n\t\t}\r\n\r\n\t\tif (typeof menuItemID === 'undefined') {\r\n\t\t\treturn _getMenuItems;\r\n\t\t} else {\r\n\t\t\treturn _getMenuItems(menuItemID);\r\n\t\t}\r\n\t}\r\n\tfunction getAllMenuItems() {\r\n\t\treturn getMenuItems().all();\r\n\t}\r\n\r\n\tfunction getTogglesForMenuItem(menuItemID) {\r\n\t\tvar menuItems = getMenuItems(menuItemID);\r\n\t\tvar toggles = menuItems\r\n\t\t\t.map(function(menuItem) {\r\n\t\t\t\treturn menuItem[0]; // toggle\r\n\t\t\t});\r\n\t\treturn toggles;\r\n\t}\r\n\r\n\r\n\tfunction anyTogglesEnabled(toggles) {\r\n\t\tvar enabled = [].concat(toggles)\r\n\t\t\t.map(function(toggle) {\r\n\t\t\t\treturn toggle[1]; // enabled\r\n\t\t\t});\r\n\t\tvar anyEnabled = enabled.reduce(function(previousEnabled, enabled) {\r\n\t\t\t// If any toggle is enabled, then collection is enabled.\r\n\t\t\t// If all toggles are disabled, then collection is disabled\r\n\t\t\treturn previousEnabled || enabled;\r\n\t\t}, false);\r\n\t\treturn anyEnabled;\r\n\t}\r\n\r\n\r\n\tmodule.go = function() {\r\n\t\tif (!module.isEnabled() || !module.isMatchURL()) return;\r\n\t\tcreateToggleMenuItems();\r\n\t};\r\n\r\n\tmodule.toggleActive = function(name) {\r\n\t\tvar active = true;\r\n\t\tif (name && module.isEnabled() && module.isMatchURL()) {\r\n\t\t\tvar toggles = getOptionByToggleName('toggle', name);\r\n\t\t\tif (toggles && !anyTogglesEnabled(toggles)) {\r\n\t\t\t\tactive = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\treturn active;\r\n\t};\r\n\r\n\t// var $menuItems = {};\r\n\tfunction createToggleMenuItems() {\r\n\t\tvar menuItems = getAllMenuItems();\r\n\t\tmenuItems.forEach(function(menuItem) {\r\n\t\t\tvar menuItemID = menuItem[0][2];\r\n\t\t\tvar toggle = RESUtils.createElement('div', null, null, menuItemID);\r\n\t\t\ttoggle.setAttribute('title', 'Toggle ' + menuItemID);\r\n\t\t\ttoggle.appendChild(RESUtils.createElement.toggleButton(moduleID, menuItemID, anyTogglesEnabled(menuItem), null, null, false));\r\n\r\n\t\t\tmodules['RESMenu'].addMenuItem(toggle, onClickToggleMenuItem.bind(module, menuItemID));\r\n\t\t});\r\n\t}\r\n\tfunction onClickToggleMenuItem(menuItemID) {\r\n\t\tif (typeof menuItemID === 'undefined') return;\r\n\r\n\t\tvar enabled = module.toggleMenuItem(menuItemID);\r\n\t\t$(this).find('.toggleButton').toggleClass('enabled', enabled);\r\n\t}\r\n\r\n\r\n\tmodule.toggleMenuItem = function(menuItemID) {\r\n\t\tvar toggles = getTogglesForMenuItem(menuItemID);\r\n\t\treturn module.toggleToggle(toggles);\r\n\t};\r\n\r\n\tmodule.toggleToggle = function(toggles) {\r\n\t\ttoggles = [].concat(toggles)\r\n\t\t\t.map(function(toggle) {\r\n\t\t\t\treturn getOptionByToggleName('toggle', toggle);\r\n\t\t\t}).reduce(function(toggles, newToggles) {\r\n\t\t\t\treturn toggles.concat(newToggles);\r\n\t\t\t}, []);\r\n\r\n\t\tvar newEnabled = !anyTogglesEnabled(toggles);\r\n\r\n\t\t// Update cached settings\r\n\t\ttoggles.forEach(function(toggle) {\r\n\t\t\ttoggle[1] = newEnabled;\r\n\t\t});\r\n\r\n\t\t// Update settings in storage\r\n\t\tmodule.options.toggle.value.filter(function(toggle) {\r\n\t\t\treturn toggles.indexOf(toggle[0]) !== -1;\r\n\t\t}).forEach(function(toggle) {\r\n\t\t\ttoggle[1] = newEnabled;\r\n\r\n\t\t});\r\n\t\tRESUtils.options.setOption(moduleID, 'toggle', module.options.toggle.value);\r\n\r\n\r\n\t\t// Notify listeners\r\n\t\ttoggles.forEach(function(toggle) {\r\n\t\t\ttoggle = toggle[0];\r\n\t\t\tif (newEnabled) {\r\n\t\t\t\t$(module).trigger($.Event('activated', { target: toggle }));\r\n\t\t\t} else {\r\n\t\t\t\t$(module).trigger($.Event('deactivated', { target: toggle }));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn newEnabled;\r\n\t};\r\n});\r\n"],"sourceRoot":"/source/"}