{"version":3,"sources":["modules/submitHelper.js"],"names":[],"mappings":"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","file":"modules/submitHelper.js","sourcesContent":["addModule('submitHelper', function(module, moduleID) {\r\n\tmodule.moduleName = 'Submission Helper';\r\n\tmodule.category = 'Submissions';\r\n\tmodule.description = 'Provides utilities to help with submitting a post.';\r\n\tmodule.options = {\r\n\t\twarnAlreadySubmitted: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show a warning when the current URL has already been submitted to the selected subreddit. <p><i>Not 100% accurate, due to search limitations and different ways to format the same URL.</i></p>'\r\n\t\t},\r\n\t\tuncheckSendRepliesToInbox: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Uncheck \"send replies to my inbox\" by default, when submitting a new post.'\r\n\t\t}\r\n\t};\r\n\tmodule.include = [\r\n\t\t'submit'\r\n\t];\r\n\tmodule.beforeLoad = function() {\r\n\t\tif (module.isEnabled() && module.isMatchURL()) {\r\n\t\t\tif (module.options.warnAlreadySubmitted.value) {\r\n\t\t\t\tRESTemplates.load('repostWarning', function(template) {\r\n\t\t\t\t\tmodule.repostWarning = template.html()[0];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tmodule.go = function() {\r\n\t\tif (module.isEnabled() && module.isMatchURL()) {\r\n\t\t\tif (module.options.warnAlreadySubmitted.value) {\r\n\t\t\t\tvar urlFieldDiv = document.body.querySelector('#url-field');\r\n\t\t\t\tif (urlFieldDiv) {\r\n\t\t\t\t\t$(urlFieldDiv).parent().after(module.repostWarning);\r\n\t\t\t\t\tmodule.urlField = urlFieldDiv.querySelector('#url');\r\n\t\t\t\t\tmodule.srField = document.body.querySelector('#sr-autocomplete');\r\n\t\t\t\t\t$([module.srField, module.urlField]).on('input keydown', function() {\r\n\t\t\t\t\t\tRESUtils.debounce('repostWarning', 300, module.updateRepostWarning);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// No event is fired when reddit's js changes the subreddit field, so update whenever the user clicks\r\n\t\t\t\t\t$('#suggested-reddits a, #sr-drop-down').on('click', module.updateRepostWarning);\r\n\t\t\t\t\t// We would allow reddit to show/hide the message for link/text posts with #link-desc\r\n\t\t\t\t\t// but some subreddits hide this box, so we'll do it manually.\r\n\t\t\t\t\tvar linkButton = document.body.querySelector('a.link-button'),\r\n\t\t\t\t\t\ttextButton = document.body.querySelector('a.text-button');\r\n\t\t\t\t\tif (linkButton && textButton) {\r\n\t\t\t\t\t\tlinkButton.addEventListener('click', function() {\r\n\t\t\t\t\t\t\tmodule.repostWarning.querySelector('.res-repost').style.display = 'block';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\ttextButton.addEventListener('click', function() {\r\n\t\t\t\t\t\t\tmodule.repostWarning.querySelector('.res-repost').style.display = 'none';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (module.options.uncheckSendRepliesToInbox.value) {\r\n\t\t\t\tvar sendReplies = document.body.querySelector('#sendreplies');\r\n\t\t\t\tif (sendReplies) {\r\n\t\t\t\t\tsendReplies.checked = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tmodule.showRepostWarning = function(sr, url, date) {\r\n\t\tvar srLink = module.repostWarning.querySelector('.subredditLink');\r\n\t\tsrLink.href = '/r/' + sr;\r\n\t\t$(srLink).text('/r/' + sr);\r\n\t\tmodule.repostWarning.querySelector('.seeMore').href = '/r/' + sr + '/search?restrict_sr=on&sort=relevance&q=url%3A' + encodeURIComponent(url);\r\n\t\t$(module.repostWarning).find('.time').text(' ' + RESUtils.niceDateDiff(date) + ' ago ');\r\n\t\tRESUtils.fadeElementIn(module.repostWarning, 0.3);\r\n\t};\r\n\tmodule.hideRepostWarning = function() {\r\n\t\tRESUtils.fadeElementOut(module.repostWarning, 0.3);\r\n\t};\r\n\tmodule.updateRepostWarning = function() {\r\n\t\tvar stripUrlRe = /^(?:https?:\\/\\/)?(?:(?:www|i|m)\\.)?(.+?)\\/?(?:\\.\\w+)?(?:#[^\\/]*)?$/i,\r\n\t\t\tsubreddit = module.srField.value,\r\n\t\t\tuserUrl = module.urlField.value;\r\n\t\tif (subreddit && userUrl) {\r\n\t\t\tuserUrl = userUrl.match(stripUrlRe)[1];\r\n\t\t\tRESEnvironment.ajax({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: location.protocol + '//' + location.hostname + '/r/' + subreddit + '/search.json?restrict_sr=on&sort=relevance&limit=1&q=url%3A' + encodeURIComponent(userUrl),\r\n\t\t\t\tonload: function(response) {\r\n\t\t\t\t\tif (response.status == 200 && response.responseText) {\r\n\t\t\t\t\t\tvar data = safeJSON.parse(response.responseText).data;\r\n\t\t\t\t\t\tif (data && data.children.length && data.children[0].data.url.match(stripUrlRe)[1] === userUrl) {\r\n\t\t\t\t\t\t\tmodule.showRepostWarning(subreddit, userUrl, new Date(data.children[0].data.created * 1000));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tmodule.hideRepostWarning();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log(response);\r\n\t\t\t\t\t\tmodule.hideRepostWarning();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tmodule.hideRepostWarning();\r\n\t\t}\r\n\t};\r\n});\r\n"],"sourceRoot":"/source/"}