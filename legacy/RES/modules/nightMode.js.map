{"version":3,"sources":["modules/nightMode.js"],"names":[],"mappings":"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","file":"modules/nightMode.js","sourcesContent":["addModule('nightMode', function(module, moduleID) {\r\n\tmodule.moduleName = 'Night Mode';\r\n\tmodule.category = 'Appearance';\r\n\tmodule.description = 'A darker, more eye-friendly version of Reddit suited for night browsing.\\\r\n\t\t<br><br>Note: Using this on/off switch will disable all features of the night mode module completely.\\\r\n\t\t<br>To simply turn off night mode, use the nightModeOn switch below.';\r\n\tmodule.options = {\r\n\t\tnightModeOn: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Enable/disable night mode.'\r\n\t\t},\r\n\t\tnightSwitch: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Enable night switch, a toggle between day and night reddit located in the Settings dropdown menu.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tautomaticNightMode: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Enable automatic night mode&mdash;night mode automatically starts and stops at the times configured below.\\\r\n\t\t\t\t<br><br>For the times below, a 24-hour clock (\"military time\") from 0:00 to 23:59 is used.\\\r\n\t\t\t\t<br>e.g. the time 8:20pm would be written as 20:20, and 12:30am would be written as 00:30 or 0:30.\\\r\n\t\t\t\t<br><br>To temporarily override automatic night mode, manually flip the night mode switch.\\\r\n\t\t\t\t<br>Configure how long the override lasts below.'\r\n\t\t},\r\n\t\tnightModeStart: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: '20:00',\r\n\t\t\tdescription: 'Time that automatic night mode starts. Default is 20:00 (8:00pm).',\r\n\t\t\tdependsOn: 'automaticNightMode'\r\n\t\t},\r\n\t\tnightModeEnd: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: '6:00',\r\n\t\t\tdescription: 'Time that automatic night mode ends. Default is 6:00 (6:00am).',\r\n\t\t\tdependsOn: 'automaticNightMode'\r\n\t\t},\r\n\t\tnightModeOverrideHours: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 8,\r\n\t\t\tdescription: 'Number of hours that the automatic night mode override lasts. Default is 8 (hours).\\\r\n\t\t\t\t<br>You can use a decimal number of hours here as well; e.g. 0.1 hours (which is 6 min).',\r\n\t\t\tdependsOn: 'automaticNightMode'\r\n\t\t},\r\n\t\tuseSubredditStyles: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Always keep subreddit styles enabled when using night mode, ignoring the compatability check.\\\r\n\t\t\t\t<br><br>When using night mode, subreddit styles are automatically disabled unless <a href=\"/r/Enhancement/wiki/subredditstyling#wiki_res_night_mode_and_your_subreddit\">the subreddit indicates it is night mode-friendly</a>. You must tick the \"Use subreddit stylesheet\" in a subreddit\\'s sidebar to enable subreddit styles in that subreddit. This is because most subreddits are not night mode-friendly.\\\r\n\t\t\t\t<br><br>If you choose to show subreddit styles, you will see flair images and spoiler tags, but be warned: <em>you may see bright images, comment highlighting, etc.</em> It is up to the mods of each subreddit to make their sub night mode friendly, which is not a tiny amount of work. Please be polite when requesting moderators make a sub night mode friendly.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tsubredditStylesWhitelist: {\r\n\t\t\ttype: 'list',\r\n\t\t\tvalue: '',\r\n\t\t\tlistType: 'subreddits',\r\n\t\t\tdescription: 'Allow the subreddits listed to display subreddit styles during night mode if useSubredditStyles is disabled.'\r\n\t\t}\r\n\t};\r\n\tmodule.onToggle = function(toggle) {\r\n\t\t// If the module is turned off, disable night mode completely\r\n\t\tif (!toggle) {\r\n\t\t\tdisableNightMode();\r\n\t\t}\r\n\t};\r\n\tmodule.loadDynamicOptions = function() {\r\n\t\tRESUtils.deferred.all([\r\n\t\t\tRESUtils.init.await.headReady(),\r\n\t\t\tRESStorage.loadItem('RES_nightMode')\r\n\t\t])\r\n\t\t.done(function() {\r\n\t\t\t// To avoid the flash of unstyled content, the very first thing we should do is get a hold\r\n\t\t\t// of the document object and add necessary classes...\r\n\t\t\tif (localStorage.getItem('RES_nightMode')) {\r\n\t\t\t\t// No need to check the background - we're in night mode for sure.\r\n\t\t\t\tenableNightMode();\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmodule.beforeLoad = function() {\r\n\t\tif ((module.isEnabled()) && (module.isMatchURL())) {\r\n\t\t\t// If night mode is enabled, set a localStorage token so that in the future,\r\n\t\t\t// we can add the res-nightmode class to the page prior to page load.\r\n\t\t\tif (module.isNightModeOn()) {\r\n\t\t\t\tenableNightMode();\r\n\t\t\t} else {\r\n\t\t\t\tdisableNightMode();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Failsafe to disable night mode if the module is disabled\r\n\t\t\tdisableNightMode();\r\n\t\t}\r\n\t};\r\n\tmodule.go = function() {\r\n\t\tif ((module.isEnabled()) && (module.isMatchURL())) {\r\n\t\t\thandleNightModeStyles();\r\n\t\t\thandleAutomaticNightMode();\r\n\r\n\t\t\tif (module.options.nightSwitch.value) {\r\n\t\t\t\tcreateNightSwitch();\r\n\t\t\t}\r\n\r\n\t\t\tmodules['commandLine'].registerCommand(/^(ls|ns)$/, 'ns - toggle nightSwitch',\r\n\t\t\t\tfunction(command, val, match) {\r\n\t\t\t\t\tif (match[1] === 'ls') {\r\n\t\t\t\t\t\treturn 'Toggle nightSwitch (deprecated, use \"ns\" instead).';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn 'Toggle nightSwitch';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, function(command, value, match, e) {\r\n\t\t\t\t\tuserToggledNightMode();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\tmodule.isNightModeOn = function() {\r\n\t\treturn module.isEnabled() && module.options.nightModeOn.value;\r\n\t};\r\n\r\n\tfunction handleNightModeStyles() {\r\n\t\tvar curSubreddit = RESUtils.currentSubreddit() || '',\r\n\t\t\tindex = module.options.subredditStylesWhitelist.value.split(',').indexOf(curSubreddit.toLowerCase());\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\t// Go no further. This subreddit is whitelisted.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check the sidebar for a link [](#/RES_SR_Config/NightModeCompatible) that indicates the sub is night mode compatible.\r\n\t\tmodule.isNightmodeCompatible =\r\n\t\t\t(document.querySelector('.side a[href=\"#/RES_SR_Config/NightModeCompatible\"]') !== null) ||\r\n\t\t\tmodule.options.useSubredditStyles.value;\r\n\r\n\t\t// If night mode is on and the sub isn't compatible, disable its stylesheet.\r\n\t\tif (module.isNightModeOn() && !module.isNightmodeCompatible) {\r\n\t\t\tmodules['styleTweaks'].toggleSubredditStyle(false);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleAutomaticNightMode() {\r\n\t\tif (!module.options.automaticNightMode.value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Handle automatic night mode override\r\n\t\tvar MS_IN_HOUR = 3600000, // 1000(ms) * 60(s) * 60(min)\r\n\r\n\t\t\t// Grab the override start time, if it exists\r\n\t\t\tnightModeOverrideStart = RESStorage.getItem('RESmodules.nightMode.nightModeOverrideStart'),\r\n\t\t\tnightModeOverrideLength = MS_IN_HOUR * module.options.nightModeOverrideHours.value,\r\n\r\n\t\t\t// RESStorage.getItem returns null if no item is found, so default\r\n\t\t\t// nightModeOverrideEnd to 0\r\n\t\t\tnightModeOverrideEnd = (nightModeOverrideStart ?\r\n\t\t\t\tnightModeOverrideStart + nightModeOverrideLength : 0),\r\n\r\n\t\t\tisOverrideActive = (Date.now() <= nightModeOverrideEnd);\r\n\r\n\t\t// Toggle is needed if night mode time is reached but night mode is\r\n\t\t// disabled, or vice versa, *unless* override is active\r\n\t\tvar needsNightModeToggle = !isOverrideActive &&\r\n\t\t\t(module.isNightModeOn() !== isTimeForNightMode());\r\n\r\n\t\tif (needsNightModeToggle) {\r\n\t\t\ttoggleNightMode();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction overrideNightMode() {\r\n\t\tif (!module.options.automaticNightMode.value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Temporarily disable automatic night mode by setting the start time\r\n\t\t// of override\r\n\t\tRESStorage.setItem('RESmodules.nightMode.nightModeOverrideStart',\r\n\t\t\tDate.now());\r\n\t}\r\n\r\n\tfunction isTimeForNightMode() {\r\n\t\tvar currentDate = new Date(),\r\n\t\t\tcurrentHour = currentDate.getHours(),\r\n\t\t\tcurrentMinute = currentDate.getMinutes(),\r\n\t\t\tcurrentTime = currentHour * 100 + currentMinute,\r\n\r\n\t\t\tstartingTime = convertTimeStringToInt(module.options.nightModeStart.value),\r\n\t\t\tendingTime = convertTimeStringToInt(module.options.nightModeEnd.value);\r\n\r\n\t\tif (startingTime <= endingTime) {\r\n\t\t\t// e.g. enabled between 6am (600) and 8pm (2000)\r\n\t\t\treturn (startingTime <= currentTime) && (currentTime < endingTime);\r\n\t\t} else {\r\n\t\t\t// e.g. enabled between 8pm (2000) and 6am (600)\r\n\t\t\treturn (startingTime <= currentTime) || (currentTime < endingTime);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction convertTimeStringToInt(timeString) {\r\n\t\t// Converts a string of form \"12:30\" to an integer 1230\r\n\t\tvar array = timeString.split(':'),\r\n\t\t\thour = parseInt(array[0], 10),\r\n\t\t\tminute = parseInt(array[1], 10),\r\n\t\t\ttime = hour * 100 + minute;\r\n\r\n\t\treturn time;\r\n\t}\r\n\r\n\tvar nightSwitch;\r\n\r\n\tfunction createNightSwitch() {\r\n\t\tnightSwitch = RESUtils.createElement('div', null, null, 'night mode');\r\n\t\tnightSwitch.setAttribute('title', 'Toggle night and day');\r\n\t\tvar toggle = RESUtils.createElement.toggleButton('nightMode', 'nightSwitchToggle', module.isNightModeOn(), '☽', '☀');\r\n\t\tnightSwitch.appendChild(toggle);\r\n\r\n\t\tmodules['RESMenu'].addMenuItem(nightSwitch, userToggledNightMode);\r\n\t}\r\n\r\n\tfunction updateNightSwitch(toggle) {\r\n\t\tif (!nightSwitch) return;\r\n\t\tif (typeof toggle === 'undefined') {\r\n\t\t\ttoggle = module.isNightModeOn();\r\n\t\t}\r\n\t\t$(nightSwitch).find('.toggleButton').toggleClass('enabled', toggle);\r\n\t}\r\n\r\n\tfunction userToggledNightMode(e) {\r\n\t\tif (e) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\r\n\t\ttoggleNightMode();\r\n\t\toverrideNightMode();\r\n\t}\r\n\r\n\tfunction toggleNightMode() {\r\n\t\tif (module.isNightModeOn()) {\r\n\t\t\tdisableNightMode();\r\n\t\t} else {\r\n\t\t\tenableNightMode();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction enableNightMode() {\r\n\t\t// Set the user preference, if possible (which is not at page load)\r\n\t\tif (RESStorage.isReady) {\r\n\t\t\tRESUtils.options.setOption('nightMode', 'nightModeOn', true);\r\n\t\t}\r\n\r\n\t\tlocalStorage.setItem('RES_nightMode', true);\r\n\t\tdocument.html.classList.add('res-nightmode');\r\n\r\n\t\tif (document.body) {\r\n\t\t\tdocument.body.classList.add('res-nightmode');\r\n\t\t} else {\r\n\t\t\t// Still get RESDoBeforeLoad function to add .res-nightmode to body just in\r\n\t\t\t// case subreddit stylesheets specified body.res-nightmode instead of\r\n\t\t\t// just .res-nightmode\r\n\t\t\tRESUtils.bodyClasses.add('res-nightmode');\r\n\t\t}\r\n\t\tupdateNightSwitch(true);\r\n\t}\r\n\r\n\tfunction disableNightMode() {\r\n\t\t// Set the user preference, if possible (which is not at page load)\r\n\t\tif (RESStorage.isReady) {\r\n\t\t\tRESUtils.options.setOption('nightMode', 'nightModeOn', false);\r\n\t\t}\r\n\r\n\t\tlocalStorage.removeItem('RES_nightMode');\r\n\t\tdocument.html.classList.remove('res-nightmode');\r\n\r\n\t\tif (document.body) {\r\n\t\t\tdocument.body.classList.remove('res-nightmode');\r\n\t\t}\r\n\t\tupdateNightSwitch(false);\r\n\t}\r\n\r\n\tmodule.addSubredditToWhitelist = function(subreddit) {\r\n\t\tsubreddit = subreddit ? subreddit.toLowerCase() : '';\r\n\r\n\t\tvar whitelist = module.options.subredditStylesWhitelist.value.split(','),\r\n\t\t\tindex = whitelist.indexOf(subreddit);\r\n\r\n\t\tif (index === -1) {\r\n\t\t\t// Add if not found\r\n\t\t\twhitelist.push(subreddit);\r\n\t\t}\r\n\r\n\t\tRESUtils.options.setOption('nightMode', 'subredditStylesWhitelist',\r\n\t\t\twhitelist.join(','));\r\n\t};\r\n\r\n\tmodule.removeSubredditFromWhitelist = function(subreddit) {\r\n\t\tsubreddit = subreddit ? subreddit.toLowerCase() : '';\r\n\r\n\t\tvar whitelist = module.options.subredditStylesWhitelist.value.split(','),\r\n\t\t\tindex = whitelist.indexOf(subreddit);\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\t// Remove if found\r\n\t\t\twhitelist.splice(index, 1);\r\n\t\t}\r\n\r\n\t\tRESUtils.options.setOption('nightMode', 'subredditStylesWhitelist',\r\n\t\t\twhitelist.join(','));\r\n\t};\r\n});\r\n"],"sourceRoot":"/source/"}