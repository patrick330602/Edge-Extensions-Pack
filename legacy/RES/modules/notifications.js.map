{"version":3,"sources":["modules/notifications.js"],"names":[],"mappings":"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","file":"modules/notifications.js","sourcesContent":["addModule('notifications', function(module, moduleID) {\r\n\tmodule.moduleName = 'RES Notifications';\r\n\tmodule.category = 'Core';\r\n\tmodule.description = 'Manage pop-up notifications for RES functions';\r\n\tmodule.options = {\r\n\t\tsticky: {\r\n\t\t\tdescription: 'Sticky notifications remain visible until you click the close button.',\r\n\t\t\ttype: 'enum',\r\n\t\t\tvalue: 'notificationType',\r\n\t\t\tvalues: [{\r\n\t\t\t\tname: 'per notification type',\r\n\t\t\t\tvalue: 'notificationType'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'always sticky',\r\n\t\t\t\tvalue: 'all'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'never sticky',\r\n\t\t\t\tvalue: 'none'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tcloseDelay: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 3000,\r\n\t\t\tdescription: 'In milliseconds, length of time until a notification begins to disappear.'\r\n\t\t},\r\n\t\tfadeOutLength: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 3000,\r\n\t\t\tdescription: 'In milliseconds, length of time available to stop a notification from disappearing.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tnotificationTypes: {\r\n\t\t\tdescription: 'Manage different types of notifications',\r\n\t\t\ttype: 'table',\r\n\t\t\tadvanced: true,\r\n\t\t\taddRowText: 'manually register notification type',\r\n\t\t\tfields: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: 'moduleID',\r\n\t\t\t\t\ttype: 'text'\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: 'notificationID',\r\n\t\t\t\t\ttype: 'text'\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: 'enabled',\r\n\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\tvalue: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: 'sticky',\r\n\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\tvalue: false\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: 'cooldown',\r\n\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\tvalue: 0\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tvalue: []\r\n\t\t}\r\n\t};\r\n\r\n\tmodule.go = function() {\r\n\t\tif (this.isEnabled() && this.isMatchURL()) {\r\n\t\t\tmodules['commandLine'].registerCommand('notification', false,\r\n\t\t\t\tfunction() { },\r\n\t\t\t\tfunction(command, val, match, e) {\r\n\t\t\t\t\t// test notification\r\n\t\t\t\t\tmodule.showNotification(val, 4000);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\tvar notificationCount, notificationTimers, RESNotifications;\r\n\r\n\tfunction saveOptions() {\r\n\t\tRESUtils.options.saveModuleOptions(moduleID);\r\n\t}\r\n\r\n\tfunction getOrAddNotificationType(notification) {\r\n\t\tvar valueIdentifier = {\r\n\t\t\tmoduleID: RESUtils.firstValid(notification.moduleID, '--'),\r\n\t\t\tnotificationID: RESUtils.firstValid(notification.notificationID, notification.optionKey, notification.header, RESUtils.hashCode(notification.message || ''))\r\n\t\t};\r\n\r\n\t\tvar value = RESUtils.options.table.getMatchingValueOrAdd(moduleID, 'notificationTypes', valueIdentifier, hydrateValue);\r\n\t\tfunction hydrateValue() {\r\n\t\t\treturn $.extend({}, notification, valueIdentifier);\r\n\t\t}\r\n\r\n\t\tif (typeof value[4] !== 'number') {\r\n\t\t\tvalue[4] = parseInt(value[4], 10) || 0;\r\n\t\t}\r\n\t\tvar notificationType = RESUtils.options.table.mapValueToObject(moduleID, 'notificationTypes', value);\r\n\t\treturn notificationType;\r\n\t}\r\n\r\n\tfunction enableNotificationType(notificationType, enabled) {\r\n\t\tvar value = RESUtils.options.table.getMatchingValueOrAdd(moduleID, 'notificationTypes', notificationType);\r\n\t\tvalue[2] = !!enabled;\r\n\t\tsaveOptions();\r\n\t}\r\n\r\n\tmodule.showNotification = function(contentObj, delay) {\r\n\t\tif (!module.isEnabled()) return;\r\n\t\tif (typeof contentObj.message === 'undefined') {\r\n\t\t\tif (typeof contentObj === 'string') {\r\n\t\t\t\tcontentObj = { message: contentObj };\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar notificationType = getOrAddNotificationType(contentObj);\r\n\t\tif (!notificationType.enabled) return notificationError('enabled');\r\n\t\tif (!hasNotificationCooledDown(notificationType)) return notificationError('cooldown');\r\n\t\tlogNotification(notificationType);\r\n\r\n\t\tcontentObj.renderedHeader = renderHeaderHtml(contentObj, notificationType);\r\n\r\n\t\tvar thisNotification = createNotificationElement(contentObj, notificationType);\r\n\t\tif (contentObj.closeDelay !== undefined) {\r\n\t\t\tdelay = contentObj.closeDelay;\r\n\t\t}\r\n\r\n\t\tif (contentObj.noDisable) {\r\n\t\t\tthisNotification.querySelector('.RESNotificationFooter').style.display = 'none';\r\n\t\t} else {\r\n\t\t\tthisNotification.querySelector('.RESNotificationToggle input').addEventListener('change', function(e) {\r\n\t\t\t\tenableNotificationType(notificationType, e.target.checked);\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar thisNotificationCloseButton = thisNotification.querySelector('.RESNotificationClose');\r\n\t\tthisNotificationCloseButton.addEventListener('click', function(e) {\r\n\t\t\tvar thisNotification = e.target.parentNode.parentNode;\r\n\t\t\tcloseNotification(thisNotification);\r\n\t\t}, false);\r\n\r\n\t\tvar isSticky = module.options.sticky.value === 'all' ||\r\n\t\t\t(module.options.sticky.value === 'notificationType' &&\r\n\t\t\tnotificationType.sticky);\r\n\r\n\r\n\t\tvar notificationOpened = false;\r\n\t\tvar notificationClosed = false;\r\n\r\n\t\tvar canShow = $.Deferred();\r\n\t\tfunction checkCanShow() {\r\n\t\t\tif (document.body) {\r\n\t\t\t\tcanShow.resolve();\r\n\t\t\t} else {\r\n\t\t\t\tsetTimeout(checkCanShow, 500);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcheckCanShow();\r\n\t\tcanShow.done(function() {\r\n\t\t\tif (notificationClosed) return;\r\n\t\t\tnotificationOpened = true;\r\n\r\n\t\t\tsetupNotificationsContainer();\r\n\r\n\t\t\tif (!isSticky) {\r\n\t\t\t\tsetCloseNotificationTimer(thisNotification, delay);\r\n\t\t\t}\r\n\r\n\t\t\tRESNotifications.style.display = 'block';\r\n\t\t\tRESNotifications.appendChild(thisNotification);\r\n\t\t\tmodules['styleTweaks'].setSRStyleToggleVisibility(false);\r\n\t\t\tRESUtils.fadeElementIn(thisNotification, 0.2);\r\n\t\t\tnotificationCount++;\r\n\t\t\t// Not sure why this won't work without fadeElementIn() above.\r\n\t\t\t$(thisNotification).addClass('transition');\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\telement: thisNotification,\r\n\t\t\tclose: function() {\r\n\t\t\t\tif (notificationClosed) return;\r\n\t\t\t\tnotificationClosed = true;\r\n\t\t\t\tif (notificationOpened) {\r\n\t\t\t\t\tcloseNotification(thisNotification);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tfunction notificationError(error) {\r\n\t\t// If a notification cannot be shown for some reason (e.g. cooldown or disabled),\r\n\t\t// return a notification-like object to avoid breaking caller\r\n\r\n\t\treturn {\r\n\t\t\telement: document.createElement('div'),\r\n\t\t\tclose: function() {},\r\n\t\t\terror: error\r\n\t\t};\r\n\t}\r\n\r\n\tfunction renderHeaderHtml(contentObj, notificationType) {\r\n\t\tvar header;\r\n\t\tif (contentObj.header) {\r\n\t\t\theader = contentObj.header;\r\n\t\t} else {\r\n\t\t\theader = [];\r\n\r\n\t\t\tif (contentObj.moduleID && modules[contentObj.moduleID]) {\r\n\t\t\t\theader.push(modules[contentObj.moduleID].moduleName);\r\n\t\t\t}\r\n\r\n\t\t\tif (contentObj.type === 'error') {\r\n\t\t\t\theader.push('Error');\r\n\t\t\t}\r\n\r\n\r\n\t\t\theader = header.join(' ');\r\n\t\t}\r\n\r\n\t\tif (contentObj.moduleID && modules[contentObj.moduleID]) {\r\n\t\t\theader += modules['settingsNavigation'].makeUrlHashLink(contentObj.moduleID, contentObj.optionKey, ' ', 'gearIcon');\r\n\t\t}\r\n\r\n\t\treturn header;\r\n\t}\r\n\r\n\tfunction setupNotificationsContainer() {\r\n\t\tif (typeof notificationCount === 'undefined') {\r\n\t\t\tvar adFrame = document.body.querySelector('#ad-frame');\r\n\t\t\tif (adFrame) {\r\n\t\t\t\tadFrame.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tvar userBar = document.querySelector('#header-bottom-right');\r\n\t\t\tnotificationCount = 0;\r\n\t\t\tnotificationTimers = [];\r\n\t\t\tRESNotifications = RESUtils.createElement('div', 'RESNotifications');\r\n\t\t\tRESNotifications.style.top = userBar.offsetTop + userBar.offsetHeight + 'px';\r\n\t\t\tdocument.body.appendChild(RESNotifications);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction createNotificationElement(contentObj, notificationType) {\r\n\t\tvar thisNotification = RESUtils.createElement('div', 'RESNotification-' + (notificationCount || 0), 'RESNotification');\r\n\t\t// all content in contentObj is written by our own code to fire notifications and is therefore safe.\r\n\t\t// TODO: Let's clean this up anyhow in the near future.\r\n\t\t$(thisNotification).html('<div class=\"RESNotificationHeader\"><h3>' + contentObj.renderedHeader + '</h3><div class=\"RESNotificationClose RESCloseButton\">&times;</div></div><div class=\"RESNotificationContent\">' + contentObj.message + '</div><div class=\"RESNotificationFooter\"><label class=\"RESNotificationToggle\"><input type=\"checkbox\" checked> Always show this type of notification</label></div>');\r\n\t\tthisNotification.querySelector('.RESNotificationToggle').setAttribute('title', 'Show notifications from ' + notificationType.moduleID + ' - ' + notificationType.notificationID);\r\n\t\treturn thisNotification;\r\n\t}\r\n\r\n\tfunction setCloseNotificationTimer(e, delay, duration) {\r\n\t\tdelay = RESUtils.firstValid(delay, parseInt(module.options['closeDelay'].value, 10), module.options['closeDelay'].default);\r\n\t\tduration = RESUtils.firstValid(duration, parseInt(module.options['fadeOutLength'].value, 10), module.options['fadeOutLength'].default);\r\n\t\tvar thisNotification = (typeof e.currentTarget !== 'undefined') ? e.currentTarget : e;\r\n\t\tvar thisNotificationID = thisNotification.getAttribute('id').split('-')[1];\r\n\t\tthisNotification.classList.add('timerOn');\r\n\t\t// Note: setAttribute() may or may not remove other styles. Make sure there is some redundancy in place.\r\n\t\tthisNotification.setAttribute('style', '-webkit-animation-delay: ' + delay / 1000 + 's; -webkit-animation-duration: ' + duration / 1000 + 's; animation-delay: ' + delay / 1000 + 's; animation-duration: ' + duration / 1000 + 's');\r\n\t\t// Total delay including fade out duration.\r\n\t\tdelay += duration;\r\n\t\tclearTimeout(notificationTimers[thisNotificationID]);\r\n\t\tvar thisTimer = setTimeout(function() {\r\n\t\t\tcloseNotification(thisNotification);\r\n\t\t}, delay);\r\n\t\tnotificationTimers[thisNotificationID] = thisTimer;\r\n\t\tthisNotification.addEventListener('mouseenter', cancelCloseNotificationTimer, false);\r\n\t\tthisNotification.removeEventListener('mouseleave', setCloseNotificationTimer, false);\r\n\t}\r\n\r\n\tfunction cancelCloseNotificationTimer(e) {\r\n\t\tvar thisNotificationID = e.currentTarget.getAttribute('id').split('-')[1];\r\n\t\te.currentTarget.classList.remove('timerOn');\r\n\t\te.currentTarget.removeAttribute('style');\r\n\t\tclearTimeout(notificationTimers[thisNotificationID]);\r\n\t\te.target.removeEventListener('mouseenter', cancelCloseNotificationTimer, false);\r\n\t\te.currentTarget.addEventListener('mouseleave', setCloseNotificationTimer, false);\r\n\t}\r\n\r\n\tfunction closeNotification(ele) {\r\n\t\t// When closing with timerOn, don't hesitate at end of animation. Otherwise do a quick fade.\r\n\t\tvar fadeLength = ele.classList.contains('timerOn') ? 0 : 0.2;\r\n\t\tRESUtils.fadeElementOut(ele, fadeLength, notificationClosed);\r\n\t}\r\n\r\n\tfunction notificationClosed(ele) {\r\n\t\tvar notifications = RESNotifications.querySelectorAll('.RESNotification'),\r\n\t\t\tdestroyed = 0;\r\n\t\tfor (var i = 0, len = notifications.length; i < len; i++) {\r\n\t\t\tif (notifications[i].style.opacity === '0') {\r\n\t\t\t\tnotifications[i].parentNode.removeChild(notifications[i]);\r\n\t\t\t\tdestroyed++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (destroyed == notifications.length) {\r\n\t\t\tRESNotifications.style.display = 'none';\r\n\t\t}\r\n\t\t// Check that all notifications are removed before resetting styleToggleVisibility.\r\n\t\tif (!RESNotifications.hasChildNodes()) {\r\n\t\t\tmodules['styleTweaks'].setSRStyleToggleVisibility(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction hasNotificationCooledDown(notificationType) {\r\n\t\tvar latestNotificationOfSameType;\r\n\t\tvar recentNotifications = getRecentNotifications();\r\n\r\n\t\tfor (var i = 0; i < recentNotifications.length; i++) {\r\n\t\t\tvar current = recentNotifications[i];\r\n\t\t\tif (current.moduleID == notificationType.moduleID &&\r\n\t\t\t\tcurrent.notificationID == notificationType.notificationID) {\r\n\t\t\t\tlatestNotificationOfSameType = current;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!latestNotificationOfSameType || !latestNotificationOfSameType.timestamp) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif ((latestNotificationOfSameType.timestamp + notificationType.cooldown) <= Date.now()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction getRecentNotifications() {\r\n\t\tvar storage = RESStorage.getItem('RESmodules.notifications.recent');\r\n\t\tif (storage) {\r\n\t\t\tvar recents = JSON.parse(storage);\r\n\t\t\treturn recents;\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction logNotification(notificationType) {\r\n\t\tvar collection = getRecentNotifications();\r\n\t\tvar newItem = {\r\n\t\t\tmoduleID: notificationType.moduleID,\r\n\t\t\tnotificationID: notificationType.notificationID,\r\n\t\t\ttimestamp: Date.now()\r\n\t\t};\r\n\r\n\t\tcollection.unshift(newItem);\r\n\t\tvar pruned = pruneLog(collection);\r\n\t\tRESStorage.setItem('RESmodules.notifications.recent', JSON.stringify(pruned));\r\n\t}\r\n\r\n\tvar maxItemsPerNotificationType = 1;\r\n\tfunction pruneLog(collection) {\r\n\t\tvar pruned = [];\r\n\t\tvar index = {};\r\n\t\tfor (var i = 0, length = collection.length; i < length; i++) {\r\n\t\t\tvar item = collection[i];\r\n\t\t\tindex[item.moduleID] = index[item.moduleID] || {};\r\n\t\t\tindex[item.moduleID][item.notificationID] = 1 + (index[item.moduleID][item.notificationID] || 0);\r\n\r\n\t\t\tif (index[item.moduleID][item.notificationID] == maxItemsPerNotificationType) {\r\n\t\t\t\tpruned.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn pruned;\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}