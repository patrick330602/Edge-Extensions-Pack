{"version":3,"sources":["modules/subredditInfo.js"],"names":[],"mappings":"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","file":"modules/subredditInfo.js","sourcesContent":["addModule('subredditInfo', function(module, moduleID) {\r\n\tmodule.moduleName = 'Subreddit Info';\r\n\tmodule.category = ['Subreddits'];\r\n\tmodule.description = 'Adds a hover tooltip to subreddits';\r\n\tmodule.options = {\r\n\t\thoverDelay: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 800,\r\n\t\t\tdescription: 'Delay, in milliseconds, before hover tooltip loads. Default is 800.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tfadeDelay: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 200,\r\n\t\t\tdescription: 'Delay, in milliseconds, before hover tooltip fades away. Default is 200.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tfadeSpeed: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 0.7,\r\n\t\t\tdescription: 'Fade animation\\'s speed (in seconds). Default is 0.7.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tUSDateFormat: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Show date (subreddit created...) in US format (i.e. 08-31-2010)',\r\n\t\t\tadvanced: true\r\n\t\t}\r\n\t};\r\n\tmodule.go = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\t$('body').on('mouseover', 'a.subreddit, a.search-subreddit-link, .md a[href^=\"/r/\"]', handleMouseOver);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction handleMouseOver(e) {\r\n\t\t// ensure it's a local link, in case some other website could have /r/ in its URLs.\r\n\t\tif (!e.target.href || (e.target.href.indexOf(location.hostname) === -1) || (e.target.textContent.substr(0, 5) === 'self.')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmodules['hover'].infocard('subredditInfo')\r\n\t\t\t.target(e.target)\r\n\t\t\t.options({\r\n\t\t\t\twidth: 450,\r\n\t\t\t\topenDelay: module.options.hoverDelay.value,\r\n\t\t\t\tfadeDelay: module.options.fadeDelay.value,\r\n\t\t\t\tfadeSpeed: module.options.fadeSpeed.value\r\n\t\t\t})\r\n\t\t\t.populateWith(showSubredditInfo)\r\n\t\t\t.begin();\r\n\t}\r\n\r\n\t// create a cache for subreddit data so we only load it once even if the hover is triggered many times\r\n\tvar subredditInfoCache = [];\r\n\r\n\tfunction showSubredditInfo(def, obj, context) {\r\n\t\tvar thisSubreddit = obj.href.match(RESUtils.regexes.subredditPostListing)[1].toLowerCase();\r\n\t\tvar header = document.createDocumentFragment();\r\n\t\tvar link = $('<a href=\"/r/' + escapeHTML(thisSubreddit) + '\">/r/' + escapeHTML(thisSubreddit) + '</a>');\r\n\t\theader.appendChild(link[0]);\r\n\t\tif (RESUtils.loggedInUser()) {\r\n\t\t\tvar subscribeToggle = $('<span />');\r\n\t\t\tsubscribeToggle\r\n\t\t\t\t.attr('id', 'RESHoverInfoSubscriptionButton')\r\n\t\t\t\t.addClass('res-fancy-toggle-button')\r\n\t\t\t\t.css('margin-left', '12px')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.on('click', toggleSubscription);\r\n\t\t\tupdateToggleButton(subscribeToggle, false);\r\n\r\n\t\t\theader.appendChild(subscribeToggle[0]);\r\n\t\t}\r\n\t\tdef.notify(header, null);\r\n\t\tif (subredditInfoCache.hasOwnProperty(thisSubreddit)) {\r\n\t\t\twriteSubredditInfo(subredditInfoCache[thisSubreddit], def);\r\n\t\t} else {\r\n\t\t\tRESEnvironment.ajax({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: location.protocol + '//' + location.hostname + '/r/' + thisSubreddit + '/about.json?app=res',\r\n\t\t\t\tonload: function(response) {\r\n\t\t\t\t\tvar thisResponse = safeJSON.parse(response.responseText, null, true);\r\n\t\t\t\t\tif (thisResponse) {\r\n\t\t\t\t\t\tupdateCache(thisSubreddit, thisResponse);\r\n\t\t\t\t\t\twriteSubredditInfo(thisResponse, def);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twriteSubredditInfo({}, def);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateCache(subreddit, data) {\r\n\t\tsubreddit = subreddit.toLowerCase();\r\n\t\tif (!data.data) {\r\n\t\t\tdata = {\r\n\t\t\t\tdata: data\r\n\t\t\t};\r\n\t\t}\r\n\t\tsubredditInfoCache[subreddit] = $.extend(true, {}, subredditInfoCache[subreddit], data);\r\n\t}\r\n\r\n\tfunction writeSubredditInfo(jsonData, deferred) {\r\n\t\tif (!(jsonData && jsonData.data) || jsonData.kind !== 't5') {\r\n\t\t\tdeferred.resolve(undefined, 'Subreddit not found');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar utctime = jsonData.data.created_utc;\r\n\t\tvar d = new Date(utctime * 1000);\r\n\t\tvar isOver18 = (jsonData.data.over18 ? 'Yes' : 'No');\r\n\t\tvar srHTML = '<div class=\"subredditInfoToolTip\">';\r\n\t\tsrHTML += '<div class=\"subredditLabel\">Subreddit created:</div> <div class=\"subredditDetail\">' + RESUtils.niceDate(d, module.options.USDateFormat.value) + ' (' + RESUtils.niceDateDiff(d) + ')</div>';\r\n\t\tsrHTML += '<div class=\"subredditLabel\">Subscribers:</div> <div class=\"subredditDetail\">' + RESUtils.createElement.commaDelimitedNumber(jsonData.data.subscribers) + '</div>';\r\n\t\tsrHTML += '<div class=\"subredditLabel\">Title:</div> <div class=\"subredditDetail\">' + escapeHTML(jsonData.data.title) + '</div>';\r\n\t\tsrHTML += '<div class=\"subredditLabel\">Over 18:</div> <div class=\"subredditDetail\">' + escapeHTML(isOver18) + '</div>';\r\n\t\t// srHTML += '<div class=\"subredditLabel\">Description:</div> <div class=\"subredditDetail\">' + jsonData.data.description + '</div>';\r\n\t\tsrHTML += '<div class=\"clear\"></div><div id=\"subTooltipButtons\" class=\"bottomButtons\">';\r\n\t\tsrHTML += '<div class=\"clear\"></div></div>'; // closes bottomButtons div\r\n\t\tsrHTML += '</div>';\r\n\r\n\t\tvar newBody = $(srHTML);\r\n\t\tvar exists;\r\n\t\t// bottom buttons will include: +filter +shortcut +dashboard (maybe sub/unsub too?)\r\n\t\tif (modules['subredditManager'].isEnabled()) {\r\n\t\t\tvar theSC = document.createElement('span');\r\n\t\t\ttheSC.setAttribute('class', 'res-fancy-toggle-button REStoggle RESshortcut');\r\n\t\t\ttheSC.setAttribute('data-subreddit', jsonData.data.display_name.toLowerCase());\r\n\t\t\tvar idx = modules['subredditManager'].mySubredditShortcuts.findIndex(function(shortcut) {\r\n\t\t\t\treturn shortcut.subreddit.toLowerCase() === jsonData.data.display_name.toLowerCase();\r\n\t\t\t});\r\n\t\t\tif (idx !== -1) {\r\n\t\t\t\ttheSC.textContent = '-shortcut';\r\n\t\t\t\ttheSC.setAttribute('title', 'Remove this subreddit from your shortcut bar');\r\n\t\t\t\ttheSC.classList.add('remove');\r\n\t\t\t} else {\r\n\t\t\t\ttheSC.textContent = '+shortcut';\r\n\t\t\t\ttheSC.setAttribute('title', 'Add this subreddit to your shortcut bar');\r\n\t\t\t}\r\n\t\t\ttheSC.addEventListener('click', modules['subredditManager'].toggleSubredditShortcut, false);\r\n\r\n\t\t\tnewBody.find('#subTooltipButtons').append(theSC);\r\n\t\t}\r\n\t\tif (modules['dashboard'].isEnabled()) {\r\n\t\t\tvar dashboardToggle = document.createElement('span');\r\n\t\t\tdashboardToggle.setAttribute('class', 'res-fancy-toggle-button RESDashboardToggle');\r\n\t\t\tdashboardToggle.setAttribute('data-subreddit', jsonData.data.display_name.toLowerCase());\r\n\t\t\texists = modules['dashboard'].widgets.some(function(widget) {\r\n\t\t\t\treturn widget && (widget.basePath.toLowerCase() === '/r/' + jsonData.data.display_name.toLowerCase());\r\n\t\t\t});\r\n\t\t\tif (exists) {\r\n\t\t\t\tdashboardToggle.textContent = '-dashboard';\r\n\t\t\t\tdashboardToggle.setAttribute('title', 'Remove this subreddit from your dashboard');\r\n\t\t\t\tdashboardToggle.classList.add('remove');\r\n\t\t\t} else {\r\n\t\t\t\tdashboardToggle.textContent = '+dashboard';\r\n\t\t\t\tdashboardToggle.setAttribute('title', 'Add this subreddit to your dashboard');\r\n\t\t\t}\r\n\t\t\tdashboardToggle.addEventListener('click', modules['dashboard'].toggleDashboard, false);\r\n\t\t\tnewBody.find('#subTooltipButtons').append(dashboardToggle);\r\n\t\t}\r\n\t\tif (modules['filteReddit'].isEnabled()) {\r\n\t\t\tvar filterToggle = document.createElement('span');\r\n\t\t\tfilterToggle.setAttribute('class', 'res-fancy-toggle-button RESFilterToggle');\r\n\t\t\tfilterToggle.setAttribute('data-subreddit', jsonData.data.display_name.toLowerCase());\r\n\t\t\tvar filteredReddits = modules['filteReddit'].options.subreddits.value;\r\n\t\t\texists = filteredReddits.some(function(reddit) {\r\n\t\t\t\treturn reddit && (reddit[0].toLowerCase() === jsonData.data.display_name.toLowerCase());\r\n\t\t\t});\r\n\t\t\tif (exists) {\r\n\t\t\t\tfilterToggle.textContent = '-filter';\r\n\t\t\t\tfilterToggle.setAttribute('title', 'Stop filtering from /r/all and /domain/*');\r\n\t\t\t\tfilterToggle.classList.add('remove');\r\n\t\t\t} else {\r\n\t\t\t\tfilterToggle.textContent = '+filter';\r\n\t\t\t\tfilterToggle.setAttribute('title', 'Filter this subreddit from /r/all and /domain/*');\r\n\t\t\t}\r\n\t\t\tfilterToggle.addEventListener('click', modules['filteReddit'].toggleFilter, false);\r\n\t\t\tnewBody.find('#subTooltipButtons').append(filterToggle);\r\n\t\t}\r\n\r\n\t\tif (RESUtils.loggedInUser()) {\r\n\t\t\tvar subscribed = !!jsonData.data.user_is_subscriber;\r\n\r\n\t\t\tvar subscribeToggle = $('#RESHoverInfoSubscriptionButton');\r\n\t\t\tsubscribeToggle.attr('data-subreddit', jsonData.data.display_name.toLowerCase());\r\n\t\t\tupdateToggleButton(subscribeToggle, subscribed);\r\n\t\t\tsubscribeToggle.fadeIn('fast');\r\n\t\t}\r\n\r\n\t\tdeferred.resolve(null, newBody);\r\n\t}\r\n\r\n\tfunction updateToggleButton(toggleButton, subscribed) {\r\n\t\tif (toggleButton instanceof jQuery) toggleButton = toggleButton[0];\r\n\t\tvar toggleOn = '+subscribe';\r\n\t\tvar toggleOff = '-unsubscribe';\r\n\t\tif (subscribed) {\r\n\t\t\ttoggleButton.textContent = toggleOff;\r\n\t\t\ttoggleButton.classList.add('remove');\r\n\t\t} else {\r\n\t\t\ttoggleButton.textContent = toggleOn;\r\n\t\t\ttoggleButton.classList.remove('remove');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction toggleSubscription(e) {\r\n\t\t// Get info\r\n\t\tvar subscribeToggle = e.target;\r\n\t\tvar subreddit = subscribeToggle.getAttribute('data-subreddit').toLowerCase();\r\n\t\tvar subredditData = subredditInfoCache[subreddit].data;\r\n\t\tvar subscribing = !subredditData.user_is_subscriber;\r\n\r\n\t\tupdateToggleButton(subscribeToggle, subscribing);\r\n\r\n\t\tmodules['subredditManager'].subscribeToSubreddit(subredditData.name, subscribing);\r\n\t\tupdateCache(subreddit, {\r\n\t\t\t'user_is_subscriber': subscribing\r\n\t\t});\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}