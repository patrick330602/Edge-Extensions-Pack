{"version":3,"sources":["modules/hosts/tumblr.js"],"names":[],"mappings":"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","file":"modules/hosts/tumblr.js","sourcesContent":["addLibrary('mediaHosts', 'tumblr', {\r\n\tdomains: ['tumblr.com'],\r\n\tAPIKey: 'WeJQquHCAasi5EzaN9jMtIZkYzGfESUtEvcYDeSMLICveo3XDq',\r\n\tmatchRE: /^https?:\\/\\/([a-z0-9\\-]+\\.tumblr\\.com)\\/(?:post|image)\\/(\\d+)(?:\\/|$)/i,\r\n\tdetect: function(href, elem) {\r\n\t\treturn modules['showImages'].siteModules['tumblr'].matchRE.test(elem.href);\r\n\t},\r\n\thandleLink: function(elem) {\r\n\t\tvar def = $.Deferred();\r\n\t\tvar siteMod = modules['showImages'].siteModules['tumblr'];\r\n\t\tvar groups = siteMod.matchRE.exec(elem.href);\r\n\t\tif (groups) {\r\n\t\t\tvar apiURL = 'http://api.tumblr.com/v2/blog/' + encodeURIComponent(groups[1]) + '/posts?api_key=' + encodeURIComponent(siteMod.APIKey) + '&id=' + encodeURIComponent(groups[2]) + '&filter=raw';\r\n\t\t\tRESEnvironment.ajax({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: apiURL,\r\n\t\t\t\t// aggressiveCache: true,\r\n\t\t\t\tonload: function(response) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tvar json = JSON.parse(response.responseText);\r\n\t\t\t\t\t\tif ('meta' in json && json.meta.status === 200) {\r\n\t\t\t\t\t\t\tdef.resolve(elem, json);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdef.reject();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tdef.reject();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonerror: function(response) {\r\n\t\t\t\t\tdef.reject();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdef.reject();\r\n\t\t}\r\n\t\treturn def.promise();\r\n\t},\r\n\thandleInfo: function(elem, info) {\r\n\t\tvar def = $.Deferred();\r\n\t\tvar post = info.response.posts[0];\r\n\r\n\t\tfunction render(string) {\r\n\t\t\treturn post.format === 'markdown' ?\r\n\t\t\t\tmodules['commentPreview'].converter.render(string) :\r\n\t\t\t\tstring;\r\n\t\t}\r\n\r\n\t\t// Overwritten in quote posts\r\n\t\telem.credits = 'Posted by: <a href=\"' + info.response.blog.url + '\">' + info.response.blog.name + '</a> @ Tumblr';\r\n\r\n\t\tswitch (post.type) {\r\n\t\t\tcase 'photo':\r\n\t\t\t\telem.type = post.photos.length > 1 ? 'GALLERY' : 'IMAGE';\r\n\t\t\t\telem.src = post.photos.map(function(photo) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tsrc: photo.original_size.url,\r\n\t\t\t\t\t\tcaption: photo.caption || post.caption\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'text':\r\n\t\t\t\telem.type = 'TEXT';\r\n\t\t\t\telem.imageTitle = post.title;\r\n\t\t\t\telem.src = render(post.body);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'quote':\r\n\t\t\t\telem.type = 'TEXT';\r\n\t\t\t\telem.credits = post.source;\r\n\t\t\t\telem.src = '<blockquote><p>' + render(post.text) + '</p></blockquote>';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'link':\r\n\t\t\t\telem.type = 'TEXT';\r\n\t\t\t\telem.imageTitle = '<a href=\"' + post.url + '\">' + post.title + '</a>';\r\n\t\t\t\telem.src = render(post.description);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'chat':\r\n\t\t\t\telem.type = 'TEXT';\r\n\t\t\t\telem.imageTitle = post.title;\r\n\t\t\t\telem.src = post.dialogue.reduce(function(pre, cur) {\r\n\t\t\t\t\treturn pre + '<blockquote><p><b>' + cur.label + '</b> ' + cur.phrase + '</p></blockquote>';\r\n\t\t\t\t}, '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'answer':\r\n\t\t\t\telem.type = 'TEXT';\r\n\t\t\t\tvar asking;\r\n\t\t\t\tif (post.asking_url) {\r\n\t\t\t\t\tasking = '<a href=\"' + post.asking_url + '\">' + post.asking_name + '</a>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tasking = post.asking_name;\r\n\t\t\t\t}\r\n\t\t\t\telem.src = '<blockquote><p>' + asking + ' sent: ' + post.question + '</p></blockquote>' + render(post.answer);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn def.reject().promise();\r\n\t\t}\r\n\r\n\t\treturn def.resolve(elem).promise();\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}