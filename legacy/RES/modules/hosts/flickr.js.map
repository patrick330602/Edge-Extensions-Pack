{"version":3,"sources":["modules/hosts/flickr.js"],"names":[],"mappings":";;AAAA,WAAW,YAAX,EAAyB,QAAzB,EAAmC;AAClC,UAAS,CAAC,YAAD,CAAT;AACA,SAAQ,gBAAS,IAAT,EAAe,IAAf,EAAqB;AAC5B,SAAO,iEAAkE,IAAlE,CAAuE,KAAK,IAAL,CAA9E;IAD4B;EAArB;AAGR,aAAY,oBAAS,IAAT,EAAe;AAC1B,MAAI,MAAM,EAAE,QAAF,EAAN;;AADsB,MAGtB,OAAO,KAAK,IAAL,CAHe;AAI1B,MAAI,KAAK,OAAL,CAAa,QAAb,MAA2B,CAAC,CAAD,EAAI;AAClC,OAAI,aAAa,KAAK,OAAL,CAAa,MAAb,CAAb,CAD8B;AAElC,OAAI,aAAa,EAAb,CAF8B;AAGlC,OAAI,eAAe,CAAC,CAAD,EAAI;AACtB,iBAAa,KAAK,SAAL,CAAe,UAAf,CAAb,CADsB;AAEtB,WAAO,KAAK,SAAL,CAAe,CAAf,EAAkB,UAAlB,CAAP,CAFsB;IAAvB;;AAKA,WAAQ,aAAa,UAAb,CAR0B;GAAnC;AAUA,SAAO,KAAK,OAAL,CAAa,WAAb,EAA0B,EAA1B,EAA8B,OAA9B,CAAsC,UAAtC,EAAkD,SAAlD,CAAP;;AAd0B,MAgB1B,GAAO,kCAAkC,mBAAmB,IAAnB,CAAlC,CAhBmB;AAiB1B,iBAAe,IAAf,CAAoB;AACnB,WAAQ,KAAR;AACA,QAAK,IAAL;AACA,WAAQ,gBAAS,QAAT,EAAmB;AAC1B,QAAI;AACH,SAAI,OAAO,KAAK,KAAL,CAAW,SAAS,YAAT,CAAlB,CADD;AAEH,SAAI,OAAJ,CAAY,IAAZ,EAAkB,IAAlB,EAFG;KAAJ,CAGE,OAAO,CAAP,EAAU;AACX,SAAI,MAAJ,GADW;KAAV;IAJK;AAQR,YAAS,iBAAS,QAAT,EAAmB;AAC3B,QAAI,MAAJ,GAD2B;IAAnB;GAXV,EAjB0B;AAgC1B,SAAO,IAAI,OAAJ,EAAP,CAhC0B;EAAf;AAkCZ,aAAY,oBAAS,IAAT,EAAe,IAAf,EAAqB;AAChC,MAAI,MAAM,EAAE,QAAF,EAAN,CAD4B;AAEhC,MAAI,QAAQ,uBAAR,CAF4B;AAGhC,MAAI,eAAe,IAAf,EAAqB;AACxB,QAAK,UAAL,GAAkB,KAAK,KAAL,CADM;AAExB,OAAI,MAAM,IAAN,CAAW,KAAK,SAAL,CAAf,EAAgC;AAC/B,SAAK,GAAL,GAAW,KAAK,SAAL,CADoB;IAAhC,MAEO;AACN,SAAK,GAAL,GAAW,KAAK,aAAL,CADL;IAFP;AAKA,OAAI,SAAS,QAAT,OAAwB,UAAxB,EAAoC;AACvC,MAAE,IAAF,EAAQ,OAAR,CAAgB,QAAhB,EAA0B,IAA1B,CAA+B,YAA/B,EAA6C,IAA7C,CAAkD,MAAlD,EAA0D,KAAK,IAAL,CAA1D,CADuC;IAAxC;AAGA,QAAK,OAAL,GAAe,0BAA0B,KAAK,UAAL,GAAkB,IAA5C,GAAmD,KAAK,WAAL,GAAmB,eAAtE,CAVS;AAWxB,QAAK,IAAL,GAAY,OAAZ,CAXwB;AAYxB,OAAI,OAAJ,CAAY,IAAZ,EAZwB;GAAzB,MAaO;AACN,OAAI,MAAJ,GADM;GAbP;AAgBA,SAAO,IAAI,OAAJ,EAAP,CAnBgC;EAArB;CAvCb","file":"modules/hosts/flickr.js","sourcesContent":["addLibrary('mediaHosts', 'flickr', {\r\n\tdomains: ['flickr.com'],\r\n\tdetect: function(href, elem) {\r\n\t\treturn (/^https?:\\/\\/(?:\\w+\\.)?flickr\\.com\\/(?:.+)\\/(\\d{10,})(?:\\/|$)/i).test(elem.href);\r\n\t},\r\n\thandleLink: function(elem) {\r\n\t\tvar def = $.Deferred();\r\n\t\t// var selector = '#allsizes-photo > IMG';\r\n\t\tvar href = elem.href;\r\n\t\tif (href.indexOf('/sizes') === -1) {\r\n\t\t\tvar inPosition = href.indexOf('/in/');\r\n\t\t\tvar inFragment = '';\r\n\t\t\tif (inPosition !== -1) {\r\n\t\t\t\tinFragment = href.substring(inPosition);\r\n\t\t\t\thref = href.substring(0, inPosition);\r\n\t\t\t}\r\n\r\n\t\t\thref += '/sizes/c' + inFragment;\r\n\t\t}\r\n\t\thref = href.replace('/lightbox', '').replace('https://', 'http://');\r\n\t\t// href = 'http://www.flickr.com/services/oembed/?format=json&url=' + encodeURIComponent(href);\r\n\t\thref = 'http://noembed.com/embed?url=' + encodeURIComponent(href);\r\n\t\tRESEnvironment.ajax({\r\n\t\t\tmethod: 'GET',\r\n\t\t\turl: href,\r\n\t\t\tonload: function(response) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar json = JSON.parse(response.responseText);\r\n\t\t\t\t\tdef.resolve(elem, json);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tdef.reject();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonerror: function(response) {\r\n\t\t\t\tdef.reject();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn def.promise();\r\n\t},\r\n\thandleInfo: function(elem, info) {\r\n\t\tvar def = $.Deferred();\r\n\t\tvar imgRe = /\\.(jpg|jpeg|gif|png)/i;\r\n\t\tif ('media_url' in info) {\r\n\t\t\telem.imageTitle = info.title;\r\n\t\t\tif (imgRe.test(info.media_url)) {\r\n\t\t\t\telem.src = info.media_url;\r\n\t\t\t} else {\r\n\t\t\t\telem.src = info.thumbnail_url;\r\n\t\t\t}\r\n\t\t\tif (RESUtils.pageType() === 'linklist') {\r\n\t\t\t\t$(elem).closest('.thing').find('.thumbnail').attr('href', elem.href);\r\n\t\t\t}\r\n\t\t\telem.credits = 'Picture by: <a href=\"' + info.author_url + '\">' + info.author_name + '</a> @ Flickr';\r\n\t\t\telem.type = 'IMAGE';\r\n\t\t\tdef.resolve(elem);\r\n\t\t} else {\r\n\t\t\tdef.reject();\r\n\t\t}\r\n\t\treturn def.promise();\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}