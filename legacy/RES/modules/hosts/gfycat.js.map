{"version":3,"sources":["modules/hosts/gfycat.js"],"names":[],"mappings":"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","file":"modules/hosts/gfycat.js","sourcesContent":["addLibrary('mediaHosts', 'gfycat', {\r\n\tdomains: ['gfycat.com'],\r\n\tdetect: function(href, elem) {\r\n\t\treturn href.substring(-1) !== '+';\r\n\t},\r\n\thandleLink: function(elem) {\r\n\t\tvar hashRe = /^https?:\\/\\/(?:[\\w]+.)?gfycat\\.com\\/(\\w+)(?:\\.gif)?/i,\r\n\t\t\tdef = $.Deferred(),\r\n\t\t\tgroups = hashRe.exec(elem.href);\r\n\r\n\t\tif (groups) {\r\n\t\t\tvar apiURL = location.protocol + '//gfycat.com/cajax/get/' + encodeURIComponent(groups[1]);\r\n\t\t\tRESEnvironment.ajax({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: apiURL,\r\n\t\t\t\taggressiveCache: true,\r\n\t\t\t\tonload: function(response) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tvar json = JSON.parse(response.responseText);\r\n\t\t\t\t\t\tjson.gfyItem.src = elem.href;\r\n\t\t\t\t\t\tdef.resolve(elem, json.gfyItem);\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tdef.reject();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonerror: function(response) {\r\n\t\t\t\t\tdef.reject();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdef.reject();\r\n\t\t}\r\n\t\treturn def.promise();\r\n\t},\r\n\thandleInfo: function(elem, info) {\r\n\t\tvar generate = function(options) {\r\n\t\t\tvar template = RESTemplates.getSync('GfycatUI');\r\n\t\t\tvar video = {\r\n\t\t\t\tloop: true,\r\n\t\t\t\tautoplay: true, // gfycat always has muted or no auto, so autoplay is OK\r\n\t\t\t\tmuted: true,\r\n\t\t\t\tdirecturl: elem.href\r\n\t\t\t};\r\n\t\t\tvideo.poster = location.protocol + '//thumbs.gfycat.com/'+info.gfyName+'-poster.jpg';\r\n\t\t\t// gfycat returns http:// even if the request came over https://, so let's swap it out\r\n\t\t\tif (location.protocol === 'https:') {\r\n\t\t\t\tinfo.webmUrl = info.webmUrl.replace('http:', 'https:');\r\n\t\t\t\tinfo.mp4Url = info.mp4Url.replace('http:', 'https:');\r\n\t\t\t}\r\n\t\t\tvideo.sources = [\r\n\t\t\t\t{\r\n\t\t\t\t\t'source': info.webmUrl,\r\n\t\t\t\t\t'type': 'video/webm',\r\n\t\t\t\t\t'class': 'gfyRwebmsrc'\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t'source': info.mp4Url,\r\n\t\t\t\t\t'type': 'video/mp4',\r\n\t\t\t\t\t'class': 'gfyRmp4src'\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\tvar element = template.html(video)[0],\r\n\t\t\t\tv = element.querySelector('video');\r\n\r\n\t\t\t// set the max width to the width of the entry area\r\n\t\t\tv.style.maxWidth = $(elem).closest('.entry').width() + 'px';\r\n\t\t\tnew window.gfyObject(element, elem.href, info.frameRate);\r\n\t\t\treturn element;\r\n\t\t};\r\n\t\telem.type = 'GENERIC_EXPANDO';\r\n\t\telem.subtype = 'VIDEO';\r\n\t\t// open via 'view all images'\r\n\t\telem.expandOnViewAll = true;\r\n\t\telem.expandoClass = ' video-muted';\r\n\r\n\t\telem.expandoOptions = {\r\n\t\t\tgenerate: generate,\r\n\t\t\tmedia: info\r\n\t\t};\r\n\r\n\t\tif (RESUtils.pageType() === 'linklist') {\r\n\t\t\t$(elem).closest('.thing').find('.thumbnail').attr('href', elem.href);\r\n\t\t}\r\n\r\n\t\treturn $.Deferred().resolve(elem).promise();\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}