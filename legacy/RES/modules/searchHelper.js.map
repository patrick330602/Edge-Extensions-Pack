{"version":3,"sources":["modules/searchHelper.js"],"names":[],"mappings":"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","file":"modules/searchHelper.js","sourcesContent":["addModule('searchHelper', function(module, moduleID) {\r\n\tmodule.moduleName = 'Search Helper';\r\n\tmodule.category = 'Browsing';\r\n\tmodule.description = 'Provide help with the use of search.';\r\n\tmodule.options = {\r\n\t\taddSearchOptions: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Allow you to choose sorting and time range on the search form of the side panel.'\r\n\t\t},\r\n\t\tlegacySearch: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Request the \"legacy layout\" feature for reddit search.\\n\\n<br>This will only be available for a limited time.'\r\n\t\t},\r\n\t\ttoggleSearchOptions: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Add a button to hide search options while searching.',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'legacySearch'\r\n\t\t},\r\n\t\thideSearchOptions: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Automatically hide search options and suggestions on the search page.',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'legacySearch'\r\n\t\t},\r\n\t\tuserFilterBySubreddit: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'When on a user profile, offer to search user\\'s post from the subreddit or multireddit we come from.'\r\n\t\t},\r\n\t\tsearchByFlair: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'When clicking on a post\\'s flair, search its subreddit for that flair. <p>May not work in some subreddits that hide the actual flair and add pseudo-flair with CSS (only workaround is to disable subreddit style).</p>'\r\n\t\t},\r\n\t\tsearchPageTabs: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Add tabs to the search page.',\r\n\t\t\tbodyClass: true\r\n\t\t},\r\n\t\tdefaultSearchTab: {\r\n\t\t\ttype: 'enum',\r\n\t\t\tvalue: 'subreddits',\r\n\t\t\tvalues: [{\r\n\t\t\t\tname: 'none',\r\n\t\t\t\tvalue: 'none'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'subreddits',\r\n\t\t\t\tvalue: 'subreddits'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'limit to subreddit',\r\n\t\t\t\tvalue: 'facets'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'refine',\r\n\t\t\t\tvalue: 'options'\r\n\t\t\t}],\r\n\t\t\tdescription: 'The tab that will be expanded each time you search.',\r\n\t\t\tdependsOn: 'searchPageTabs',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\ttransitionSearchTabs: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Play a transition when you open and close tabs.',\r\n\t\t\tdependsOn: 'searchPageTabs',\r\n\t\t\tadvanced: true\r\n\t\t}\r\n\t};\r\n\tmodule.go = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\tvar searchExpando;\r\n\t\t\tif (this.options.addSearchOptions.value) {\r\n\t\t\t\tsearchExpando = document.getElementById('searchexpando');\r\n\t\t\t\tif (searchExpando) {\r\n\t\t\t\t\tvar searchOptionsHtml = '<label>Sort:<select name=\"sort\"><option value=\"relevance\">relevance</option><option value=\"new\">new</option><option value=\"hot\">hot</option><option value=\"top\">top</option><option value=\"comments\">comments</option></select></label> <label>Time:<select name=\"t\"><option value=\"all\">all time</option><option value=\"hour\">this hour</option><option value=\"day\">today</option><option value=\"week\">this week</option><option value=\"month\">this month</option><option value=\"year\">this year</option></select></label>';\r\n\t\t\t\t\tif ($(searchExpando).find('input[name=restrict_sr]').length) { // we don't want to add the new line if we are on the front page\r\n\t\t\t\t\t\tsearchOptionsHtml = '<br />' + searchOptionsHtml;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(searchExpando).find('#moresearchinfo').before(searchOptionsHtml);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.options.legacySearch.value) {\r\n\t\t\t\t$('form#search').append('<input type=\"hidden\" name=\"feature\" value=\"legacy_search\" />');\r\n\t\t\t}\r\n\t\t\tif (this.options.userFilterBySubreddit.value) {\r\n\t\t\t\tvar match = location.href.match(RESUtils.regexes.profile);\r\n\t\t\t\tif (match !== null) {\r\n\t\t\t\t\tvar userProfile = match[1];\r\n\t\t\t\t\tvar previousPage;\r\n\t\t\t\t\tif ((match = document.referrer.match(RESUtils.regexes.subreddit)) !== null) {\r\n\t\t\t\t\t\tpreviousPage = 'r/' + match[1];\r\n\t\t\t\t\t} else if ((match = document.referrer.match(RESUtils.regexes.multireddit)) !== null) {\r\n\t\t\t\t\t\tpreviousPage = match[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof previousPage !== 'undefined') {\r\n\t\t\t\t\t\t$('.content[role=main]').prepend('<div class=\"infobar\"><a href=\"/' + previousPage + '/search?q=author:' + userProfile + ' nsfw:no&restrict_sr=on\">Search post of ' + userProfile + ' on /' + previousPage + '</a></div>');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar isLegacySearch = document.querySelector('#siteTable');\r\n\t\t\tif (this.options.toggleSearchOptions.value && RESUtils.regexes.search.test(location.href) && isLegacySearch) {\r\n\t\t\t\tif (this.options.hideSearchOptions.value || location.hash === '#res-hide-options') {\r\n\t\t\t\t\tRESUtils.bodyClasses.add('res-hide-options');\r\n\t\t\t\t}\r\n\t\t\t\t$('.content .searchpane').append('<a href=\"#res-hide-options\" class=\"searchpane-toggle-hide\">hide search options</a>');\r\n\t\t\t\t$('.content .searchpane ~ .menuarea').prepend('<a href=\"#res-show-options\" class=\"searchpane-toggle-show\">show search options</a>');\r\n\t\t\t\t$('.searchpane-toggle-hide').on('click', function() {\r\n\t\t\t\t\tRESUtils.bodyClasses.add('res-hide-options');\r\n\t\t\t\t});\r\n\t\t\t\t$('.searchpane-toggle-show').on('click', function() {\r\n\t\t\t\t\tRESUtils.bodyClasses.remove('res-hide-options');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (this.options.searchByFlair.value) {\r\n\t\t\t\t$('#siteTable').on('mouseenter', '.title > .linkflairlabel:not(.res-flairSearch)', function(e) {\r\n\t\t\t\t\tvar parent = $(e.target).closest('.thing')[0],\r\n\t\t\t\t\t\tsrMatch = RESUtils.regexes.subreddit.exec(parent.querySelector('.entry a.subreddit')),\r\n\t\t\t\t\t\tsubreddit = (srMatch) ? srMatch[1] : RESUtils.currentSubreddit(),\r\n\t\t\t\t\t\tflair = e.target.title.replace(/\\s/g, '+');\r\n\t\t\t\t\tif (flair && subreddit) {\r\n\t\t\t\t\t\tvar link = document.createElement('a');\r\n\t\t\t\t\t\tlink.href = '/r/' + encodeURIComponent(subreddit) + '/search?sort=new&restrict_sr=on&q=flair%3A' + encodeURIComponent(flair);\r\n\t\t\t\t\t\te.target.classList.add('res-flairSearch');\r\n\t\t\t\t\t\te.target.appendChild(link);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Group search options into tabs.\r\n\t\t\tif (this.options.searchPageTabs.value && !isLegacySearch) {\r\n\t\t\t\t// Variables.\r\n\t\t\t\tvar searchTabsEle = RESUtils.createElementWithID('ul', '', 'res-search-tabs');\r\n\t\t\t\tvar searchHeader = document.querySelector('#previoussearch');\r\n\t\t\t\tvar searchForm = document.querySelector('.content form#search');\r\n\t\t\t\tvar moreSearchInfo = document.querySelector('#moresearchinfo');\r\n\t\t\t\tvar searchFacets = document.querySelector('body.search-page .searchfacets');\r\n\t\t\t\tvar searchOptions = RESUtils.createElementWithID('div', '', 'res-search-options');\r\n\r\n\t\t\t\t// Don't continue if search form isn't present. e.g. on /search/404.\r\n\t\t\t\tif (!searchForm) { return; }\r\n\r\n\t\t\t\tsearchForm.removeChild(searchForm.querySelector('#moresearchinfo + p'));\r\n\t\t\t\tmoreSearchInfo = moreSearchInfo.innerHTML;\r\n\r\n\t\t\t\t$(searchTabsEle).appendTo(searchHeader);\r\n\r\n\t\t\t\t// Create a class for the subreddit results container.\r\n\t\t\t\tvar subredditResultListing = document.querySelectorAll('.search-result-listing');\r\n\t\t\t\tfor (var i = 0; i < subredditResultListing.length; i++) {\r\n\t\t\t\t\tif (subredditResultListing.length > 1) {\r\n\t\t\t\t\t\tsubredditResultListing[0].classList.add('res-search-subreddits');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set up search panes.\r\n\t\t\t\tif ($(moreSearchInfo).length) {\r\n\t\t\t\t\t$(searchOptions).appendTo(searchHeader);\r\n\t\t\t\t\t$(moreSearchInfo).appendTo(searchOptions);\r\n\t\t\t\t}\r\n\t\t\t\tif (searchFacets) {\r\n\t\t\t\t\t$(searchFacets).appendTo(searchHeader);\r\n\t\t\t\t}\r\n\t\t\t\tif ($('.res-search-subreddits').length) {\r\n\t\t\t\t\t$('.res-search-subreddits').appendTo(searchHeader);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Create tabs object.\r\n\t\t\t\tvar searchTabs = {\r\n\t\t\t\t\t'subreddits' : {\r\n\t\t\t\t\t\t'label' : 'subreddits',\r\n\t\t\t\t\t\t'id' : 'subs',\r\n\t\t\t\t\t\t'target' : '.res-search-subreddits',\r\n\t\t\t\t\t\t'exists' : $('.res-search-subreddits').length\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'facets' : {\r\n\t\t\t\t\t\t'label' : 'limit to subreddit',\r\n\t\t\t\t\t\t'id' : 'facets',\r\n\t\t\t\t\t\t'target' : '.searchfacets',\r\n\t\t\t\t\t\t'exists' : searchFacets\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'options' : {\r\n\t\t\t\t\t\t'label' : 'refine',\r\n\t\t\t\t\t\t'id' : 'options',\r\n\t\t\t\t\t\t'target' : '.res-search-options',\r\n\t\t\t\t\t\t'exists' : searchOptions\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfor (var tab in searchTabs) {\r\n\t\t\t\t\tif (searchTabs.hasOwnProperty(tab)) {\r\n\t\t\t\t\t\tif (searchTabs[tab]['exists']) {\r\n\t\t\t\t\t\t\t// Add common class to each tab pane.\r\n\t\t\t\t\t\t\tdocument.querySelector(searchTabs[tab]['target']).classList.add('res-search-pane');\r\n\t\t\t\t\t\t\t$(searchTabs[tab]['target']).slideUp(0);\r\n\r\n\t\t\t\t\t\t\t// Build tabs in DOM.\r\n\t\t\t\t\t\t\t$('<li>').attr({ class: 'res-search-tab-' + searchTabs[tab]['id'] }).appendTo(searchTabsEle);\r\n\t\t\t\t\t\t\t$('<a>').attr({ href: '#'})\r\n\t\t\t\t\t\t\t\t.text(searchTabs[tab]['label'])\r\n\t\t\t\t\t\t\t\t.appendTo(searchTabsEle.querySelector('li.res-search-tab-' + searchTabs[tab]['id']))\r\n\t\t\t\t\t\t\t\t.click({id: searchTabs[tab]['id'], target: searchTabs[tab]['target']}, searchTabToggle);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set default tab if specified and if it exists on the page.\r\n\t\t\t\tif (this.options.defaultSearchTab.value !== 'none' && searchTabs[this.options.defaultSearchTab.value]['exists']) {\r\n\t\t\t\t\t// Send the data as an object the same way jquery's click() does.\r\n\t\t\t\t\tsearchTabToggle({\r\n\t\t\t\t\t\t'data' : {\r\n\t\t\t\t\t\t\tid: searchTabs[this.options.defaultSearchTab.value]['id'],\r\n\t\t\t\t\t\t\ttarget: searchTabs[this.options.defaultSearchTab.value]['target']\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfunction searchTabToggle(e) {\r\n\t\tvar transitionSpd = (module.options.transitionSearchTabs.value) ? 200 : 0;\r\n\t\tvar tabID = e.data.id;\r\n\t\tvar target = e.data.target;\r\n\t\t// Check whether the tab was selected through code or with a click.\r\n\t\tvar tab = (this.parentNode) ? this.parentNode : document.querySelector('.res-search-tabs .res-search-tab-' + tabID);\r\n\t\tvar activeClass = 'res-search-tab-active';\r\n\t\tvar openClass = 'res-search-pane-open';\r\n\r\n\t\t// Close the pane if its tab was already active, else open it.\r\n\t\tif (tab.classList.contains(activeClass)) {\r\n\t\t\t$(target).removeClass(openClass).slideUp(transitionSpd);\r\n\t\t\ttab.classList.remove(activeClass);\r\n\t\t} else {\r\n\t\t\t$('.res-search-pane').addClass(openClass).slideUp(transitionSpd);\r\n\t\t\t$('.res-search-tabs li').removeClass(activeClass);\r\n\t\t\t$('.res-search-pane').removeClass(openClass);\r\n\t\t\ttab.classList.add(activeClass);\r\n\t\t\tvar speed = (this.parentNode) ? transitionSpd : 0;\r\n\t\t\t$(target).addClass(openClass).slideDown(speed);\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}