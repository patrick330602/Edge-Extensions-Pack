{"version":3,"sources":["modules/selectedEntry.js"],"names":[],"mappings":"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","file":"modules/selectedEntry.js","sourcesContent":["addModule('selectedEntry', function(module, moduleID) {\r\n\tmodule.moduleName = 'Selected Entry';\r\n\tmodule.category = [ 'Appearance', 'Browsing'];\r\n\tmodule.include = [ 'comments', 'linklist', 'profile', 'inbox', 'search' ];\r\n\tmodule.description = 'Style the currently selected submission or comment. For use with Keyboard Navigation.';\r\n\r\n\tmodule.options = {\r\n\t\tautoSelectOnScroll: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'Automatically select the topmost item while scrolling'\r\n\t\t},\r\n\t\tselectOnClick: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Allows you to click on an item to select it',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\taddFocusBGColor: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Use a background color'\r\n\t\t},\r\n\t\tfocusBGColor: {\r\n\t\t\ttype: 'color',\r\n\t\t\tvalue: '#F0F3FC',\r\n\t\t\tdescription: 'The background color',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'addFocusBGColor'\r\n\t\t},\r\n\t\tfocusBGColorNight: {\r\n\t\t\ttype: 'color',\r\n\t\t\tvalue: '#373737',\r\n\t\t\tdescription: 'The background color while using Night Mode',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'addFocusBGColor'\r\n\t\t},\r\n\t\tfocusFGColorNight: {\r\n\t\t\ttype: 'color',\r\n\t\t\tvalue: '#DDDDDD',\r\n\t\t\tdescription: 'The text color while using Night Mode',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'addFocusBGColor'\r\n\t\t},\r\n\t\taddFocusBorder: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Use a border'\r\n\t\t},\r\n\t\tfocusBorder: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: '',\r\n\t\t\tdescription: 'Border appearance. E.g. <code>1px dashed gray</code> (CSS)',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'addFocusBorder'\r\n\t\t},\r\n\t\tfocusBorderNight: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: '',\r\n\t\t\tdescription: 'Border appearance using Night Mode (as above)',\r\n\t\t\tadvanced: true,\r\n\t\t\tdependsOn: 'addFocusBorder'\r\n\t\t}\r\n\t};\r\n\r\n\taddSelectListeners();\r\n\tmodule.beforeLoad = function() {\r\n\t\tif (!(module.isMatchURL() && module.isEnabled())) return;\r\n\r\n\t\taddNewElementListeners();\r\n\t};\r\n\r\n\tmodule.go = function() {\r\n\t\tif (!(module.isMatchURL() && module.isEnabled())) return;\r\n\r\n\t\tif (module.options.autoSelectOnScroll.value) {\r\n\t\t\twindow.addEventListener('scroll', function(e) { RESUtils.debounce(moduleID + '.autoSelectOnScroll', 300, onScroll); });\r\n\t\t}\r\n\t\tif (module.options.selectOnClick.value) {\r\n\t\t\tvar throttled;\r\n\t\t\t$(document.body).on('click', thingSelector, function(e) {\r\n\t\t\t\tif (!throttled) {\r\n\t\t\t\t\tthrottled = true;\r\n\t\t\t\t\tsetTimeout(function() { throttled = false; }, 100);\r\n\t\t\t\t\tonClick.call(this, e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (module.options.addFocusBGColor.value) {\r\n\t\t\taddFocusBGColor();\r\n\t\t}\r\n\t\tif (module.options.addFocusBorder.value) {\r\n\t\t\taddFocusBorder();\r\n\t\t}\r\n\r\n\t\tsetTimeout(selectInitial, 100);\r\n\t};\r\n\r\n\tvar selectedThing, selectedContainer;\r\n\tmodule.select = function(thing, options) {\r\n\t\tif (!thing || ('length' in thing && thing.length === 0)) return;\r\n\t\tselect(thing, options);\r\n\t};\r\n\r\n\tmodule.unselect = function() {\r\n\t\tvar prevSelected = module.selected();\r\n\t\tselect(undefined);\r\n\t\treturn prevSelected;\r\n\t};\r\n\r\n\tmodule.selected = function() {\r\n\t\treturn selectedThing;\r\n\t};\r\n\r\n\tvar thingSelector = '.linklisting .thing, .nestedlisting .thing, .search-result-link';\r\n\tmodule.selectableThings = function selectableThings(selector) {\r\n\t\treturn $(thingSelector).filter(':visible');\r\n\t};\r\n\r\n\tvar listeners;\r\n\tmodule.addListener = addListener;\r\n\tfunction addListener(callback) {\r\n\t\tif (!listeners) listeners = new $.Callbacks();\r\n\t\tlisteners.add(callback);\r\n\t}\r\n\r\n\tfunction select(thingOrEntry, options) {\r\n\t\tvar newThing = RESUtils.thing(thingOrEntry);\r\n\t\tif (!newThing.thing || newThing.is(selectedThing)) return;\r\n\r\n\t\tvar newSelected = newThing;\r\n\t\tvar oldSelected = selectedThing;\r\n\r\n\t\toptions = options || {};\r\n\t\tif (listeners) {\r\n\t\t\tlisteners.fire(newSelected, oldSelected, options);\r\n\t\t}\r\n\r\n\t\tselectedThing = newSelected;\r\n\t\tselectedContainer = newSelected && $(newSelected.thing).parent().closest('.thing');\r\n\t}\r\n\r\n\tvar onNewCommentsCooldown;\r\n\tfunction onNewComments(entry) {\r\n\t\tif (onNewCommentsCooldown) {\r\n\t\t\t// Recently selected something, ignore remainder of batch\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (selectedThing && !selectedThing.parentNode) {\r\n\t\t\t// Selected thing was replaced, so select the replacement\r\n\t\t\tvar newContainer = $(entry).closest('.thing').parent().closest('.thing');\r\n\t\t\tif (newContainer.filter(selectedContainer).length) {\r\n\t\t\t\tselect(entry, {\r\n\t\t\t\t\treplacement: true\r\n\t\t\t\t});\r\n\t\t\t\t// only select the first applicable thing in a batch\r\n\t\t\t\tonNewCommentsCooldown = setTimeout(function() {\r\n\t\t\t\t\tonNewCommentsCooldown = undefined;\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction scrollTo(selected, last, options) {\r\n\t\tif (!selected) return;\r\n\t\toptions = $.extend(true,\r\n\t\t\t{ makeVisible: selected.entry },\r\n\t\t\toptions\r\n\t\t);\r\n\t\tRESUtils.scrollToElement(selected.thing, options);\r\n\t}\r\n\r\n\tfunction addSelectListeners() {\r\n\t\taddListener(function(selected, unselected) { if (unselected) modules['hover'].infocard('showParent').close(false); });\r\n\t\taddListener(updateActiveElement);\r\n\t\taddListener(scrollTo);\r\n\t\taddListener(updateLastSelectedCache);\r\n\t}\r\n\r\n\tfunction addNewElementListeners() {\r\n\t\tRESUtils.watchForElement('newComments', onNewComments);\r\n\t}\r\n\r\n\tfunction updateActiveElement(selected, last) {\r\n\t\tif (selected) {\r\n\t\t\tselected.entry.classList.add('RES-keyNav-activeElement');\r\n\t\t\t// Add a class to thing to provide extra styling options.\r\n\t\t\tselected.thing.classList.add('RES-keyNav-activeThing');\r\n\t\t}\r\n\t\tif (last) {\r\n\t\t\tlast.entry.classList.remove('RES-keyNav-activeElement');\r\n\t\t\tlast.thing.classList.remove('RES-keyNav-activeThing');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onScroll() {\r\n\t\tif (modules['keyboardNav'].recentKeyPress) return;\r\n\r\n\t\tvar selected = module.selected();\r\n\t\tif (selected && RESUtils.elementInViewport(selected.entry)) return;\r\n\r\n\r\n\t\tvar things = $('.thing');\r\n\t\tfor (var i = 0, len = things.length; i < len; i++) {\r\n\t\t\tif (RESUtils.elementInViewport(things[i])) {\r\n\t\t\t\tselect(things[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClick(e) {\r\n\t\tselect(e.target, { scrollStyle: 'none' });\r\n\t}\r\n\r\n\tvar lastSelectedCache,\r\n\t\tlastSelectedKey = 'RESmodules.selectedThing.lastSelectedCache';\r\n\tfunction setupLastSelectedCache() {\r\n\t\tif (lastSelectedCache) return;\r\n\t\tlastSelectedCache = RESStorage.getItem(lastSelectedKey) || '{}';\r\n\t\tlastSelectedCache = safeJSON.parse(lastSelectedCache, lastSelectedKey) || {};\r\n\r\n\t\t// clean cache every so often and delete any urls that haven't been visited recently\r\n\t\tvar clearCachePeriod = 21600000; // 6 hours\r\n\t\tvar itemExpiration = 3600000; // 1 hour\r\n\t\tvar now = Date.now();\r\n\t\tif (!lastSelectedCache.lastScan || (now - lastSelectedCache.lastScan > clearCachePeriod)) {\r\n\t\t\tfor (var idx in lastSelectedCache) {\r\n\t\t\t\tif (lastSelectedCache[idx] && (now - lastSelectedCache[idx].updated > itemExpiration)) {\r\n\t\t\t\t\tdelete lastSelectedCache[idx];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlastSelectedCache.lastScan = now;\r\n\t\t\tRESStorage.setItem(lastSelectedKey, JSON.stringify(lastSelectedCache));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction urlForSelectedCache() {\r\n\t\tvar url = document.location.pathname;\r\n\t\t// remove any trailing slash from the URL\r\n\t\tif (url.substr(-1) === '/') {\r\n\t\t\turl = url.substr(0, url.length - 1);\r\n\t\t}\r\n\r\n\t\treturn url;\r\n\t}\r\n\r\n\r\n\tfunction updateLastSelectedCache(selected) {\r\n\t\tif (!lastSelectedCache || !RESUtils.isPageType('linklist', 'profile')) return;\r\n\r\n\t\tvar url = urlForSelectedCache();\r\n\t\tvar now = Date.now();\r\n\t\tvar fullname = $(selected.thing).data('fullname');\r\n\t\tlastSelectedCache[url] = {\r\n\t\t\tfullname: fullname,\r\n\t\t\tupdated: now\r\n\t\t};\r\n\t\tRESStorage.setItem('RESmodules.selectedThing.lastSelectedCache', JSON.stringify(lastSelectedCache));\r\n\t}\r\n\r\n\tfunction selectInitial() {\r\n\t\tvar target = findLastSelectedThing();\r\n\t\tif (!(target && target.length)) {\r\n\t\t\ttarget = module.selectableThings().first();\r\n\t\t}\r\n\t\tselect(target);\r\n\t}\r\n\r\n\tfunction findLastSelectedThing() {\r\n\t\tsetupLastSelectedCache();\r\n\r\n\t\tvar url = urlForSelectedCache();\r\n\t\tvar lastSelected = (lastSelected = lastSelectedCache[url]) && lastSelected.fullname;\r\n\t\tif (lastSelected) {\r\n\t\t\tvar target = module.selectableThings().filter(function() {\r\n\t\t\t\treturn this.getAttribute('data-fullname') === lastSelected;\r\n\t\t\t});\r\n\t\t\treturn target;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// old style: .RES-keyNav-activeElement { '+borderType+': '+focusBorder+'; background-color: '+focusBGColor+'; } \\\r\n\t// this new pure CSS arrow will not work because to position it we must have .RES-keyNav-activeElement position relative, but that screws up image viewer's absolute positioning to\r\n\t// overlay over the sidebar... yikes.\r\n\t// .RES-keyNav-activeElement:after { content: \"\"; float: right; margin-right: -5px; border-color: transparent '+focusBorderColor+' transparent transparent; border-style: solid; border-width: 3px 4px 3px 0; } \\\r\n\r\n\t// why !important on .RES-keyNav-activeElement?  Because some subreddits are unfortunately using !important for no good reason on .entry divs...\r\n\r\n\tfunction addFocusBGColor() {\r\n\t\tvar focusFGColorNight, focusBGColor, focusBGColorNight;\r\n\r\n\t\tif (typeof module.options.focusBGColor === 'undefined') {\r\n\t\t\tfocusBGColor = '#F0F3FC';\r\n\t\t} else {\r\n\t\t\tfocusBGColor = module.options.focusBGColor.value;\r\n\t\t}\r\n\r\n\t\tif (!(module.options.focusBGColorNight.value)) {\r\n\t\t\tfocusBGColorNight = '#666';\r\n\t\t} else {\r\n\t\t\tfocusBGColorNight = module.options.focusBGColorNight.value;\r\n\t\t}\r\n\t\tif (!(module.options.focusFGColorNight.value)) {\r\n\t\t\tfocusFGColorNight = '#DDD';\r\n\t\t} else {\r\n\t\t\tfocusFGColorNight = module.options.focusFGColorNight.value;\r\n\t\t}\r\n\r\n\t\tRESUtils.addCSS('\t\\\r\n\t\t\t.RES-keyNav-activeElement,\\\r\n\t\t\t.RES-keyNav-activeElement .md-container { background-color: ' + focusBGColor + ' !important; }\\\r\n\t\t\t\\\r\n\t\t\t.res-nightmode .RES-keyNav-activeElement > .tagline,\\\r\n\t\t\t.res-nightmode .RES-keyNav-activeElement .md-container > .md,\\\r\n\t\t\t.res-nightmode .RES-keyNav-activeElement .md-container > .md p { color: ' + focusFGColorNight + ' !important; }\\\r\n\t\t\t\\\r\n\t\t\t.res-nightmode .RES-keyNav-activeElement,\\\r\n\t\t\t.res-nightmode .RES-keyNav-activeElement .md-container { background-color: ' + focusBGColorNight + ' !important; }\\\r\n\t\t\t');\r\n\t}\r\n\r\n\tfunction addFocusBorder() {\r\n\t\tvar focusBorder, focusBorderNight;\r\n\t\tvar borderType = RESEnvironment.getOutlineProperty() || 'outline';\r\n\r\n\t\tif (typeof module.options.focusBorder === 'undefined') {\r\n\t\t\tfocusBorder = '';\r\n\t\t} else {\r\n\t\t\tfocusBorder = borderType + ': ' + module.options.focusBorder.value + ';';\r\n\t\t}\r\n\t\tif (typeof module.options.focusBorderNight === 'undefined') {\r\n\t\t\tfocusBorderNight = '';\r\n\t\t} else {\r\n\t\t\tfocusBorderNight = borderType + ': ' + module.options.focusBorderNight.value + ';';\r\n\t\t}\r\n\r\n\t\tRESUtils.addCSS('\t\\\r\n\t\t\t.RES-keyNav-activeElement { ' + focusBorder + ' } \\\r\n\t\t\t.res-nightmode .RES-keyNav-activeElement { ' + focusBorderNight + ' } \\\r\n\t\t\t');\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}