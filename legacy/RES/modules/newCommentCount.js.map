{"version":3,"sources":["modules/newCommentCount.js"],"names":[],"mappings":"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","file":"modules/newCommentCount.js","sourcesContent":["/* global RESUtils */\r\naddModule('newCommentCount', function(module, moduleID) {\r\n\tmodule.moduleName = 'New Comment Count';\r\n\tmodule.category = 'Submissions';\r\n\tmodule.description = 'Tells you how many comments have been posted since you last viewed a thread.';\r\n\tmodule.options = {\r\n\t\tcleanComments: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 7,\r\n\t\t\tdescription: 'Number of days before RES stops keeping track of a viewed thread'\r\n\t\t},\r\n\t\tsubscriptionLength: {\r\n\t\t\ttype: 'text',\r\n\t\t\tvalue: 2,\r\n\t\t\tdescription: 'Number of days before thread subscriptions expire (<code>0</code> to subscribe forever)'\r\n\t\t}\r\n\t};\r\n\r\n\tvar commentCounts, toggleButton;\r\n\r\n\tmodule.go = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\t// go!\r\n\t\t\tvar counts = RESStorage.getItem('RESmodules.newCommentCount.counts');\r\n\t\t\tif (counts === null) counts = '{}';\r\n\t\t\tcommentCounts = safeJSON.parse(counts, 'RESmodules.newCommentCount.counts');\r\n\t\t\tif (RESUtils.pageType() === 'comments') {\r\n\t\t\t\tupdateCommentCount();\r\n\r\n\t\t\t\tRESUtils.watchForElement('newCommentsForms', updateCommentCountFromMyComment);\r\n\t\t\t\tRESUtils.watchForElement('newComments', updateCommentCountFromMyComment);\r\n\t\t\t\tif (document.querySelector('.commentarea .panestack-title')) {\r\n\t\t\t\t\thandleToggleButton();\r\n\t\t\t\t}\r\n\t\t\t} else if (RESUtils.currentSubreddit('dashboard')) {\r\n\t\t\t\t// If we're on the dashboard, add a tab to it...\r\n\t\t\t\t// add tab to dashboard\r\n\t\t\t\tmodules['dashboard'].addTab('newCommentsContents', 'My Subscriptions');\r\n\t\t\t\t// populate the contents of the tab\r\n\t\t\t\tvar showDiv = $('<div class=\"show\">Show </div>');\r\n\t\t\t\tvar subscriptionFilter = $('<select id=\"subscriptionFilter\"><option>subscribed threads</option><option>all threads</option></select>');\r\n\t\t\t\t$(showDiv).append(subscriptionFilter);\r\n\t\t\t\tvar openOnReddit = $('<a href=\"#\" id=\"openOnReddit\">as reddit link listing</a>');\r\n\t\t\t\t$(openOnReddit).click(function(event) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tvar url = 't3_';\r\n\t\t\t\t\tvar $threads = $('#newCommentsTable tr td:last-of-type > span:first-of-type');\r\n\t\t\t\t\tvar ids = $threads.get().map(function(ele) { return ele.getAttribute('data-threadid'); });\r\n\t\t\t\t\tvar concatIds = ids.join(',t3_');\r\n\t\t\t\t\turl += concatIds;\r\n\t\t\t\t\tlocation.href = '/by_id/' + url;\r\n\t\t\t\t});\r\n\t\t\t\t$(showDiv).append(' ').append(openOnReddit);\r\n\t\t\t\t$('#newCommentsContents').append(showDiv);\r\n\t\t\t\t$('#subscriptionFilter').change(function() {\r\n\t\t\t\t\tdrawSubscriptionsTable();\r\n\t\t\t\t});\r\n\t\t\t\tvar thisTable = $('<table id=\"newCommentsTable\" />');\r\n\t\t\t\t$(thisTable).append('<thead><tr><th sort=\"\" class=\"active\">Submission</th><th sort=\"subreddit\">Subreddit</th><th sort=\"updateTime\">Last viewed</th><th sort=\"subscriptionDate\">Expires in</th><th class=\"actions\">Actions</th></tr></thead><tbody></tbody>');\r\n\t\t\t\t$('#newCommentsContents').append(thisTable);\r\n\t\t\t\t$('#newCommentsTable thead th').click(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tif ($(this).hasClass('actions')) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($(this).hasClass('active')) {\r\n\t\t\t\t\t\t$(this).toggleClass('descending');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(this).addClass('active');\r\n\t\t\t\t\t$(this).siblings().removeClass('active').find('SPAN').remove();\r\n\t\t\t\t\t$(this).find('.sortAsc, .sortDesc').remove();\r\n\t\t\t\t\tif ($(e.target).hasClass('descending')) {\r\n\t\t\t\t\t\t$(this).append('<span class=\"sortDesc\" />');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(this).append('<span class=\"sortAsc\" />');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrawSubscriptionsTable($(e.target).attr('sort'), $(e.target).hasClass('descending'));\r\n\t\t\t\t});\r\n\t\t\t\tdrawSubscriptionsTable();\r\n\t\t\t\tRESUtils.watchForElement('siteTable', processCommentCounts);\r\n\t\t\t} else {\r\n\t\t\t\tprocessCommentCounts();\r\n\t\t\t\tRESUtils.watchForElement('siteTable', processCommentCounts);\r\n\t\t\t}\r\n\t\t\tcheckSubscriptions();\r\n\t\t}\r\n\t};\r\n\r\n\tvar currentSortMethod, isDescending;\r\n\r\n\tfunction drawSubscriptionsTable(sortMethod, descending) {\r\n\t\tvar filterType = $('#subscriptionFilter').val();\r\n\t\tcurrentSortMethod = sortMethod || currentSortMethod;\r\n\t\tisDescending = (descending === undefined) ? isDescending : !!descending;\r\n\t\tvar thisCounts = [];\r\n\t\tvar i;\r\n\t\tfor (i in commentCounts) {\r\n\t\t\tcommentCounts[i].id = i;\r\n\t\t\t// grab the subreddit out of the URL and store it in match[i]\r\n\t\t\tvar match = commentCounts[i].url.match(RESUtils.regexes.subreddit);\r\n\t\t\tif (match) {\r\n\t\t\t\tcommentCounts[i].subreddit = match[1].toLowerCase();\r\n\t\t\t\tthisCounts.push(commentCounts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t$('#newCommentsTable tbody').html('');\r\n\t\tswitch (currentSortMethod) {\r\n\t\t\tcase 'subscriptionDate':\r\n\t\t\t\tthisCounts.sort(function(a, b) {\r\n\t\t\t\t\treturn (a.subscriptionDate > b.subscriptionDate) ? 1 : (b.subscriptionDate > a.subscriptionDate) ? -1 : 0;\r\n\t\t\t\t});\r\n\t\t\t\tif (isDescending) thisCounts.reverse();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'updateTime':\r\n\t\t\t\tthisCounts.sort(function(a, b) {\r\n\t\t\t\t\treturn (a.updateTime > b.updateTime) ? 1 : (b.updateTime > a.updateTime) ? -1 : 0;\r\n\t\t\t\t});\r\n\t\t\t\tif (isDescending) thisCounts.reverse();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'subreddit':\r\n\t\t\t\tthisCounts.sort(function(a, b) {\r\n\t\t\t\t\treturn (a.subreddit > b.subreddit) ? 1 : (b.subreddit > a.subreddit) ? -1 : 0;\r\n\t\t\t\t});\r\n\t\t\t\tif (isDescending) thisCounts.reverse();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthisCounts.sort(function(a, b) {\r\n\t\t\t\t\treturn (a.title > b.title) ? 1 : (b.title > a.title) ? -1 : 0;\r\n\t\t\t\t});\r\n\t\t\t\tif (isDescending) thisCounts.reverse();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tvar rows = 0;\r\n\t\tfor (i in thisCounts) {\r\n\t\t\tvar isSubscribed = typeof thisCounts[i].subscriptionDate !== 'undefined';\r\n\t\t\tif ((filterType === 'all threads') || ((filterType === 'subscribed threads') && (isSubscribed))) {\r\n\t\t\t\tvar thisUpdateTime = new Date(thisCounts[i].updateTime);\r\n\t\t\t\tvar now = new Date();\r\n\t\t\t\tvar thisExpires;\r\n\t\t\t\tvar thisExpiresContent;\r\n\r\n\t\t\t\t// set up buttons.\r\n\t\t\t\tvar thisTrash = handleButton(thisCounts[i].id, 'delete');\r\n\t\t\t\tvar thisRenewButton = handleButton(thisCounts[i].id, 'renew');\r\n\t\t\t\tvar thisUnsubButton = handleButton(thisCounts[i].id, 'unsubscribe');\r\n\t\t\t\tvar thisSubscribeButton = handleButton(thisCounts[i].id, 'subscribe');\r\n\r\n\t\t\t\tif (isSubscribed) {\r\n\t\t\t\t\t// expire time is in days, so: 1000ms * 60s * 60m * 24hr = 86400000 * [2].\r\n\t\t\t\t\tthisExpires = new Date(thisCounts[i].subscriptionDate + (86400000 * module.options.subscriptionLength.value));\r\n\t\t\t\t\tthisExpiresContent = '<abbr title=\"' + RESUtils.niceDateTime(thisExpires) + '\">' + RESUtils.niceDateDiff(now, thisExpires) + '</abbr>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthisExpiresContent = '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// populate table row.\r\n\t\t\t\tvar thisROW = '';\r\n\t\t\t\tthisROW += '<tr><td><a href=\"' + thisCounts[i].url + '\">' + escapeHTML(thisCounts[i].title) + '</a></td>';\r\n\t\t\t\tthisROW += '<td><a href=\"/r/' + thisCounts[i].subreddit + '\">/r/' + thisCounts[i].subreddit + '</a></td>';\r\n\t\t\t\tthisROW += '<td><abbr title=\"' + RESUtils.niceDateTime(thisUpdateTime) + '\">' + RESUtils.niceDateDiff(thisUpdateTime) + ' ago</abbr></td>';\r\n\t\t\t\tthisROW += '<td>' + thisExpiresContent + '</td><td></td></tr>';\r\n\r\n\t\t\t\tvar $thisROW = $(thisROW);\r\n\r\n\t\t\t\t// add buttons.\r\n\t\t\t\t$thisROW.find('td:first-of-type').append(thisTrash);\r\n\t\t\t\tif (isSubscribed) {\r\n\t\t\t\t\t$thisROW.find('td:last-of-type').append(thisRenewButton).append(' ');\r\n\t\t\t\t\t$thisROW.find('td:last-of-type').append(thisUnsubButton);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$thisROW.find('td:last-of-type').append(thisSubscribeButton);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('#newCommentsTable tbody').append($thisROW);\r\n\t\t\t\trows++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (rows === 0) {\r\n\t\t\tif (filterType === 'subscribed threads') {\r\n\t\t\t\t$('#newCommentsTable tbody').append('<td colspan=\"5\">You are currently not subscribed to any threads. To subscribe to a thread, click the \"subscribe\" button found near the top of the comments page.</td>');\r\n\t\t\t} else {\r\n\t\t\t\t$('#newCommentsTable tbody').append('<td colspan=\"5\">No threads found</td>');\r\n\t\t\t}\r\n\t\t\t$('#openOnReddit').hide();\r\n\t\t} else {\r\n\t\t\t$('#openOnReddit').show();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction renewSubscriptionButton(e) {\r\n\t\tvar thisURL = $(e.currentTarget).data('threadid');\r\n\t\trenewSubscription(thisURL);\r\n\t\tmodules['notifications'].showNotification({\r\n\t\t\tnotificationID: 'newCommentCountRenew',\r\n\t\t\tmoduleID: 'newCommentCount',\r\n\t\t\toptionKey: 'subscriptionLength',\r\n\t\t\tmessage: 'Subscription renewed for ' + module.options.subscriptionLength.value + ' days.'\r\n\t\t});\r\n\t}\r\n\r\n\tfunction renewSubscription(threadid) {\r\n\t\tvar now = Date.now();\r\n\t\tcommentCounts[threadid].subscriptionDate = now;\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\tdrawSubscriptionsTable();\r\n\t}\r\n\r\n\tfunction unsubscribeButton(e) {\r\n\t\tvar thisURL = $(e.currentTarget).data('threadid');\r\n\t\tunsubscribe(thisURL);\r\n\t}\r\n\r\n\tfunction stopTracking(e) {\r\n\t\tvar threadId = $(e.currentTarget).data('threadid'),\r\n\t\t\tbutton = $(e.currentTarget);\r\n\t\talert('Are you sure you want to stop tracking new comments on post: \"' + commentCounts[threadId].title + '\"?',\r\n\t\t\tfunction(e) {\r\n\t\t\t\tdelete commentCounts[threadId];\r\n\t\t\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\t\t\tbutton.closest('tr').remove();\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tfunction unsubscribe(threadid) {\r\n\t\tdelete commentCounts[threadid].subscriptionDate;\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\tdrawSubscriptionsTable();\r\n\t}\r\n\r\n\tfunction subscribeButton(e) {\r\n\t\tvar thisURL = $(e.currentTarget).data('threadid');\r\n\t\tsubscribe(thisURL);\r\n\t}\r\n\r\n\tfunction subscribe(threadid) {\r\n\t\tvar now = Date.now();\r\n\t\tcommentCounts[threadid].subscriptionDate = now;\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\tdrawSubscriptionsTable();\r\n\t}\r\n\r\n\tfunction processCommentCounts(ele) {\r\n\t\tele = ele || document.body;\r\n\t\tvar lastClean = RESStorage.getItem('RESmodules.newCommentCount.lastClean');\r\n\t\tvar now = Date.now();\r\n\t\tif (lastClean === null) {\r\n\t\t\tlastClean = now;\r\n\t\t\tRESStorage.setItem('RESmodules.newCommentCount.lastClean', now);\r\n\t\t}\r\n\t\t// Clean cache every six hours\r\n\t\tif ((now - lastClean) > 21600000) {\r\n\t\t\tcleanCache();\r\n\t\t}\r\n\t\tvar IDre = /\\/r\\/[\\w]+\\/comments\\/([\\w]+)\\//i;\r\n\t\tvar commentsLinks = ele.querySelectorAll('.sitetable.linklisting div.thing.link a.comments');\r\n\t\tArray.prototype.slice.call(commentsLinks).forEach(function(link) {\r\n\t\t\tvar href = link.getAttribute('href');\r\n\t\t\tvar thisCount = link.textContent;\r\n\t\t\t// split number from the word comments\r\n\t\t\tthisCount = thisCount.replace(/\\D/g, '');\r\n\t\t\tvar matches = IDre.exec(href);\r\n\t\t\tif (matches) {\r\n\t\t\t\tvar thisID = matches[1];\r\n\t\t\t\tif ((typeof commentCounts[thisID] !== 'undefined') && (commentCounts[thisID] !== null)) {\r\n\t\t\t\t\tvar diff = thisCount - commentCounts[thisID].count;\r\n\t\t\t\t\tif (diff > 0) {\r\n\t\t\t\t\t\tvar newString = $('<span class=\"newComments\">&nbsp;(' + diff + ' new)</span>');\r\n\t\t\t\t\t\t$(link).append(newString);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction updateCommentCountFromMyComment() {\r\n\t\tupdateCommentCount(true);\r\n\t}\r\n\r\n\tvar currentCommentCount, currentCommentID;\r\n\r\n\tfunction updateCommentCount(mycomment) {\r\n\t\tvar IDre = /\\/r\\/[\\w]+\\/comments\\/([\\w]+)\\//i;\r\n\t\tvar matches = IDre.exec(location.href);\r\n\t\tif (matches) {\r\n\t\t\tif (!currentCommentCount) {\r\n\t\t\t\tcurrentCommentID = matches[1];\r\n\t\t\t\tvar thisCount = document.querySelector('#siteTable a.comments');\r\n\t\t\t\tif (thisCount) {\r\n\t\t\t\t\t// split number from the word comments\r\n\t\t\t\t\tcurrentCommentCount = thisCount.textContent.replace(/\\D/g, '');\r\n\t\t\t\t\tif ((typeof commentCounts[currentCommentID] !== 'undefined') && (commentCounts[currentCommentID] !== null)) {\r\n\t\t\t\t\t\tvar prevCommentCount = commentCounts[currentCommentID].count;\r\n\t\t\t\t\t\tvar diff = currentCommentCount - prevCommentCount;\r\n\t\t\t\t\t\tvar newString = $('<span class=\"newComments\">&nbsp;(' + diff + ' new)</span>');\r\n\t\t\t\t\t\tif (diff > 0) $(thisCount).append(newString);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isNaN(currentCommentCount)) currentCommentCount = 0;\r\n\t\t\t\t\tif (mycomment) currentCommentCount++;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcurrentCommentCount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar now = Date.now();\r\n\t\tif (typeof commentCounts === 'undefined') {\r\n\t\t\tcommentCounts = {};\r\n\t\t}\r\n\t\tif (typeof commentCounts[currentCommentID] === 'undefined') {\r\n\t\t\tcommentCounts[currentCommentID] = {};\r\n\t\t}\r\n\t\tcommentCounts[currentCommentID].count = currentCommentCount;\r\n\t\tcommentCounts[currentCommentID].url = location.href.replace(location.hash, '');\r\n\t\tcommentCounts[currentCommentID].title = document.title;\r\n\t\tcommentCounts[currentCommentID].updateTime = now;\r\n\t\t// if (currentCommentCount) {\r\n\t\t// dumb, but because of Greasemonkey security restrictions we need a window.setTimeout here...\r\n\t\twindow.setTimeout(function() {\r\n\t\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\t}, 100);\r\n\t\t// }\r\n\t}\r\n\r\n\tfunction cleanCache() {\r\n\t\tvar now = Date.now();\r\n\t\tfor (var i in commentCounts) {\r\n\t\t\tif ((commentCounts[i] !== null) && ((now - commentCounts[i].updateTime) > (86400000 * module.options.cleanComments.value))) {\r\n\t\t\t\t// commentCounts[i] = null;\r\n\t\t\t\tdelete commentCounts[i];\r\n\t\t\t} else if (commentCounts[i] === null) {\r\n\t\t\t\tdelete commentCounts[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.lastClean', now);\r\n\t}\r\n\r\n\tfunction handleButton(threadid, action) {\r\n\t\tvar button = RESUtils.createElement('span', null, 'RESSubscriptionButton');\r\n\t\tbutton.setAttribute('data-threadid', threadid);\r\n\r\n\t\tswitch (action) {\r\n\t\t\tcase 'unsubscribe':\r\n\t\t\t\tbutton.innerHTML = '<span class=\"res-icon\">&#xF038;</span> unsubscribe';\r\n\t\t\t\tbutton.setAttribute('title', 'stop receiving notifications');\r\n\t\t\t\tbutton.classList.add('unsubscribe');\r\n\t\t\t\t$(button).click(unsubscribeButton);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'subscribe':\r\n\t\t\t\tbutton.innerHTML = '<span class=\"res-icon\">&#xF03B;</span> subscribe';\r\n\t\t\t\tbutton.setAttribute('title', 'notify me of new comments');\r\n\t\t\t\t$(button).click(subscribeButton);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'renew':\r\n\t\t\t\tbutton.innerHTML = '<span class=\"res-icon\">&#xF03B;</span> renew';\r\n\t\t\t\tbutton.setAttribute('title', 'renew for ' + module.options.subscriptionLength.value + ' days');\r\n\t\t\t\t$(button).click(renewSubscriptionButton);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'delete':\r\n\t\t\t\tbutton.innerHTML = '<span class=\"res-icon\">&#xF155;</span>';\r\n\t\t\t\tbutton.setAttribute('title', 'delete from list');\r\n\t\t\t\tbutton.classList.add('deleteIcon');\r\n\t\t\t\t$(button).click(stopTracking);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn button;\r\n\t}\r\n\r\n\tfunction handleToggleButton() {\r\n\t\tif (!toggleButton) {\r\n\t\t\t// Create the button if it doesn't exist.\r\n\t\t\ttoggleButton = RESUtils.createElement('span', 'REScommentSubToggle', 'RESSubscriptionButton');\r\n\t\t\ttoggleButton.addEventListener('click', toggleSubscription, false);\r\n\t\t\tdocument.querySelector('.commentarea .panestack-title').appendChild(toggleButton);\r\n\t\t}\r\n\t\tif (typeof commentCounts[currentCommentID].subscriptionDate !== 'undefined') {\r\n\t\t\t// Unsubscribe.\r\n\t\t\ttoggleButton.innerHTML = '<span class=\"res-icon\">&#xF038;</span> unsubscribe';\r\n\t\t\ttoggleButton.setAttribute('title', 'stop receiving notifications');\r\n\t\t\ttoggleButton.classList.add('unsubscribe');\r\n\t\t} else {\r\n\t\t\t// Subscribe.\r\n\t\t\ttoggleButton.innerHTML = '<span class=\"res-icon\">&#xF03B;</span> subscribe';\r\n\t\t\ttoggleButton.setAttribute('title', 'notify me of new comments');\r\n\t\t\ttoggleButton.classList.remove('unsubscribe');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction toggleSubscription() {\r\n\t\tvar commentID = currentCommentID;\r\n\t\tif (typeof commentCounts[commentID].subscriptionDate !== 'undefined') {\r\n\t\t\tunsubscribeFromThread(commentID);\r\n\t\t} else {\r\n\t\t\tsubscribeToThread(commentID);\r\n\t\t}\r\n\t\thandleToggleButton();\r\n\t}\r\n\r\n\tfunction getLatestCommentCounts() {\r\n\t\tvar counts = RESStorage.getItem('RESmodules.newCommentCount.counts');\r\n\t\tif (counts === null) {\r\n\t\t\tcounts = '{}';\r\n\t\t}\r\n\t\tcommentCounts = safeJSON.parse(counts, 'RESmodules.newCommentCount.counts');\r\n\t}\r\n\r\n\tfunction subscribeToThread(commentID) {\r\n\t\tgetLatestCommentCounts();\r\n\t\tcommentID = commentID || currentCommentID;\r\n\t\tvar now = Date.now();\r\n\t\tcommentCounts[commentID].subscriptionDate = now;\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\tmodules['notifications'].showNotification({\r\n\t\t\tnotificationID: 'newCommentCountSubscribe',\r\n\t\t\tmoduleID: 'newCommentCount',\r\n\t\t\toptionKey: 'subscriptionLength',\r\n\t\t\tmessage: '<p>You are now subscribed to this thread for ' + module.options.subscriptionLength.value + ' days. When new comments are posted you\\'ll receive a notification.<p><a href=\"/r/Dashboard#newCommentsContents\">Manage subscriptions</a><p>'\r\n\t\t}, 5000);\r\n\t}\r\n\r\n\tfunction unsubscribeFromThread(commentID) {\r\n\t\tgetLatestCommentCounts();\r\n\t\tcommentID = commentID || currentCommentID;\r\n\r\n\t\tdelete commentCounts[commentID].subscriptionDate;\r\n\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\tmodules['notifications'].showNotification({\r\n\t\t\tnotificationID: 'newCommentCountUnsubscribe',\r\n\t\t\tmoduleID: 'newCommentCount',\r\n\t\t\tmessage: 'You are now unsubscribed from this thread.'\r\n\t\t}, 3000);\r\n\t}\r\n\r\n\tfunction checkSubscriptions() {\r\n\t\tif (commentCounts) {\r\n\t\t\tvar threadsToCheck = [];\r\n\t\t\tfor (var i in commentCounts) {\r\n\t\t\t\tvar thisSubscription = commentCounts[i];\r\n\t\t\t\tif ((thisSubscription) && (typeof thisSubscription.subscriptionDate !== 'undefined')) {\r\n\t\t\t\t\tvar lastCheck = parseInt(thisSubscription.lastCheck, 10) || 0;\r\n\t\t\t\t\tvar subscriptionDate = parseInt(thisSubscription.subscriptionDate, 10);\r\n\t\t\t\t\t// If it's been subscriptionLength days since we've subscribed, we're going to delete this subscription...\r\n\t\t\t\t\tvar now = Date.now();\r\n\t\t\t\t\tif ((now - subscriptionDate) > (module.options.subscriptionLength.value * 86400000)) {\r\n\t\t\t\t\t\tdelete commentCounts[i].subscriptionDate;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// if we haven't checked this subscription in 5 minutes, try it again...\r\n\t\t\t\t\tif ((now - lastCheck) > 300000) {\r\n\t\t\t\t\t\tthisSubscription.lastCheck = now;\r\n\t\t\t\t\t\tcommentCounts[i] = thisSubscription;\r\n\t\t\t\t\t\t// checkThread(i);\r\n\t\t\t\t\t\tthreadsToCheck.push('t3_' + i);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tRESStorage.setItem('RESmodules.newCommentCount.count', JSON.stringify(commentCounts));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (threadsToCheck.length > 0) {\r\n\t\t\t\tcheckThreads(threadsToCheck);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkThreads(commentIDs) {\r\n\t\tRESEnvironment.ajax({\r\n\t\t\tmethod: 'GET',\r\n\t\t\turl: location.protocol + '//' + location.hostname + '/by_id/' + commentIDs.join(',') + '.json?app=res',\r\n\t\t\tonload: function(response) {\r\n\t\t\t\tvar commentInfo = JSON.parse(response.responseText);\r\n\t\t\t\tif (typeof commentInfo.data !== 'undefined') {\r\n\t\t\t\t\tcommentInfo.data.children.forEach(function(comment) {\r\n\t\t\t\t\t\tvar commentID = comment.data.id;\r\n\t\t\t\t\t\tvar subObj = commentCounts[commentID];\r\n\t\t\t\t\t\tvar unsubscribeButton = handleButton(commentID, 'unsubscribe');\r\n\t\t\t\t\t\tif (subObj.count < comment.data.num_comments) {\r\n\t\t\t\t\t\t\tcommentCounts[commentID].count = comment.data.num_comments;\r\n\r\n\t\t\t\t\t\t\tvar notification = modules['notifications'].showNotification({\r\n\t\t\t\t\t\t\t\theader: 'New comments',\r\n\t\t\t\t\t\t\t\tnotificationID: 'newCommentCount',\r\n\t\t\t\t\t\t\t\tmoduleID: 'newCommentCount',\r\n\t\t\t\t\t\t\t\tnoDisable: true,\r\n\t\t\t\t\t\t\t\tmessage: '<p><a href=\"' + subObj.url + '\">' + escapeHTML(subObj.title) + '</a></p>'\r\n\t\t\t\t\t\t\t}, 10000);\r\n\r\n\t\t\t\t\t\t\t// add button to unsubscribe from within notification.\r\n\t\t\t\t\t\t\tunsubscribeButton.addEventListener('click', notification.close, false);\r\n\t\t\t\t\t\t\t$(notification.element).find('.RESNotificationContent').append(unsubscribeButton);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tRESStorage.setItem('RESmodules.newCommentCount.counts', JSON.stringify(commentCounts));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}