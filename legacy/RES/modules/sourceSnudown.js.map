{"version":3,"sources":["modules/sourceSnudown.js"],"names":[],"mappings":"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","file":"modules/sourceSnudown.js","sourcesContent":["addModule('sourceSnudown', function(module, moduleID) {\r\n\tmodule.moduleName = 'Show Snudown Source';\r\n\tmodule.description = 'Add tool to show the original text on posts and comments, before reddit formats the text.';\r\n\tmodule.category = ['Comments'];\r\n\tmodule.include = [\r\n\t\t'comments',\r\n\t\t'inbox',\r\n\t\t'profile'\r\n\t];\r\n\r\n\tmodule.go = function() {\r\n\t\tif (module.isMatchURL() && module.isEnabled()) {\r\n\t\t\t$(document.body).on('click', 'li.viewSource a', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tviewSource(this);\r\n\t\t\t}).on('click', '.usertext-edit.viewSource .cancel', function() {\r\n\t\t\t\t$(this).parents('.usertext-edit.viewSource').hide();\r\n\t\t\t});\r\n\r\n\r\n\t\t\tattachViewSourceButtons();\r\n\t\t\tRESUtils.watchForElement('newComments', attachViewSourceButtons);\r\n\t\t}\r\n\t};\r\n\r\n\tvar gettingSource = {};\r\n\r\n\tfunction attachViewSourceButtons(entry) {\r\n\t\tif (RESUtils.pageType() === 'comments' || RESUtils.pageType() === 'inbox') {\r\n\t\t\tvar menus;\r\n\r\n\t\t\tif (RESUtils.pageType() === 'comments') {\r\n\t\t\t\tif (entry) {\r\n\t\t\t\t\tmenus = $(entry).find('.flat-list.buttons li.first');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmenus = $('.flat-list.buttons li.first');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmenus = $('.flat-list.buttons a.bylink');\r\n\t\t\t}\r\n\t\t\tRESUtils.forEachChunked(menus, 30, 500, function(item, i, array) {\r\n\t\t\t\t$(item).closest('li').after('<li class=\"viewSource\"><a class=\"noCtrlF\" href=\"javascript:void 0\" data-text=\"source\"></a></li>');\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tfunction viewSource(button) {\r\n\t\tvar $buttonList = $(button).closest('ul');\r\n\t\tif ($(button).data('source-open')) {\r\n\t\t\tvar $sourceDiv = $(button).closest('.thing').find('.usertext-edit.viewSource:first');\r\n\t\t\t$sourceDiv.toggle();\r\n\t\t} else {\r\n\t\t\tvar $permaLink = $buttonList.find('a.bylink, .first a');\r\n\t\t\tvar jsonURL = $permaLink.attr('href');\r\n\t\t\tvar urlSplit = jsonURL.split('/');\r\n\t\t\tvar postID = urlSplit[urlSplit.length - 1];\r\n\r\n\t\t\tvar isSelfText = $permaLink.is('.comments');\r\n\t\t\tif (jsonURL.indexOf('?context') !== -1) {\r\n\t\t\t\tjsonURL = jsonURL.replace('?context=3', '.json?');\r\n\t\t\t} else {\r\n\t\t\t\tjsonURL += '/.json';\r\n\t\t\t}\r\n\r\n\t\t\tjsonURL = RESUtils.insertParam(jsonURL, 'raw_json', '1');\r\n\r\n\t\t\tif (gettingSource[postID]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tgettingSource[postID] = true;\r\n\r\n\t\t\tRESEnvironment.ajax({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: jsonURL,\r\n\t\t\t\tonload: function(response) {\r\n\t\t\t\t\tvar thisResponse = JSON.parse(response.responseText),\r\n\t\t\t\t\t\tsourceText = null,\r\n\t\t\t\t\t\t$userTextForm = $('<div class=\"usertext-edit viewSource\"><div><textarea rows=\"1\" cols=\"1\" name=\"text\" readonly></textarea></div><div class=\"bottom-area\"><div class=\"usertext-buttons\"><button type=\"button\" class=\"cancel\">hide</button></div></div></div>');\r\n\t\t\t\t\t$userTextForm.find('textarea').bind('dblclick', function() {\r\n\t\t\t\t\t\t$(this).unbind('dblclick');\r\n\t\t\t\t\t\t$(this).removeAttr('readonly');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!isSelfText) {\r\n\t\t\t\t\t\tif (typeof thisResponse[1] !== 'undefined') {\r\n\t\t\t\t\t\t\tsourceText = thisResponse[1].data.children[0].data.body;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar thisData = thisResponse.data.children[0].data;\r\n\t\t\t\t\t\t\tif (thisData.id === postID) {\r\n\t\t\t\t\t\t\t\tsourceText = thisData.body;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// The message we want is a reply to a PM/modmail, but reddit returns the whole thread.\r\n\t\t\t\t\t\t\t\t// So, we have to dig into the replies to find the message we want.\r\n\t\t\t\t\t\t\t\tfor (var i = 0, len = thisData.replies.data.children.length; i < len; i++) {\r\n\t\t\t\t\t\t\t\t\tvar replyData = thisData.replies.data.children[i].data;\r\n\t\t\t\t\t\t\t\t\tif (replyData.id === postID) {\r\n\t\t\t\t\t\t\t\t\t\tsourceText = replyData.body;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsourceText = thisResponse[0].data.children[0].data.selftext;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$userTextForm.find('textarea[name=text]').text(sourceText);\r\n\t\t\t\t\t$buttonList.before($userTextForm);\r\n\t\t\t\t\t$(button).data('source-open', true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n});\r\n"],"sourceRoot":"/source/"}