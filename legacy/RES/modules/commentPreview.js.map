{"version":3,"sources":["modules/commentPreview.js"],"names":[],"mappings":"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","file":"modules/commentPreview.js","sourcesContent":["addModule('commentPreview', function(module, moduleID) {\r\n\tmodule.moduleName = 'Live Comment Preview';\r\n\tmodule.category = 'Comments';\r\n\tmodule.description = 'Provides a live preview of comments, as well as a two column editor for writing walls of text.';\r\n\tmodule.options = {\r\n\t\tenableBigEditor: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Enable the 2 column editor.'\r\n\t\t},\r\n\t\topenBigEditor: {\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [69, false, true, false], // control-e\r\n\t\t\tdescription: 'Open the current markdown field in the big editor. (Only when a markdown form is focused)'\r\n\t\t},\r\n\t\tdraftStyle: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Apply a \\'draft\\' style  background to the preview to differentiate it from the comment textarea.',\r\n\t\t\tadvanced: true,\r\n\t\t\tbodyClass: true\r\n\t\t},\r\n\t\tenableForComments: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show preview for comments',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tenableForPosts: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show preview for posts',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tenableForWiki: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show preview for wiki pages',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tenableForSubredditConfig: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show preview for editing subreddit settings',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tenableForBanMessages: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show preview for ban notes',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tsidebarPreview: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show the markdown live preview directly in the sidebar when editing',\r\n\t\t\tadvanced: true\r\n\t\t}\r\n\t};\r\n\tmodule.include = [\r\n\t\t'comments',\r\n\t\t'inbox',\r\n\t\t'submit',\r\n\t\t'profile',\r\n\t\t/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/(?:edit|modqueue|reports|spam|banned)/i,\r\n\t\t'wiki'\r\n\t];\r\n\tmodule.exclude = [\r\n\t\t/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/(?:r\\/[\\-\\w\\.]+\\/)?wiki\\/edit\\/config\\/automoderator\\b/i\r\n\t];\r\n\r\n\tvar subredditImages = {};\r\n\tvar isWiki, isBan;\r\n\r\n\tmodule.go = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\tisWiki = RESUtils.pageType() === 'wiki';\r\n\t\t\tisBan = /^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/banned/i.test(document.location.href);\r\n\r\n\t\t\tif (!isWiki) {\r\n\t\t\t\tthis.converter = window.SnuOwnd.getParser();\r\n\t\t\t} else {\r\n\t\t\t\tRESEnvironment.ajax({\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: location.protocol + '//' + location.hostname + '/r/' + RESUtils.currentSubreddit() + '/about/stylesheet.json',\r\n\t\t\t\t\tonload: function(response) {\r\n\t\t\t\t\t\tvar thisResponse;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tthisResponse = JSON.parse(response.responseText);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tconsole.log('commentPreview: Error parsing response from reddit');\r\n\t\t\t\t\t\t\tconsole.log(response.responseText);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (thisResponse.data && thisResponse.data.images) {\r\n\t\t\t\t\t\t\tthisResponse.data.images.forEach(function(image) {\r\n\t\t\t\t\t\t\t\tsubredditImages[image.name] = image.url;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t//We need to configure non-default renderers here\r\n\t\t\t\tvar SnuOwnd = window.SnuOwnd;\r\n\t\t\t\tvar redditCallbacks = SnuOwnd.getRedditCallbacks();\r\n\t\t\t\tvar rendererConfig = SnuOwnd.defaultRenderState();\r\n\t\t\t\trendererConfig.flags = SnuOwnd.DEFAULT_WIKI_FLAGS;\r\n\t\t\t\trendererConfig.html_element_whitelist = SnuOwnd.DEFAULT_HTML_ELEMENT_WHITELIST;\r\n\t\t\t\trendererConfig.html_attr_whitelist = SnuOwnd.DEFAULT_HTML_ATTR_WHITELIST;\r\n\t\t\t\tthis.converter = SnuOwnd.getParser({\r\n\t\t\t\t\tcallbacks: redditCallbacks,\r\n\t\t\t\t\tcontext: rendererConfig\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.enableBigEditor.value) {\r\n\t\t\t\t// Install the 2 column editor\r\n\t\t\t\taddBigEditorListener();\r\n\r\n\t\t\t\tif (modules['keyboardNav'].isEnabled()) {\r\n\t\t\t\t\t$('body').on('keydown', '.usertext-edit textarea, #wiki_page_content', function(e) {\r\n\t\t\t\t\t\tif (RESUtils.checkKeysForEvent(e, module.options.openBigEditor.value)) {\r\n\t\t\t\t\t\t\tshowBigEditor(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//Close the preview on submit\r\n\t\t\t$('body').on('submit', 'form', function() {\r\n\t\t\t\t$(this).find('.livePreview').hide();\r\n\t\t\t});\r\n\r\n\t\t\tif (!isWiki) {\r\n\t\t\t\t//Perform initial setup of tools over the whole page}\r\n\t\t\t\tattachPreview();\r\n\t\t\t\t// Wireup reply editors\r\n\t\t\t\tRESUtils.watchForElement('newCommentsForms', attachPreview);\r\n\t\t\t\t// Wireup edit editors (usertext-edit already exists in the page)\r\n\t\t\t\tRESUtils.watchForElement('newComments', attachPreview);\r\n\t\t\t} else {\r\n\t\t\t\tattachWikiPreview();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfunction markdownToHTML(md) {\r\n\t\tif (isBan && md.length) {\r\n\t\t\tvar subreddit = location.href.match(/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/([\\-\\w\\.]+)/i)[1];\r\n\r\n\t\t\tmd = modules['commentTools'].generateBanMessage(md, subreddit, modules['commentTools'].curSubredditTitle);\r\n\t\t}\r\n\r\n\t\tvar body = module.converter.render(md);\r\n\t\tif (isWiki) {\r\n\t\t\t/*\r\n\t\t\t<s>Snudown, and therefore SnuOwnd, is a bit funny about how it generates its table of contents entries.\r\n\t\t\tTo when it encounters a header it tries to perform some of the usual inline formatting such as emphasis, strikethoughs, or superscript in headers. The text containing generated HTML then gets passed into cb_toc_header which escapes all of the passed HTML. When reddit gets it escaped tags are stripped.\r\n\r\n\t\t\tIt would be nicer if they just used different functions for rendering the emphasis when making headers.</s>\r\n\r\n\t\t\tIt seems that my understanding was wrong, for some reason reddit doesn't even use snudown's TOC renderer.\r\n\t\t\t*/\r\n\r\n\t\t\tbody = body.replace(/<img src=\"%%([a-z0-9\\-]+)%%\"/gi, function(match, name) {\r\n\t\t\t\tif (subredditImages[name]) {\r\n\t\t\t\t\treturn '<img src=\"' + subredditImages[name] + '\"';\r\n\t\t\t\t}\r\n\t\t\t\treturn match;\r\n\t\t\t});\r\n\r\n\t\t\t// SnuOwnd created this HTML from markdown so it is safe.\r\n\t\t\tvar doc = $('<body>').html(body);\r\n\t\t\tvar header_ids = {};\r\n\t\t\tvar headers = doc.find('h1, h2, h3, h4, h5, h6');\r\n\t\t\tvar tocDiv = $('<div>').addClass('toc');\r\n\t\t\tvar parent = $('<ul>');\r\n\t\t\tparent.data('level', 0);\r\n\t\t\ttocDiv.append(parent);\r\n\t\t\tvar level = 0,\r\n\t\t\t\tprevious = 0;\r\n\t\t\tvar prefix = 'wiki';\r\n\t\t\theaders.each(function(i, e) {\r\n\t\t\t\tvar contents = $(this).text();\r\n\t\t\t\tvar aid = $('<div>').html(contents).text();\r\n\t\t\t\taid = prefix + '_' + aid.replace(/ /g, '_').toLowerCase();\r\n\t\t\t\taid = aid.replace(/[^\\w\\.\\-]/g, function(s) {\r\n\t\t\t\t\treturn '.' + s.charCodeAt(0).toString(16).toUpperCase();\r\n\t\t\t\t});\r\n\t\t\t\tif (!(aid in header_ids)) {\r\n\t\t\t\t\theader_ids[aid] = 0;\r\n\t\t\t\t}\r\n\t\t\t\tvar id_num = header_ids[aid] + 1;\r\n\t\t\t\theader_ids[aid] += 1;\r\n\r\n\t\t\t\tif (id_num > 1) {\r\n\t\t\t\t\taid += id_num;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).attr('id', aid);\r\n\r\n\t\t\t\tvar li = $('<li>').addClass(aid);\r\n\t\t\t\tvar a = $('<a>').attr('href', '#' + aid).text(contents);\r\n\t\t\t\tli.append(a);\r\n\r\n\t\t\t\tvar thisLevel = +this.tagName.slice(-1);\r\n\t\t\t\tif (previous && thisLevel > previous) {\r\n\t\t\t\t\tvar newUL = $('<ul>');\r\n\t\t\t\t\tnewUL.data('level', thisLevel);\r\n\t\t\t\t\tparent.append(newUL);\r\n\t\t\t\t\tparent = newUL;\r\n\t\t\t\t\tlevel++;\r\n\t\t\t\t} else if (level && thisLevel < previous) {\r\n\t\t\t\t\twhile (level && parent.data('level') > thisLevel) {\r\n\t\t\t\t\t\tparent = parent.closest('ul');\r\n\t\t\t\t\t\tlevel -= 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tprevious = thisLevel;\r\n\t\t\t\tparent.append(li);\r\n\t\t\t});\r\n\t\t\tdoc.prepend(tocDiv);\r\n\t\t\treturn doc.html();\r\n\t\t} else {\r\n\t\t\treturn body;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction makeBigEditorButton() {\r\n\t\treturn $('<button type=\"button\" class=\"RESBigEditorPop\" tabIndex=\"3\"><span class=\"res-icon res-icon-12\">&#xF0A4;</span> big editor</button>');\r\n\t}\r\n\r\n\tfunction attachPreview(usertext) {\r\n\t\tif (usertext === undefined || usertext === null) {\r\n\t\t\tusertext = document.body;\r\n\t\t}\r\n\t\tif (module.options.enableBigEditor.value) {\r\n\t\t\tif (isBan) {\r\n\t\t\t\tmakeBigEditorButton().appendTo('#banned .ban-details:has(textarea)');\r\n\t\t\t} else {\r\n\t\t\t\tmakeBigEditorButton().prependTo($('.bottom-area:not(:has(.RESBigEditorPop))', usertext));\r\n\t\t\t}\r\n\t\t}\r\n\t\t$(usertext).find('.usertext-edit, .ban-details:has(#ban_message)').each(function() {\r\n\t\t\tvar $this = $(this);\r\n\r\n\t\t\tif ($this.closest('.commentarea, .message').length &&\r\n\t\t\t\t\t!module.options.enableForComments.value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ((RESUtils.pageType() === 'submit' || $(this).closest('.link').length) &&\r\n\t\t\t\t\t!module.options.enableForPosts.value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/edit/i.test(document.location.href) &&\r\n\t\t\t\t\t!module.options.enableForSubredditConfig.value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/banned/i.test(document.location.href) &&\r\n\t\t\t\t\t!module.options.enableForBanMessages.value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar preview = $this.find('.livePreview');\r\n\r\n\t\t\tif (preview.length === 0) {\r\n\t\t\t\tpreview = makePreviewBox();\r\n\t\t\t\t$this.append(preview);\r\n\t\t\t}\r\n\r\n\t\t\tvar contents = preview.find('.RESDialogContents');\r\n\t\t\tvar textareas = $this.find('textarea[name=text], textarea[name=description], textarea[name=public_description], textarea[name=ban_message]');\r\n\r\n\t\t\tif (textareas.attr('name') === 'description' && module.options.sidebarPreview.value) {\r\n\t\t\t\tvar sideMd = $('.side .usertext-body .md:first');\r\n\r\n\t\t\t\tif (sideMd.length) {\r\n\t\t\t\t\tcontents.push(sideMd[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttextareas.on('input', onTextareaInput.bind(this, preview, contents));\r\n\r\n\t\t\t// check for reply --> quoted text\r\n\t\t\t$this.closest('.thing').find('.buttons a[onclick*=\"reply\"]') /* terrible selector */\r\n\t\t\t\t.on('click', textareas.trigger.bind(textareas, 'input'));\r\n\t\t\tsetTimeout(textareas.trigger.bind(textareas, 'input'), 1);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction attachWikiPreview() {\r\n\t\tif (module.options.enableBigEditor.value) {\r\n\t\t\tmakeBigEditorButton().insertAfter('.markhelp');\r\n\t\t}\r\n\r\n\t\tif (RESUtils.pageType() === 'wiki' && module.options.enableForWiki.value) {\r\n\t\t\tvar preview = makePreviewBox();\r\n\t\t\tpreview.find('.md').addClass('wiki');\r\n\t\t\tpreview.insertAfter($('#editform > br').first());\r\n\r\n\t\t\tvar contents = preview.find('.RESDialogContents');\r\n\t\t\t$('#wiki_page_content').on('input', onTextareaInput.bind(this, preview, contents));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onTextareaInput(preview, contents, event) {\r\n\t\tvar textarea = $(event.target);\r\n\t\tRESUtils.debounce('refreshPreview', 250, function() {\r\n\t\t\tvar markdownText = textarea.val();\r\n\r\n\t\t\tif (markdownText.length > 0) {\r\n\t\t\t\tvar html = markdownToHTML(markdownText);\r\n\t\t\t\tpreview.show();\r\n\t\t\t\t// SnuOwnd created this HTML from markdown so it is safe.\r\n\t\t\t\tcontents.html(html);\r\n\t\t\t} else {\r\n\t\t\t\tpreview.hide();\r\n\t\t\t\tcontents.html('');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction makePreviewBox() {\r\n\t\tvar previewBox = $('<div style=\"display: none\" class=\"RESDialogSmall livePreview\"><h3>Live Preview</h3><div class=\"md RESDialogContents\"></div></div>');\r\n\t\tvar urlHashLink = modules['settingsNavigation'].makeUrlHashLink('commentPreview', null, ' ', 'gearIcon');\r\n\t\tpreviewBox.find('h3').append(urlHashLink);\r\n\r\n\t\treturn previewBox;\r\n\t}\r\n\r\n\tvar bigTextTarget, bigEditor;\r\n\r\n\tfunction createBigEditor() {\r\n\t\tif (bigEditor) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar editor = $('<div id=\"BigEditor\" style=\"display: none;\">');\r\n\t\tvar left = $('<div class=\"BELeft RESDialogSmall\"><h3>Editor</h3></div>');\r\n\t\tvar contents = $('<div class=\"RESDialogContents\"><textarea id=\"BigText\" name=\"text\" class=\"\"></textarea></div>');\r\n\t\tvar foot = $('<div class=\"BEFoot\">');\r\n\t\tif (!isBan) {\r\n\t\t\tfoot.append($('<button type=\"button\">save</button>').on('click', function() {\r\n\t\t\t\tvar len = $('#BigText').val().length;\r\n\t\t\t\tvar max = $('#BigText').data('max-length');\r\n\t\t\t\tif (len > max) {\r\n\t\t\t\t\t$('#BigEditor .errorList .error').hide().filter('.TOO_LONG').text('this is too long (max: ' + max + ')').show();\r\n\t\t\t\t} else if (len === 0) {\r\n\t\t\t\t\t$('#BigEditor .errorList .error').hide().filter('.NO_TEXT').show();\r\n\t\t\t\t} else if (bigTextTarget) {\r\n\t\t\t\t\tbigTextTarget.closest('form').find('button[type=submit]').click();\r\n\t\t\t\t\tbigTextTarget.parents('.usertext-edit:first').find('.livePreview .md').html('');\r\n\t\t\t\t\thideBigEditor(false, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$('#BigEditor .errorList .error').hide().filter('.NO_TARGET').show();\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\tfoot.append($('<button type=\"button\">close</button>').on('click', hideBigEditor));\r\n\r\n\t\tfoot.append($('<span class=\"errorList\">\\\r\n\t\t\t<span style=\"display: none;\" class=\"error NO_TEXT\">we need something here</span>\\\r\n\t\t\t<span style=\"display: none;\" class=\"error TOO_LONG\">this is too long (max: 10000)</span>\\\r\n\t\t\t<span style=\"display: none;\" class=\"error NO_TARGET\">there is no associated textarea</span>\\\r\n\t\t\t</span>'));\r\n\r\n\t\tcontents.append(foot);\r\n\t\tleft.append(contents);\r\n\r\n\t\tvar right = $('<div class=\"BERight RESDialogSmall\"><h3>Preview</h3><div class=\"RESCloseButton RESFadeButton\">&#xf04e;</div><div class=\"RESCloseButton close\">X</div>\\\r\n\t\t\t<div class=\"RESDialogContents\"><div id=\"BigPreview\" class=\" md\"></div></div></div>');\r\n\t\teditor.append(left).append(right);\r\n\t\tif (modules['commentTools'].isEnabled()) {\r\n\t\t\tcontents.prepend(modules['commentTools'].makeEditBar());\r\n\t\t}\r\n\r\n\t\t$(document.body).append(editor);\r\n\r\n\t\t$('.BERight .RESCloseButton.close').on('click', hideBigEditor);\r\n\t\t$('.BERight .RESFadeButton').on('click', function(e) {\r\n\t\t\tif (this.isFaded) {\r\n\t\t\t\t$('#BigEditor').fadeTo(300, 1.0).css('pointer-events', 'auto');\r\n\t\t\t\t$(document.body).addClass('RESScrollLock');\r\n\t\t\t} else {\r\n\t\t\t\t$('#BigEditor').fadeTo(300, 0.3).css('pointer-events', 'none');\r\n\t\t\t\t$(document.body).removeClass('RESScrollLock');\r\n\t\t\t}\r\n\t\t\tthis.isFaded = !this.isFaded;\r\n\t\t});\r\n\r\n\t\t$('#BigText').on('input', function() {\r\n\t\t\tRESUtils.debounce('refreshBigPreview', 250, function() {\r\n\t\t\t\tvar text = $('#BigText').val();\r\n\t\t\t\tvar html = markdownToHTML(text);\r\n\r\n\t\t\t\t// SnuOwnd created this HTML from markdown so it is safe.\r\n\t\t\t\t$('#BigPreview').html(html);\r\n\t\t\t\tif (bigTextTarget) {\r\n\t\t\t\t\tbigTextTarget.val(text);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}).on('keydown', function(e) {\r\n\t\t\t//Close big editor on escape\r\n\t\t\tif (e.keyCode === modules['commentTools'].KEYS.ESCAPE) {\r\n\t\t\t\thideBigEditor();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tbigEditor = editor;\r\n\t}\r\n\r\n\tfunction addBigEditorListener() {\r\n\t\t$('body').on('click', '.RESBigEditorPop', showBigEditor);\r\n\t}\r\n\r\n\tfunction showBigEditor(e) {\r\n\t\tvar limit, baseText;\r\n\r\n\t\te.preventDefault();\r\n\t\tcreateBigEditor();\r\n\t\t// bigTextTarget = null;\r\n\t\thideBigEditor(true);\r\n\t\t$('.side').addClass('BESideHide');\r\n\t\t$('body').addClass('RESScrollLock');\r\n\t\tRESUtils.fadeElementIn(document.getElementById('BigEditor'), 0.3);\r\n\t\tif (!isWiki && !isBan) {\r\n\t\t\tbaseText = $(this).parents('.usertext-edit:first').find('textarea');\r\n\r\n\t\t\tlimit = $(baseText).attr('data-limit');\r\n\t\t\t$('#BigText').attr('data-limit', limit);\r\n\t\t\t$('#BigPreview').removeClass('wiki');\r\n\t\t\t$('.BERight .RESDialogContents').removeClass('wiki-page-content');\r\n\t\t} else if (isBan) {\r\n\t\t\tbaseText = $('#ban_message');\r\n\r\n\t\t\tlimit = $(baseText).attr('data-limit');\r\n\t\t\t$('#BigText').attr('data-limit', limit);\r\n\t\t\t$('#BigPreview').removeClass('wiki');\r\n\t\t\t$('.BERight .RESDialogContents').removeClass('wiki-page-content');\r\n\t\t} else {\r\n\t\t\tbaseText = $('#wiki_page_content');\r\n\t\t\t$('#BigPreview').addClass('wiki');\r\n\t\t\t$('.BERight .RESDialogContents').addClass('wiki-page-content');\r\n\t\t}\r\n\r\n\t\tvar markdown = baseText.val();\r\n\t\tvar maxLength = baseText.data('max-length');\r\n\t\t$('#BigText').data('max-length', maxLength).val(markdown).focus();\r\n\t\tmodules['commentTools'].updateCounter($('#BigText')[0]);\r\n\t\t// SnuOwnd created this HTML from markdown so it is safe.\r\n\t\t$('#BigPreview').html(markdownToHTML(markdown));\r\n\t\tbigTextTarget = baseText;\r\n\r\n\t\t// dynamically set paddingBottom on .RESDialogContents to make textarea scale correctly.\r\n\t\tvar dialogTitle = document.querySelector('.BELeft h3');\r\n\t\tvar editorWrapperHeight = document.querySelector('.BELeft .RESDialogContents .markdownEditor-wrapper');\r\n\t\teditorWrapperHeight = (editorWrapperHeight ? editorWrapperHeight.offsetHeight : 0);\r\n\t\tvar dialogFooter = document.querySelector('.BELeft .BEFoot');\r\n\t\tvar dialogContentBox = document.querySelector('.BELeft .RESDialogContents');\r\n\t\tdialogContentBox.style.paddingBottom =\r\n\t\t\tdialogTitle.offsetHeight - 10 + // add offsetHeight and subtract margin\r\n\t\t\teditorWrapperHeight +\r\n\t\t\tdialogFooter.offsetHeight +\r\n\t\t\t'px';\r\n\t}\r\n\r\n\tfunction hideBigEditor(quick, submitted) {\r\n\t\tif (quick === true) {\r\n\t\t\t$('#BigEditor').hide();\r\n\t\t} else {\r\n\t\t\tRESUtils.fadeElementOut(document.getElementById('BigEditor'), 0.3);\r\n\t\t}\r\n\t\t$('.side').removeClass('BESideHide');\r\n\t\t$('body').removeClass('RESScrollLock');\r\n\t\tvar target = bigTextTarget;\r\n\r\n\t\tif (target) {\r\n\t\t\ttarget.val($('#BigText').val());\r\n\t\t\ttarget.focus();\r\n\t\t\tif (submitted !== true) {\r\n\t\t\t\tvar inputEvent = document.createEvent('HTMLEvents');\r\n\t\t\t\tinputEvent.initEvent('input', true, true);\r\n\t\t\t\ttarget[0].dispatchEvent(inputEvent);\r\n\t\t\t}\r\n\t\t\tbigTextTarget = null;\r\n\t\t}\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}