{"version":3,"sources":["modules/commentTools.js"],"names":[],"mappings":"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","file":"modules/commentTools.js","sourcesContent":["addModule('commentTools', function(module, moduleID) {\r\n\tmodule.moduleName = 'Comment Tools';\r\n\tmodule.category = ['Comments'];\r\n\tmodule.description = 'Provides shortcuts for easier markdown.';\r\n\tmodule.options = {\r\n\t\tuserAutocomplete: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show user autocomplete tool when typing in posts, comments and replies',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tsubredditAutocomplete: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show subreddit autocomplete tool when typing in posts, comments and replies',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tformattingToolButtons: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show formatting tools (bold, italic, tables, etc.) to the edit form for posts, comments, and other snudown/markdown areas.'\r\n\t\t},\r\n\t\tkeyboardShortcuts: {\r\n\t\t\tdependsOn: 'formattingToolButtons',\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Use keyboard shortcuts to apply styles to selected text'\r\n\t\t},\r\n\t\tboldKey: {\r\n\t\t\tdependsOn: 'keyboardShortcuts',\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [66, false, true, false, false], // ctrl-b\r\n\t\t\tdescription: 'Keyboard shortcut to make text bold.'\r\n\t\t},\r\n\t\titalicKey: {\r\n\t\t\tdependsOn: 'keyboardShortcuts',\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [73, false, true, false, false], // ctrl-i\r\n\t\t\tdescription: 'Keyboard shortcut to make text italic.'\r\n\t\t},\r\n\t\tstrikeKey: {\r\n\t\t\tdependsOn: 'keyboardShortcuts',\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [83, false, true, false, false], // ctrl-s\r\n\t\t\tdescription: 'Keyboard shortcut to add a strikethrough.'\r\n\t\t},\r\n\t\tsuperKey: {\r\n\t\t\tdependsOn: 'keyboardShortcuts',\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [187, false, true, true, false], // ctrl-+ (ctrl-shift-=)\r\n\t\t\tdescription: 'Keyboard shortcut to make text superscript.'\r\n\t\t},\r\n\t\tlinkKey: {\r\n\t\t\tdependsOn: 'keyboardShortcuts',\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [75, false, true, false, false], // ctrl-k\r\n\t\t\tdescription: 'Keyboard shortcut to add a link.'\r\n\t\t},\r\n\t\tquoteKey: {\r\n\t\t\tdependsOn: 'keyboardShortcuts',\r\n\t\t\ttype: 'keycode',\r\n\t\t\tvalue: [190, false, true, true, false], // ctrl-> (strl-shift-.)\r\n\t\t\tdescription: 'Keyboard shortcut to quote text.'\r\n\t\t},\r\n\t\tctrlEnterSubmitsComments: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Pressing Ctrl+Enter or Cmd+Enter will submit your comment/wiki edit.'\r\n\t\t},\r\n\t\tctrlEnterSubmitsPosts: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Pressing Ctrl+Enter or Cmd+Enter will submit your post.'\r\n\t\t},\r\n\t\tcommentingAs: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Shows your currently logged in username to avoid posting from the wrong account.'\r\n\t\t},\r\n\t\thighlightIfAltAccount: {\r\n\t\t\tdependsOn: 'commentingAs',\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Put in bold the \"Commenting As\" part if you are using an alt account. The first account in the Account Switcher module is considered as your main account.'\r\n\t\t},\r\n\t\tshowInputLength: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'When submitting, display the number of characters entered in the title and text fields and indicate when you go over the 300 character limit for titles.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tmacroButtons: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Add macro buttons to the edit form for posts, comments, and other snudown/markdown areas.',\r\n\t\t\tbodyClass: true\r\n\t\t},\r\n\t\tmacros: {\r\n\t\t\tdependsOn: 'macroButtons',\r\n\t\t\ttype: 'table',\r\n\t\t\taddRowText: '+add shortcut',\r\n\t\t\tfields: [{\r\n\t\t\t\tname: 'label',\r\n\t\t\t\ttype: 'text'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'text',\r\n\t\t\t\ttype: 'textarea'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'category',\r\n\t\t\t\ttype: 'text'\r\n\t\t\t}, {\r\n\t\t\t\tname: 'key',\r\n\t\t\t\ttype: 'keycode'\r\n\t\t\t}],\r\n\t\t\tvalue: [\r\n\t\t\t\t['reddiquette', '[reddiquette](/wiki/reddiquette) '],\r\n\t\t\t\t['Promote RES', '[Reddit Enhancement Suite](http://redditenhancementsuite.com \"also /r/Enhancement\") '],\r\n\t\t\t\t['Current timestamp', '{{now}} ']\r\n\t\t\t],\r\n\t\t\tdescription: 'Add buttons to insert frequently used snippets of text.'\r\n\t\t},\r\n\t\tkeepMacroListOpen: {\r\n\t\t\tdependsOn: 'macroButtons',\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: false,\r\n\t\t\tdescription: 'After selecting a macro from the dropdown list, do not hide the list.',\r\n\t\t\tadvanced: true\r\n\t\t},\r\n\t\tmacroPlaceholders: {\r\n\t\t\tdependsOn: 'macroButtons',\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'When using macro, replace placeholders in text via pop-up prompt.\\\r\n\t\t\t<p>Example macro text:<br>\\\r\n\t\t\tThe {{adj1}} {{adj2}} {{animal}} jumped over the lazy {{dog_color}} dog. The {{animal}} is so {{adj1}}!\\\r\n\t\t\t</p>\\\r\n\t\t\t'\r\n\t\t},\r\n\t\tenabledOnBanMessages: {\r\n\t\t\ttype: 'boolean',\r\n\t\t\tvalue: true,\r\n\t\t\tdescription: 'Show the comment tools on the ban note textbox.',\r\n\t\t\tadvanced: true\r\n\t\t}\r\n\t};\r\n\tmodule.include = [\r\n\t\t'comments',\r\n\t\t'inbox',\r\n\t\t'submit',\r\n\t\t'profile',\r\n\t\t/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/(?:edit|modqueue|reports|spam|banned)\\/?/i,\r\n\t\t/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/wiki\\/(?:create|edit)(\\/\\w+)?/i\r\n\t];\r\n\tmodule.loadDynamicOptions = function() {\r\n\t\tif (magicPlaceholders.length) {\r\n\t\t\tvar macroPlaceholdersDescription = '<br><br>Some placeholders are automatically filled in when you use the macro:<dl>';\r\n\t\t\tmacroPlaceholdersDescription += magicPlaceholders.map(function(placeholder) {\r\n\t\t\t\tvar description = '<dt>' + placeholder.matches.map(function(placeholder) { return '{{' + placeholder + '}}'; }).join('<br>') + '</dt>';\r\n\t\t\t\tif (placeholder.description) {\r\n\t\t\t\t\tdescription += '<dd>' + placeholder.description + '</dd>';\r\n\t\t\t\t}\r\n\t\t\t\treturn description;\r\n\t\t\t}).join('');\r\n\t\t\tmacroPlaceholdersDescription += '</dl>';\r\n\t\t\tmodule.options['macroPlaceholders'].description += macroPlaceholdersDescription;\r\n\t\t}\r\n\t};\r\n\tmodule.beforeLoad = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\treturn RESStorage.loadItem('RESmodules.commentTools.macroDataVersion');\r\n\t\t}\r\n\t};\r\n\r\n\tvar SUBMIT_LIMITS = {\r\n\t\tSTYLESHEET: 128 * 1024,\r\n\t\tSIDEBAR: 5120,\r\n\t\tDESCRIPTION: 500,\r\n\t\tWIKI: 512 * 1024,\r\n\t\tCOMMENT: 10000,\r\n\t\tPOST: 40000,\r\n\t\tPOST_TITLE: 300,\r\n\t\tBAN_MESSAGE: 10000\r\n\t};\r\n\tvar macroCallbackTable = [];\r\n\tvar macroKeyTable = [];\r\n\tmodule.curSubreddit = null;\r\n\tmodule.curSubredditTitle = null;\r\n\r\n\tmodule.go = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\tmigrateData();\r\n\r\n\t\t\tvar $body = $('body');\r\n\r\n\t\t\tif (location.href.match(/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/banned\\/?/i)) {\r\n\t\t\t\tvar subreddit = location.href.match(/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/([\\-\\w\\.]+)/i)[1];\r\n\r\n\t\t\t\tSUBMIT_LIMITS.BAN_MESSAGE = 10000 - module.generateBanMessage(null, subreddit).length;\r\n\t\t\t\tthis.curSubreddit = subreddit;\r\n\r\n\t\t\t\tfetchTitle();\r\n\t\t\t}\r\n\r\n\r\n\t\t\t$body.on('click', 'div.markdownEditor-wrapper a:not(.userTagLink)', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tvar index = $(this).data('macro-index');\r\n\t\t\t\tvar box = findTextareaForElement(this)[0];\r\n\t\t\t\t// var box = $(this).closest('.usertext-edit, .RESDialogContents, .wiki-page-content').find('textarea[name=text], textarea[name=description], textarea[name=public_description]')[0];\r\n\t\t\t\tif (box === null) {\r\n\t\t\t\t\tconsole.error('Failed to locate textarea.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar handler = macroCallbackTable[index];\r\n\t\t\t\tif (handler === null) {\r\n\t\t\t\t\tconsole.error('Failed to locate find callback.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\thandler.call(module, this, box);\r\n\r\n\t\t\t\tbox.focus();\r\n\t\t\t\t//Fire an input event to refresh the preview\r\n\t\t\t\tvar inputEvent = document.createEvent('HTMLEvents');\r\n\t\t\t\tinputEvent.initEvent('input', true, true);\r\n\t\t\t\tbox.dispatchEvent(inputEvent);\r\n\t\t\t}).on('click', '.RESMacroDropdownTitle', function(e) {\r\n\t\t\t\tvar thisCat = e.target;\r\n\t\t\t\tif (thisCat.classList.contains('openMacro')) {\r\n\t\t\t\t\tthisCat.classList.remove('openMacro');\r\n\t\t\t\t\tmodules['styleTweaks'].setSRStyleToggleVisibility(true, 'commentTools-macroDropdown');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$('.RESMacroWrappingSpan span').removeClass('openMacro');\r\n\t\t\t\t\tthisCat.classList.add('openMacro');\r\n\t\t\t\t\tmodules['styleTweaks'].setSRStyleToggleVisibility(false, 'commentTools-macroDropdown');\r\n\t\t\t\t}\r\n\t\t\t\t// position the drop down so it's flush with the right of the category button.\r\n\t\t\t\t$(this).next().css({\r\n\t\t\t\t\ttop: thisCat.offsetTop + thisCat.offsetHeight + 'px',\r\n\t\t\t\t\tleft: (thisCat.offsetLeft + thisCat.offsetWidth) - thisCat.nextSibling.offsetWidth + 'px'\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tif (this.options.showInputLength.value) {\r\n\t\t\t\t$body.on('input', '.usertext-edit textarea, #title-field textarea, #BigEditor textarea, #wiki_page_content, #ban_message', function(e) {\r\n\t\t\t\t\tmodule.updateCounter(this);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.keyboardShortcuts.value) {\r\n\t\t\t\t$body.on('keydown', '.usertext-edit textarea, #BigEditor textarea, #wiki_page_content, #ban_message', function(e) {\r\n\t\t\t\t\tif (e.keyCode === module.KEYS.ESCAPE) {\r\n\t\t\t\t\t\tif (!autoCompletePop.is(':visible')) {\r\n\t\t\t\t\t\t\t// Blur from the editor on escape, so we can return to using the keyboard nav.\r\n\t\t\t\t\t\t\t// NOTE: The big editor closes on ESC so this won't be reached in that case.\r\n\t\t\t\t\t\t\t$(this).blur();\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (var i = 0; i < macroKeyTable.length; i++) {\r\n\t\t\t\t\t\tvar row = macroKeyTable[i];\r\n\t\t\t\t\t\tvar testedKeyArray = row[0],\r\n\t\t\t\t\t\t\tmacroIndex = row[1];\r\n\t\t\t\t\t\tif (RESUtils.checkKeysForEvent(e, testedKeyArray)) {\r\n\t\t\t\t\t\t\tvar handler = macroCallbackTable[macroIndex];\r\n\t\t\t\t\t\t\thandler.call(module, null, this);\r\n\r\n\t\t\t\t\t\t\t// Fire an input event to refresh the preview\r\n\t\t\t\t\t\t\tvar inputEvent = document.createEvent('HTMLEvents');\r\n\t\t\t\t\t\t\tinputEvent.initEvent('input', true, true);\r\n\t\t\t\t\t\t\tthis.dispatchEvent(inputEvent);\r\n\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (this.options.ctrlEnterSubmitsComments.value) {\r\n\t\t\t\tmodule.onCtrlEnter(\r\n\t\t\t\t\t'.usertext-edit textarea, #BigEditor textarea, #wiki_page_content',\r\n\t\t\t\t\tfunction(e) {\r\n\t\t\t\t\t\tvar currentForm = $(e.target).closest('form');\r\n\t\t\t\t\t\tvar saveButton = currentForm.find('.save')[0] || currentForm.find('#wiki_save_button')[0] || $('.BEFoot button')[0];\r\n\t\t\t\t\t\tRESUtils.click(saveButton);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (this.options.ctrlEnterSubmitsPosts.value) {\r\n\t\t\t\tmodule.onCtrlEnter(\r\n\t\t\t\t\t'#title-field textarea, #text-field textarea, #url, #sr-autocomplete, input.captcha',\r\n\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\tvar captcha = $('input.captcha:not(.cap-text)');\r\n\t\t\t\t\t\tif (captcha.length && captcha.val() === '') {\r\n\t\t\t\t\t\t\tcaptcha.focus();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tRESUtils.click($('.spacer .btn')[0]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.subredditAutocomplete.value || this.options.userAutocomplete.value) {\r\n\t\t\t\taddAutoCompletePop();\r\n\t\t\t}\r\n\r\n\t\t\t//Perform initial setup of tools over the whole page\r\n\t\t\tattachCommentTools();\r\n\r\n\t\t\t/*\r\n\t\t\t//These are no longer necessary but I am saving them in case Reddit changes how they make their reply forms.\r\n\t\t\t// Wireup reply editors\r\n\t\t\tRESUtils.watchForElement('newCommentsForms', attachCommentTools);\r\n\t\t\t// Wireup edit editors (usertext-edit already exists in the page)\r\n\t\t\tRESUtils.watchForElement('newComments', attachCommentTools);\r\n\t\t\t*/\r\n\t\t}\r\n\t};\r\n\r\n\tfunction migrateData() {\r\n\t\tvar LATEST_MACRO_DATA_VERSION = '2';\r\n\t\tvar macroVersion = RESStorage.getItem('RESmodules.commentTools.macroDataVersion');\r\n\t\tif (macroVersion === null || macroVersion === '0') {\r\n\t\t\t//In this case it is unmigrated or uncreated\r\n\t\t\tvar previewOptionString = RESStorage.getItem('RESoptions.commentPreview');\r\n\t\t\tvar previewOptions = safeJSON.parse(previewOptionString, 'commentPreview');\r\n\t\t\tif (previewOptions !== null) {\r\n\t\t\t\tif (typeof previewOptions.commentingAs !== 'undefined') {\r\n\t\t\t\t\tmodule.options.commentingAs.value = previewOptions.commentingAs.value;\r\n\t\t\t\t\tdelete previewOptions.commentingAs;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof previewOptions.keyboardShortcuts !== 'undefined') {\r\n\t\t\t\t\tmodule.options.keyboardShortcuts.value = previewOptions.keyboardShortcuts.value;\r\n\t\t\t\t\tdelete previewOptions.keyboardShortcuts;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof previewOptions.subredditAutocomplete !== 'undefined') {\r\n\t\t\t\t\tmodule.options.subredditAutocomplete.value = previewOptions.subredditAutocomplete.value;\r\n\t\t\t\t\tdelete previewOptions.subredditAutocomplete;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof previewOptions.macros !== 'undefined') {\r\n\t\t\t\t\tmodule.options.macros.value = previewOptions.macros.value;\r\n\t\t\t\t\tmodule.options.macros.value.forEach(function(macro) {\r\n\t\t\t\t\t\twhile (macro.length < 4) {\r\n\t\t\t\t\t\t\tmacro.push('');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdelete previewOptions.macros;\r\n\t\t\t\t}\r\n\t\t\t\tRESUtils.options.saveModuleOptions('commentTools');\r\n\t\t\t\tRESUtils.options.saveModuleOptions('commentPreview', previewOptions);\r\n\t\t\t\tRESStorage.setItem('RESmodules.commentTools.macroDataVersion', LATEST_MACRO_DATA_VERSION);\r\n\t\t\t} else {\r\n\t\t\t\t//No migration will be performed\r\n\t\t\t\tRESStorage.setItem('RESmodules.commentTools.macroDataVersion', LATEST_MACRO_DATA_VERSION);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (macroVersion === '1') {\r\n\t\t\tmodule.options.macros.value.forEach(function(macro) {\r\n\t\t\t\twhile (macro.length < 4) {\r\n\t\t\t\t\tmacro.push('');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tRESStorage.setItem('RESmodules.commentTools.macroDataVersion', LATEST_MACRO_DATA_VERSION);\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.getCommentTextarea = function(elem) {\r\n\t\treturn $(elem || document.body).find('textarea[name][name!=share_to][name!=message]');\r\n\t};\r\n\r\n\tfunction attachCommentTools(elem) {\r\n\t\tmodule.getCommentTextarea(elem).each(attachEditorToUsertext);\r\n\t}\r\n\r\n\tfunction getFieldLimit(elem) {\r\n\t\tswitch (elem.name) {\r\n\t\t\tcase 'title':\r\n\t\t\t\treturn SUBMIT_LIMITS.POST_TITLE;\r\n\t\t\tcase 'text': // https://github.com/honestbleeps/Reddit-Enhancement-Suite/issues/829\r\n\t\t\t\tif (RESUtils.pageType() === 'submit' || $(elem).closest('.thing').hasClass('self')) {\r\n\t\t\t\t\treturn SUBMIT_LIMITS.POST;\r\n\t\t\t\t}\r\n\t\t\t\treturn SUBMIT_LIMITS.COMMENT;\r\n\t\t\tcase 'description':\r\n\t\t\t\treturn SUBMIT_LIMITS.SIDEBAR;\r\n\t\t\tcase 'public_description':\r\n\t\t\t\treturn SUBMIT_LIMITS.DESCRIPTION;\r\n\t\t\tcase 'content':\r\n\t\t\t\treturn SUBMIT_LIMITS.WIKI;\r\n\t\t\tcase 'ban_message':\r\n\t\t\t\treturn SUBMIT_LIMITS.BAN_MESSAGE;\r\n\t\t\t//case 'description_conflict_old':\r\n\t\t\t//case 'public_description_conflict_old':\r\n\t\t\tdefault:\r\n\t\t\t\t// console.warn('unhandled form', this);\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction attachEditorToUsertext() {\r\n\t\tif (this.hasAttribute('data-max-length')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar limit = getFieldLimit(this);\r\n\r\n\t\tthis.setAttribute('data-limit', limit);\r\n\r\n\t\tif (this.name === 'title') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.id === 'ban_message' && !module.options.enabledOnBanMessages.value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.id === 'ban_message') {\r\n\t\t\tthis.style.width = '500px';\r\n\t\t\tthis.style.height = '100px';\r\n\t\t}\r\n\r\n\t\tvar bar = module.makeEditBar();\r\n\t\tif (this.id === 'wiki_page_content' || this.id === 'ban_message') {\r\n\t\t\t$(this).parent().prepend(bar);\r\n\t\t} else {\r\n\t\t\t$(this).parent().before(bar);\r\n\t\t}\r\n\t\tmodule.updateCounter(this);\r\n\t}\r\n\r\n\tmodule.updateCounter = function(textarea) {\r\n\t\tvar length = $(textarea).val().length;\r\n\t\tvar limit = textarea.getAttribute('data-limit');\r\n\t\tvar counter = $(textarea).parent().parent().find('.RESCharCounter');\r\n\t\tcounter.attr('title', 'character limit: ' + length + '/' + limit);\r\n\t\tcounter.text(length + '/' + limit);\r\n\t\tif (length > limit) {\r\n\t\t\tcounter.addClass('tooLong');\r\n\t\t} else {\r\n\t\t\tcounter.removeClass('tooLong');\r\n\t\t}\r\n\t};\r\n\r\n\tvar cachedEditBar;\r\n\r\n\tmodule.makeEditBar = function() {\r\n\t\tif (cachedEditBar) {\r\n\t\t\treturn $(cachedEditBar).clone();\r\n\t\t}\r\n\r\n\t\tvar editBar = $('<div class=\"markdownEditor\">');\r\n\t\t// Wrap the edit bar in a <div> of its own\r\n\t\tvar wrappedEditBar = $('<div class=\"markdownEditor-wrapper\">').append(editBar);\r\n\r\n\t\tif (module.options.commentingAs.value && (!modules['usernameHider'].isEnabled())) {\r\n\t\t\t// show who we're commenting as...\r\n\t\t\tvar commentingAsMessage = location.href.match(/^https?:\\/\\/(?:[\\-\\w\\.]+\\.)?reddit\\.com\\/r\\/[\\-\\w\\.]+\\/about\\/banned\\/?/i) ? 'Moderating as' : 'Commenting as';\r\n\r\n\t\t\tvar commentingAs = $('<div class=\"commentingAs\">').html(commentingAsMessage + ': <span class=\"commentingAsUser\" data-user=\"'+ RESUtils.loggedInUser() +'\">' + RESUtils.loggedInUser() + '</span>');\r\n\t\t\tif (modules['userTagger'].isEnabled()) {\r\n\t\t\t\tmodules['userTagger'].applyTagToAuthor(commentingAs.find('.commentingAsUser')[0], true);\r\n\t\t\t}\r\n\t\t\tif (module.options.highlightIfAltAccount.value && modules['accountSwitcher'].options.accounts.value.length && typeof RESUtils.loggedInUser() === 'string' && RESUtils.loggedInUser().toLowerCase() !== modules['accountSwitcher'].options.accounts.value[0][0].toLowerCase()) {\r\n\t\t\t\tcommentingAs.addClass('highlightedAltAccount');\r\n\t\t\t}\r\n\t\t\twrappedEditBar.append(commentingAs);\r\n\t\t}\r\n\r\n\t\tif (module.options.formattingToolButtons.value) {\r\n\t\t\tvar shortcuts = module.options.keyboardShortcuts.value;\r\n\t\t\teditBar.append(makeEditButton('<b>Bold</b>', 'bold' + (shortcuts ? ' (' + RESUtils.niceKeyCode(module.options.boldKey.value) + ')' : ''), module.options.boldKey.value, 'btn-bold', function(button, box) {\r\n\t\t\t\twrapSelection(box, '**', '**');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('<i>Italic</i>', 'italic' + (shortcuts ? ' (' + RESUtils.niceKeyCode(module.options.italicKey.value) + ')' : ''), module.options.italicKey.value, 'btn-italic', function(button, box) {\r\n\t\t\t\twrapSelection(box, '*', '*');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('<del>strike</del>', 'strike' + (shortcuts ? ' (' + RESUtils.niceKeyCode(module.options.strikeKey.value) + ')' : ''), module.options.strikeKey.value, 'btn-strike', function(button, box) {\r\n\t\t\t\twrapSelection(box, '~~', '~~');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('<sup>sup</sup>', 'super' + (shortcuts ? ' (' + RESUtils.niceKeyCode(module.options.superKey.value) + ')' : ''), module.options.superKey.value, 'btn-superscript', function(button, box) {\r\n\t\t\t\twrapSelectedWords(box, '^');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('Link', 'link' + (shortcuts ? ' (' + RESUtils.niceKeyCode(module.options.linkKey.value) + ')' : ''), module.options.linkKey.value, 'btn-link', function(button, box) {\r\n\t\t\t\tlinkSelection(box);\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('>Quote', 'quote' + (shortcuts ? ' (' + RESUtils.niceKeyCode(module.options.quoteKey.value) + ')' : ''), module.options.quoteKey.value, 'btn-quote', function(button, box) {\r\n\t\t\t\twrapSelectedLines(box, '> ', '');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('<span style=\"font-family: monospace\">Code</span>', 'code', null, 'btn-code', function(button, box) {\r\n\t\t\t\twrapSelectedLines(box, '    ', '');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('&bull;Bullets', 'bullet list', null, 'btn-list-unordered', function(button, box) {\r\n\t\t\t\twrapSelectedLines(box, '* ', '');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('1.Numbers', 'number list', null, 'btn-list-ordered', function(button, box) {\r\n\t\t\t\twrapSelectedLines(box, '1. ', '');\r\n\t\t\t}));\r\n\t\t\teditBar.append(makeEditButton('<span style=\"border: 1px black solid;\">Table</span>', 'table', null, 'btn-table', function(button, box) {\r\n\t\t\t\t// First check if the selected text is a table, this also clean the selection\r\n\t\t\t\tvar selectedText = box.value.substring(box.selectionStart, box.selectionEnd).replace(/^[\\s]+/, '').replace(/[\\s]+$/, '').split('\\n'); // In fact, if the header start by '   |' this is not a table. But it's better to accept it then after editing the table it will work\r\n\t\t\t\tvar isTable;\r\n\t\t\t\tif (selectedText.length >= 2) {\r\n\t\t\t\t\tif (selectedText[0].indexOf('|') !== -1) {\t// Check if there is at least one '|' to check if it's a table\r\n\t\t\t\t\t\tselectedText[0] = selectedText[0].replace(/^\\|/, '').replace(/\\|\\s+$/, ''); // Avoid '| foo | bar |' instead of 'foo | bar'\r\n\t\t\t\t\t\tvar numSeparator = selectedText[0].split('|').length;\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\t\tnumSeparator can be 0 for example with :\r\n\t\t\t\t\t\t\t\tfoo |\r\n\t\t\t\t\t\t\t\t----|\r\n\t\t\t\t\t\t\t\tbar |\r\n\t\t\t\t\t\t\tbut it's important to check for each line before removing starting/ending '|' if there is at least one '|' to check if it's really a table\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\tisTable = true;\r\n\r\n\t\t\t\t\t\t// Check the HEADER/BODY separator\r\n\t\t\t\t\t\tselectedText[1] = selectedText[1].replace(/\\|[^|\\-]+$/, ''); // '-|-|-|ILOVECOOKIE' is correct, so clean it. But '-|-|-ILOVECOOKIE' is not correct if there is 3 column (okay if there is less though, but will not be detected). Also '-      |     -    |   -' is correct and will not be detected.\r\n\t\t\t\t\t\tselectedText[1] = selectedText[1].replace(/-/g, '--'); // Required to allow -|-|- to work (else the split would give ['', '|-'])\r\n\t\t\t\t\t\tif (selectedText[1].indexOf('-|') === -1 && selectedText[1].indexOf('|-') === -1) {\r\n\t\t\t\t\t\t\tisTable = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tselectedText[1] = selectedText[1].replace(/^\\]+/, '').replace(/[\\s|]+$/, '');\r\n\t\t\t\t\t\tif (selectedText[1].split('-|-').length < numSeparator) { // Check if there is enough '-|-'\r\n\t\t\t\t\t\t\tisTable = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (/[^|\\-]/.test(selectedText[1])) { // If the separator contain an other character than | or -\r\n\t\t\t\t\t\t\tisTable = false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Now check the BODY\r\n\t\t\t\t\t\tif (isTable) {\r\n\t\t\t\t\t\t\tfor (var i = 2, len = selectedText.length; i<len; i++) {\r\n\t\t\t\t\t\t\t\tif (selectedText[i].indexOf('|') === -1) {\r\n\t\t\t\t\t\t\t\t\tisTable = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tselectedText[i] = selectedText[i].replace(/^\\|/, '').replace(/[\\s|]+$/, '');\r\n\t\t\t\t\t\t\t\tif (selectedText[i].split('|').length !== numSeparator)\t{ // Check if there is the same '|' number\r\n\t\t\t\t\t\t\t\t\t// In fact this should be >= but that would means make disappear some content, so I will consider this is not a table\r\n\t\t\t\t\t\t\t\t\t// in fact this is useless, because if we omit last cell they will be void. But this would complicate the generation part by managing void cell and the code is enough complicate.\r\n\t\t\t\t\t\t\t\t\tisTable = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar startTable;\r\n\t\t\t\tif (isTable) {\r\n\t\t\t\t\t// The selected text is a table, now transform it to HTML!\r\n\t\t\t\t\tstartTable = selectedText.reduce(function(prevTable, currText, i) {\r\n\t\t\t\t\t\tif (i === 1) {\r\n\t\t\t\t\t\t\treturn prevTable;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn prevTable + '<tr><td>' + escapeHTML(currText).replace(/\\|/g, '</td><td>') + '</td></tr>';\r\n\t\t\t\t\t}, '');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstartTable = '<tr><td>Foo</td><td>Bar</td></tr><tr><td>Foo</td><td>Bar</td></tr>';\r\n\t\t\t\t}\r\n\t\t\t\talert('<div class=\"buttonContainer\"></div><table class=\"commentPreview\" contenteditable=\"true\">' + startTable + '</table>',\r\n\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\tvar generatedTable = '\\n\\n';\r\n\t\t\t\t\t\tvar generatedTableSeparation = '';\r\n\t\t\t\t\t\t$('#alert_message tr:first td').each(function(){\r\n\t\t\t\t\t\t\tvar text = $(this).text().replace(/[\\n|]/g, '');\r\n\t\t\t\t\t\t\tgeneratedTable += text + ' | ';\r\n\t\t\t\t\t\t\tfor (var i = 0, len = text.length; i < len; i++) {\r\n\t\t\t\t\t\t\t\tgeneratedTableSeparation += '-';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgeneratedTableSeparation += '|';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tgeneratedTableSeparation = generatedTableSeparation.substr(0, generatedTableSeparation.length - 1);\r\n\t\t\t\t\t\tgeneratedTable = generatedTable.substr(0, generatedTable.length - 3) + '\\n' + generatedTableSeparation + '\\n';\r\n\t\t\t\t\t\t$('#alert_message tr:gt(0)').each(function() {\r\n\t\t\t\t\t\t\t$(this).find('td').each(function() {\r\n\t\t\t\t\t\t\t\tgeneratedTable += $(this).text().replace(/[\\n|]/g, '') + ' | ';\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tgeneratedTable = generatedTable.substr(0, generatedTable.length - 3) + '\\n';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (isTable) {\r\n\t\t\t\t\t\t\treplaceSelection(box, generatedTable);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twrapSelection(box, generatedTable, '');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$(box).trigger('input'); // update preview\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\tvar addRow = gdAlert.makeButton('+ Row');\r\n\t\t\t\tvar remRow = gdAlert.makeButton('- Row');\r\n\t\t\t\tvar addCol = gdAlert.makeButton('+ Col');\r\n\t\t\t\tvar remCol = gdAlert.makeButton('- Col');\r\n\t\t\t\taddRow.addEventListener('click', function() {\r\n\t\t\t\t\tvar nbCol = $('#alert_message tr:first td').length;\r\n\t\t\t\t\tfor (var i = 0, newRow = ''; i<nbCol; i++) {\r\n\t\t\t\t\t\tnewRow += '<td>text</td>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$('#alert_message table').append('<tr>' + newRow + '</tr>');\r\n\t\t\t\t}, false);\r\n\t\t\t\tremRow.addEventListener('click', function() {\r\n\t\t\t\t\tif ($('#alert_message tr').length > 1) {\r\n\t\t\t\t\t\t$('#alert_message table tr:last').remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, false);\r\n\t\t\t\taddCol.addEventListener('click', function() {\r\n\t\t\t\t\t$('#alert_message table tr').append('<td>text</td>');\r\n\t\t\t\t}, false);\r\n\t\t\t\tremCol.addEventListener('click', function() {\r\n\t\t\t\t\tif ($('#alert_message tr:first td').length > 1) {\r\n\t\t\t\t\t\t$('#alert_message table tr td:last-of-type').remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, false);\r\n\r\n\t\t\t\tvar $buttonContainer = $('#alert_message .buttonContainer');\r\n\t\t\t\t$buttonContainer.append(addRow);\r\n\t\t\t\t$buttonContainer.append(remRow);\r\n\t\t\t\t$buttonContainer.append(addCol);\r\n\t\t\t\t$buttonContainer.append(remCol);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tif (module.options.showInputLength.value) {\r\n\t\t\tvar counter = $('<span class=\"RESCharCounter\" title=\"character limit: 0/?????\">0/?????</span>');\r\n\t\t\teditBar.prepend(counter); // prepend for more reliable css floating.\r\n\t\t\t$('.submit-page #title-field .title').prepend($('<span class=\"RESCharCounter\" title=\"character limit: 0/300\">0/300</span>'));\r\n\t\t}\r\n\r\n\t\tif (module.options.macroButtons.value) {\r\n\t\t\tbuildMacroDropdowns(wrappedEditBar);\r\n\r\n\t\t\tvar addMacroButton = makeEditButton(module.options.macros.addRowText, null, null, 'btn-macro btn-macro-add', function() {\r\n\t\t\t\tmodules['settingsNavigation'].loadSettingsPage(moduleID, 'macros');\r\n\t\t\t\t$('.RESMacroWrappingSpan span').removeClass('openMacro');\r\n\t\t\t});\r\n\t\t\taddButtonToMacroGroup('', addMacroButton);\r\n\t\t}\r\n\r\n\t\tcachedEditBar = wrappedEditBar;\r\n\t\treturn cachedEditBar;\r\n\t};\r\n\r\n\tvar macroDropDownTable = {};\r\n\r\n\tfunction getMacroGroup(groupName) {\r\n\t\t// Normalize and supply a default group name{}\r\n\t\tgroupName = (groupName || '').toString().trim() || 'macros';\r\n\t\tvar macroGroup;\r\n\t\tif (groupName in macroDropDownTable) {\r\n\t\t\tmacroGroup = macroDropDownTable[groupName];\r\n\t\t} else {\r\n\t\t\tmacroGroup = macroDropDownTable[groupName] = {};\r\n\t\t\tmacroGroup.titleButton = $('<span class=\"RESMacroDropdownTitle\">' + groupName + '</span>');\r\n\t\t\tmacroGroup.container = $('<span class=\"RESMacroDropdown\"></span>');\r\n\t\t\tmacroGroup.dropdown = $('<ul class=\"RESMacroDropdownList\"></ul>');\r\n\t\t\tmacroGroup.container.append(macroGroup.dropdown);\r\n\t\t}\r\n\t\treturn macroGroup;\r\n\t}\r\n\r\n\tfunction addButtonToMacroGroup(groupName, button) {\r\n\t\tvar group = getMacroGroup(groupName);\r\n\t\tgroup.dropdown.append($('<li>').append(button));\r\n\t}\r\n\r\n\tfunction buildMacroDropdowns(editBar) {\r\n\t\tvar macros = module.options.macros.value;\r\n\r\n\t\tfor (var i = 0; i < macros.length; i++) {\r\n\t\t\tvar macro = macros[i];\r\n\r\n\t\t\t// Confound these scoping rules\r\n\t\t\t(function(title, text, category, key) {\r\n\t\t\t\tvar button = makeEditButton(title, null, key, 'btn-macro', function(button, box) {\r\n\t\t\t\t\tmacroSelection(box, text, '');\r\n\t\t\t\t});\r\n\t\t\t\taddButtonToMacroGroup(category, button);\r\n\t\t\t}).apply(this, macro);\r\n\t\t}\r\n\r\n\t\tvar macroWrapper = $('<span class=\"RESMacroWrappingSpan\">');\r\n\r\n\t\tvar defaultGroup = getMacroGroup('');\r\n\t\tmacroWrapper.append(defaultGroup.titleButton);\r\n\t\tmacroWrapper.append(defaultGroup.container);\r\n\r\n\t\tfor (var category in macroDropDownTable) {\r\n\t\t\tif (category === 'macros') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tmacroWrapper.append(macroDropDownTable[category].titleButton);\r\n\t\t\tmacroWrapper.append(macroDropDownTable[category].container);\r\n\t\t}\r\n\t\teditBar.append(macroWrapper);\r\n\t}\r\n\r\n\tfunction makeEditButton(label, title, key, cls, handler) {\r\n\t\tif (label === null) {\r\n\t\t\tlabel = 'unlabeled';\r\n\t\t}\r\n\t\tif (title === null) {\r\n\t\t\ttitle = '';\r\n\t\t}\r\n\t\tvar macroButtonIndex = macroCallbackTable.length;\r\n\t\tvar button = $('<a>').html(RESUtils.sanitizeHTML(label)).attr({\r\n\t\t\tclass: 'edit-btn '+cls,\r\n\t\t\ttitle: title,\r\n\t\t\thref: '#',\r\n\t\t\ttabindex: 1,\r\n\t\t\t'data-macro-index': macroButtonIndex\r\n\t\t});\r\n\r\n\t\tif (key && key[0] !== null) {\r\n\t\t\tmacroKeyTable.push([key, macroButtonIndex]);\r\n\t\t}\r\n\t\tmacroCallbackTable[macroButtonIndex] = handler;\r\n\t\treturn button;\r\n\t}\r\n\r\n\tfunction linkSelection(box) {\r\n\t\tvar url = prompt('Enter the URL:', '');\r\n\t\tif (url !== null) {\r\n\t\t\t//escape parens in url\r\n\t\t\turl = url.replace(/[\\(\\)]/g, '\\\\$&');\r\n\t\t\twrapSelection(box, '[', '](' + url + ')', function(text) {\r\n\t\t\t\t//escape brackets and parens in text\r\n\t\t\t\ttext = text.replace(/[\\[\\]\\(\\)]/g, '\\\\$&');\r\n\t\t\t\treturn text;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction macroSelection(box, macroText) {\r\n\t\tif (!module.options.keepMacroListOpen.value) {\r\n\t\t\t$('.RESMacroWrappingSpan span').removeClass('openMacro');\r\n\t\t}\r\n\t\tif (module.options['macroPlaceholders'].value) {\r\n\t\t\tvar formatText = fillPlaceholders.bind(this, box, macroText);\r\n\t\t\twrapSelection(box, '', '', formatText);\r\n\t\t} else {\r\n\t\t\twrapSelection(box, macroText, '');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction fillPlaceholders(box, macroText, selectedText) {\r\n\t\tvar placeholders = macroText.match(/\\{\\{\\w+\\}\\}/g);\r\n\r\n\t\tif (placeholders) {\r\n\t\t\tvar completedPlaceholders = {};\r\n\r\n\t\t\tfor (var i = 0; i < placeholders.length; i++) {\r\n\t\t\t\tvar placeholder = placeholders[i];\r\n\t\t\t\tif (completedPlaceholders.hasOwnProperty(placeholder)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tcompletedPlaceholders[placeholder] = true;\r\n\r\n\t\t\t\tvar placeholderInnerText = placeholder.substring(2, placeholder.length - 2).toLowerCase();\r\n\t\t\t\tvar value = getMagicPlaceholderValue(placeholderInnerText, macroText, selectedText, box);\r\n\t\t\t\tif (value === undefined) {\r\n\t\t\t\t\tvalue = promptForPlaceholderValue(placeholder, macroText);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value === null) {\r\n\t\t\t\t\t// user cancelled\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Replace placeholder with value\r\n\t\t\t\tmacroText = macroText.replace(new RegExp(placeholder, 'g'), value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn macroText;\r\n\t}\r\n\r\n\tfunction getMagicPlaceholderValue(placeholder, macroText, selectedText, box) {\r\n\t\tvar handler = magicPlaceholders.find(function(current) {\r\n\t\t\treturn current.matches.indexOf(placeholder) !== -1;\r\n\t\t});\r\n\r\n\t\tif (handler) {\r\n\t\t\treturn handler.handle(macroText, selectedText, box);\r\n\t\t}\r\n\t}\r\n\r\n\tvar magicPlaceholders = [\r\n\t\t{\r\n\t\t\tmatches: [ 'subreddit' ],\r\n\t\t\tdescription: 'The current subreddit, in the form /r/subreddit',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar subredditName = RESUtils.subredditForElement(box);\r\n\r\n\t\t\t\tif (!subredditName) {\r\n\t\t\t\t\tsubredditName = RESUtils.currentSubreddit();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (subredditName) {\r\n\t\t\t\t\tvar subreddit = '/r/' + subredditName;\r\n\t\t\t\t\treturn subreddit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'me', 'my_username' ],\r\n\t\t\tdescription: 'Your username, in the form /u/username',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar username = RESUtils.loggedInUser();\r\n\t\t\t\tif (username) {\r\n\t\t\t\t\tusername = '/u/' + username;\r\n\t\t\t\t\treturn username;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'op', 'op_username' ],\r\n\t\t\tdescription: 'The username of the \"original poster\", in the form /u/username. On a post\\'s comments page, this the person who made the post; on a PM / modmail, this is the person who started the conversation',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar profile;\r\n\t\t\t\tif (RESUtils.pageType() === 'comments') {\r\n\t\t\t\t\tprofile = document.querySelector('.sitetable .author');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar furthest;\r\n\t\t\t\t\tvar next = $(box);\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (next && next.length) furthest = next;\r\n\t\t\t\t\t\tnext = next.parent().closest('.sitetable');\r\n\t\t\t\t\t} while (next.length);\r\n\r\n\t\t\t\t\tprofile = furthest.find('.author')[0];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (profile) {\r\n\t\t\t\t\treturn '/u/' + profile.href.match(RESUtils.regexes.profile)[1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'url' ],\r\n\t\t\tdescription: 'The current page\\'s URL, like http://www.reddit.com/r/Enhancement/comments/123abc/example_post',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\treturn document.location.href;\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'reply_to', 'reply_to_username' ],\r\n\t\t\tdescription: 'The username of person you\\'re replying to, in the form /u/username. ',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar $base = $(box);\r\n\t\t\t\tvar isEditing = $base.closest('.thing, .entry').hasClass('entry');\r\n\r\n\t\t\t\tif (isEditing) {\r\n\t\t\t\t\t$base = $base.closest('.thing').parent();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar profile = $base.closest('.thing').find('.entry .author')[0];\r\n\r\n\t\t\t\tif (!profile) {\r\n\t\t\t\t\treturn getMagicPlaceholderValue('op', macroText, selectedText, box);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn '/u/' + profile.href.match(RESUtils.regexes.profile)[1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'selected', 'selection' ],\r\n\t\t\tdescription: 'The text which is currently selected (highlighted)',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\treturn selectedText;\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'now' ],\r\n\t\t\tdescription: 'The current date and time in your locale',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar date = new Date();\r\n\t\t\t\treturn date.toTimeString();\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'today' ],\r\n\t\t\tdescription: 'The current date in your locale',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar date = new Date();\r\n\t\t\t\treturn date.toDateString();\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tmatches: [ 'escaped' ],\r\n\t\t\tdescription: 'The selected text, escaped for snudown/markdown. Useful for text emoji like ¯\\\\_(ツ)_/¯',\r\n\t\t\thandle: function(macroText, selectedText, box) {\r\n\t\t\t\tvar escaped = selectedText.replace(/[\\[\\]()\\\\\\*\\^~\\-_.]/g, '\\\\$&');\r\n\t\t\t\treturn escaped;\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\r\n\tfunction promptForPlaceholderValue(placeholder, macroText) {\r\n\t\t// Get value for placeholder\r\n\t\tvar display = macroText + '\\n\\n\\n' +\r\n\t\t\t'Enter replacement for ' + placeholder + ':';\r\n\t\tvar value = placeholder;\r\n\t\tvalue = prompt(display, value);\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tfunction wrapSelection(box, prefix, suffix, escapeFunction) {\r\n\t\tif (box === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//record scroll top to restore it later.\r\n\t\tvar scrollTop = box.scrollTop;\r\n\r\n\t\t//We will restore the selection later, so record the current selection.\r\n\t\tvar selectionStart = box.selectionStart;\r\n\t\tvar selectionEnd = box.selectionEnd;\r\n\r\n\t\tvar text = box.value;\r\n\t\tvar beforeSelection = text.substring(0, selectionStart);\r\n\t\tvar selectedText = text.substring(selectionStart, selectionEnd);\r\n\t\tvar afterSelection = text.substring(selectionEnd);\r\n\r\n\t\t//Markdown doesn't like it when you tag a word like **this **. The space messes it up. So we'll account for that because Firefox selects the word, and the followign space when you double click a word.\r\n\t\tvar trailingSpace = '';\r\n\t\tvar cursor = selectedText.length - 1;\r\n\t\twhile (cursor > 0 && selectedText[cursor] === ' ') {\r\n\t\t\ttrailingSpace += ' ';\r\n\t\t\tcursor--;\r\n\t\t}\r\n\t\tselectedText = selectedText.substring(0, cursor + 1);\r\n\r\n\t\tif (typeof escapeFunction === 'function') {\r\n\t\t\tselectedText = escapeFunction(selectedText);\r\n\t\t}\r\n\r\n\t\tbox.value = beforeSelection + prefix + selectedText + suffix + trailingSpace + afterSelection;\r\n\r\n\t\tbox.selectionEnd = beforeSelection.length + prefix.length + selectedText.length;\r\n\t\tif (selectionStart === selectionEnd) {\r\n\t\t\tbox.selectionStart = box.selectionEnd;\r\n\t\t} else {\r\n\t\t\tbox.selectionStart = beforeSelection.length + prefix.length;\r\n\t\t}\r\n\r\n\t\tbox.scrollTop = scrollTop;\r\n\t}\r\n\r\n\tfunction replaceSelection(box, replacement) {\r\n\t\tif (box === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//record scroll top to restore it later.\r\n\t\tvar scrollTop = box.scrollTop;\r\n\r\n\t\t//We will restore the selection later, so record the current selection.\r\n\t\tvar selectionStart = box.selectionStart;\r\n\t\tvar selectionEnd = box.selectionEnd;\r\n\r\n\t\tvar text = box.value;\r\n\t\tvar beforeSelection = text.substring(0, selectionStart);\r\n\t\tvar afterSelection = text.substring(selectionEnd);\r\n\r\n\r\n\t\tbox.value = beforeSelection + replacement + afterSelection;\r\n\r\n\t\tbox.selectionEnd = beforeSelection.length + replacement.length;\r\n\r\n\t\tbox.scrollTop = scrollTop;\r\n\t}\r\n\r\n\tfunction wrapSelectedLines(box, prefix, suffix) {\r\n\t\tvar scrollTop = box.scrollTop;\r\n\t\tvar selectionStart = box.selectionStart;\r\n\t\tvar selectionEnd = box.selectionEnd;\r\n\r\n\t\tvar text = box.value;\r\n\t\tvar startPosition = 0;\r\n\t\tvar lines = text.split('\\n');\r\n\t\tfor (var i = 0; i < lines.length; i++) {\r\n\t\t\tvar lineStart = startPosition;\r\n\t\t\tvar lineEnd = lineStart + lines[i].length;\r\n\t\t\t//Check if either end of the line is within the selection\r\n\t\t\tif (selectionStart <= lineStart && lineStart <= selectionEnd || selectionStart <= lineEnd && lineEnd <= selectionEnd ||\r\n\t\t\t\t\t// Check if either end of the selection is within the line\r\n\t\t\t\t\tlineStart <= selectionStart && selectionStart <= lineEnd || lineStart <= selectionEnd && selectionEnd <= lineEnd) {\r\n\t\t\t\tlines[i] = prefix + lines[i] + suffix;\r\n\t\t\t\t//Move the offsets separately so we don't throw off detection for the other end\r\n\t\t\t\tvar startMovement = 0,\r\n\t\t\t\t\tendMovement = 0;\r\n\t\t\t\tif (lineStart < selectionStart) {\r\n\t\t\t\t\tstartMovement += prefix.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (lineEnd < selectionStart) {\r\n\t\t\t\t\tstartMovement += suffix.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (lineStart < selectionEnd) {\r\n\t\t\t\t\tendMovement += prefix.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (lineEnd < selectionEnd) {\r\n\t\t\t\t\tendMovement += suffix.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselectionStart += startMovement;\r\n\t\t\t\tselectionEnd += endMovement;\r\n\t\t\t\tlineStart += prefix.length;\r\n\t\t\t\tlineEnd += prefix.length + suffix.length;\r\n\t\t\t}\r\n\t\t\t//Remember the newline\r\n\t\t\tstartPosition = lineEnd + 1;\r\n\t\t}\r\n\r\n\t\tbox.value = lines.join('\\n');\r\n\t\tbox.selectionStart = selectionStart;\r\n\t\tbox.selectionEnd = selectionEnd;\r\n\t\tbox.scrollTop = scrollTop;\r\n\t}\r\n\r\n\tfunction wrapSelectedWords(box, prefix) {\r\n\t\tvar scrollTop = box.scrollTop;\r\n\t\tvar selectionStart = box.selectionStart;\r\n\t\tvar selectionEnd = box.selectionEnd;\r\n\r\n\t\tvar text = box.value;\r\n\t\tvar beforeSelection = text.substring(0, selectionStart);\r\n\t\tvar selectedWords = text.substring(selectionStart, selectionEnd).split(' ');\r\n\t\tvar afterSelection = text.substring(selectionEnd);\r\n\r\n\t\tvar selectionModify = 0;\r\n\r\n\t\tfor (var i = 0; i < selectedWords.length; i++) {\r\n\t\t\tif (selectedWords[i] !== '') {\r\n\t\t\t\tif (selectedWords[i].indexOf('\\n') !== -1) {\r\n\t\t\t\t\tvar newLinePosition = selectedWords[i].lastIndexOf('\\n') + 1;\r\n\t\t\t\t\tselectedWords[i] = selectedWords[i].substring(0, newLinePosition) + prefix + selectedWords[i].substring(newLinePosition);\r\n\t\t\t\t\tselectionModify += prefix.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (selectedWords[i].charAt(0) !== '\\n') {\r\n\t\t\t\t\tselectedWords[i] = prefix + selectedWords[i];\r\n\t\t\t\t}\r\n\t\t\t\tselectionModify += prefix.length;\r\n\t\t\t} else if (selectedWords[i] === '' && selectedWords.length === 1) {\r\n\t\t\t\t// If nothing is selected, stick the prefix in there and move the cursor to the right side.\r\n\t\t\t\tselectedWords[i] = prefix + selectedWords[i];\r\n\t\t\t\tselectionModify += prefix.length;\r\n\t\t\t\tselectionStart += prefix.length;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbox.value = beforeSelection + selectedWords.join(' ') + afterSelection;\r\n\t\tbox.selectionStart = selectionStart;\r\n\t\tbox.selectionEnd = selectionEnd + selectionModify;\r\n\t\tbox.scrollTop = scrollTop;\r\n\t}\r\n\r\n\t// Unused, kept for posterity (?)\r\n\t/*var firstlod;\r\n\tfunction lod() {\r\n\t\tif (!firstlod) {\r\n\t\t\tfirstlod = true;\r\n\t\t\t$('body').append('<div id=\"RESlod\" style=\"display: none; position: fixed; left: 0; top: 0; right: 0; bottom: 0; background-color: #ddd; opacity: 0.9; z-index: 99999;\"><div style=\"position: relative; text-align: center; width: 400px; height: 300px; margin: auto;\"><div style=\"font-size: 100px; margin-bottom: 10px;\">&#3232;_&#3232;</div> when you do this, people direct their frustrations at <b>me</b>... could we please maybe give this a rest?</div></div>');\r\n\t\t}\r\n\t\t$('#RESlod').fadeIn('slow', function() {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\t$('#RESlod').fadeOut('slow');\r\n\t\t\t}, 5000);\r\n\t\t});\r\n\t}*/\r\n\r\n\tmodule.KEYS = {\r\n\t\tBACKSPACE: 8,\r\n\t\tTAB: 9,\r\n\t\tENTER: 13,\r\n\t\tESCAPE: 27,\r\n\t\tSPACE: 32,\r\n\t\tPAGE_UP: 33,\r\n\t\tPAGE_DOWN: 34,\r\n\t\tEND: 35,\r\n\t\tHOME: 36,\r\n\t\tLEFT: 37,\r\n\t\tUP: 38,\r\n\t\tRIGHT: 39,\r\n\t\tDOWN: 40,\r\n\t\tNUMPAD_ENTER: 108,\r\n\t\tCOMMA: 188\r\n\t};\r\n\r\n\tvar autoCompleteCache = {};\r\n\tvar autoCompletePop;\r\n\r\n\tfunction addAutoCompletePop() {\r\n\t\tautoCompletePop = $('<div id=\"autocomplete_dropdown\" \\\r\n\t\t\tclass=\"drop-choices srdrop inuse\" \\\r\n\t\t\tstyle=\"display:none;\">');\r\n\t\tautoCompletePop.on('click mousedown', '.choice', function() {\r\n\t\t\tautoCompleteHideDropdown();\r\n\t\t\tautoCompleteInsert(this.innerHTML);\r\n\t\t});\r\n\t\t$('body').append(autoCompletePop);\r\n\r\n\t\t$('body').on({\r\n\t\t\tkeyup: autoCompleteTrigger,\r\n\t\t\tkeydown: autoCompleteNavigate,\r\n\t\t\tblur: autoCompleteHideDropdown\r\n\t\t}, '.usertext .usertext-edit textarea, #BigText, #wiki_page_content');\r\n\t}\r\n\r\n\tvar autoCompleteLastTarget;\r\n\r\n\tfunction autoCompleteTrigger(e) {\r\n\t\tvar KEYS = module.KEYS;\r\n\t\t//\\0x08 is backspace\r\n\t\tif (/[^A-Za-z0-9 \\x08]/.test(String.fromCharCode(e.keyCode))) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tautoCompleteLastTarget = this;\r\n\t\tvar matchRE = /\\W\\/?([ru])\\/([\\w\\.]*)$/;\r\n\t\tvar matchSkipRE = /\\W\\/?([ru])\\/([\\w\\.]*)\\ $/;\r\n\t\tvar fullText = $(this).val();\r\n\t\tvar prefixText = fullText.slice(0, this.selectionStart);\r\n\t\tvar match = matchRE.exec(' ' + prefixText);\r\n\t\tif (match !== null) {\r\n\t\t\tif (match[1] === 'r' && !module.options.subredditAutocomplete.value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (match[1] === 'u' && !module.options.userAutocomplete.value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (match === null || match[2] === '' || match[2].length > 10) {\r\n\t\t\tif (e.keyCode === KEYS.SPACE || e.keyCode === KEYS.ENTER) {\r\n\t\t\t\tmatch = matchSkipRE.exec(' ' + prefixText);\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\tautoCompleteInsert(match[2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn autoCompleteHideDropdown();\r\n\t\t}\r\n\r\n\t\tvar type = match[1];\r\n\t\tvar query = match[2].toLowerCase();\r\n\t\tvar queryId = type + '/' + query;\r\n\t\tvar cache = autoCompleteCache;\r\n\t\tif (queryId in cache) {\r\n\t\t\treturn autoCompleteUpdateDropdown(cache[queryId]);\r\n\t\t}\r\n\r\n\t\tRESUtils.debounce('autoComplete', 300, function() {\r\n\t\t\tif (type === 'r') {\r\n\t\t\t\tgetSubredditCompletions(query);\r\n\t\t\t} else if (type === 'u') {\r\n\t\t\t\tgetUserCompletions(query);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction getSubredditCompletions(query) {\r\n\t\tif (module.options.subredditAutocomplete.value) {\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\turl: '/api/search_reddit_names.json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tquery: query,\r\n\t\t\t\t\tapp: 'res'\r\n\t\t\t\t},\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tsuccess: function(data) {\r\n\t\t\t\t\tautoCompleteCache['r/' + query] = data.names;\r\n\t\t\t\t\tautoCompleteUpdateDropdown(data.names);\r\n\t\t\t\t\tautoCompleteSetNavIndex(0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getUserCompletions(query) {\r\n\t\tif (module.options.userAutocomplete.value) {\r\n\t\t\tvar tags = JSON.parse(RESStorage.getItem('RESmodules.userTagger.tags'));\r\n\t\t\tvar tagNames = Object.keys(tags);\r\n\t\t\tvar pageNames = Array.prototype.map.call($('.author'), function(e) {\r\n\t\t\t\treturn e.textContent;\r\n\t\t\t});\r\n\t\t\tvar names = tagNames.concat(pageNames);\r\n\t\t\tnames = names.filter(function(e, i, a) {\r\n\t\t\t\treturn e.toLowerCase().indexOf(query) === 0;\r\n\t\t\t}).sort().reduce(function(prev, current, i, a) {\r\n\t\t\t\t//Removing duplicates\r\n\t\t\t\tif (prev[prev.length - 1] != current) {\r\n\t\t\t\t\tprev.push(current);\r\n\t\t\t\t}\r\n\t\t\t\treturn prev;\r\n\t\t\t}, []);\r\n\r\n\t\t\tautoCompleteCache['u/' + query] = names;\r\n\t\t\tautoCompleteUpdateDropdown(names);\r\n\t\t\tautoCompleteSetNavIndex(0);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction autoCompleteNavigate(e) {\r\n\t\t//Don't mess with shortcuts for fancier cursor movement\r\n\t\tif (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) return;\r\n\t\tvar KEYS = module.KEYS;\r\n\t\tvar entries = autoCompletePop.find('a.choice');\r\n\t\tvar index = +autoCompletePop.find('.selectedItem').data('index');\r\n\t\tif (autoCompletePop.is(':visible')) {\r\n\t\t\tswitch (e.keyCode) {\r\n\t\t\t\tcase KEYS.DOWN:\r\n\t\t\t\tcase KEYS.RIGHT:\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tif (index < entries.length - 1) index++;\r\n\t\t\t\t\tautoCompleteSetNavIndex(index);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KEYS.UP:\r\n\t\t\t\tcase KEYS.LEFT:\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tif (index > 0) index--;\r\n\t\t\t\t\tautoCompleteSetNavIndex(index);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KEYS.TAB:\r\n\t\t\t\tcase KEYS.ENTER:\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$(entries[index]).click();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KEYS.ESCAPE:\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tautoCompleteHideDropdown();\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction autoCompleteSetNavIndex(index) {\r\n\t\tvar entries = autoCompletePop.find('a.choice');\r\n\t\tentries.removeClass('selectedItem');\r\n\t\tentries.eq(index).addClass('selectedItem');\r\n\t}\r\n\r\n\tfunction autoCompleteHideDropdown() {\r\n\t\tautoCompletePop.hide();\r\n\t}\r\n\r\n\tfunction autoCompleteUpdateDropdown(names) {\r\n\t\tif (!names.length) return autoCompleteHideDropdown();\r\n\t\tautoCompletePop.empty();\r\n\t\t$.each(names.slice(0, 20), function(i, e) {\r\n\t\t\tautoCompletePop.append('<a class=\"choice\" data-index=\"' + i + '\">' + e + '</a>');\r\n\t\t});\r\n\r\n\t\tvar textareaOffset = $(autoCompleteLastTarget).offset();\r\n\t\ttextareaOffset.left += $(autoCompleteLastTarget).width();\r\n\t\tautoCompletePop.css(textareaOffset).show();\r\n\r\n\t\tautoCompleteSetNavIndex(0);\r\n\r\n\t}\r\n\r\n\tfunction autoCompleteInsert(inputValue) {\r\n\t\tvar textarea = autoCompleteLastTarget,\r\n\t\t\tcaretPos = textarea.selectionStart,\r\n\t\t\tleft = textarea.value.substr(0, caretPos),\r\n\t\t\tright = textarea.value.substr(caretPos);\r\n\t\tleft = left.replace(/\\/?([ru])\\/(\\w*)\\ ?$/, '/$1/' + inputValue + ' ');\r\n\t\ttextarea.value = left + right;\r\n\t\ttextarea.selectionStart = textarea.selectionEnd = left.length;\r\n\t\ttextarea.focus();\r\n\t}\r\n\r\n\tfunction findTextareaForElement(elem) {\r\n\t\treturn $(elem)\r\n\t\t\t.closest('.usertext-edit, .RESDialogContents, .wiki-page-content, .ban-details')\r\n\t\t\t.find('textarea')\r\n\t\t\t.filter('#BigText, [name=text], [name=description], [name=public_description], #wiki_page_content, #ban_message')\r\n\t\t\t.first();\r\n\t}\r\n\r\n\tmodule.onCtrlEnter = function(selector, handler) {\r\n\t\t$(document.body).on('keydown', selector, function(e) {\r\n\t\t\tif (e.keyCode === module.KEYS.ENTER && (e.ctrlKey || e.metaKey)) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\thandler(e);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tmodule.generateBanMessage = function(message, subreddit, title) {\r\n\t\tif (!message) {\r\n\t\t\tmessage = '';\r\n\t\t}\r\n\r\n\t\tif (!title) {\r\n\t\t\ttitle = '/r/' + subreddit;\r\n\t\t}\r\n\r\n\t\treturn ['you have been banned from posting to [/r/' + subreddit + ': ' + title + '](/r/' + subreddit + ').',\r\n\t\t\t\t'',\r\n\t\t\t\t'note from the moderators:',\r\n\t\t\t\t'',\r\n\t\t\t\t'\"' + message + '\"'].join('\\r\\n');\r\n\t};\r\n\r\n\tfunction fetchTitle() {\r\n\t\tRESEnvironment.ajax({\r\n\t\t\tmethod: 'GET',\r\n\t\t\turl: location.protocol + '//' + location.hostname + '/r/' + module.curSubreddit + '/about.json?app=res',\r\n\t\t\tonload: function(response) {\r\n\t\t\t\tvar thisResponse;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthisResponse = JSON.parse(response.responseText);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (thisResponse.data && thisResponse.data.submission_type) {\r\n\t\t\t\t\tmodule.curSubredditTitle = thisResponse.data.title;\r\n\t\t\t\t\tSUBMIT_LIMITS.BAN_MESSAGE = 10000 - module.generateBanMessage(null, module.curSubreddit, module.curSubredditTitle).length;\r\n\r\n\t\t\t\t\t$('textarea[name=ban_message]').each(function() {\r\n\t\t\t\t\t\tthis.setAttribute('data-limit', SUBMIT_LIMITS.BAN_MESSAGE);\r\n\t\t\t\t\t\tmodule.updateCounter(this);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}